<!-- HTML header for doxygen 1.8.12-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.20"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>YARP: Thrift IDL in YARP: simple tutorial</title>
<link rel="shortcut icon" href="yarp-favicon.ico" type="image/x-icon" />
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript">
    var DOCUMENTATION_OPTIONS = { VERSION: '3.3.3' };
</script>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(function() { init_search(); });
/* @license-end */
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="yarp-doxygen-style.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../version_switch.js"></script>
<link rel="stylesheet" type="text/css" href="cookieconsent.min.css" />
<script src="cookieconsent.min.js"></script>
<script>
window.addEventListener("load", function(){
window.cookieconsent.initialise({
  "palette": {
    "popup": {
      "background": "#eb6c44",
      "text": "#ffffff"
    },
    "button": {
      "background": "#237afc",
    }
  },
  "theme": "classic",
  "content": {
    "message": "INFORMATION NOTICE ON COOKIES : This website uses only browsing/session cookies. Users can choose whether or not to accept the use of cookies and access the website. By clicking on \"Further information\", the full information notice on the types of cookies will be displayed and you will be able  to choose whether or not to accept them whilst browsing on the website.",
    "dismiss": "ACCEPT and close",
    "link": "Further information",
    "href": "http://www.icub.org/other/personal_data_notice.html"
  }
})});
</script>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="yarp-robot-64.png"/></td>
  <td id="projectalign" style="padding-left: 1.5em;">
   <div id="projectname">YARP</div>
   <div id="projectbrief">Yet Another Robot Platform</div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.svg"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.svg" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.20 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('thrift_tutorial_simple.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Thrift IDL in YARP: simple tutorial </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>This tutorial shows how to use the Apache Thrift Interface Definition Language (and relative compiler) to easily define RPC-based interfaces for YARP Modules.</p>
<h1><a class="anchor" id="thrift_tutorial_simple_intro"></a>
Introduction</h1>
<p>Apache Thrift allows to define service interfaces in a simple definition file. Taking that file as input, a compiler generates source code which handles the RPC communication for commands and replies defined in the interface. This source code can therefore be used by a server that executes the commands and by clients that send requests to the server by means of simple function calls.</p>
<h1><a class="anchor" id="thrift_tutorial_simple_thriftfile"></a>
Step One: Interface Definition</h1>
<p>Let's assume that we want to create a new module that can receive commands on a RPC port to start/stop execution, and get/set some value. We can create a <code>.thrift</code> text file that defines a <em>Thrift</em> <em>service</em> interface for our module like this:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#demo.thrift</span></div>
<div class="line">service Demo {</div>
<div class="line">  i32 get_answer();</div>
<div class="line">  <span class="keywordtype">bool</span> set_answer(1:i32 rightAnswer)</div>
<div class="line">  i32 add_one(1:i32 x);</div>
<div class="line">  <span class="keywordtype">bool</span> start();</div>
<div class="line">  <span class="keywordtype">bool</span> stop();</div>
<div class="line">  <span class="keywordtype">bool</span> is_running();</div>
<div class="line">}</div>
</div><!-- fragment --><p>where <code>i32</code> is defined by the Thrift type system as a 32-bit signed integer, and <code>bool</code> is a boolean value (true or false), one byte. Note that each argument of a function is associated to a unique, positive integer identifier. For a complete explanation of the Thrift IDL, please see <a class="el" href="thrift_tutorial.html">Thrift IDL in YARP: advanced tutorial</a>.</p>
<h1><a class="anchor" id="sec_generation"></a>
Step Two: Source code generation</h1>
<p>Now that we have our nice and clear interface definition, we want to generate the source code that provides this interface in YARPic terms, and implements the RPC communication process that occurs between a client that invokes a function call and the server that exectutes it.</p>
<p>Using CMake, generation of code for our demo.thrift file can be performed automatically during the configuration process. We create a <code>CMakeLists.txt</code> configuration file in which we call the <code>yarp_idl_to_dir</code> macro:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#CMakeList.txt</span></div>
<div class="line">cmake_minimum_required(VERSION 3.12)</div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#find YARP</span></div>
<div class="line">find_package(YARP REQUIRED)</div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#compile definition file to generate source code into the desired directory</span></div>
<div class="line">set(generated_libs_dir <span class="stringliteral">&quot;${CMAKE_CURRENT_SOURCE_DIR}&quot;</span>)</div>
<div class="line">yarp_idl_to_dir(INPUT_FILES demo.thrift</div>
<div class="line">                OUTPUT_DIR ${generated_libs_dir}</div>
<div class="line">                SOURCES_VAR sources</div>
<div class="line">                HEADERS_VAR headers</div>
<div class="line">                INCLUDE_DIRS_VAR include_dirs)</div>
<div class="line"><span class="preprocessor"># generated source files now listed in ${sources}</span></div>
<div class="line"><span class="preprocessor"># generated header files now listed in ${headers}</span></div>
<div class="line"><span class="preprocessor"># paths to include now listed in ${include_dirs}</span></div>
</div><!-- fragment --><p>We can now run CMake to set up an out-of-source tree build from command line: </p><div class="fragment"><div class="line">$ cd &lt;where_we_put_demo.thrift_and_CMakeLists.txt&gt;</div>
<div class="line">$ <a class="code" href="namespaceyarp_1_1os.html#a1317b150b2bd76460f6a11d7675c423b">mkdir</a> build &amp;&amp; cd build</div>
<div class="line">$ cmake -D ALLOW_IDL_GENERATION=ON ../</div>
</div><!-- fragment --><p>The YarpIDL macro defines a CMake "advanced" option, ALLOW_IDL_GENERATION, which is by default set to OFF if generated code is already present in the desired directory; we enable it with the -D ALLOW_IDL_GENERATION=ON option. We should now see two folders, "include" and "src", appear in the source tree, together with a demo_thrift.cmake file that helps CMake keep track of the generated files. Inside <code>include</code>, we find a <code>Demo.h</code> header file, which provides the interface: </p><div class="fragment"><div class="line"><span class="keyword">class </span>Demo : <span class="keyword">public</span> <a class="code" href="classyarp_1_1os_1_1Wire.html">yarp::os::Wire</a> {</div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">  Demo() { <a class="code" href="classyarp_1_1os_1_1Wire.html#aa31a0bd22799f4137fbfba3a50f9f50b">yarp</a>().<a class="code" href="classyarp_1_1os_1_1WireLink.html#a688428d46ab502e47b1851a51c05f964">setOwner</a>(*<span class="keyword">this</span>); }</div>
<div class="line">  <span class="keyword">virtual</span> int32_t get_answer();</div>
<div class="line">  <span class="keyword">virtual</span> <span class="keywordtype">bool</span> set_answer(<span class="keyword">const</span> int32_t rightAnswer);</div>
<div class="line">  <span class="keyword">virtual</span> int32_t add_one(<span class="keyword">const</span> int32_t x);</div>
<div class="line">  <span class="keyword">virtual</span> <span class="keywordtype">bool</span> start();</div>
<div class="line">  <span class="keyword">virtual</span> <span class="keywordtype">bool</span> stop();</div>
<div class="line">  <span class="keyword">virtual</span> <span class="keywordtype">bool</span> is_running();</div>
<div class="line">  <span class="keyword">virtual</span> <span class="keywordtype">bool</span> <a class="code" href="classyarp_1_1os_1_1PortReader.html#a10c08e5812f43e208fae5843137afa1d">read</a>(<a class="code" href="classyarp_1_1os_1_1ConnectionReader.html">yarp::os::ConnectionReader</a>&amp; connection);</div>
<div class="line">};</div>
</div><!-- fragment --><p> <code>src</code> instead contains a <code>Demo.cpp</code> file that provides implementation for the RPC communication, but there's no need to bother with it: all we need to care about is the interface!</p>
<h1><a class="anchor" id="thrift_tutorial_simple_server"></a>
Step Three: Interface Implementation</h1>
<p>It is now time to provide an implementation for the functions we defined in the service interface. Let's create a <code>DemoServer.cpp</code> file in which: </p><ul>
<li>we include the interface definition <div class="fragment"><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="libYARP__os_2src_2yarp_2os_2all_8h.html">yarp/os/all.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;Demo.h&gt;</span></div>
</div><!-- fragment --> </li>
<li>we declare a derived class that overrides the methods of the interface: <div class="fragment"><div class="line"><span class="keyword">class </span>DemoServer : <span class="keyword">public</span> Demo</div>
<div class="line">{</div>
<div class="line">  <span class="comment">// Class members declaration</span></div>
<div class="line">  int32_t answer;</div>
<div class="line">  <span class="keywordtype">bool</span> isRunning;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">  DemoServer();</div>
<div class="line">  <span class="comment">// function declarations, copied from Demo.h</span></div>
<div class="line">  int32_t get_answer() <span class="keyword">override</span>;</div>
<div class="line">  <span class="keywordtype">bool</span> set_answer(int32_t rightAnswer) <span class="keyword">override</span>;</div>
<div class="line">  int32_t add_one(<span class="keyword">const</span> int32_t x) <span class="keyword">override</span>;</div>
<div class="line">  <span class="keywordtype">bool</span> start() <span class="keyword">override</span>;</div>
<div class="line">  <span class="keywordtype">bool</span> stop() <span class="keyword">override</span>;</div>
<div class="line">  <span class="keywordtype">bool</span> is_running() <span class="keyword">override</span>;</div>
<div class="line">};</div>
</div><!-- fragment --></li>
</ul>
<ul>
<li>we provide an implementation for these methods, for example: <div class="fragment"><div class="line">int32_t DemoServer::get_answer()</div>
<div class="line">{</div>
<div class="line">  std::cout &lt;&lt; <span class="stringliteral">&quot;The answer is &quot;</span>&lt;&lt; answer &lt;&lt; std::endl;</div>
<div class="line">  <span class="keywordflow">return</span> answer;</div>
<div class="line">}</div>
</div><!-- fragment --></li>
</ul>
<ul>
<li>finally, we need to create an istance of the DemoServer class and attach it to a YARP port; a simple test can consist in this <a class="el" href="yarpros_8cpp.html#a0ddf1224851353fc92bfbff6f499fa97">main()</a> function: <div class="fragment"><div class="line"><span class="keywordtype">int</span> <a class="code" href="yarpros_8cpp.html#a0ddf1224851353fc92bfbff6f499fa97">main</a>(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> *argv[])</div>
<div class="line">{</div>
<div class="line">    <a class="code" href="classyarp_1_1os_1_1Network.html">yarp::os::Network</a> <a class="code" href="namespaceyarp.html">yarp</a>;</div>
<div class="line"> </div>
<div class="line">    DemoServer demoServer;</div>
<div class="line">    <a class="code" href="classyarp_1_1os_1_1Port.html">yarp::os::Port</a> port;</div>
<div class="line">    demoServer.yarp().attachAsServer(port);</div>
<div class="line">    <span class="keywordflow">if</span> (!port.<a class="code" href="classyarp_1_1os_1_1Port.html#adbca981deeed5f66b3c4465b91eac509">open</a>(<span class="stringliteral">&quot;/demoServer&quot;</span>)) {</div>
<div class="line">        <span class="keywordflow">return</span> 1;</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">while</span> (<span class="keyword">true</span>) {</div>
<div class="line">        printf(<span class="stringliteral">&quot;Server running happily\n&quot;</span>);</div>
<div class="line">        <a class="code" href="namespaceyarp_1_1os_1_1Time.html#aca80809e0597551745954e2547e581ee">yarp::os::Time::delay</a>(10);</div>
<div class="line">    }</div>
<div class="line">    port.<a class="code" href="classyarp_1_1os_1_1Port.html#ad0c3a032e49f56fbdfc8ca67f3ee2dff">close</a>();</div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
</div><!-- fragment --></li>
</ul>
<h1><a class="anchor" id="thrift_tutorial_simple_client"></a>
Client use</h1>
<p>The thirft engine generates all the required code for the client. Clients can directly invoke remote procedures on the server using a proxy object (generated by thrift) attached to a YARP port.</p>
<p>Simple example:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;iostream&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="libYARP__os_2src_2yarp_2os_2all_8h.html">yarp/os/all.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;Demo.h&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">using namespace </span><a class="code" href="namespaceyarp_1_1os.html">yarp::os</a>;</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> <a class="code" href="yarpros_8cpp.html#a0ddf1224851353fc92bfbff6f499fa97">main</a>(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> *argv[])</div>
<div class="line">{</div>
<div class="line">  <a class="code" href="classyarp_1_1os_1_1Property.html">Property</a> config;</div>
<div class="line">  config.<a class="code" href="classyarp_1_1os_1_1Property.html#af6bb398936ab0710d5c5d4960622663f">fromCommand</a>(argc,argv);</div>
<div class="line"> </div>
<div class="line">  <a class="code" href="classyarp_1_1os_1_1Network.html">Network</a> <a class="code" href="namespaceyarp.html">yarp</a>;</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// This port will be used to talk to the remote server</span></div>
<div class="line">  <a class="code" href="classyarp_1_1os_1_1Port.html">Port</a> client_port;</div>
<div class="line"> </div>
<div class="line">  std::string servername= config.<a class="code" href="classyarp_1_1os_1_1Property.html#a01b2c87730d92ac79189a139874b8f32">find</a>(<span class="stringliteral">&quot;server&quot;</span>).<a class="code" href="classyarp_1_1os_1_1Value.html#af2125ceb5eb007b6cd6ab77666682117">asString</a>().c_str();</div>
<div class="line">  client_port.<a class="code" href="classyarp_1_1os_1_1Port.html#adbca981deeed5f66b3c4465b91eac509">open</a>(<span class="stringliteral">&quot;/demo/client&quot;</span>);</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// connect to server</span></div>
<div class="line">  <span class="keywordflow">if</span> (!<a class="code" href="namespaceyarp.html">yarp</a>.connect(<span class="stringliteral">&quot;/demo/client&quot;</span>,servername.c_str()))</div>
<div class="line">  {</div>
<div class="line">     std::cout &lt;&lt; <span class="stringliteral">&quot;Error! Could not connect to server &quot;</span> &lt;&lt; servername &lt;&lt; std::endl;</div>
<div class="line">     <span class="keywordflow">return</span> -1;</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// Instatate proxy object and attach it to the port -- the proxy will use this port to talk to the server</span></div>
<div class="line">  Demo demo;</div>
<div class="line">  demo.yarp().attachAsClient(client_port);</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// Now we are ready to chat with the server!</span></div>
<div class="line">  <span class="comment">// Notice that from now on we will invoke only the server methods declared in demo.thrift/Demo.h</span></div>
<div class="line">  std::cout &lt;&lt; <span class="stringliteral">&quot;Hey are you up and running?&quot;</span> &lt;&lt; std::endl;</div>
<div class="line">  <span class="keywordflow">while</span>(!demo.is_running())</div>
<div class="line">  {</div>
<div class="line">      std::cout &lt;&lt; <span class="stringliteral">&quot;No? Well... start!&quot;</span> &lt;&lt; std::endl;</div>
<div class="line">      demo.start();</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">  std::cout &lt;&lt; <span class="stringliteral">&quot;Wonderful! I have a question for you... so, what&#39;s the answer??&quot;</span> &lt;&lt; std::endl;</div>
<div class="line">  int32_t answer=demo.get_answer();</div>
<div class="line">  std::cout &lt;&lt; <span class="stringliteral">&quot;What?? &quot;</span> &lt;&lt; answer &lt;&lt; <span class="stringliteral">&quot;?? Are you kidding??&quot;</span>;</div>
<div class="line">  answer = demo.add_one(answer);</div>
<div class="line">  std::cout &lt;&lt; <span class="stringliteral">&quot; It&#39;s definitely &quot;</span> &lt;&lt; answer &lt;&lt; <span class="stringliteral">&quot;!!&quot;</span> &lt;&lt; std::endl;</div>
<div class="line">  demo.set_answer(answer);</div>
<div class="line">  std::cout &lt;&lt; <span class="stringliteral">&quot;Got it? So, repeat after me: the answer is ... &quot;</span> &lt;&lt; demo.get_answer() &lt;&lt; <span class="stringliteral">&quot;! Great!&quot;</span> &lt;&lt; std::endl;</div>
<div class="line">  std::cout &lt;&lt; <span class="stringliteral">&quot;Ok you can relax now, I&#39;ll leave you alone&quot;</span> &lt;&lt; std::endl;</div>
<div class="line">  demo.stop();</div>
<div class="line">  std::cout&lt;&lt;<span class="stringliteral">&quot;Bye&quot;</span> &lt;&lt; std::endl;</div>
<div class="line">  <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
</div><!-- fragment --><h1><a class="anchor" id="thrift_tutorial_simple_module"></a>
Implementing the server as a RFModule</h1>
<p>A nicer altenative is to create a YARP RFModule that also implements the service interface:</p>
<div class="fragment"><div class="line"><span class="keyword">class </span>DemoServerModule : <span class="keyword">public</span> Demo, <span class="keyword">public</span> <a class="code" href="classyarp_1_1os_1_1RFModule.html">yarp::os::RFModule</a></div>
<div class="line">{</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// Members declaration and service functions implementation</span></div>
<div class="line"> </div>
<div class="line">  <span class="comment">// &lt;snip&gt; see above</span></div>
<div class="line"> </div>
<div class="line">  <span class="comment">// RFModule functions declaration</span></div>
<div class="line">  <span class="keywordtype">bool</span> <a class="code" href="classyarp_1_1os_1_1RFModule.html#a679ac4e820e92304c89648b1b7b85c1e">attach</a>(<a class="code" href="classyarp_1_1os_1_1Port.html">yarp::os::Port</a> &amp;source);</div>
<div class="line">  <span class="keywordtype">bool</span> <a class="code" href="classyarp_1_1os_1_1RFModule.html#a6c3880961b00b0a7eb527d62214169b7">configure</a>( <a class="code" href="classyarp_1_1os_1_1ResourceFinder.html">yarp::os::ResourceFinder</a> &amp;rf );</div>
<div class="line">  <span class="keywordtype">bool</span> <a class="code" href="classyarp_1_1os_1_1RFModule.html#a37ee5baa17ce243458a1dff209e878b7">updateModule</a>();</div>
<div class="line">  <span class="keywordtype">bool</span> <a class="code" href="classyarp_1_1os_1_1RFModule.html#a58ce26fc6fdcb6eb4af8e8dc678e095e">close</a>();</div>
<div class="line">};</div>
</div><!-- fragment --><p>The RFModule implementation:</p>
<div class="fragment"><div class="line"><span class="keywordtype">bool</span> DemoServerModule::attach(<a class="code" href="classyarp_1_1os_1_1Port.html">yarp::os::Port</a> &amp;source)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">return</span> this-&gt;yarp().attachAsServer(source);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">bool</span> DemoServerModule::configure( <a class="code" href="classyarp_1_1os_1_1ResourceFinder.html">yarp::os::ResourceFinder</a> &amp;rf )</div>
<div class="line">{</div>
<div class="line">    std::string moduleName = rf.<a class="code" href="classyarp_1_1os_1_1ResourceFinder.html#a0319a04b0f777210a4205cf1e10a3afb">check</a>(<span class="stringliteral">&quot;name&quot;</span>,</div>
<div class="line">            <a class="code" href="classyarp_1_1os_1_1Value.html">yarp::os::Value</a>(<span class="stringliteral">&quot;demoServerModule&quot;</span>),</div>
<div class="line">            <span class="stringliteral">&quot;module name (string)&quot;</span>).asString().c_str();</div>
<div class="line">    setName(moduleName.c_str());</div>
<div class="line"> </div>
<div class="line">    std::string <a class="code" href="Run_8cpp.html#a32bbb051c8e1d43772af1f8b284b97e8">slash</a>=<span class="stringliteral">&quot;/&quot;</span>;</div>
<div class="line"> </div>
<div class="line">    attach(cmdPort);</div>
<div class="line"> </div>
<div class="line">    std::string cmdPortName= <span class="stringliteral">&quot;/&quot;</span>;</div>
<div class="line">    cmdPortName+= getName();</div>
<div class="line">    cmdPortName += <span class="stringliteral">&quot;/cmd&quot;</span>;</div>
<div class="line">    <span class="keywordflow">if</span> (!cmdPort.<a class="code" href="classyarp_1_1os_1_1Port.html#adbca981deeed5f66b3c4465b91eac509">open</a>(cmdPortName.c_str())) {</div>
<div class="line">        std::cout &lt;&lt; getName() &lt;&lt; <span class="stringliteral">&quot;: Unable to open port &quot;</span> &lt;&lt; cmdPortName &lt;&lt; std::endl;</div>
<div class="line">        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">bool</span> DemoServerModule::updateModule()</div>
<div class="line">{</div>
<div class="line">    <span class="comment">// do something very useful</span></div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line">}</div>
<div class="line"><span class="keywordtype">bool</span> DemoServerModule::close()</div>
<div class="line">{</div>
<div class="line">    cmdPort.<a class="code" href="classyarp_1_1os_1_1Port.html#ad0c3a032e49f56fbdfc8ca67f3ee2dff">close</a>();</div>
<div class="line">    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line">}</div>
</div><!-- fragment --><p>And the main function:</p>
<div class="fragment"><div class="line"><span class="comment">// Check YARP and run the module</span></div>
<div class="line"><span class="keywordtype">int</span> <a class="code" href="yarpros_8cpp.html#a0ddf1224851353fc92bfbff6f499fa97">main</a>(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> *argv[])</div>
<div class="line">{</div>
<div class="line">    <a class="code" href="classyarp_1_1os_1_1Network.html">yarp::os::Network</a> <a class="code" href="namespaceyarp.html">yarp</a>;</div>
<div class="line">    <span class="keywordflow">if</span> (!<a class="code" href="namespaceyarp.html">yarp</a>.checkNetwork())</div>
<div class="line">    {</div>
<div class="line">        std::cout&lt;&lt;<span class="stringliteral">&quot;Error: yarp server does not seem available&quot;</span>&lt;&lt;std::endl;</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classyarp_1_1os_1_1ResourceFinder.html">yarp::os::ResourceFinder</a> rf;</div>
<div class="line">    rf.<a class="code" href="classyarp_1_1os_1_1ResourceFinder.html#af6b29f542e049ca102f1d871cee3a627">setVerbose</a>(<span class="keyword">true</span>);</div>
<div class="line">    rf.<a class="code" href="classyarp_1_1os_1_1ResourceFinder.html#a3a93050284000a2b177babe81e474445">configure</a>(argc, argv);</div>
<div class="line"> </div>
<div class="line">    DemoServerModule demoMod;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (!demoMod.configure(rf)) {</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> demoMod.runModule();</div>
<div class="line">}</div>
</div><!-- fragment --><h1><a class="anchor" id="thrift_tutorial_simple_completex"></a>
Complete example</h1>
<p>A complete example of Thrift code generation and server/client creation with CMake is available in <code>example/idl/thriftSimple</code></p>
<p>This is what we get when we launch server and client from command line (assuming a <em>yarpserver</em> is running, and we are in the "build" directory):</p>
<table class="doxtable">
<tr>
<td align="center"><b>Client</b>  </td><td align="center"><p class="starttd"><b>Server</b>  </p>
<p class="endtd"></p>
</td></tr>
<tr>
<td valign="top"><pre class="fragment">$ ./demoClient --server /demoServerModule/cmd
yarp: Port /demo/client active at tcp://10.255.36.53:10003
</pre>  </td><td valign="top"><pre class="fragment">$ ./demoServerModule
||| policy set to YARP_POLICY
||| YARP_POLICY:
      &lt;snip&gt;
I know the answer!
yarp: Port /demoServerModule/cmd active at tcp://10.255.36.53:10002
</pre>  <p class="endtd"></p>
</td></tr>
<tr>
<td valign="top"><pre class="fragment">yarp: Sending output from /demo/client to /demoServerModule/cmd using tcp
Hey are you up and running?
No? Well... start!
</pre>  </td><td valign="top"><pre class="fragment">yarp: Receiving input from /demo/client to /demoServerModule/cmd using tcp
Indeed I am not running
Starting!
Indeed I am running
</pre>  <p class="endtd"></p>
</td></tr>
<tr>
<td valign="top"><pre class="fragment">Wonderful! I have a question for you... so, what's the answer??
What?? 42?? Are you kidding?? It's definitely 43!!</pre>  </td><td valign="top"><pre class="fragment">The answer is 42
I'm adding one to 42. That's easy :)
OMG are you serious? The answer is 43?!?
</pre>  <p class="endtd"></p>
</td></tr>
<tr>
<td valign="top"><pre class="fragment">Got it? So, repeat after me: the answer is ... 43! Great!
Ok you can relax now, I'll leave you alone</pre>  </td><td valign="top"><pre class="fragment">The answer is 43
Stopping!</pre>  <p class="endtd"></p>
</td></tr>
<tr>
<td valign="top"><pre class="fragment">Bye
yarp: Removing output from /demo/client to /demoServerModule/cmd
</pre>  </td><td valign="top"><pre class="fragment">yarp: Removing input from /demo/client to /demoServerModule/cmd
</pre>  <p class="endtd"></p>
</td></tr>
</table>
<p>RPC calls can also be sent to the server from command line (note that commands with "_" in their name can be split): </p><pre class="fragment">$ yarp rpc /demoServerModule/cmd
get_answer
Response: 42
set_answer 28
Response: [ok]
get answer
Response: 28
is running
Response: [fail]
start
Response: [ok]
is running
Response: [ok]
stop
Response: [ok]
is_running
Response: [fail]
</pre> </div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<div class="ttc" id="aclassyarp_1_1os_1_1Port_html_ad0c3a032e49f56fbdfc8ca67f3ee2dff"><div class="ttname"><a href="classyarp_1_1os_1_1Port.html#ad0c3a032e49f56fbdfc8ca67f3ee2dff">yarp::os::Port::close</a></div><div class="ttdeci">void close() override</div><div class="ttdoc">Stop port activity.</div><div class="ttdef"><b>Definition:</b> <a href="Port_8cpp_source.html#l00349">Port.cpp:349</a></div></div>
<div class="ttc" id="aclassyarp_1_1os_1_1RFModule_html"><div class="ttname"><a href="classyarp_1_1os_1_1RFModule.html">yarp::os::RFModule</a></div><div class="ttdoc">A base-class for standard YARP modules that supports ResourceFinder.</div><div class="ttdef"><b>Definition:</b> <a href="RFModule_8h_source.html#l00023">RFModule.h:24</a></div></div>
<div class="ttc" id="aclassyarp_1_1os_1_1PortReader_html_a10c08e5812f43e208fae5843137afa1d"><div class="ttname"><a href="classyarp_1_1os_1_1PortReader.html#a10c08e5812f43e208fae5843137afa1d">yarp::os::PortReader::read</a></div><div class="ttdeci">virtual bool read(ConnectionReader &amp;reader)=0</div><div class="ttdoc">Read this object from a network connection.</div></div>
<div class="ttc" id="alibYARP__os_2src_2yarp_2os_2all_8h_html"><div class="ttname"><a href="libYARP__os_2src_2yarp_2os_2all_8h.html">all.h</a></div></div>
<div class="ttc" id="aclassyarp_1_1os_1_1WireLink_html_a688428d46ab502e47b1851a51c05f964"><div class="ttname"><a href="classyarp_1_1os_1_1WireLink.html#a688428d46ab502e47b1851a51c05f964">yarp::os::WireLink::setOwner</a></div><div class="ttdeci">bool setOwner(yarp::os::PortReader &amp;owner)</div><div class="ttdoc">Set the owner of this WireLink.</div><div class="ttdef"><b>Definition:</b> <a href="WireLink_8cpp_source.html#l00077">WireLink.cpp:77</a></div></div>
<div class="ttc" id="ayarpros_8cpp_html_a0ddf1224851353fc92bfbff6f499fa97"><div class="ttname"><a href="yarpros_8cpp.html#a0ddf1224851353fc92bfbff6f499fa97">main</a></div><div class="ttdeci">int main(int argc, char *argv[])</div><div class="ttdef"><b>Definition:</b> <a href="yarpros_8cpp_source.html#l00227">yarpros.cpp:227</a></div></div>
<div class="ttc" id="aclassyarp_1_1os_1_1Property_html_a01b2c87730d92ac79189a139874b8f32"><div class="ttname"><a href="classyarp_1_1os_1_1Property.html#a01b2c87730d92ac79189a139874b8f32">yarp::os::Property::find</a></div><div class="ttdeci">Value &amp; find(const std::string &amp;key) const override</div><div class="ttdoc">Gets a value corresponding to a given keyword.</div><div class="ttdef"><b>Definition:</b> <a href="Property_8cpp_source.html#l01032">Property.cpp:1032</a></div></div>
<div class="ttc" id="aclassyarp_1_1os_1_1Port_html_adbca981deeed5f66b3c4465b91eac509"><div class="ttname"><a href="classyarp_1_1os_1_1Port.html#adbca981deeed5f66b3c4465b91eac509">yarp::os::Port::open</a></div><div class="ttdeci">bool open(const std::string &amp;name) override</div><div class="ttdoc">Start port operation, with a specific name, with automatically-chosen network parameters.</div><div class="ttdef"><b>Definition:</b> <a href="Port_8cpp_source.html#l00078">Port.cpp:78</a></div></div>
<div class="ttc" id="aclassyarp_1_1os_1_1Port_html"><div class="ttname"><a href="classyarp_1_1os_1_1Port.html">yarp::os::Port</a></div><div class="ttdoc">A mini-server for network communication.</div><div class="ttdef"><b>Definition:</b> <a href="Port_8h_source.html#l00049">Port.h:50</a></div></div>
<div class="ttc" id="aclassyarp_1_1os_1_1RFModule_html_a37ee5baa17ce243458a1dff209e878b7"><div class="ttname"><a href="classyarp_1_1os_1_1RFModule.html#a37ee5baa17ce243458a1dff209e878b7">yarp::os::RFModule::updateModule</a></div><div class="ttdeci">virtual bool updateModule()=0</div><div class="ttdoc">Override this to do whatever your module needs to do.</div></div>
<div class="ttc" id="aclassyarp_1_1os_1_1Property_html_af6bb398936ab0710d5c5d4960622663f"><div class="ttname"><a href="classyarp_1_1os_1_1Property.html#af6bb398936ab0710d5c5d4960622663f">yarp::os::Property::fromCommand</a></div><div class="ttdeci">void fromCommand(int argc, char *argv[], bool skipFirst=true, bool wipe=true)</div><div class="ttdoc">Interprets a list of command arguments as a list of properties.</div><div class="ttdef"><b>Definition:</b> <a href="Property_8cpp_source.html#l01055">Property.cpp:1055</a></div></div>
<div class="ttc" id="aclassyarp_1_1os_1_1ResourceFinder_html_a3a93050284000a2b177babe81e474445"><div class="ttname"><a href="classyarp_1_1os_1_1ResourceFinder.html#a3a93050284000a2b177babe81e474445">yarp::os::ResourceFinder::configure</a></div><div class="ttdeci">bool configure(int argc, char *argv[], bool skipFirstArgument=true)</div><div class="ttdoc">Sets up the ResourceFinder.</div><div class="ttdef"><b>Definition:</b> <a href="ResourceFinder_8cpp_source.html#l00825">ResourceFinder.cpp:825</a></div></div>
<div class="ttc" id="aclassyarp_1_1os_1_1RFModule_html_a679ac4e820e92304c89648b1b7b85c1e"><div class="ttname"><a href="classyarp_1_1os_1_1RFModule.html#a679ac4e820e92304c89648b1b7b85c1e">yarp::os::RFModule::attach</a></div><div class="ttdeci">virtual bool attach(yarp::os::Port &amp;source)</div><div class="ttdoc">Make any input from a Port object go to the respond() method.</div><div class="ttdef"><b>Definition:</b> <a href="RFModule_8cpp_source.html#l00456">RFModule.cpp:456</a></div></div>
<div class="ttc" id="aclassyarp_1_1os_1_1Value_html_af2125ceb5eb007b6cd6ab77666682117"><div class="ttname"><a href="classyarp_1_1os_1_1Value.html#af2125ceb5eb007b6cd6ab77666682117">yarp::os::Value::asString</a></div><div class="ttdeci">virtual std::string asString() const</div><div class="ttdoc">Get string value.</div><div class="ttdef"><b>Definition:</b> <a href="Value_8cpp_source.html#l00237">Value.cpp:237</a></div></div>
<div class="ttc" id="aclassyarp_1_1os_1_1Wire_html"><div class="ttname"><a href="classyarp_1_1os_1_1Wire.html">yarp::os::Wire</a></div><div class="ttdoc">Base class for IDL client/server.</div><div class="ttdef"><b>Definition:</b> <a href="Wire_8h_source.html#l00021">Wire.h:22</a></div></div>
<div class="ttc" id="aclassyarp_1_1os_1_1RFModule_html_a6c3880961b00b0a7eb527d62214169b7"><div class="ttname"><a href="classyarp_1_1os_1_1RFModule.html#a6c3880961b00b0a7eb527d62214169b7">yarp::os::RFModule::configure</a></div><div class="ttdeci">virtual bool configure(yarp::os::ResourceFinder &amp;rf)</div><div class="ttdoc">Configure the module, pass a ResourceFinder object to the module.</div><div class="ttdef"><b>Definition:</b> <a href="RFModule_8cpp_source.html#l00438">RFModule.cpp:438</a></div></div>
<div class="ttc" id="aclassyarp_1_1os_1_1ResourceFinder_html_a0319a04b0f777210a4205cf1e10a3afb"><div class="ttname"><a href="classyarp_1_1os_1_1ResourceFinder.html#a0319a04b0f777210a4205cf1e10a3afb">yarp::os::ResourceFinder::check</a></div><div class="ttdeci">bool check(const std::string &amp;key) const override</div><div class="ttdoc">Check if there exists a property of the given name.</div><div class="ttdef"><b>Definition:</b> <a href="ResourceFinder_8cpp_source.html#l00962">ResourceFinder.cpp:962</a></div></div>
<div class="ttc" id="anamespaceyarp_1_1os_html_a1317b150b2bd76460f6a11d7675c423b"><div class="ttname"><a href="namespaceyarp_1_1os.html#a1317b150b2bd76460f6a11d7675c423b">yarp::os::mkdir</a></div><div class="ttdeci">int mkdir(const char *p)</div><div class="ttdoc">Portable wrapper for the mkdir() function.</div><div class="ttdef"><b>Definition:</b> <a href="Os_8cpp_source.html#l00038">Os.cpp:38</a></div></div>
<div class="ttc" id="aclassyarp_1_1os_1_1ConnectionReader_html"><div class="ttname"><a href="classyarp_1_1os_1_1ConnectionReader.html">yarp::os::ConnectionReader</a></div><div class="ttdoc">An interface for reading from a network connection.</div><div class="ttdef"><b>Definition:</b> <a href="ConnectionReader_8h_source.html#l00039">ConnectionReader.h:40</a></div></div>
<div class="ttc" id="aclassyarp_1_1os_1_1ResourceFinder_html_af6b29f542e049ca102f1d871cee3a627"><div class="ttname"><a href="classyarp_1_1os_1_1ResourceFinder.html#af6b29f542e049ca102f1d871cee3a627">yarp::os::ResourceFinder::setVerbose</a></div><div class="ttdeci">bool setVerbose(bool verbose=true)</div><div class="ttdoc">Request that information be printed to the console on how resources are being found.</div><div class="ttdef"><b>Definition:</b> <a href="ResourceFinder_8cpp_source.html#l00951">ResourceFinder.cpp:951</a></div></div>
<div class="ttc" id="aclassyarp_1_1os_1_1Wire_html_aa31a0bd22799f4137fbfba3a50f9f50b"><div class="ttname"><a href="classyarp_1_1os_1_1Wire.html#aa31a0bd22799f4137fbfba3a50f9f50b">yarp::os::Wire::yarp</a></div><div class="ttdeci">yarp::os::WireLink &amp; yarp()</div><div class="ttdoc">Get YARP state associated with this object.</div><div class="ttdef"><b>Definition:</b> <a href="Wire_8h_source.html#l00034">Wire.h:34</a></div></div>
<div class="ttc" id="anamespaceyarp_1_1os_html"><div class="ttname"><a href="namespaceyarp_1_1os.html">yarp::os</a></div><div class="ttdoc">An interface to the operating system, including Port based communication.</div><div class="ttdef"><b>Definition:</b> <a href="AbstractCarrier_8h_source.html#l00017">AbstractCarrier.h:17</a></div></div>
<div class="ttc" id="aclassyarp_1_1os_1_1Network_html"><div class="ttname"><a href="classyarp_1_1os_1_1Network.html">yarp::os::Network</a></div><div class="ttdoc">Utilities for manipulating the YARP network, including initialization and shutdown.</div><div class="ttdef"><b>Definition:</b> <a href="Network_8h_source.html#l00772">Network.h:773</a></div></div>
<div class="ttc" id="anamespaceyarp_html"><div class="ttname"><a href="namespaceyarp.html">yarp</a></div><div class="ttdoc">The main, catch-all namespace for YARP.</div><div class="ttdef"><b>Definition:</b> <a href="numeric_8h_source.html#l00047">numeric.h:47</a></div></div>
<div class="ttc" id="aclassyarp_1_1os_1_1Value_html"><div class="ttname"><a href="classyarp_1_1os_1_1Value.html">yarp::os::Value</a></div><div class="ttdoc">A single value (typically within a Bottle).</div><div class="ttdef"><b>Definition:</b> <a href="Value_8h_source.html#l00046">Value.h:47</a></div></div>
<div class="ttc" id="anamespaceyarp_1_1os_1_1Time_html_aca80809e0597551745954e2547e581ee"><div class="ttname"><a href="namespaceyarp_1_1os_1_1Time.html#aca80809e0597551745954e2547e581ee">yarp::os::Time::delay</a></div><div class="ttdeci">void delay(double seconds)</div><div class="ttdoc">Wait for a certain number of seconds.</div><div class="ttdef"><b>Definition:</b> <a href="Time_8cpp_source.html#l00111">Time.cpp:111</a></div></div>
<div class="ttc" id="aRun_8cpp_html_a32bbb051c8e1d43772af1f8b284b97e8"><div class="ttname"><a href="Run_8cpp.html#a32bbb051c8e1d43772af1f8b284b97e8">slash</a></div><div class="ttdeci">constexpr fs::value_type slash</div><div class="ttdef"><b>Definition:</b> <a href="Run_8cpp_source.html#l00099">Run.cpp:99</a></div></div>
<div class="ttc" id="aclassyarp_1_1os_1_1Property_html"><div class="ttname"><a href="classyarp_1_1os_1_1Property.html">yarp::os::Property</a></div><div class="ttdoc">A class for storing options and configuration information.</div><div class="ttdef"><b>Definition:</b> <a href="Property_8h_source.html#l00034">Property.h:37</a></div></div>
<div class="ttc" id="aclassyarp_1_1os_1_1ResourceFinder_html"><div class="ttname"><a href="classyarp_1_1os_1_1ResourceFinder.html">yarp::os::ResourceFinder</a></div><div class="ttdoc">Helper class for finding config files and other external resources.</div><div class="ttdef"><b>Definition:</b> <a href="ResourceFinder_8h_source.html#l00032">ResourceFinder.h:33</a></div></div>
<div class="ttc" id="aclassyarp_1_1os_1_1RFModule_html_a58ce26fc6fdcb6eb4af8e8dc678e095e"><div class="ttname"><a href="classyarp_1_1os_1_1RFModule.html#a58ce26fc6fdcb6eb4af8e8dc678e095e">yarp::os::RFModule::close</a></div><div class="ttdeci">virtual bool close()</div><div class="ttdoc">Close function.</div><div class="ttdef"><b>Definition:</b> <a href="RFModule_8cpp_source.html#l00490">RFModule.cpp:490</a></div></div>
<!-- HTML footer for doxygen 1.8.13-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li><span id="projectname_footer">YARP</span></li>
    <li><span id="projectnumber" class="version_switch">3.3.3</span></li>
    <li class="footer">Generated on Tue Nov 3 2020 16:57:07 for YARP by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.20 </li>
  </ul>
</div>
</body>
</html>
