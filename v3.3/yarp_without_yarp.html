<!-- HTML header for doxygen 1.8.12-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.20"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>YARP: YARP without YARP</title>
<link rel="shortcut icon" href="yarp-favicon.ico" type="image/x-icon" />
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript">
    var DOCUMENTATION_OPTIONS = { VERSION: '3.3.3' };
</script>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(function() { init_search(); });
/* @license-end */
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="yarp-doxygen-style.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../version_switch.js"></script>
<link rel="stylesheet" type="text/css" href="cookieconsent.min.css" />
<script src="cookieconsent.min.js"></script>
<script>
window.addEventListener("load", function(){
window.cookieconsent.initialise({
  "palette": {
    "popup": {
      "background": "#eb6c44",
      "text": "#ffffff"
    },
    "button": {
      "background": "#237afc",
    }
  },
  "theme": "classic",
  "content": {
    "message": "INFORMATION NOTICE ON COOKIES : This website uses only browsing/session cookies. Users can choose whether or not to accept the use of cookies and access the website. By clicking on \"Further information\", the full information notice on the types of cookies will be displayed and you will be able  to choose whether or not to accept them whilst browsing on the website.",
    "dismiss": "ACCEPT and close",
    "link": "Further information",
    "href": "http://www.icub.org/other/personal_data_notice.html"
  }
})});
</script>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="yarp-robot-64.png"/></td>
  <td id="projectalign" style="padding-left: 1.5em;">
   <div id="projectname">YARP</div>
   <div id="projectbrief">Yet Another Robot Platform</div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.svg"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.svg" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.20 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('yarp_without_yarp.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">YARP without YARP </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#yarp_without_yarp_test">Test scenario</a></li>
<li class="level1"><a href="#yarp_without_yarp_begin">Talking to a Port</a></li>
<li class="level1"><a href="#yarp_without_yarp_owner">Talking to a Port&#39;s owner</a></li>
<li class="level1"><a href="#yarp_without_yarp_python_rpc">Writing commands from code</a></li>
<li class="level1"><a href="#yarp_without_yarp_listening">Listening to a Port&#39;s owner</a></li>
<li class="level1"><a href="#yarp_without_yarp_name">Talking to the name server</a></li>
<li class="level1"><a href="#yarp_without_yarp_binary">Binary messages</a></li>
</ul>
</div>
<div class="textblock"><p>This tutorial covers how to communicate with a YARP Port without using the YARP library.</p>
<p>You might want to do this when trying to hook up some on your non-YARP-using code with a YARP robot. Or you may just want to know that users of your robot will have this option in future.</p>
<p>YARP Ports can be communicated with in a choice of protocols. Some of those protocols are very simple, simple enough to use without any code or to implement yourself in your own code.</p>
<p>The tutorial has two parts. For the first part, you will need the "telnet" program or an equivalent for this tutorial. It is used just as a way to create a socket from the command-line; we don't rely on any special parts of the telnet protocol. For the second part, we use a few lines of python to repeat the steps done manually with telnet. There are examples of interoperating with YARP from other languages in the <code>example/external</code> subdirectory of the YARP source code (YARP can also be used directly from many languages via SWIG, but that is a different topic).</p>
<h1><a class="anchor" id="yarp_without_yarp_test"></a>
Test scenario</h1>
<p>For concreteness, let's set up a very simple YARP system to interact with. In separate terminals, run:</p>
<pre class="fragment">yarp server
yarp read /read
yarp write /write
yarpdev --device controlboard --subdevice test_motor --name /motor --axes 5
</pre><p>The <code>yarp server</code> command is the yarp name server, which creates a Port called <code>/root</code>. We can communicate with that Port in order to find out how to communicate with all other Ports. The <code>yarp read /read</code> command creates a Port called <code>/read</code>, and prints anything sent to it onto standard output. The <code>yarp write /write</code> command creates a Port called <code>/write</code>, and sends anything typed on standard input to that Port. The <code>yarpdev</code> command creates a fake motor controlboard with 5 controllable axes.</p>
<p>As a reference, if we type <code>yarp name list</code> we can see a list of all ports created here:</p>
<div class="fragment"><div class="line">yarp name list</div>
</div><!-- fragment --><pre class="fragment">registration name /motor/command:i ip 127.0.0.1 port 10032 type tcp
registration name /motor/quit ip 127.0.0.1 port 10052 type quit
registration name /motor/rpc:i ip 127.0.0.1 port 10022 type tcp
registration name /motor/state:o ip 127.0.0.1 port 10042 type tcp
registration name /read ip 127.0.0.1 port 10002 type tcp
registration name /root ip 127.0.0.1 port 10000 type tcp
registration name /write ip 127.0.0.1 port 10012 type tcp
registration name fallback ip 224.2.1.1 port 10001 type mcast
*** end of message
</pre><p>We can see <code>/root</code>, the name server, <code>/read</code> and <code>/write</code>, and four ports related to the controlboard. We're not concerned here with the details of what you can do with motors, you can find out about that elsewhere.</p>
<h1><a class="anchor" id="yarp_without_yarp_begin"></a>
Talking to a Port</h1>
<p>The <code>yarp read /read</code> program is waiting for data to be sent to the port <code>/read</code>, which it will then print out. Let's make it happy.</p>
<p>From the output of <code>yarp name list</code>", we see that <code>/read</code> is at address <code>127.0.0.1</code> with port number <code>10002</code>. Let's do:</p>
<div class="fragment"><div class="line">telnet 127.0.0.1 10002</div>
</div><!-- fragment --><p>(Replace these numbers for whatever they are on your system).</p>
<p>We do this, and nothing happens, telnet just sits there doing nothing. That's normal. YARP ports don't respond immediately, they are waiting for a header that tells them what protocol you want to use (there are several).</p>
<p>Type carefully into telnet (on Windows you'll have to get this right first time without any visual feedback): </p><pre class="fragment">CONNECT foo
</pre><p>(you can substitute "foo" with anything you like). Hit return after you type this. Finally, we get a response:</p>
<pre class="fragment">Welcome foo
</pre><p>Hit return again. You should see something like:</p>
<pre class="fragment">Port command not understood.
Type d to send data to the port's owner.
Type ? for help.
</pre><p>Type:</p>
<pre class="fragment">?
</pre><p>and hit return. You should see something like: </p><pre class="fragment">This is a YARP port.  Here are the commands it responds to:
*       Gives a description of this port
d       Signals the beginning of input for the port's owner
do      The same as "d" except replies should be suppressed ("data-only")
q       Disconnects
i       Interrupt parent process (unix only)
r       Reverse connection type to be a reader
/port   Requests to send output to /port
!/port  Requests to stop sending output to /port
~/port  Requests to stop receiving input from /port
a       Signals the beginning of an administrative message
?       Gives this help
</pre><p>Good, we are clearly talking to a YARP port (it says so). Let's use the first command listed to get some information about the port. Type:</p>
<pre class="fragment">*
</pre><p>and hit return. You should see something like:</p>
<pre class="fragment">This is /read at tcp://127.0.0.1:10002
There are no outgoing connections
There is an input connection from foo to /read using text
</pre><p>We are indeed connected to the <code>/read</code> port, and our connection is listed. The <code>using text</code> part means we are using a text-mode protocol, chosen by starting the communication with <code>CONNECT</code> (other choices include more efficient binary protocols, protocols that switch to using udp, multi-cast, shared memory, etc).</p>
<p>Every single YARP port responds to the kinds of commands we've used so far. We could connect to <code>/write</code> or <code>/root</code> or <code>/motor/...</code> and do the same thing.</p>
<h1><a class="anchor" id="yarp_without_yarp_owner"></a>
Talking to a Port's owner</h1>
<p>So far we have chatted with the <code>/read</code> Port and found out some information about it that we already knew (its name is <code>/read</code> and we are connected to it).</p>
<p>Now let's send some data to the owner of the <code>/read</code> Port, which is the <code>yarp read /read</code> program. We expect that this data will get printed out on the terminal where that program is running.</p>
<p>Hit return without a command. You should see something like:</p>
<pre class="fragment">Port command not understood.
Type d to send data to the port's owner.
Type ? for help.
</pre><p>Okay, so "d" sends data to the port's owner. Let's do it. Type:</p>
<pre class="fragment">d
</pre><p>and hit return. Nothing happens, but now you are talking to the owner of the Port, rather than the Port itself. What you can type now depends on what the owner is expecting. There are several possible data-types in YARP, and users can easily define their own. All well-behaved data-types should follow the YARP <a class="el" href="data_rep.html">Standard data representation format</a>, which is particularly easy to enter in text-mode - it is just a list of space-separated numbers, strings, and nested structures.</p>
<p>Let's see what happens - type:</p>
<pre class="fragment">hello yarp
</pre><p>(And hit return as always).</p>
<p>Nothing happens in telnet, but if you look on the terminal running <code>yarp read /read</code>, you should see your text appear.</p>
<p>(If you find it disconcerting that you got no acknowledgement in telnet, next time you connect to a port, start with <code>CONNACK foo</code> rather than <code>CONNECT foo</code>, this is a small variant of the protocol that always supplies acknowledgements).</p>
<p>Okay, we're done for now - type:</p>
<pre class="fragment">q
</pre><p>(and hit return) and the connection will close.</p>
<p>Let's try talking to another Port. For the controlboard, <code>/motor/rpc:i</code> is a useful Port for sending commands and getting responses. Refer back to the <code>yarp name list</code> output we got earlier, or type on the command line:</p>
<pre class="fragment">yarp name query /motor/rpc:i
</pre><p>This gives us the machine and socket port number we need to contact this Port, in my case machine <code>127.0.0.1</code> and socket port number <code>10042</code>. So do:</p>
<pre class="fragment">telnet 127.0.0.1 10042
</pre><p>(Replace these numbers for whatever they are on your system).</p>
<p>Then type:</p>
<pre class="fragment">CONNECT bar
</pre><p>(you can substitute <code>bar</code> with anything you like). Hit return after you type this. We get a response:</p>
<pre class="fragment">Welcome bar
</pre><p>Let's send some data. Type:</p>
<pre class="fragment">d
help
</pre><p>Some helpful YARP Port owners respond to <code>help</code> with a brief list of the kinds of data the expect. In this case, you should see something like:</p>
<pre class="fragment">"[help]"
"[help] [more]"
"[get] [axes]"
"[get] [name] $iAxisNumber"
"[set] [pos] $iAxisNumber $fPosition"
"[set] [rel] $iAxisNumber $fPosition"
"[set] [vmo] $iAxisNumber $fVelocity"
"[get] [enc] $iAxisNumber"
"[set] [poss] ($f0 $f1 $f2 $f3 $f4)"
"[set] [rels] ($f0 $f1 $f2 $f3 $f4)"
"[set] [vmos] ($f0 $f1 $f2 $f3 $f4)"
"[set] [aen] $iAxisNumber"
"[set] [adi] $iAxisNumber"
"[get] [acu] $iAxisNumber"
"[get] [acus]"
[ok]
</pre><p>You'd need to consult with other tutorials to see what these do. Let's send a simple command to get the number of axes in the controlboard. Type:</p>
<pre class="fragment">d
[get] [axes]
</pre><p>(As a shorthand, you can omit the "[" and "]" characters and everything will still work).</p>
<p>You should see a response like:</p>
<pre class="fragment">[is] [axes] 5 [ok]
</pre><p>Checking back, 5 is indeed the number of axes we specified that our test controlboard should have.</p>
<p>If this were a real robot, we could go on to turn on power and control the motors. As it is, we can do it in simulation. Type:</p>
<pre class="fragment">d
[set] [poss] (10 10 -10 -10 5)
d
[get] [enc] 2
</pre><p>This sets the position of the 5 motors, and then checks the position of the third one (index 2). The responses are something like:</p>
<pre class="fragment">[ok]
[is] [enc] -10.0 [ok]
</pre><h1><a class="anchor" id="yarp_without_yarp_python_rpc"></a>
Writing commands from code</h1>
<p>Here is a python program for sending a command to a YARP port and receiving a response. The program does not use the YARP library (of course it is perfectly possible to use YARP from python/perl/ruby/tcl/... directly, this is just to show that you don't have to). First it sends a query to the name server to find the address of the port whose name is passed as the first argument to the program. Then it sends the string specified as the second argument to the program to that address, and prints the response.</p>
<div class="fragment"><div class="line"><span class="comment">#!/usr/bin/python</span></div>
<div class="line"> </div>
<div class="line"><span class="comment"># Copyright (C) 2006-2020 Istituto Italiano di Tecnologia (IIT)</span></div>
<div class="line"><span class="comment"># Copyright (C) 2006-2010 RobotCub Consortium</span></div>
<div class="line"><span class="comment"># All rights reserved.</span></div>
<div class="line"><span class="comment">#</span></div>
<div class="line"><span class="comment"># This software may be modified and distributed under the terms of the</span></div>
<div class="line"><span class="comment"># BSD-3-Clause license. See the accompanying LICENSE file for details.</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">import</span> socket</div>
<div class="line"><span class="keyword">import</span> re</div>
<div class="line"><span class="keyword">import</span> sys</div>
<div class="line"> </div>
<div class="line"><span class="keywordflow">if</span> len(sys.argv)!=3:</div>
<div class="line">    <span class="keywordflow">print</span> <span class="stringliteral">&#39;Call as:\n  %s /port/to/write/to \&quot;message to send\&quot;&#39;</span>%sys.argv[0]</div>
<div class="line">    exit(1)</div>
<div class="line"> </div>
<div class="line"><span class="keywordflow">try</span>:</div>
<div class="line">    <span class="keyword">import</span> find_name_server</div>
<div class="line">    name_server = find_name_server.find_name_server()</div>
<div class="line">    <span class="keywordflow">print</span> <span class="stringliteral">&quot;Nameserver is here:&quot;</span>, name_server</div>
<div class="line"><span class="keywordflow">except</span>:</div>
<div class="line">    name_server = (<span class="stringliteral">&#39;localhost&#39;</span>,10000)</div>
<div class="line">    <span class="keywordflow">print</span> <span class="stringliteral">&quot;Assuming nameserver is here:&quot;</span>, name_server</div>
<div class="line"> </div>
<div class="line">port_name = sys.argv[1]</div>
<div class="line">message = sys.argv[2]</div>
<div class="line"> </div>
<div class="line"><span class="keyword">def </span>get_addr(s):</div>
<div class="line">    m = re.match(<span class="stringliteral">&quot;registration name [^ ]+ ip ([^ ]+) port ([0-9]+) type tcp&quot;</span>,s)</div>
<div class="line">    <span class="keywordflow">return</span> (m.group(1),int(m.group(2))) <span class="keywordflow">if</span> m <span class="keywordflow">else</span> <span class="keywordtype">None</span></div>
<div class="line"> </div>
<div class="line"><span class="comment"># get a single line of text from a socket</span></div>
<div class="line"><span class="keyword">def </span>getline(sock):</div>
<div class="line">    result = <span class="stringliteral">&quot;&quot;</span></div>
<div class="line">    <span class="keywordflow">while</span> result.find(<span class="stringliteral">&#39;\n&#39;</span>)==-1:</div>
<div class="line">        result = result + sock.recv(1024)</div>
<div class="line">    result = re.sub(<span class="stringliteral">&#39;[\r\n].*&#39;</span>,<span class="stringliteral">&#39;&#39;</span>,result)</div>
<div class="line">    <span class="keywordflow">return</span> result</div>
<div class="line"> </div>
<div class="line"><span class="comment"># send a message and expect a reply</span></div>
<div class="line"><span class="keyword">def </span>comm(addr,message):</div>
<div class="line">    sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</div>
<div class="line">    sock.connect(addr)</div>
<div class="line">    sock.send(<span class="stringliteral">&#39;CONNACK extern\n&#39;</span>)</div>
<div class="line">    getline(sock) </div>
<div class="line">    sock.send(<span class="stringliteral">&#39;d\n%s\n&#39;</span> % message)</div>
<div class="line">    result = getline(sock)</div>
<div class="line">    sock.close()</div>
<div class="line">    <span class="keywordflow">return</span> result</div>
<div class="line"> </div>
<div class="line"><span class="comment"># ask name server for location</span></div>
<div class="line">query = get_addr(comm(name_server,<span class="stringliteral">&quot;query %s&quot;</span>%port_name))</div>
<div class="line"><span class="keywordflow">print</span> <span class="stringliteral">&quot;Talking to&quot;</span>, port_name, <span class="stringliteral">&quot;here:&quot;</span>, query</div>
<div class="line"><span class="keywordflow">print</span> comm(query,message)</div>
</div><!-- fragment --><p>The program assumes that the name server is running on the local machine, at socket port number <code>10000</code>. If not, it is best to add the following <code>find_name_server.py</code> module for reading the address of the server from YARP configuration files:</p>
<div class="fragment"><div class="line"><span class="comment">#!/usr/bin/python</span></div>
<div class="line"> </div>
<div class="line"><span class="comment"># Copyright (C) 2006-2020 Istituto Italiano di Tecnologia (IIT)</span></div>
<div class="line"><span class="comment"># Copyright (C) 2006-2010 RobotCub Consortium</span></div>
<div class="line"><span class="comment"># All rights reserved.</span></div>
<div class="line"><span class="comment">#</span></div>
<div class="line"><span class="comment"># This software may be modified and distributed under the terms of the</span></div>
<div class="line"><span class="comment"># BSD-3-Clause license. See the accompanying LICENSE file for details.</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">import</span> os</div>
<div class="line"> </div>
<div class="line"><span class="keyword">def </span>find_name_server():</div>
<div class="line">    <span class="comment"># ==================================================================</span></div>
<div class="line">    <span class="comment"># WARNING: This code is deprecated and will no longer work,</span></div>
<div class="line">    <span class="comment">#          see ResourceFinder documentation for paths searched</span></div>
<div class="line">    <span class="comment">#          by YARP</span></div>
<div class="line">    <span class="keywordflow">if</span> <span class="stringliteral">&quot;YARP_CONF&quot;</span> <span class="keywordflow">in</span> os.environ.keys():</div>
<div class="line">        base = os.environ[<span class="stringliteral">&quot;YARP_CONF&quot;</span>]</div>
<div class="line">    <span class="keywordflow">elif</span> <span class="stringliteral">&quot;HOMEDIR&quot;</span> <span class="keywordflow">in</span> os.environ.keys():</div>
<div class="line">        base = os.path.join(os.environ[<span class="stringliteral">&quot;HOMEDIR&quot;</span>],<span class="stringliteral">&quot;yarp&quot;</span>,<span class="stringliteral">&quot;conf&quot;</span>)</div>
<div class="line">    <span class="keywordflow">elif</span> <span class="stringliteral">&quot;HOME&quot;</span> <span class="keywordflow">in</span> os.environ.keys():</div>
<div class="line">        base = os.path.join(os.environ[<span class="stringliteral">&quot;HOME&quot;</span>],<span class="stringliteral">&quot;.yarp&quot;</span>,<span class="stringliteral">&quot;conf&quot;</span>)</div>
<div class="line">    <span class="keywordflow">else</span>:</div>
<div class="line">        <span class="keywordflow">print</span> <span class="stringliteral">&quot;Please set YARP_CONF to the location reported by this command:&quot;</span></div>
<div class="line">        <span class="keywordflow">print</span> <span class="stringliteral">&quot;  yarp conf&quot;</span></div>
<div class="line">        <span class="keywordflow">return</span> <span class="keywordtype">None</span></div>
<div class="line">    <span class="comment"># ==================================================================</span></div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">print</span> <span class="stringliteral">&quot;Config files should be in&quot;</span>, base</div>
<div class="line"> </div>
<div class="line">    namespace = <span class="stringliteral">&quot;/root&quot;</span></div>
<div class="line">    server_filename = <span class="stringliteral">&quot;yarp.conf&quot;</span></div>
<div class="line">    namespace_filename = os.path.join(base,<span class="stringliteral">&quot;yarp_namespace.conf&quot;</span>)</div>
<div class="line">    <span class="keywordflow">if</span> os.path.exists(namespace_filename):</div>
<div class="line">        namespace = open(namespace_filename).<a class="code" href="namespaceyarp_1_1sig_1_1file.html#a07569dcd80588910b9f97d167185e870">read</a>().strip()</div>
<div class="line">        namespace = namespace.replace(<span class="stringliteral">&quot;\&quot;&quot;</span>,<span class="stringliteral">&quot;&quot;</span>)</div>
<div class="line">        <span class="keywordflow">print</span> <span class="stringliteral">&quot;Namespace set to&quot;</span>, namespace</div>
<div class="line">        server_filename = namespace.replace(<span class="stringliteral">&quot;/&quot;</span>,<span class="stringliteral">&quot;_&quot;</span>) + <span class="stringliteral">&quot;.conf&quot;</span></div>
<div class="line">    <span class="keywordflow">else</span>:</div>
<div class="line">        <span class="keywordflow">print</span> <span class="stringliteral">&quot;Using default namespace,&quot;</span>, namespace</div>
<div class="line">    <span class="keywordflow">print</span> <span class="stringliteral">&quot;Expect name server information in&quot;</span>, server_filename</div>
<div class="line">    server_filename = os.path.join(base,server_filename)</div>
<div class="line">    <span class="keywordflow">if</span> os.path.exists(server_filename):</div>
<div class="line">        info = open(server_filename).readline().strip().split()</div>
<div class="line">        info = (info[0], int(info[1]))</div>
<div class="line">        <span class="keywordflow">print</span> <span class="stringliteral">&quot;server contact information:&quot;</span>, info</div>
<div class="line">    <span class="keywordflow">else</span>:</div>
<div class="line">        <span class="keywordflow">print</span> <span class="stringliteral">&quot;cannot find&quot;</span>, server_filename</div>
<div class="line">    <span class="keywordflow">return</span> info</div>
</div><!-- fragment --><p>Here's an example of using the program assuming it is called <code>yarprpc.py</code>:</p>
<pre class="fragment"># check number of axes on simulated motor controlboard
python yarprpc.py /motor/rpc:i "[get] [axes]"
[is] [axes] 5 [ok]

# move joint 0 on simulated motor controlboard
python yarprpc.py /motor/rpc:i "[set] [pos] 0 45.0"
[ok]
</pre><h1><a class="anchor" id="yarp_without_yarp_listening"></a>
Listening to a Port's owner</h1>
<p>So far, we have been the ones to initiate all communication. We send data to a Port's owner, and possibly get a reply back, but we are in charge.</p>
<p>Often, the initiative should be in the other direction. For example, the <code>yarp write /write</code> program takes data typed on the terminal and sends it out to anyone listening. How can we listen to it?</p>
<p>The usual answer within YARP is just to connect the <code>/write</code> Port to another Port /foo with the <code>yarp connect /write /foo</code>. But in this tutorial, we are trying to read from YARP without using the YARP libraries. It would take some work to create a full Port, and we certainly couldn't do it with just telnet.</p>
<p>There's an easier way. The first step is to connect just as we did before. We check where <code>/write</code> is with <code>yarp name query /write</code>, for my system it is:</p>
<pre class="fragment">registration name /write ip 127.0.0.1 port 10012 type tcp
*** end of message
</pre><p>This gives us the machine and socket port number we need to contact this Port, in my case machine <code>127.0.0.1</code> and socket port number <code>10012</code>. So do:</p>
<pre class="fragment">telnet 127.0.0.1 10012
</pre><p>(Replace these numbers for whatever they are on your system).</p>
<p>Then type:</p>
<pre class="fragment">CONNECT foo
</pre><p>(you can substitute "foo" with anything you like). Hit return after you type this. We get a response:</p>
<pre class="fragment">Welcome foo
</pre><p>So far things are just the same. Now, we don't want to send data to this Port's owner, we want to read it. Just as a check, type something on the <code>yarp write /write</code> terminal and hit return - it will NOT show up on the telnet terminal. You never receive data in YARP unless you are expecting it. So let's tell the <code>/write</code> Port that we are expecting data. Type:</p>
<pre class="fragment">?
</pre><p>and hit return. You should see something like:</p>
<pre class="fragment">This is a YARP port.  Here are the commands it responds to:
*       Gives a description of this port
d       Signals the beginning of input for the port's owner
do      The same as "d" except replies should be suppressed ("data-only")
q       Disconnects
i       Interrupt parent process (unix only)
r       Reverse connection type to be a reader
/port   Requests to send output to /port
!/port  Requests to stop sending output to /port
~/port  Requests to stop receiving input from /port
a       Signals the beginning of an administrative message
?       Gives this help
</pre><p>Look at the listing for <code>r</code> - "Reverse connection type to be a reader". This is what we want. Type:</p>
<pre class="fragment">r
</pre><p>and hit return. Nothing happens. But if you go to the <code>yarp write /write</code> terminal and type something, such as:</p>
<pre class="fragment">hello yarp
</pre><p>Then on the telnet terminal you will see: </p><pre class="fragment">do
hello yarp
</pre><p> So we got the message. What is <code>do</code>? It is a variant of <code>d</code> that tells the listener that a reply is not expected.</p>
<p>Once we convert to being a reader, there is no going back. The only safe way to take control again is to cut the connection (<code>&lt;control&gt;-] q &lt;return&gt;</code> in telnet) and connect again.</p>
<p>Let's try another Port, the <code>/motor/state:o</code> Port. Make the appropriate telnet connection based on <code>yarp name query /motor/state:o</code>, then type:</p>
<pre class="fragment">CONNECT foo
r
</pre><p>You should see a stream of data, something like:</p>
<pre class="fragment">...
do 2654 1215723086.182938
10.0 10.0 -10.0 -10.0 5.0
do 2655 1215723086.203243
10.0 10.0 -10.0 -10.0 5.0
do 2656 1215723086.226119
10.0 10.0 -10.0 -10.0 5.0
do 2657 1215723086.246381
10.0 10.0 -10.0 -10.0 5.0
do 2658 1215723086.266672
10.0 10.0 -10.0 -10.0 5.0
do 2659 1215723086.286925
10.0 10.0 -10.0 -10.0 5.0
do 2660 1215723086.307388
10.0 10.0 -10.0 -10.0 5.0
....
</pre><p>The line starting with <code>d</code> signals data; <code>do</code> means we're not expected to reply. The <code>do</code> is followed by some numbers - this is a message index and timestamp, an optional part of the protocol (important for motor information though). Then the actual positions of the motors are listed, exactly as we set them earlier.</p>
<h1><a class="anchor" id="yarp_without_yarp_name"></a>
Talking to the name server</h1>
<p>We've been using <code>yarp name list</code> or <code>yarp name query /PORT</code> to find out where ports are. What if we wanted to do this step too from telnet or our own program?</p>
<p>No problem. All we need is the address of the name server Port (which is just like any other Port), and then we can get all other addresses from it.</p>
<p>By default, the YARP name server runs on socket port number <code>10000</code>, so then you just need to find what machine it is running on. You could choose to always run it on a standard machine at your lab.</p>
<p>Suppose we know the server is on <code>127.0.0.1</code> with socket port number <code>10000</code>. Now if we want to find out the address of the <code>/read</code> Port, here is how we do it. Connect to the name server with telnet, and type:</p>
<pre class="fragment">CONNECT foo
d
help
</pre><p>The response is something like:</p>
<pre class="fragment">Welcome foo
Here are some ways to use the name server:
+ help
+ list
+ register $portname
+ register $portname $carrier $ipAddress $portNumber
  (if you want a field set automatically, write '...')
+ unregister $portname
+ query $portname
+ set $portname $property $value
+ get $portname $property
+ check $portname $property
+ match $portname $property $prefix
+ route $port1 $port2
+ gc
*** end of message
</pre><p>In the list above, we can see <code>query $portname</code>. Sounds good, let's try it. Type:</p>
<pre class="fragment">d
query /read
</pre><p>and the response should be something like:</p>
<pre class="fragment">registration name /read ip 127.0.0.1 port 10002 type tcp
*** end of message
</pre><p>So we have our replacement for the <code>yarp name query /PORT</code> command.</p>
<h1><a class="anchor" id="yarp_without_yarp_binary"></a>
Binary messages</h1>
<p>Text-mode communication is fine for small messages. It isn't very useful for transmitting images or sound. For that, we need a binary protocol; at this point there's no avoiding reading hairy documentation like <a class="el" href="yarp_protocol.html">Port and connection protocols</a> and writing some code.</p>
<p>There is sample C code for reading binary data (images in particular) in the directory <code>example/external/c</code> - there are also examples in C that translate the python examples above. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<div class="ttc" id="anamespaceyarp_1_1sig_1_1file_html_a07569dcd80588910b9f97d167185e870"><div class="ttname"><a href="namespaceyarp_1_1sig_1_1file.html#a07569dcd80588910b9f97d167185e870">yarp::sig::file::read</a></div><div class="ttdeci">bool read(ImageOf&lt; PixelRgb &gt; &amp;dest, const std::string &amp;src, image_fileformat format=FORMAT_ANY)</div><div class="ttdef"><b>Definition:</b> <a href="ImageFile_8cpp_source.html#l00516">ImageFile.cpp:516</a></div></div>
<!-- HTML footer for doxygen 1.8.13-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li><span id="projectname_footer">YARP</span></li>
    <li><span id="projectnumber" class="version_switch">3.3.3</span></li>
    <li class="footer">Generated on Tue Nov 3 2020 16:57:07 for YARP by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.20 </li>
  </ul>
</div>
</body>
</html>
