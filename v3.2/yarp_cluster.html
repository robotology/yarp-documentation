<!-- HTML header for doxygen 1.8.12-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.20"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>YARP: Setting up your network for YARP</title>
<link rel="shortcut icon" href="yarp-favicon.ico" type="image/x-icon" />
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript">
    var DOCUMENTATION_OPTIONS = { VERSION: '3.2.2' };
</script>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(function() { init_search(); });
/* @license-end */
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="yarp-doxygen-style.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../version_switch.js"></script>
<link rel="stylesheet" type="text/css" href="cookieconsent.min.css" />
<script src="cookieconsent.min.js"></script>
<script>
window.addEventListener("load", function(){
window.cookieconsent.initialise({
  "palette": {
    "popup": {
      "background": "#eb6c44",
      "text": "#ffffff"
    },
    "button": {
      "background": "#237afc",
    }
  },
  "theme": "classic",
  "content": {
    "message": "INFORMATION NOTICE ON COOKIES : This website uses only browsing/session cookies. Users can choose whether or not to accept the use of cookies and access the website. By clicking on \"Further information\", the full information notice on the types of cookies will be displayed and you will be able  to choose whether or not to accept them whilst browsing on the website.",
    "dismiss": "ACCEPT and close",
    "link": "Further information",
    "href": "http://www.icub.org/other/personal_data_notice.html"
  }
})});
</script>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="yarp-robot-64.png"/></td>
  <td id="projectalign" style="padding-left: 1.5em;">
   <div id="projectname">YARP</div>
   <div id="projectbrief">Yet Another Robot Platform</div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.svg"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.svg" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.20 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('yarp_cluster.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Setting up your network for YARP </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#yarp_cluster_iperf">iperf is your friend</a></li>
<li class="level1"><a href="#yarp_cluster_tcp">Checking TCP communication</a></li>
<li class="level1"><a href="#yarp_cluster_udp">Checking UDP communication</a></li>
<li class="level1"><a href="#yarp_cluster_mcast">Checking multicast communication</a></li>
<li class="level1"><a href="#yarp_cluster_suggest">YARP&#39;s suggestion</a></li>
<li class="level1"><a href="#yarp_cluster_tweak">YARP connection problems</a></li>
<li class="level1"><a href="#yarp_cluster_code">Relevant source code</a></li>
</ul>
</div>
<div class="textblock"><p>Along with TCP, YARP supports UDP and multicast communication on a local network.</p>
<p>These are unreliable network protocols, but can be quite efficient. We discuss here steps that are useful for making your network friendly to UDP and multicast. But if you find yourself spending a lot of time on this, you may need to reconsider whether you have made the right choice of protocol.</p>
<p>NOTE: if you are just getting started with YARP, you don't need to look at any of this yet! It only matters when you are working with a cluster of computers using unreliable protocols, or run into bandwidth problems. But it is important to remember that this page is here for when you need it.</p>
<h1><a class="anchor" id="yarp_cluster_iperf"></a>
iperf is your friend</h1>
<p>If you are doing any non-trivial networking, you need to learn how to test your network and debug throughput issues. A key resource in this battle is the "iperf" program.</p>
<ul>
<li>Download from <a href="http://software.es.net/iperf/">http://software.es.net/iperf/</a></li>
<li>Linux: apt-get install iperf (or similar command)</li>
<li>macOS: brew install iperf (if you use homebrew)</li>
</ul>
<p>Please make sure you have iperf available on all your machines before going any further.</p>
<h1><a class="anchor" id="yarp_cluster_tcp"></a>
Checking TCP communication</h1>
<p>TCP is the simplest protocol to work with, so let's start with it. Let's check the throughput between two of your machines. Pick two machines, and choose one (arbitrarily) to be the iperf server. Determine its IP address of domain name &ndash; let's say it is 10.0.0.26. Run the following commands:</p>
<pre class="fragment"> [On server, e.g. 10.0.0.26] iperf -s
 [On client, e.g. 10.0.0.27] iperf -c 10.0.0.26
</pre><p>This will run for a while and then describe your TCP throughput, for example:</p>
<pre class="fragment"> ------------------------------------------------------------
 Client connecting to 10.0.0.26, TCP port 5001
 TCP window size: 16.0 KByte (default)
 ------------------------------------------------------------
 [  3] local 10.0.0.25 port 34160 connected with 10.0.0.26 port 5001
 [  3]  0.0-10.0 sec  1.08 GBytes    924 Mbits/sec
 ...
</pre><h1><a class="anchor" id="yarp_cluster_udp"></a>
Checking UDP communication</h1>
<p>UDP is an unreliable protocol, and there are lots of possible pitfalls in using it. YARP will try to send messages broken into rather large UDP packets (around 60K), and your network may or may not actually pass those packets through.</p>
<p>To test UDP behavior on your network with iperf, add the "-u" flag to the client and server. To the server, we can add "-i 1" to get reports at regular intervals. To the client, we can specify target bandwidth, e.g. "-b 50m" for a target of 50 MBits/sec.</p>
<pre class="fragment"> [On server, 10.0.0.26] iperf -s -u -i 1
 [On client, 10.0.0.27] iperf -c 10.0.0.26 -b 50m
</pre><p>To test a gigabit network:</p>
<pre class="fragment"> [On server, 10.0.0.26] iperf -s -u -i 1
 [On client, 10.0.0.27] iperf -c 10.0.0.26 -b 1000m
</pre><p>On a healthy gigabit network you should get a bandwidth of ~950 Mbits/sec.</p>
<p>Example result on the client side:</p>
<pre class="fragment">------------------------------------------------------------
Client connecting to 10.0.0.26, UDP port 5001
Sending 1470 byte datagrams
UDP buffer size:   122 KByte (default)
------------------------------------------------------------
[  3] local 10.0.0.221 port 52990 connected with 10.0.0.222 port 5001
[ ID] Interval       Transfer     Bandwidth
[  3]  0.0- 6.1 sec    700 MBytes    956 Mbits/sec
[  3] Sent 499273 datagrams
[  3] Server Report:
[  3]  0.0- 6.1 sec    699 MBytes    955 Mbits/sec  0.014 ms  575/499272 (0.12%)
[  3]  0.0- 6.1 sec  1 datagrams received out-of-order
</pre><p>Result on the server side: </p><pre class="fragment">------------------------------------------------------------
Server listening on UDP port 5001
Receiving 1470 byte datagrams
UDP buffer size:   122 KByte (default)
------------------------------------------------------------
[  3] local 10.0.0.26 port 5001 connected with 10.0.0.27 port 52990
[ ID] Interval       Transfer     Bandwidth       Jitter   Lost/Total Datagrams
[  3]  0.0- 1.0 sec    114 MBytes    954 Mbits/sec  0.012 ms   88/81245 (0.11%)
[  3]  1.0- 2.0 sec    114 MBytes    955 Mbits/sec  0.011 ms   92/81263 (0.11%)
[  3]  2.0- 3.0 sec    114 MBytes    955 Mbits/sec  0.014 ms   90/81287 (0.11%)
[  3]  3.0- 4.0 sec    114 MBytes    955 Mbits/sec  0.012 ms   98/81273 (0.12%)
[  3]  4.0- 5.0 sec    114 MBytes    954 Mbits/sec  0.012 ms   99/81263 (0.12%)
[  3]  5.0- 6.0 sec    114 MBytes    955 Mbits/sec  0.012 ms   95/81288 (0.12%)
[  3]  0.0- 6.1 sec    699 MBytes    955 Mbits/sec  0.014 ms  575/499272 (0.12%)
[  3]  0.0- 6.1 sec  1 datagrams received out-of-order
</pre><p>A key test for YARP is that you can send big datagrams okay. This is necessary for efficient transmission of large images using UDP or MCAST. To check 63KB datagrams, do:</p>
<pre class="fragment"> [On server, 10.0.0.26] iperf -s -u -l 63K -w 200K -i 1
 [On client, 10.0.0.27] iperf -c 10.0.0.26 -u -l 63K -w 200K -b 1000m
</pre><p>Make sure you try this in both directions! For example, we've seen an asymmetric problems going from a Linux machine to a Windows machine on a gigabit network with a particular switch. If you see problems, reduce the "-l" size until things work just to understand your system (but if you want to send large images you'll need to tweak your system until large packets work).</p>
<p>It could also be worth checking several machines since different network cards can have different performance.</p>
<h1><a class="anchor" id="yarp_cluster_mcast"></a>
Checking multicast communication</h1>
<p>For testing multicast, make sure you have the most recent version of iperf, and try this:</p>
<pre class="fragment"> iperf -s -u -B 224.0.55.55 -i 1 -T 32 -l 60k
 iperf -c 224.0.55.55 -u -T 32 -t 100 -i 1 -l 60k -b 1000m
</pre><p>Note the IP addresses are multicast-style, they don't correspond to individual machines.</p>
<p>On the client ("-c") side, you should see something like:</p>
<pre class="fragment">------------------------------------------------------------
Client connecting to 224.0.55.55, UDP port 5001
Sending 61440 byte datagrams
Setting multicast TTL to 32
UDP buffer size:   122 KByte (default)
------------------------------------------------------------
[  3] local 10.0.0.221 port 60992 connected with 224.0.55.55 port 5001
[ ID] Interval       Transfer     Bandwidth
[  3]  0.0- 1.0 sec    114 MBytes    958 Mbits/sec
[  3]  1.0- 2.0 sec    114 MBytes    956 Mbits/sec
[  3]  2.0- 3.0 sec    114 MBytes    956 Mbits/sec
[  3]  3.0- 4.0 sec    114 MBytes    956 Mbits/sec
</pre><p>Server side:</p>
<pre class="fragment">------------------------------------------------------------
Server listening on UDP port 5001
Binding to local address 224.0.55.55
Joining multicast group  224.0.55.55
Receiving 61440 byte datagrams
UDP buffer size:   122 KByte (default)
------------------------------------------------------------
[  3] local 224.0.55.55 port 5001 connected with 10.0.0.221 port 60992
[ ID] Interval       Transfer     Bandwidth       Jitter   Lost/Total Datagrams
[  3]  0.0- 1.0 sec    111 MBytes    931 Mbits/sec  0.380 ms   50/ 1945 (2.6%)
[  3]  1.0- 2.0 sec    111 MBytes    934 Mbits/sec  0.442 ms   46/ 1947 (2.4%)
[  3]  2.0- 3.0 sec    112 MBytes    941 Mbits/sec  0.280 ms   31/ 1946 (1.6%)
[  3]  3.0- 4.0 sec    112 MBytes    935 Mbits/sec  0.362 ms   43/ 1946 (2.2%)
[  3]  4.0- 5.0 sec    110 MBytes    920 Mbits/sec  0.459 ms   75/ 1947 (3.9%)
[  3]  5.0- 6.0 sec    111 MBytes    934 Mbits/sec  0.418 ms   45/ 1946 (2.3%)
[  3]  6.0- 7.0 sec    111 MBytes    933 Mbits/sec  0.380 ms   48/ 1947 (2.5%)
[  3]  7.0- 8.0 sec    111 MBytes    933 Mbits/sec  0.365 ms   49/ 1947 (2.5%)
[  3]  8.0- 9.0 sec    112 MBytes    936 Mbits/sec  0.319 ms   41/ 1946 (2.1%)
</pre><h1><a class="anchor" id="yarp_cluster_suggest"></a>
YARP's suggestion</h1>
<p>If MCAST/UDP packets drop when using YARP, YARP may suggest this:</p>
<pre class="fragment"> The UDP/MCAST system buffer limit on your system is low.
 You may get packet loss under heavy conditions.
 To change the buffer limit on linux: sysctl -w net.core.rmem_max=8388608
 (Might be something like: sudo /sbin/sysctl -w net.core.rmem_max=8388608)
 To change the limit use: sysctl for Linux/FreeBSD, ndd for Solaris, no for AIX
</pre><p>This controls the maximum allowed size for a RECEIVER buffer, so that a number of packets adding up to a large amount of data can be received and stored while your program is doing something else. YARP will try to get a large buffer, and your operating system may not comply unless you do the above. This configuration step is not necessary on MS-Windows.</p>
<p>There are a lot more suggestions for Linux here:</p><ul>
<li><a href="http://wwwx.cs.unc.edu/~sparkst/howto/network_tuning.php">http://wwwx.cs.unc.edu/~sparkst/howto/network_tuning.php</a></li>
</ul>
<h1><a class="anchor" id="yarp_cluster_tweak"></a>
YARP connection problems</h1>
<p>If you are confident of your network, but are having trouble with making a YARP connection of some kind, read about that kind of connection in <a class="el" href="carrier_config.html">Configuring YARP Connections</a> and see if there's a tweak that can be made. There are some parameters you can control for the <a class="el" href="carrier_config.html#carrier_config_udp">udp carrier</a> and <a class="el" href="carrier_config.html#carrier_config_mcast">mcast (multicast) carrier</a>.</p>
<h1><a class="anchor" id="yarp_cluster_code"></a>
Relevant source code</h1>
<p>In case you need to fix something, the relevant source code in YARP is:</p>
<ul>
<li>src/libYARP_OS/include/yarp/os/DgramTwoWayStream.h</li>
<li><a class="el" href="DgramTwoWayStream_8cpp.html">src/libYARP_OS/src/DgramTwoWayStream.cpp</a></li>
</ul>
<p>We appreciate patches to these files. We only have a few networks to test on, and this topic can be quite network-dependent and subtle. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.8.13-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li><span id="projectname_footer">YARP</span></li>
    <li><span id="projectnumber" class="version_switch">3.2.2</span></li>
    <li class="footer">Generated on Tue Nov 3 2020 16:49:14 for YARP by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.20 </li>
  </ul>
</div>
</body>
</html>
