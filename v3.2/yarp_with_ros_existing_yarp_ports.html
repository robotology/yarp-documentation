<!-- HTML header for doxygen 1.8.12-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.20"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>YARP: Use ROS with existing YARP programs</title>
<link rel="shortcut icon" href="yarp-favicon.ico" type="image/x-icon" />
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript">
    var DOCUMENTATION_OPTIONS = { VERSION: '3.2.2' };
</script>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(function() { init_search(); });
/* @license-end */
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="yarp-doxygen-style.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../version_switch.js"></script>
<link rel="stylesheet" type="text/css" href="cookieconsent.min.css" />
<script src="cookieconsent.min.js"></script>
<script>
window.addEventListener("load", function(){
window.cookieconsent.initialise({
  "palette": {
    "popup": {
      "background": "#eb6c44",
      "text": "#ffffff"
    },
    "button": {
      "background": "#237afc",
    }
  },
  "theme": "classic",
  "content": {
    "message": "INFORMATION NOTICE ON COOKIES : This website uses only browsing/session cookies. Users can choose whether or not to accept the use of cookies and access the website. By clicking on \"Further information\", the full information notice on the types of cookies will be displayed and you will be able  to choose whether or not to accept them whilst browsing on the website.",
    "dismiss": "ACCEPT and close",
    "link": "Further information",
    "href": "http://www.icub.org/other/personal_data_notice.html"
  }
})});
</script>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="yarp-robot-64.png"/></td>
  <td id="projectalign" style="padding-left: 1.5em;">
   <div id="projectname">YARP</div>
   <div id="projectbrief">Yet Another Robot Platform</div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.svg"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.svg" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.20 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('yarp_with_ros_existing_yarp_ports.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Use ROS with existing YARP programs </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#yarp_with_ros_name_types">Decide what to do about types</a></li>
<li class="level1"><a href="#yarp_with_ros_read_topic">Reading ROS topics</a></li>
<li class="level1"><a href="#yarp_with_ros_publish_topic">Publishing to ROS topics</a></li>
<li class="level1"><a href="#yarp_with_ros_making_connections">An important note on making connections</a></li>
<li class="level1"><a href="#yarp_with_ros_existing">Reading existing YARP ports from ROS</a></li>
<li class="level1"><a href="#yarp_with_ros_configuring_ports">How to configure Ports to talk to ROS</a></li>
</ul>
</div>
<div class="textblock"><h1><a class="anchor" id="yarp_with_ros_name_types"></a>
Decide what to do about types</h1>
<p>ROS has a type system that YARP knows nothing about. You can tell YARP about ROS types either at compile-time or at run-time. In either case, you'll need access to the .msg/.srv files stored in ROS packages. You have at least three options:</p>
<ul>
<li>Install ROS. This can be easier said than done, if you're not used to it. Tip: don't try to work against the grain - install exactly the recommended version of Ubuntu, or use a virtual machine or chroot. </li>
<li>Or: ask YARP to read type definitions from a website. This is a bit of a hack, but can be good for getting up and running quickly. </li>
<li>Or: track down the .msg/.srv files for the types you care about by any means available, and copy them. This can be good for embedded scenarios.</li>
</ul>
<p>We'll focus on the first two options, but bear in mind that the third is possible if ever you need to strip your system down to the essentials.</p>
<p>You can make ROS types available to YARP via reading from a website by running the following additional type server:</p>
<pre class="fragment">yarpidl_rosmsg --web true --name /typ@/yarpidl
</pre><p>This server will lurk around waiting for YARP clients baffled by a ROS type, and will swoop in to their rescue. For example if you were running the ROS "add two ints" tutorial:</p>
<pre class="fragment">rosrun rospy_tutorials add_two_ints_server
</pre><p>You could now talk to it from a YARP program in the way you might to intuitively expect:</p>
<pre class="fragment">$ yarp rpc /add_two_ints
22 20
Response: 42
</pre><p>This looks straightforward, but it relies critically on YARP being able to determine ROS types. If you were to shut down the yarpidl_rosmsg server, here is what you would see:</p>
<pre class="fragment">$ yarp rpc /add_two_ints
Do not know anything about type 'rospy_tutorials/AddTwoInts'
Could not connect to a type server to look up type 'rospy_tutorials/AddTwoInts'
</pre><p>YARP is successfully connecting to the ROS integer-adding service, which lets it know the type of data it expects, but is baffled at how to supply it. That's where the type server comes in.</p>
<p>Having the type server do type lookups via the web is handy but subject to the random flakiness of the internet. If you can, you'll be much better off running yarpidl_rosmsg on a machine with ROS installed. Then you can leave off the &ndash;web option:</p>
<pre class="fragment">yarpidl_rosmsg --name /typ@/yarpidl
</pre><p>That's the only YARP program you'll need on that machine.</p>
<p>Here we've used yarpidl_rosmsg as a server, to pass around type information at run-time. It can also be used to do the translation at compile-time, see yarp_with_ros_roscore_ros_types. Translation at compile-time works for arbitrary ROS types, whereas run-time translation currently does not support ROS types with nesting via arrays (coming soon though!).</p>
<h1><a class="anchor" id="yarp_with_ros_read_topic"></a>
Reading ROS topics</h1>
<p>Let's start with a simple test reader:</p>
<pre class="fragment">yarp read /msg@/test_node
</pre><p>For someone familiar with ROS, the "/msg@/test_node" syntax can be read as "use
a topic name of /msg, and a node name of /test_node". We can check that everything looks familiar with rosnode and rostopic:</p>
<pre class="fragment">$ rosnode list
...
/test_node
...

$ rostopic info /msg
Type: unknown type
Publishers: None
Subscribers:
* /test_node (... address ...)
</pre><p>As invoked, we didn't assign any particular type to the port/topic - this can be picked up from the sender. Try any of:</p>
<pre class="fragment">rostopic pub /msg std_msgs/String "hello yarp"
rostopic pub /msg turtlesim/Pose 0 5 10 15 20
</pre><p>And you should see the messages print out on the console of yarp read.</p>
<h1><a class="anchor" id="yarp_with_ros_publish_topic"></a>
Publishing to ROS topics</h1>
<p>Let's start a ROS program to print out strings:</p>
<pre class="fragment">$ rosrun roscpp_tutorials listener
</pre><p>This program subscribes to a topic called "/chatter". Let's publish something there from YARP:</p>
<pre class="fragment">$ yarp write /chatter@/yarp_writer
yarp: Port /yarp_writer active at tcp://192.168.1.2:54473
yarp: Port /chatter+@/yarp_writer active at tcp://192.168.1.2:50896
yarp: Sending output from /chatter+@/yarp_writer to /listener using tcpros
hello?
</pre><p>Once we type a message (here "hello?") and hit return, we should see it echoed on the listener's console:</p>
<pre class="fragment">[ INFO] [1386605949.838711935]: I heard: [hello?]
</pre><p>Under the hood, the yarp port has found the type of data expected (from the listener) and is matching what you enter with that type. If you try to send a number, you'll get a message like this:</p>
<pre class="fragment">42
yarp: Structure of message is unexpected (expected std_msgs/String)
</pre><p>(If you actually want to send a string that looks like an integer, just put it in quotes). In this case, the listener is expecting a message of type 'std_msgs/String'.</p>
<p>Let's start a ROS service that adds two integers:</p>
<pre class="fragment">$ rosrun rospy_tutorials add_two_ints_server
</pre><p>This creates a service named /add_two_ints that expects two integers and gives back an integer. We can use it from 'yarp rpc', for example:</p>
<pre class="fragment">$ yarp rpc /add_two_ints
22 20
Response: 42
1 -10
Response: -9
</pre><p>As explained before, this relies critically on YARP being able to determine ROS types. If you were to shut down the yarpidl_rosmsg server, here is what you would see:</p>
<pre class="fragment">$ yarp rpc /add_two_ints
Do not know anything about type 'rospy_tutorials/AddTwoInts'
Could not connect to a type server to look up type 'rospy_tutorials/AddTwoInts'
</pre><p>With the type server running, YARP can make the needed translations. Let's try the opposite direction, setting up a ROS-style rpc server, for example this:</p>
<pre class="fragment">$ yarp rpcserver /add_two_ints@/my_int_server --type rospy_tutorials/AddTwoInts
</pre><p>Notice that we specify a node name for the server here, and also we give the type of data it expects and returns (ROS-style clients expect us to know that). Now from ROS we can do:</p>
<pre class="fragment">$ rosrun roscpp_tutorials add_two_ints_client 3 4
</pre><p>On the "yarp rpcserver" terminal we will now see:</p>
<pre class="fragment">Waiting for a message...
yarp: Receiving input from /add_two_ints_client to /add_two_ints-1@/my_int_server using tcpros
Message: 3 4
Reply:
</pre><p>It is waiting for us to reply. We can type in whatever number we like ("7" if we are feeling constructive), and it will be reported on the "roscpp_tutorials" terminal:</p>
<pre class="fragment">[ INFO] [1386793386.003997149]: Sum: 7
</pre><h1><a class="anchor" id="yarp_with_ros_making_connections"></a>
An important note on making connections</h1>
<p>In YARP we usually make connections using "yarp connect". This may lead to thinking that we can connect a YARP port to a topic using the following sequence of commands:</p>
<pre class="fragment">$ yarpview --name /view
$ yarp connect /topic@/node /view
</pre><p>ROS however requires to manage the connections through roscore. Therefore YARP ports need to be registered as topic with "roscore" as described above. In our example this means running yarpview as follows:</p>
<pre class="fragment">$ yarpview --name /topic@/viewer
</pre><p>and let ROS (roscore)establish the connection with /topic.</p>
<h1><a class="anchor" id="yarp_with_ros_existing"></a>
Reading existing YARP ports from ROS</h1>
<p>To read existing YARP ports from ROS, we need to define their type for ROS's benefit. There is a tool to help with this.</p>
<p>For testing purposes, let's start a fake motor control board: </p><pre class="fragment">yarpdev --device test_motor --name /motor
</pre><p>One of the ports this creates is /motor/state:o. ROS forbids port names with ":" in them, and YARP versions 2.3.15 and earlier didn't have a work-around for this, so make sure you are using YARP trunk or YARP version &gt; 2.3.15 for this part.</p>
<p>To see how to access /motor/state:o from ROS, do: </p><pre class="fragment">yarpros sniff out /motor/state:o
</pre><p> This gives us the following rather arcane lines: </p><pre class="fragment">int32 v_tag # set to 266 (BOTTLE_TAG_LIST+code)
float64[] v # suggested length: 4
</pre><p> This is a valid .msg file, and can be used directly in ROS.</p>
<p>See some more examples in the yarp source code, in the example/yarpros_examples directory.</p>
<h1><a class="anchor" id="yarp_with_ros_configuring_ports"></a>
How to configure Ports to talk to ROS</h1>
<p>In a previous example (<a class="el" href="yarp_with_ros_services.html">Use YARP to talk to ROS services</a>) we have seen how to use <a class="el" href="classyarp_1_1os_1_1RpcClient.html" title="A port that is specialized as an RPC client.">yarp::os::RpcClient</a> to talk to a ROS service. In fact we could have used a normal port configured appropriately:</p>
<div class="fragment"><div class="line">Port client;</div>
<div class="line">client.setRpcClient();</div>
</div><!-- fragment --><p>In <a class="el" href="yarp_with_ros_writing_code_topics.html">Writing code to talk to ROS topics</a> we have used special classes (<a class="el" href="classyarp_1_1os_1_1Node.html" title="The Node class.">yarp::os::Node</a>, <a class="el" href="classyarp_1_1os_1_1Publisher.html" title="A port specialized for publishing data of a constant type on a topic.">yarp::os::Publisher</a>, <a class="el" href="classyarp_1_1os_1_1Subscriber.html" title="A port specialized for reading data of a constant type published on a topic.">yarp::os::Subscriber</a>) to crate ROS nodes, publishers and subscribers. The same result can be achieved by configuring a <a class="el" href="classyarp_1_1os_1_1Port.html" title="A mini-server for network communication.">yarp::os::Port</a>. However if we try to use a regular port without telling YARP how we'll be using it (by calling one of setRpcClient(), setRpcServer(), setWriteOnly(), setReadOnly()), YARP will complain because it won't know how to describe it to ROS. However, if you have a YARP-using program that you can't easily modify to add such a call, you can sneak the needed information into the port name using the special syntax described above.</p>
<table class="doxtable">
<tr>
<th>ROS idea</th><th>Call needed to specialize a Port/BufferedPort</th><th>Or add this decoration before "@" in port name</th><th>Specialized class </th></tr>
<tr>
<td>Topic Subscriber</td><td>port.setWriteOnly()</td><td>-</td><td><a class="el" href="classyarp_1_1os_1_1Subscriber.html" title="A port specialized for reading data of a constant type published on a topic.">yarp::os::Subscriber</a> </td></tr>
<tr>
<td>Topic Publisher</td><td>port.setReadOnly()</td><td>+</td><td><a class="el" href="classyarp_1_1os_1_1Publisher.html" title="A port specialized for publishing data of a constant type on a topic.">yarp::os::Publisher</a> </td></tr>
<tr>
<td>Service</td><td>port.setRpcServer()</td><td>-1</td><td><a class="el" href="classyarp_1_1os_1_1RpcServer.html" title="A port that is specialized as an RPC server.">yarp::os::RpcServer</a> </td></tr>
<tr>
<td>Client</td><td>port.setRpcClient()</td><td>+1</td><td><a class="el" href="classyarp_1_1os_1_1RpcClient.html" title="A port that is specialized as an RPC client.">yarp::os::RpcClient</a> </td></tr>
</table>
<p>For new code, however, it may be convenient to create ROS-like nodes and topics explicitly rather than having names that bundles node and topic/service names together.</p>
<p>One thing to watch out for is that if you stop a program using ^C or if it crashes, YARP will not yet unregister your ports with ROS. If this bothers you, either add a signal handler to close the Port, or run "rosnode cleanup" from time to time. Will fix this soon. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.8.13-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li><span id="projectname_footer">YARP</span></li>
    <li><span id="projectnumber" class="version_switch">3.2.2</span></li>
    <li class="footer">Generated on Tue Nov 3 2020 16:49:14 for YARP by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.20 </li>
  </ul>
</div>
</body>
</html>
