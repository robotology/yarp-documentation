<!-- HTML header for doxygen 1.8.12-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>YARP: src/libYARP_os/src/yarp/os/impl/DgramTwoWayStream.cpp Source File</title>
<link rel="shortcut icon" href="yarp-favicon.ico" type="image/x-icon" />
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript">
    var DOCUMENTATION_OPTIONS = { VERSION: '3.4.6' };
</script>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(function() { init_search(); });
/* @license-end */
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="yarp-doxygen-style.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../version_switch.js"></script>
<link rel="stylesheet" type="text/css" href="cookieconsent.min.css" />
<script src="cookieconsent.min.js"></script>
<script>
window.addEventListener("load", function(){
window.cookieconsent.initialise({
  "palette": {
    "popup": {
      "background": "#eb6c44",
      "text": "#ffffff"
    },
    "button": {
      "background": "#237afc",
    }
  },
  "theme": "classic",
  "content": {
    "message": "INFORMATION NOTICE ON COOKIES : This website uses only browsing/session cookies. Users can choose whether or not to accept the use of cookies and access the website. By clicking on \"Further information\", the full information notice on the types of cookies will be displayed and you will be able  to choose whether or not to accept them whilst browsing on the website.",
    "dismiss": "ACCEPT and close",
    "link": "Further information",
    "href": "http://www.icub.org/other/personal_data_notice.html"
  }
})});
</script>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="yarp-robot-64.png"/></td>
  <td id="projectalign" style="padding-left: 1.5em;">
   <div id="projectname">YARP</div>
   <div id="projectbrief">Yet Another Robot Platform</div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.svg"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.svg" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('DgramTwoWayStream_8cpp_source.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">DgramTwoWayStream.cpp</div>  </div>
</div><!--header-->
<div class="contents">
<a href="DgramTwoWayStream_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">/*</span></div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment"> * Copyright (C) 2006-2020 Istituto Italiano di Tecnologia (IIT)</span></div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment"> * Copyright (C) 2006-2010 RobotCub Consortium</span></div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment"> * All rights reserved.</span></div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment"> * This software may be modified and distributed under the terms of the</span></div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="comment"> * BSD-3-Clause license. See the accompanying LICENSE file for details.</span></div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160; </div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="preprocessor">#include &lt;<a class="code" href="DgramTwoWayStream_8h.html">yarp/os/impl/DgramTwoWayStream.h</a>&gt;</span></div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160; </div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="preprocessor">#include &lt;<a class="code" href="system_8h.html">yarp/conf/system.h</a>&gt;</span></div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="preprocessor">#include &lt;<a class="code" href="environment_8h.html">yarp/conf/environment.h</a>&gt;</span></div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160; </div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="preprocessor">#include &lt;<a class="code" href="NetType_8h.html">yarp/os/NetType.h</a>&gt;</span></div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="preprocessor">#include &lt;<a class="code" href="libYARP__os_2src_2yarp_2os_2Time_8h.html">yarp/os/Time.h</a>&gt;</span></div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="preprocessor">#include &lt;<a class="code" href="libYARP__os_2src_2yarp_2os_2impl_2LogComponent_8h.html">yarp/os/impl/LogComponent.h</a>&gt;</span></div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160; </div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="preprocessor">#if defined(YARP_HAS_ACE)</span></div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="preprocessor">#    include &lt;ace/ACE.h&gt;</span></div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="preprocessor">#    include &lt;ace/Handle_Set.h&gt;</span></div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="preprocessor">#    include &lt;ace/INET_Addr.h&gt;</span></div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="preprocessor">#    include &lt;ace/Log_Msg.h&gt;</span></div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;<span class="preprocessor">#    include &lt;ace/OS_Memory.h&gt;</span></div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;<span class="preprocessor">#    include &lt;ace/OS_NS_sys_select.h&gt;</span></div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;<span class="preprocessor">#    include &lt;ace/SOCK_Dgram.h&gt;</span></div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;<span class="preprocessor">#    include &lt;ace/SOCK_Dgram_Mcast.h&gt;</span></div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;<span class="preprocessor">#    include &lt;ace/os_include/net/os_if.h&gt;</span></div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;<span class="comment">// In one the ACE headers there is a definition of &quot;main&quot; for WIN32</span></div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;<span class="preprocessor">#    ifdef main</span></div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;<span class="preprocessor">#        undef main</span></div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;<span class="preprocessor">#    endif</span></div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;<span class="preprocessor">#else</span></div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;<span class="preprocessor">#    include &lt;arpa/inet.h&gt;</span></div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;<span class="preprocessor">#    include &lt;netinet/in.h&gt;</span></div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;<span class="preprocessor">#    include &lt;sys/socket.h&gt;</span></div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;<span class="preprocessor">#    include &lt;sys/types.h&gt;</span></div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;<span class="preprocessor">#    include &lt;unistd.h&gt;</span></div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160; </div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;<span class="preprocessor">#include &lt;cerrno&gt;</span></div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;<span class="preprocessor">#include &lt;cstring&gt;</span></div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160; </div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;<span class="keyword">using namespace </span><a class="code" href="namespaceyarp_1_1os_1_1impl.html">yarp::os::impl</a>;</div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;<span class="keyword">using namespace </span><a class="code" href="namespaceyarp_1_1os.html">yarp::os</a>;</div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160; </div>
<div class="line"><a name="l00047"></a><span class="lineno"><a class="line" href="DgramTwoWayStream_8cpp.html#aa93e89217587fdff12bf43b5d7f54f74">   47</a></span>&#160;<span class="preprocessor">#define CRC_SIZE 8</span></div>
<div class="line"><a name="l00048"></a><span class="lineno"><a class="line" href="DgramTwoWayStream_8cpp.html#ae0a51066428b22f9c74ad2d090df6c88">   48</a></span>&#160;<span class="preprocessor">#define UDP_MAX_DATAGRAM_SIZE (65507 - CRC_SIZE)</span></div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160; </div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160; </div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;<span class="keyword">namespace </span>{</div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;<a class="code" href="libYARP__os_2src_2yarp_2os_2impl_2LogComponent_8h.html#a07501992585e9038bb37b7765a6594b0">YARP_OS_LOG_COMPONENT</a>(DGRAMTWOWAYSTREAM, <span class="stringliteral">&quot;yarp.os.impl.DgramTwoWayStream&quot;</span>)</div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;} <span class="comment">// namespace</span></div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160; </div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160; </div>
<div class="line"><a name="l00056"></a><span class="lineno"><a class="line" href="DgramTwoWayStream_8cpp.html#a3f8812130ffb175a81bdb3eb5f2a0faf">   56</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="DgramTwoWayStream_8cpp.html#a3f8812130ffb175a81bdb3eb5f2a0faf">checkCrc</a>(<span class="keywordtype">char</span>* buf, <a class="code" href="namespaceyarp_1_1conf.html#a3df5afb43ff7b7cc2b4e3cb9150eab20">yarp::conf::ssize_t</a> length, <a class="code" href="namespaceyarp_1_1conf.html#a3df5afb43ff7b7cc2b4e3cb9150eab20">yarp::conf::ssize_t</a> crcLength, <span class="keywordtype">int</span> pct, <span class="keywordtype">int</span>* store_altPct = <span class="keyword">nullptr</span>)</div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;{</div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;    <span class="keyword">auto</span> alt = (<a class="code" href="namespaceyarp_1_1os.html#ab2676e32122f2ffd9eeb4301a2c06b4f">NetInt32</a>)<a class="code" href="classyarp_1_1os_1_1NetType.html#aa7e85a7bead7fad8b156b89ed48c7185">NetType::getCrc</a>(buf + crcLength,</div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;                                         (length &gt; crcLength) ? (length - crcLength) : 0);</div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;    <a class="code" href="classyarp_1_1os_1_1Bytes.html">Bytes</a> b(buf, 4);</div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;    <a class="code" href="classyarp_1_1os_1_1Bytes.html">Bytes</a> b2(buf + 4, 4);</div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;    <a class="code" href="namespaceyarp_1_1os.html#ab2676e32122f2ffd9eeb4301a2c06b4f">NetInt32</a> curr = <a class="code" href="classyarp_1_1os_1_1NetType.html#a180deac631b371563b130ee2f0c7e320">NetType::netInt</a>(b);</div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;    <span class="keywordtype">int</span> altPct = <a class="code" href="classyarp_1_1os_1_1NetType.html#a180deac631b371563b130ee2f0c7e320">NetType::netInt</a>(b2);</div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;    <span class="keywordtype">bool</span> ok = (alt == curr &amp;&amp; pct == altPct);</div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;    <span class="keywordflow">if</span> (!ok) {</div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;        <span class="keywordflow">if</span> (alt != curr) {</div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;            <a class="code" href="libYARP__os_2src_2yarp_2os_2LogComponent_8h.html#a8227343e844aca96bb821dd566d8cbb2">yCDebug</a>(DGRAMTWOWAYSTREAM, <span class="stringliteral">&quot;crc mismatch&quot;</span>);</div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;        }</div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;        <span class="keywordflow">if</span> (pct != altPct) {</div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;            <a class="code" href="libYARP__os_2src_2yarp_2os_2LogComponent_8h.html#a8227343e844aca96bb821dd566d8cbb2">yCDebug</a>(DGRAMTWOWAYSTREAM, <span class="stringliteral">&quot;packet code broken&quot;</span>);</div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;        }</div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;    }</div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;    <span class="keywordflow">if</span> (store_altPct != <span class="keyword">nullptr</span>) {</div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;        *store_altPct = altPct;</div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;    }</div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160; </div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;    <span class="keywordflow">return</span> ok;</div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;}</div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160; </div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160; </div>
<div class="line"><a name="l00081"></a><span class="lineno"><a class="line" href="DgramTwoWayStream_8cpp.html#afa693fafffe613a6f5c1283661588090">   81</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="DgramTwoWayStream_8cpp.html#afa693fafffe613a6f5c1283661588090">addCrc</a>(<span class="keywordtype">char</span>* buf, <a class="code" href="namespaceyarp_1_1conf.html#a3df5afb43ff7b7cc2b4e3cb9150eab20">yarp::conf::ssize_t</a> length, <a class="code" href="namespaceyarp_1_1conf.html#a3df5afb43ff7b7cc2b4e3cb9150eab20">yarp::conf::ssize_t</a> crcLength, <span class="keywordtype">int</span> pct)</div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;{</div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;    <span class="keyword">auto</span> alt = (<a class="code" href="namespaceyarp_1_1os.html#ab2676e32122f2ffd9eeb4301a2c06b4f">NetInt32</a>)<a class="code" href="classyarp_1_1os_1_1NetType.html#aa7e85a7bead7fad8b156b89ed48c7185">NetType::getCrc</a>(buf + crcLength,</div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;                                         (length &gt; crcLength) ? (length - crcLength) : 0);</div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;    <a class="code" href="classyarp_1_1os_1_1Bytes.html">Bytes</a> b(buf, 4);</div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;    <a class="code" href="classyarp_1_1os_1_1Bytes.html">Bytes</a> b2(buf + 4, 4);</div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;    <a class="code" href="classyarp_1_1os_1_1NetType.html#a180deac631b371563b130ee2f0c7e320">NetType::netInt</a>((<a class="code" href="namespaceyarp_1_1os.html#ab2676e32122f2ffd9eeb4301a2c06b4f">NetInt32</a>)alt, b);</div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;    <a class="code" href="classyarp_1_1os_1_1NetType.html#a180deac631b371563b130ee2f0c7e320">NetType::netInt</a>((<a class="code" href="namespaceyarp_1_1os.html#ab2676e32122f2ffd9eeb4301a2c06b4f">NetInt32</a>)pct, b2);</div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;}</div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160; </div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160; </div>
<div class="line"><a name="l00092"></a><span class="lineno"><a class="line" href="classyarp_1_1os_1_1impl_1_1DgramTwoWayStream.html#a421205cfcf35495ea9e518e1d8eba805">   92</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="classyarp_1_1os_1_1impl_1_1DgramTwoWayStream.html#a421205cfcf35495ea9e518e1d8eba805">DgramTwoWayStream::open</a>(<span class="keyword">const</span> <a class="code" href="classyarp_1_1os_1_1Contact.html">Contact</a>&amp; remote)</div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;{</div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;<span class="preprocessor">#if defined(YARP_HAS_ACE)</span></div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;    ACE_INET_Addr anywhere((u_short)0, (ACE_UINT32)INADDR_ANY);</div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;    <a class="code" href="classyarp_1_1os_1_1Contact.html">Contact</a> local(anywhere.get_host_addr(),</div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;                  anywhere.get_port_number());</div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;<span class="preprocessor">#else</span></div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;    <a class="code" href="classyarp_1_1os_1_1Contact.html">Contact</a> local(<span class="stringliteral">&quot;localhost&quot;</span>, -1);</div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;    <span class="keywordflow">return</span> open(local, remote);</div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;}</div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160; </div>
<div class="line"><a name="l00104"></a><span class="lineno"><a class="line" href="classyarp_1_1os_1_1impl_1_1DgramTwoWayStream.html#a6626f3968b26a2f68c71b1ead232c184">  104</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="classyarp_1_1os_1_1impl_1_1DgramTwoWayStream.html#a421205cfcf35495ea9e518e1d8eba805">DgramTwoWayStream::open</a>(<span class="keyword">const</span> <a class="code" href="classyarp_1_1os_1_1Contact.html">Contact</a>&amp; local, <span class="keyword">const</span> <a class="code" href="classyarp_1_1os_1_1Contact.html">Contact</a>&amp; remote)</div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;{</div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;    localAddress = local;</div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;    remoteAddress = remote;</div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160; </div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;<span class="preprocessor">#if defined(YARP_HAS_ACE)</span></div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;    localHandle = ACE_INET_Addr((u_short)(localAddress.getPort()), (ACE_UINT32)INADDR_ANY);</div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;    <span class="keywordflow">if</span> (remote.<a class="code" href="classyarp_1_1os_1_1Contact.html#a44450481ce5c8dd99f3a75eb9c8f310f">isValid</a>()) {</div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;        remoteHandle.set(remoteAddress.getPort(), remoteAddress.getHost().c_str());</div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;    }</div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;    dgram = <span class="keyword">new</span> ACE_SOCK_Dgram;</div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;    <a class="code" href="libYARP__os_2src_2yarp_2os_2LogComponent_8h.html#a2a73589cc2da13516a620f1b86ef17a0">yCAssert</a>(DGRAMTWOWAYSTREAM, dgram != <span class="keyword">nullptr</span>);</div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160; </div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;    <span class="keywordtype">int</span> result = dgram-&gt;open(localHandle,</div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;                             ACE_PROTOCOL_FAMILY_INET,</div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;                             0,</div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;                             1);</div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;<span class="preprocessor">#else</span></div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;    dgram = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;    dgram_sockfd = -1;</div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160; </div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;    <span class="keywordtype">int</span> s = -1;</div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;    <span class="keywordflow">if</span> ((s = socket(AF_INET, SOCK_DGRAM, IPPROTO_UDP)) == -1) {</div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;        std::exit(1);</div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;    }</div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;    <span class="keyword">struct </span>sockaddr_in dgram_sin;</div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;    memset((<span class="keywordtype">char</span>*)&amp;dgram_sin, 0, <span class="keyword">sizeof</span>(dgram_sin));</div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;    dgram_sin.sin_family = AF_INET;</div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;    dgram_sin.sin_addr.s_addr = htonl(INADDR_ANY);</div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;    dgram_sin.sin_port = htons(remote.<a class="code" href="classyarp_1_1os_1_1Contact.html#ab4312ee491059450c68ab85bb713b44f">getPort</a>());</div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;    <span class="keywordflow">if</span> (local.isValid()) {</div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;        <span class="keywordflow">if</span> (inet_pton(AF_INET, remote.<a class="code" href="classyarp_1_1os_1_1Contact.html#af2fa156ae18485d859ef8c859f43eca1">getHost</a>().c_str(), &amp;dgram_sin.sin_addr) == 0) {</div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;            <a class="code" href="libYARP__os_2src_2yarp_2os_2LogComponent_8h.html#a224fd66c5d833ba0367a2ed54bcc279a">yCError</a>(DGRAMTWOWAYSTREAM, <span class="stringliteral">&quot;could not set up udp client&quot;</span>);</div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;            std::exit(1);</div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;        }</div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;        <span class="keywordflow">if</span> (connect(s, (<span class="keyword">struct</span> sockaddr*)&amp;dgram_sin, <span class="keyword">sizeof</span>(dgram_sin)) == -1) {</div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;            <a class="code" href="libYARP__os_2src_2yarp_2os_2LogComponent_8h.html#a224fd66c5d833ba0367a2ed54bcc279a">yCError</a>(DGRAMTWOWAYSTREAM, <span class="stringliteral">&quot;could not connect udp client&quot;</span>);</div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;            std::exit(1);</div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;        }</div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;        <span class="keywordflow">if</span> (bind(s, (<span class="keyword">struct</span> sockaddr*)&amp;dgram_sin, <span class="keyword">sizeof</span>(dgram_sin)) == -1) {</div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;            <a class="code" href="libYARP__os_2src_2yarp_2os_2LogComponent_8h.html#a224fd66c5d833ba0367a2ed54bcc279a">yCError</a>(DGRAMTWOWAYSTREAM, <span class="stringliteral">&quot;could not create udp server&quot;</span>);</div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;            std::exit(1);</div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;        }</div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;    }</div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;    dgram_sockfd = s;</div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;    dgram = <span class="keyword">this</span>;</div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;    <span class="keywordtype">int</span> result = -1;</div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;    <span class="keywordtype">int</span> local_port = -1;</div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160; </div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;    <span class="keyword">struct </span>sockaddr_in sin;</div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;    socklen_t len = <span class="keyword">sizeof</span>(sin);</div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;    <span class="keywordflow">if</span> (getsockname(dgram_sockfd, (<span class="keyword">struct</span> sockaddr*)&amp;sin, &amp;len) == 0 &amp;&amp; sin.sin_family == AF_INET) {</div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;        result = 0;</div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;        local_port = ntohs(sin.sin_port);</div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;    }</div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160; </div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;    <span class="keywordflow">if</span> (result != 0) {</div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;        <a class="code" href="libYARP__os_2src_2yarp_2os_2LogComponent_8h.html#a224fd66c5d833ba0367a2ed54bcc279a">yCError</a>(DGRAMTWOWAYSTREAM, <span class="stringliteral">&quot;could not open datagram socket&quot;</span>);</div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;    }</div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160; </div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;    configureSystemBuffers();</div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160; </div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;<span class="preprocessor">#if defined(YARP_HAS_ACE)</span></div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;    dgram-&gt;get_local_addr(localHandle);</div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;    <a class="code" href="libYARP__os_2src_2yarp_2os_2LogComponent_8h.html#a8227343e844aca96bb821dd566d8cbb2">yCDebug</a>(DGRAMTWOWAYSTREAM, <span class="stringliteral">&quot;starting DGRAM entity on port number %u&quot;</span>,localHandle.get_port_number());</div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;    localAddress = <a class="code" href="classyarp_1_1os_1_1Contact.html">Contact</a>(<span class="stringliteral">&quot;127.0.0.1&quot;</span>, localHandle.get_port_number());</div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;<span class="preprocessor">#else</span></div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;    localAddress = <a class="code" href="classyarp_1_1os_1_1Contact.html">Contact</a>(<span class="stringliteral">&quot;127.0.0.1&quot;</span>, local_port);</div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160; </div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;    <a class="code" href="libYARP__os_2src_2yarp_2os_2LogComponent_8h.html#a8227343e844aca96bb821dd566d8cbb2">yCDebug</a>(DGRAMTWOWAYSTREAM, <span class="stringliteral">&quot;Update: DGRAM from %s to %s&quot;</span>, localAddress.toURI().c_str(), remoteAddress.toURI().c_str());</div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160; </div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;    allocate();</div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160; </div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;}</div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160; </div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;<span class="keywordtype">void</span> DgramTwoWayStream::allocate(<span class="keywordtype">int</span> readSize, <span class="keywordtype">int</span> writeSize)</div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;{</div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;    <span class="comment">//These are only as another default. We should modify the method to return bool</span></div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;    <span class="comment">//and fail if we cannot read the socket size.</span></div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160; </div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;    <span class="keywordtype">int</span> _read_size = -1;</div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;    <span class="keywordtype">int</span> _write_size = -1;</div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160; </div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;    std::string _env_dgram = <a class="code" href="namespaceyarp_1_1conf_1_1environment.html#a7903710562dc58e7d8c23fabb9c9fda6">yarp::conf::environment::getEnvironment</a>(<span class="stringliteral">&quot;YARP_DGRAM_SIZE&quot;</span>);</div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;    std::string _env_mode;</div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;    <span class="keywordflow">if</span> (multiMode) {</div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;        _env_mode = <a class="code" href="namespaceyarp_1_1conf_1_1environment.html#a7903710562dc58e7d8c23fabb9c9fda6">yarp::conf::environment::getEnvironment</a>(<span class="stringliteral">&quot;YARP_MCAST_SIZE&quot;</span>);</div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;        _env_mode = <a class="code" href="namespaceyarp_1_1conf_1_1environment.html#a7903710562dc58e7d8c23fabb9c9fda6">yarp::conf::environment::getEnvironment</a>(<span class="stringliteral">&quot;YARP_UDP_SIZE&quot;</span>);</div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;    }</div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;    <span class="keywordflow">if</span> (!_env_mode.empty()) {</div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;        _env_dgram = _env_mode;</div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;    }</div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;    <span class="keywordflow">if</span> (!_env_dgram.empty()) {</div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;        <span class="keywordtype">int</span> sz = <a class="code" href="classyarp_1_1os_1_1NetType.html#ae376a87cb0d9c158ad094c94e013907e">NetType::toInt</a>(_env_dgram);</div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;        <span class="keywordflow">if</span> (sz != 0) {</div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;            _read_size = _write_size = sz;</div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;        }</div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;        <a class="code" href="libYARP__os_2src_2yarp_2os_2LogComponent_8h.html#a18e11e963a9867766b3ac49614348799">yCInfo</a>(DGRAMTWOWAYSTREAM, <span class="stringliteral">&quot;Datagram packet size set to %d&quot;</span>, _read_size);</div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;    }</div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;    <span class="keywordflow">if</span> (readSize != 0) {</div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;        _read_size = readSize;</div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;        <a class="code" href="libYARP__os_2src_2yarp_2os_2LogComponent_8h.html#a18e11e963a9867766b3ac49614348799">yCInfo</a>(DGRAMTWOWAYSTREAM, <span class="stringliteral">&quot;Datagram read size reset to %d&quot;</span>, _read_size);</div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;    }</div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;    <span class="keywordflow">if</span> (writeSize != 0) {</div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;        _write_size = writeSize;</div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;        <a class="code" href="libYARP__os_2src_2yarp_2os_2LogComponent_8h.html#a18e11e963a9867766b3ac49614348799">yCInfo</a>(DGRAMTWOWAYSTREAM, <span class="stringliteral">&quot;Datagram write size reset to %d&quot;</span>, _write_size);</div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;    }</div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160; </div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;    <span class="comment">// force the size of the write buffer to be under the max size of a udp datagram.</span></div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;    <span class="keywordflow">if</span> (_write_size &gt; <a class="code" href="DgramTwoWayStream_8cpp.html#ae0a51066428b22f9c74ad2d090df6c88">UDP_MAX_DATAGRAM_SIZE</a> || _write_size &lt; 0) {</div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;        _write_size = <a class="code" href="DgramTwoWayStream_8cpp.html#ae0a51066428b22f9c74ad2d090df6c88">UDP_MAX_DATAGRAM_SIZE</a>;</div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;    }</div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160; </div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;    <span class="keywordflow">if</span> (_read_size &lt; 0) {</div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;<span class="preprocessor">#if defined(YARP_HAS_ACE)</span></div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;        <span class="comment">//Defaults to socket size</span></div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;        <span class="keywordflow">if</span> (dgram != <span class="keyword">nullptr</span>) {</div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;            <span class="keywordtype">int</span> len = <span class="keyword">sizeof</span>(_read_size);</div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;            <span class="keywordtype">int</span> result = dgram-&gt;get_option(SOL_SOCKET, SO_RCVBUF, &amp;_read_size, &amp;len);</div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;            <span class="keywordflow">if</span> (result &lt; 0) {</div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;                <a class="code" href="libYARP__os_2src_2yarp_2os_2LogComponent_8h.html#a224fd66c5d833ba0367a2ed54bcc279a">yCError</a>(DGRAMTWOWAYSTREAM, <span class="stringliteral">&quot;Failed to read buffer size from RCVBUF socket with error: %s. Setting read buffer size to UDP_MAX_DATAGRAM_SIZE.&quot;</span>,</div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;                           strerror(errno));</div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;                _read_size = <a class="code" href="DgramTwoWayStream_8cpp.html#ae0a51066428b22f9c74ad2d090df6c88">UDP_MAX_DATAGRAM_SIZE</a>;</div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;            }</div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;        }</div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;<span class="preprocessor">#else</span></div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;        socklen_t len = <span class="keyword">sizeof</span>(_read_size);</div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160; </div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;        <span class="keywordtype">int</span> result = getsockopt(dgram_sockfd, SOL_SOCKET, SO_RCVBUF, &amp;_read_size, &amp;len);</div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;        <span class="keywordflow">if</span> (result &lt; 0) {</div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;            <a class="code" href="libYARP__os_2src_2yarp_2os_2LogComponent_8h.html#a224fd66c5d833ba0367a2ed54bcc279a">yCError</a>(DGRAMTWOWAYSTREAM, <span class="stringliteral">&quot;Failed to read buffer size from RCVBUF socket with error: %s. Setting read buffer size to UDP_MAX_DATAGRAM_SIZE.&quot;</span>,</div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;                       strerror(errno));</div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;            _read_size = <a class="code" href="DgramTwoWayStream_8cpp.html#ae0a51066428b22f9c74ad2d090df6c88">UDP_MAX_DATAGRAM_SIZE</a>;</div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;        }</div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;    }</div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160; </div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;    readBuffer.allocate(_read_size);</div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;    writeBuffer.allocate(_write_size);</div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;    readAt = 0;</div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;    readAvail = 0;</div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;    writeAvail = <a class="code" href="DgramTwoWayStream_8cpp.html#aa93e89217587fdff12bf43b5d7f54f74">CRC_SIZE</a>;</div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;    <span class="comment">//happy = true;</span></div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;    pct = 0;</div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;}</div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160; </div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160; </div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;<span class="keywordtype">void</span> DgramTwoWayStream::configureSystemBuffers()</div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;{</div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;    <span class="comment">//By default the buffers are forced to the datagram size limit.</span></div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;    <span class="comment">//These can be overwritten by environment variables</span></div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;    <span class="comment">//Generic variable</span></div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;    std::string socketBufferSize = <a class="code" href="namespaceyarp_1_1conf_1_1environment.html#a7903710562dc58e7d8c23fabb9c9fda6">yarp::conf::environment::getEnvironment</a>(<span class="stringliteral">&quot;YARP_DGRAM_BUFFER_SIZE&quot;</span>);</div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;    <span class="comment">//Specific read</span></div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;    std::string socketReadBufferSize = <a class="code" href="namespaceyarp_1_1conf_1_1environment.html#a7903710562dc58e7d8c23fabb9c9fda6">yarp::conf::environment::getEnvironment</a>(<span class="stringliteral">&quot;YARP_DGRAM_RECV_BUFFER_SIZE&quot;</span>);</div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;    <span class="comment">//Specific write</span></div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;    std::string socketSendBufferSize = <a class="code" href="namespaceyarp_1_1conf_1_1environment.html#a7903710562dc58e7d8c23fabb9c9fda6">yarp::conf::environment::getEnvironment</a>(<span class="stringliteral">&quot;YARP_DGRAM_SND_BUFFER_SIZE&quot;</span>);</div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160; </div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;    <span class="keywordtype">int</span> readBufferSize = -1;</div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;    <span class="keywordflow">if</span> (!socketReadBufferSize.empty()) {</div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;        readBufferSize = <a class="code" href="classyarp_1_1os_1_1NetType.html#ae376a87cb0d9c158ad094c94e013907e">NetType::toInt</a>(socketReadBufferSize);</div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!socketBufferSize.empty()) {</div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;        readBufferSize = <a class="code" href="classyarp_1_1os_1_1NetType.html#ae376a87cb0d9c158ad094c94e013907e">NetType::toInt</a>(socketBufferSize);</div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;    }</div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160; </div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;    <span class="keywordtype">int</span> writeBufferSize = -1;</div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;    <span class="keywordflow">if</span> (!socketSendBufferSize.empty()) {</div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;        writeBufferSize = <a class="code" href="classyarp_1_1os_1_1NetType.html#ae376a87cb0d9c158ad094c94e013907e">NetType::toInt</a>(socketSendBufferSize);</div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!socketBufferSize.empty()) {</div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;        writeBufferSize = <a class="code" href="classyarp_1_1os_1_1NetType.html#ae376a87cb0d9c158ad094c94e013907e">NetType::toInt</a>(socketBufferSize);</div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;    }</div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;    <span class="comment">// The writeBufferSize can&#39;t be set greater than udp datagram</span></div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;    <span class="comment">// maximum size</span></div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;    <span class="keywordflow">if</span> (writeBufferSize &lt; 0 || writeBufferSize &gt; <a class="code" href="DgramTwoWayStream_8cpp.html#ae0a51066428b22f9c74ad2d090df6c88">UDP_MAX_DATAGRAM_SIZE</a>) {</div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;        <span class="keywordflow">if</span> (writeBufferSize &gt; <a class="code" href="DgramTwoWayStream_8cpp.html#ae0a51066428b22f9c74ad2d090df6c88">UDP_MAX_DATAGRAM_SIZE</a>) {</div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;            <a class="code" href="libYARP__os_2src_2yarp_2os_2LogComponent_8h.html#a677a97e364857e0eafefacd5cff5dc7e">yCWarning</a>(DGRAMTWOWAYSTREAM, <span class="stringliteral">&quot;The desired SND buffer size is too big. It is set to the max datagram size : %d&quot;</span>,</div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;                         <a class="code" href="DgramTwoWayStream_8cpp.html#ae0a51066428b22f9c74ad2d090df6c88">UDP_MAX_DATAGRAM_SIZE</a>);</div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;        }</div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;        writeBufferSize = <a class="code" href="DgramTwoWayStream_8cpp.html#ae0a51066428b22f9c74ad2d090df6c88">UDP_MAX_DATAGRAM_SIZE</a>;</div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;    }</div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160; </div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;    <span class="keywordflow">if</span> (readBufferSize &gt; 0) {</div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;        <span class="keywordtype">int</span> actualReadSize = -1;</div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160; </div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;<span class="preprocessor">#if defined(YARP_HAS_ACE)</span></div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;        <span class="keywordtype">int</span> intSize = <span class="keyword">sizeof</span>(readBufferSize);</div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;        <span class="keywordtype">int</span> setResult = dgram-&gt;set_option(SOL_SOCKET, SO_RCVBUF, (<span class="keywordtype">void</span>*)&amp;readBufferSize, intSize);</div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160; </div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;        <span class="keywordtype">int</span> getResult = dgram-&gt;get_option(SOL_SOCKET, SO_RCVBUF, (<span class="keywordtype">void</span>*)&amp;actualReadSize, &amp;intSize);</div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;<span class="preprocessor">#else</span></div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;        socklen_t intSize = <span class="keyword">sizeof</span>(readBufferSize);</div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;        <span class="keywordtype">int</span> setResult = setsockopt(dgram_sockfd, SOL_SOCKET, SO_RCVBUF, (<span class="keywordtype">void</span>*)&amp;readBufferSize, intSize);</div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;        <span class="keywordtype">int</span> getResult = getsockopt(dgram_sockfd, SOL_SOCKET, SO_RCVBUF, (<span class="keywordtype">void</span>*)&amp;actualReadSize, &amp;intSize);</div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;        <span class="comment">// in linux the value returned by getsockopt is &quot;doubled&quot;</span></div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;        <span class="comment">// for some unknown reasons (see https://linux.die.net/man/7/socket)</span></div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;<span class="preprocessor">#if defined(__linux__)</span></div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;        actualReadSize /= 2;</div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;        <span class="keywordflow">if</span> (setResult &lt; 0 || getResult &lt; 0 || readBufferSize != actualReadSize) {</div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;            bufferAlertNeeded = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;            bufferAlerted = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;            <a class="code" href="libYARP__os_2src_2yarp_2os_2LogComponent_8h.html#a677a97e364857e0eafefacd5cff5dc7e">yCWarning</a>(DGRAMTWOWAYSTREAM, <span class="stringliteral">&quot;Failed to set RECV socket buffer to desired size. Actual: %d, Desired %d&quot;</span>,</div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;                         actualReadSize,</div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;                         readBufferSize);</div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;        }</div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;    }</div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;    <span class="keywordflow">if</span> (writeBufferSize &gt; 0) {</div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;        <span class="keywordtype">int</span> actualWriteSize = -1;</div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;<span class="preprocessor">#if defined(YARP_HAS_ACE)</span></div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;        <span class="keywordtype">int</span> intSize = <span class="keyword">sizeof</span>(writeBufferSize);</div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;        <span class="keywordtype">int</span> setResult = dgram-&gt;set_option(SOL_SOCKET, SO_SNDBUF, (<span class="keywordtype">void</span>*)&amp;writeBufferSize, intSize);</div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;        <span class="keywordtype">int</span> getResult = dgram-&gt;get_option(SOL_SOCKET, SO_SNDBUF, (<span class="keywordtype">void</span>*)&amp;actualWriteSize, &amp;intSize);</div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;<span class="preprocessor">#else</span></div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;        socklen_t intSize = <span class="keyword">sizeof</span>(writeBufferSize);</div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;        <span class="keywordtype">int</span> setResult = setsockopt(dgram_sockfd, SOL_SOCKET, SO_SNDBUF, (<span class="keywordtype">void</span>*)&amp;writeBufferSize, intSize);</div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;        <span class="keywordtype">int</span> getResult = getsockopt(dgram_sockfd, SOL_SOCKET, SO_SNDBUF, (<span class="keywordtype">void</span>*)&amp;actualWriteSize, &amp;intSize);</div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;        <span class="comment">// in linux the value returned by getsockopt is &quot;doubled&quot;</span></div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;        <span class="comment">// for some unknown reasons (see https://linux.die.net/man/7/socket)</span></div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;<span class="preprocessor">#if defined(__linux__)</span></div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;        actualWriteSize /= 2;</div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;        <span class="keywordflow">if</span> (setResult &lt; 0 || getResult &lt; 0 || writeBufferSize != actualWriteSize) {</div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;            bufferAlertNeeded = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;            bufferAlerted = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;            <a class="code" href="libYARP__os_2src_2yarp_2os_2LogComponent_8h.html#a677a97e364857e0eafefacd5cff5dc7e">yCWarning</a>(DGRAMTWOWAYSTREAM, <span class="stringliteral">&quot;Failed to set SND socket buffer to desired size. Actual: %d, Desired: %d&quot;</span>,</div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;                         actualWriteSize,</div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;                         writeBufferSize);</div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;        }</div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;    }</div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;}</div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160; </div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160; </div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;<span class="preprocessor">#if defined(YARP_HAS_ACE)</span></div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;<span class="keywordtype">int</span> DgramTwoWayStream::restrictMcast(ACE_SOCK_Dgram_Mcast* dmcast,</div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;                                     <span class="keyword">const</span> <a class="code" href="classyarp_1_1os_1_1Contact.html">Contact</a>&amp; group,</div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;                                     <span class="keyword">const</span> <a class="code" href="classyarp_1_1os_1_1Contact.html">Contact</a>&amp; ipLocal,</div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;                                     <span class="keywordtype">bool</span> add)</div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;{</div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;    restrictInterfaceIp = ipLocal;</div>
<div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160; </div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;    <a class="code" href="libYARP__os_2src_2yarp_2os_2LogComponent_8h.html#a18e11e963a9867766b3ac49614348799">yCInfo</a>(DGRAMTWOWAYSTREAM, <span class="stringliteral">&quot;multicast connection %s on network interface for %s&quot;</span>, group.<a class="code" href="classyarp_1_1os_1_1Contact.html#af2fa156ae18485d859ef8c859f43eca1">getHost</a>().c_str(), ipLocal.<a class="code" href="classyarp_1_1os_1_1Contact.html#af2fa156ae18485d859ef8c859f43eca1">getHost</a>().c_str());</div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;    <span class="keywordtype">int</span> result = -1;</div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;    <span class="comment">// There&#39;s some major damage in ACE mcast interfaces.</span></div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;    <span class="comment">// Most require interface names, yet provide no way to query</span></div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;    <span class="comment">// these names - and in the end, convert to IP addresses.</span></div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;    <span class="comment">// Here we try to do an end run around ACE.</span></div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160; </div>
<div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;    <span class="comment">// based on: ACE_SOCK_Dgram::set_nic</span></div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160; </div>
<div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;    ip_mreq multicast_address;</div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;    ACE_INET_Addr group_addr(group.<a class="code" href="classyarp_1_1os_1_1Contact.html#ab4312ee491059450c68ab85bb713b44f">getPort</a>(),</div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;                             group.<a class="code" href="classyarp_1_1os_1_1Contact.html#af2fa156ae18485d859ef8c859f43eca1">getHost</a>().c_str());</div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;    ACE_INET_Addr interface_addr(ipLocal.<a class="code" href="classyarp_1_1os_1_1Contact.html#ab4312ee491059450c68ab85bb713b44f">getPort</a>(),</div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;                                 ipLocal.<a class="code" href="classyarp_1_1os_1_1Contact.html#af2fa156ae18485d859ef8c859f43eca1">getHost</a>().c_str());</div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;    multicast_address.imr_interface.s_addr = htonl(interface_addr.get_ip_address());</div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;    multicast_address.imr_multiaddr.s_addr = htonl(group_addr.get_ip_address());</div>
<div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160; </div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;    <span class="keywordflow">if</span> (add) {</div>
<div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;        <a class="code" href="libYARP__os_2src_2yarp_2os_2LogComponent_8h.html#a8227343e844aca96bb821dd566d8cbb2">yCDebug</a>(DGRAMTWOWAYSTREAM, <span class="stringliteral">&quot;Trying to correct mcast membership...&quot;</span>);</div>
<div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;        result = ((ACE_SOCK*)dmcast)-&gt;set_option(IPPROTO_IP, IP_ADD_MEMBERSHIP, &amp;multicast_address, <span class="keyword">sizeof</span>(<span class="keyword">struct</span> ip_mreq));</div>
<div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;        <a class="code" href="libYARP__os_2src_2yarp_2os_2LogComponent_8h.html#a8227343e844aca96bb821dd566d8cbb2">yCDebug</a>(DGRAMTWOWAYSTREAM, <span class="stringliteral">&quot;Trying to correct mcast output...&quot;</span>);</div>
<div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;        result = ((ACE_SOCK*)dmcast)-&gt;set_option(IPPROTO_IP, IP_MULTICAST_IF, &amp;multicast_address.imr_interface.s_addr, <span class="keyword">sizeof</span>(<span class="keyword">struct</span> in_addr));</div>
<div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;    }</div>
<div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;    <span class="keywordflow">if</span> (result != 0) {</div>
<div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;        <span class="keywordtype">int</span> num = errno;</div>
<div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;        <a class="code" href="libYARP__os_2src_2yarp_2os_2LogComponent_8h.html#a8227343e844aca96bb821dd566d8cbb2">yCDebug</a>(DGRAMTWOWAYSTREAM, <span class="stringliteral">&quot;mcast result: %s&quot;</span>, strerror(num));</div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;        <span class="keywordflow">if</span> (num == 98) {</div>
<div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;            <span class="comment">// our membership is already correct / Address already in use</span></div>
<div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;            result = 0;</div>
<div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;        }</div>
<div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;        result = 0; <span class="comment">// in fact, best to proceed for Windows.</span></div>
<div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;    }</div>
<div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160; </div>
<div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;    <span class="keywordflow">return</span> result;</div>
<div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;}</div>
<div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160; </div>
<div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160; </div>
<div class="line"><a name="l00391"></a><span class="lineno"><a class="line" href="classyarp_1_1os_1_1impl_1_1DgramTwoWayStream.html#a8b3cbebddac01498d48a7204a3e664d8">  391</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="classyarp_1_1os_1_1impl_1_1DgramTwoWayStream.html#a8b3cbebddac01498d48a7204a3e664d8">DgramTwoWayStream::openMcast</a>(<span class="keyword">const</span> <a class="code" href="classyarp_1_1os_1_1Contact.html">Contact</a>&amp; group,</div>
<div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;                                  <span class="keyword">const</span> <a class="code" href="classyarp_1_1os_1_1Contact.html">Contact</a>&amp; ipLocal)</div>
<div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;{</div>
<div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160; </div>
<div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;    multiMode = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160; </div>
<div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;    localAddress = ipLocal;</div>
<div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160; </div>
<div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;<span class="preprocessor">#if defined(YARP_HAS_ACE)</span></div>
<div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;    localHandle = ACE_INET_Addr((u_short)(localAddress.getPort()),</div>
<div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;                                (ACE_UINT32)INADDR_ANY);</div>
<div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160; </div>
<div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;    ACE_SOCK_Dgram_Mcast::options mcastOptions = ACE_SOCK_Dgram_Mcast::DEFOPTS;</div>
<div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;<span class="preprocessor">#    if defined(__APPLE__)</span></div>
<div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;    mcastOptions = <span class="keyword">static_cast&lt;</span>ACE_SOCK_Dgram_Mcast::options<span class="keyword">&gt;</span>(ACE_SOCK_Dgram_Mcast::OPT_BINDADDR_NO | ACE_SOCK_Dgram_Mcast::DEFOPT_NULLIFACE);</div>
<div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;<span class="preprocessor">#    endif</span></div>
<div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160; </div>
<div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;    <span class="keyword">auto</span>* dmcast = <span class="keyword">new</span> ACE_SOCK_Dgram_Mcast(mcastOptions);</div>
<div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;    dgram = dmcast;</div>
<div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;    mgram = dmcast;</div>
<div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;    <a class="code" href="libYARP__os_2src_2yarp_2os_2LogComponent_8h.html#a2a73589cc2da13516a620f1b86ef17a0">yCAssert</a>(DGRAMTWOWAYSTREAM, dgram != <span class="keyword">nullptr</span>);</div>
<div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160; </div>
<div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;    <span class="keywordtype">int</span> result = -1;</div>
<div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;    ACE_INET_Addr addr(group.<a class="code" href="classyarp_1_1os_1_1Contact.html#ab4312ee491059450c68ab85bb713b44f">getPort</a>(), group.<a class="code" href="classyarp_1_1os_1_1Contact.html#af2fa156ae18485d859ef8c859f43eca1">getHost</a>().c_str());</div>
<div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;    result = dmcast-&gt;open(addr, <span class="keyword">nullptr</span>, 1);</div>
<div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;    <span class="keywordflow">if</span> (result == 0) {</div>
<div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;        result = restrictMcast(dmcast, group, ipLocal, <span class="keyword">false</span>);</div>
<div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;    }</div>
<div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160; </div>
<div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;    <span class="keywordflow">if</span> (result != 0) {</div>
<div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;        <a class="code" href="libYARP__os_2src_2yarp_2os_2LogComponent_8h.html#a224fd66c5d833ba0367a2ed54bcc279a">yCError</a>(DGRAMTWOWAYSTREAM, <span class="stringliteral">&quot;could not open multicast datagram socket&quot;</span>);</div>
<div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;    }</div>
<div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160; </div>
<div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;<span class="preprocessor">#else</span></div>
<div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;    dgram = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;    dgram_sockfd = -1;</div>
<div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160; </div>
<div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;    <span class="keywordtype">int</span> s = -1;</div>
<div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;    <span class="keyword">struct </span>sockaddr_in dgram_sin;</div>
<div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;    <span class="comment">// create what looks like an ordinary UDP socket</span></div>
<div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;    <span class="keywordflow">if</span> ((s = socket(AF_INET, SOCK_DGRAM, IPPROTO_UDP)) == -1) {</div>
<div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;        <a class="code" href="libYARP__os_2src_2yarp_2os_2LogComponent_8h.html#a224fd66c5d833ba0367a2ed54bcc279a">yCError</a>(DGRAMTWOWAYSTREAM, <span class="stringliteral">&quot;could not create sender socket&quot;</span>);</div>
<div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;        std::exit(1);</div>
<div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;    }</div>
<div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;    <span class="comment">// set up destination address</span></div>
<div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;    memset((<span class="keywordtype">char</span>*)&amp;dgram_sin, 0, <span class="keyword">sizeof</span>(dgram_sin));</div>
<div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;    dgram_sin.sin_family = AF_INET;</div>
<div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;    dgram_sin.sin_port = htons(group.<a class="code" href="classyarp_1_1os_1_1Contact.html#ab4312ee491059450c68ab85bb713b44f">getPort</a>());</div>
<div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160; </div>
<div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160; </div>
<div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;    <span class="keywordflow">if</span> (inet_pton(AF_INET, group.<a class="code" href="classyarp_1_1os_1_1Contact.html#af2fa156ae18485d859ef8c859f43eca1">getHost</a>().c_str(), &amp;dgram_sin.sin_addr) == 0) {</div>
<div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;        <a class="code" href="libYARP__os_2src_2yarp_2os_2LogComponent_8h.html#a224fd66c5d833ba0367a2ed54bcc279a">yCError</a>(DGRAMTWOWAYSTREAM, <span class="stringliteral">&quot;could not set up mcast client&quot;</span>);</div>
<div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;        std::exit(1);</div>
<div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;    }</div>
<div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;    <span class="keywordflow">if</span> (connect(s, (<span class="keyword">struct</span> sockaddr*)&amp;dgram_sin, <span class="keyword">sizeof</span>(dgram_sin)) == -1) {</div>
<div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;        <a class="code" href="libYARP__os_2src_2yarp_2os_2LogComponent_8h.html#a224fd66c5d833ba0367a2ed54bcc279a">yCError</a>(DGRAMTWOWAYSTREAM, <span class="stringliteral">&quot;could not connect mcast client&quot;</span>);</div>
<div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;        std::exit(1);</div>
<div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;    }</div>
<div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160; </div>
<div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160; </div>
<div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;    dgram_sockfd = s;</div>
<div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;    dgram = <span class="keyword">this</span>;</div>
<div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;    <span class="keywordtype">int</span> local_port = -1;</div>
<div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160; </div>
<div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;    <span class="keyword">struct </span>sockaddr_in sin;</div>
<div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;    socklen_t len = <span class="keyword">sizeof</span>(sin);</div>
<div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;    <span class="keywordflow">if</span> (getsockname(dgram_sockfd, (<span class="keyword">struct</span> sockaddr*)&amp;sin, &amp;len) == 0 &amp;&amp; sin.sin_family == AF_INET) {</div>
<div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;        local_port = ntohs(sin.sin_port);</div>
<div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;    }</div>
<div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160; </div>
<div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160; </div>
<div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;    configureSystemBuffers();</div>
<div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;    remoteAddress = group;</div>
<div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;<span class="preprocessor">#ifdef YARP_HAS_ACE</span></div>
<div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160; </div>
<div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;    localHandle.set(localAddress.getPort(), localAddress.getHost().c_str());</div>
<div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;    remoteHandle.set(remoteAddress.getPort(), remoteAddress.getHost().c_str());</div>
<div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;<span class="preprocessor">#else</span></div>
<div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160; </div>
<div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;    remoteAddress = group;</div>
<div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;    localAddress = <a class="code" href="classyarp_1_1os_1_1Contact.html">Contact</a>(<span class="stringliteral">&quot;127.0.0.1&quot;</span>, local_port);</div>
<div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;    localHandle = local_port;</div>
<div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;    remoteHandle = remoteAddress.getPort();</div>
<div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160; </div>
<div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160; </div>
<div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;    <a class="code" href="libYARP__os_2src_2yarp_2os_2LogComponent_8h.html#a8227343e844aca96bb821dd566d8cbb2">yCDebug</a>(DGRAMTWOWAYSTREAM, <span class="stringliteral">&quot;Update: DGRAM from %s to %s&quot;</span>, localAddress.toURI().c_str(), remoteAddress.toURI().c_str());</div>
<div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;    allocate();</div>
<div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160; </div>
<div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;}</div>
<div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160; </div>
<div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160; </div>
<div class="line"><a name="l00486"></a><span class="lineno"><a class="line" href="classyarp_1_1os_1_1impl_1_1DgramTwoWayStream.html#a9e36f05df8aebf6273bec55fcddeb7be">  486</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="classyarp_1_1os_1_1impl_1_1DgramTwoWayStream.html#a9e36f05df8aebf6273bec55fcddeb7be">DgramTwoWayStream::join</a>(<span class="keyword">const</span> <a class="code" href="classyarp_1_1os_1_1Contact.html">Contact</a>&amp; group, <span class="keywordtype">bool</span> sender, <span class="keyword">const</span> <a class="code" href="classyarp_1_1os_1_1Contact.html">Contact</a>&amp; ipLocal)</div>
<div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;{</div>
<div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;    <a class="code" href="libYARP__os_2src_2yarp_2os_2LogComponent_8h.html#a8227343e844aca96bb821dd566d8cbb2">yCDebug</a>(DGRAMTWOWAYSTREAM, <span class="stringliteral">&quot;subscribing to mcast address %s for %s&quot;</span>, group.<a class="code" href="classyarp_1_1os_1_1Contact.html#ab3fceb3bf92cbc7b8eb9d91bda5c807e">toURI</a>().c_str(), (sender ? <span class="stringliteral">&quot;writing&quot;</span> : <span class="stringliteral">&quot;reading&quot;</span>));</div>
<div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160; </div>
<div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;    multiMode = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160; </div>
<div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;    <span class="keywordflow">if</span> (sender) {</div>
<div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;        <span class="keywordflow">if</span> (ipLocal.<a class="code" href="classyarp_1_1os_1_1Contact.html#a44450481ce5c8dd99f3a75eb9c8f310f">isValid</a>()) {</div>
<div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;            <span class="keywordflow">return</span> openMcast(group, ipLocal);</div>
<div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;        }</div>
<div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;        <span class="comment">// just use udp as normal</span></div>
<div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;        <span class="keywordflow">return</span> open(group);</div>
<div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;    }</div>
<div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160; </div>
<div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;<span class="preprocessor">#if defined(YARP_HAS_ACE)</span></div>
<div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;    ACE_SOCK_Dgram_Mcast::options mcastOptions = ACE_SOCK_Dgram_Mcast::DEFOPTS;</div>
<div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;<span class="preprocessor">#    if defined(__APPLE__)</span></div>
<div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;    mcastOptions = <span class="keyword">static_cast&lt;</span>ACE_SOCK_Dgram_Mcast::options<span class="keyword">&gt;</span>(ACE_SOCK_Dgram_Mcast::OPT_BINDADDR_NO | ACE_SOCK_Dgram_Mcast::DEFOPT_NULLIFACE);</div>
<div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;<span class="preprocessor">#    endif</span></div>
<div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160; </div>
<div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;    <span class="keyword">auto</span>* dmcast = <span class="keyword">new</span> ACE_SOCK_Dgram_Mcast(mcastOptions);</div>
<div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160; </div>
<div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;    dgram = dmcast;</div>
<div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;    mgram = dmcast;</div>
<div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;    <a class="code" href="libYARP__os_2src_2yarp_2os_2LogComponent_8h.html#a2a73589cc2da13516a620f1b86ef17a0">yCAssert</a>(DGRAMTWOWAYSTREAM, dgram != <span class="keyword">nullptr</span>);</div>
<div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160; </div>
<div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;    ACE_INET_Addr addr(group.<a class="code" href="classyarp_1_1os_1_1Contact.html#ab4312ee491059450c68ab85bb713b44f">getPort</a>(), group.<a class="code" href="classyarp_1_1os_1_1Contact.html#af2fa156ae18485d859ef8c859f43eca1">getHost</a>().c_str());</div>
<div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160; </div>
<div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;    <span class="keywordtype">int</span> result = -1;</div>
<div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;    <span class="keywordflow">if</span> (ipLocal.<a class="code" href="classyarp_1_1os_1_1Contact.html#a44450481ce5c8dd99f3a75eb9c8f310f">isValid</a>()) {</div>
<div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;        result = dmcast-&gt;join(addr, 1);</div>
<div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160; </div>
<div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;        <span class="keywordflow">if</span> (result == 0) {</div>
<div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;            result = restrictMcast(dmcast, group, ipLocal, <span class="keyword">true</span>);</div>
<div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;        }</div>
<div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;        result = dmcast-&gt;join(addr, 1);</div>
<div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;    }</div>
<div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160; </div>
<div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;    <span class="keywordflow">if</span> (result != 0) {</div>
<div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;        <a class="code" href="libYARP__os_2src_2yarp_2os_2LogComponent_8h.html#a224fd66c5d833ba0367a2ed54bcc279a">yCError</a>(DGRAMTWOWAYSTREAM, <span class="stringliteral">&quot;cannot connect to multi-cast address&quot;</span>);</div>
<div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;        happy = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;    }</div>
<div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;<span class="preprocessor">#else</span></div>
<div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;    <span class="keyword">struct </span>ip_mreq mreq;</div>
<div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;    <span class="keywordtype">int</span> s = -1;</div>
<div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;    <span class="keywordflow">if</span> ((s = socket(AF_INET, SOCK_DGRAM, 0)) &lt; 0) {</div>
<div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;        <a class="code" href="libYARP__os_2src_2yarp_2os_2LogComponent_8h.html#a224fd66c5d833ba0367a2ed54bcc279a">yCError</a>(DGRAMTWOWAYSTREAM, <span class="stringliteral">&quot;could not create receiver socket&quot;</span>);</div>
<div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;        happy = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;    }</div>
<div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;    <span class="keyword">struct </span>sockaddr_in addr;</div>
<div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;    u_int yes = 1;</div>
<div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160; </div>
<div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;    <span class="comment">/* set up destination address */</span></div>
<div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;    memset(&amp;addr, 0, <span class="keyword">sizeof</span>(addr));</div>
<div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;    addr.sin_family = AF_INET;</div>
<div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;    addr.sin_addr.s_addr = htonl(INADDR_ANY);</div>
<div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;    addr.sin_port = htons(group.<a class="code" href="classyarp_1_1os_1_1Contact.html#ab4312ee491059450c68ab85bb713b44f">getPort</a>());</div>
<div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160; </div>
<div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;    <span class="comment">// allow multiple sockets to use the same PORT number</span></div>
<div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;    <span class="keywordflow">if</span> (setsockopt(s, SOL_SOCKET, SO_REUSEADDR, &amp;yes, <span class="keyword">sizeof</span>(u_int)) &lt; 0) {</div>
<div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;        <a class="code" href="libYARP__os_2src_2yarp_2os_2LogComponent_8h.html#a224fd66c5d833ba0367a2ed54bcc279a">yCError</a>(DGRAMTWOWAYSTREAM, <span class="stringliteral">&quot;could not allow sockets use the same ADDRESS&quot;</span>);</div>
<div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;        happy = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;    }</div>
<div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160; </div>
<div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;<span class="preprocessor">#    if defined(__APPLE__)</span></div>
<div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;    <span class="keywordflow">if</span> (setsockopt(s, SOL_SOCKET, SO_REUSEPORT, &amp;yes, <span class="keyword">sizeof</span>(u_int)) &lt; 0) {</div>
<div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;        <a class="code" href="libYARP__os_2src_2yarp_2os_2LogComponent_8h.html#a224fd66c5d833ba0367a2ed54bcc279a">yCError</a>(DGRAMTWOWAYSTREAM, <span class="stringliteral">&quot;could not allow sockets use the same PORT number&quot;</span>);</div>
<div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;        happy = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;    }</div>
<div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;<span class="preprocessor">#    endif</span></div>
<div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160; </div>
<div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;    <span class="comment">// bind to receive address</span></div>
<div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;    <span class="keywordflow">if</span> (bind(s, (<span class="keyword">struct</span> sockaddr*)&amp;addr, <span class="keyword">sizeof</span>(addr)) == -1) {</div>
<div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;        <a class="code" href="libYARP__os_2src_2yarp_2os_2LogComponent_8h.html#a224fd66c5d833ba0367a2ed54bcc279a">yCError</a>(DGRAMTWOWAYSTREAM, <span class="stringliteral">&quot;could not create mcast server&quot;</span>);</div>
<div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;        happy = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;    }</div>
<div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160; </div>
<div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;    <span class="comment">// use setsockopt() to request that the kernel join a multicast group</span></div>
<div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;    <span class="keywordflow">if</span> (inet_pton(AF_INET, group.<a class="code" href="classyarp_1_1os_1_1Contact.html#af2fa156ae18485d859ef8c859f43eca1">getHost</a>().c_str(), &amp;mreq.imr_multiaddr) == 0) {</div>
<div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;        <a class="code" href="libYARP__os_2src_2yarp_2os_2LogComponent_8h.html#a224fd66c5d833ba0367a2ed54bcc279a">yCError</a>(DGRAMTWOWAYSTREAM, <span class="stringliteral">&quot;Could not set up the mcast server&quot;</span>);</div>
<div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;        std::exit(1);</div>
<div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;    }</div>
<div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;    mreq.imr_interface.s_addr = htonl(INADDR_ANY);</div>
<div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;    <span class="keywordflow">if</span> (setsockopt(s, IPPROTO_IP, IP_ADD_MEMBERSHIP, &amp;mreq, <span class="keyword">sizeof</span>(mreq)) &lt; 0) {</div>
<div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;        <a class="code" href="libYARP__os_2src_2yarp_2os_2LogComponent_8h.html#a224fd66c5d833ba0367a2ed54bcc279a">yCError</a>(DGRAMTWOWAYSTREAM, <span class="stringliteral">&quot;could not join the multicast group&quot;</span>);</div>
<div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;        <a class="code" href="libYARP__os_2src_2yarp_2os_2LogComponent_8h.html#a224fd66c5d833ba0367a2ed54bcc279a">yCError</a>(DGRAMTWOWAYSTREAM, <span class="stringliteral">&quot;sendto: %d, %s&quot;</span>, errno, strerror(errno));</div>
<div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;        happy = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;    }</div>
<div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160; </div>
<div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;    dgram_sockfd = s;</div>
<div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;    dgram = <span class="keyword">this</span>;</div>
<div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;    configureSystemBuffers();</div>
<div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160; </div>
<div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;    localAddress = group;</div>
<div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;    remoteAddress = group;</div>
<div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;<span class="preprocessor">#ifdef YARP_HAS_ACE</span></div>
<div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;    localHandle.set(localAddress.getPort(), localAddress.getHost().c_str());</div>
<div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;    remoteHandle.set(remoteAddress.getPort(), remoteAddress.getHost().c_str());</div>
<div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;<span class="preprocessor">#else</span></div>
<div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;    localHandle = localAddress.<a class="code" href="classyarp_1_1os_1_1Contact.html#ab4312ee491059450c68ab85bb713b44f">getPort</a>();</div>
<div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;    remoteHandle = remoteAddress.getPort();</div>
<div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;    allocate();</div>
<div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;}</div>
<div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160; </div>
<div class="line"><a name="l00600"></a><span class="lineno"><a class="line" href="classyarp_1_1os_1_1impl_1_1DgramTwoWayStream.html#aa4a6185fcea781c219d18242411890b0">  600</a></span>&#160;<a class="code" href="classyarp_1_1os_1_1impl_1_1DgramTwoWayStream.html#aa4a6185fcea781c219d18242411890b0">DgramTwoWayStream::~DgramTwoWayStream</a>()</div>
<div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;{</div>
<div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;    closeMain();</div>
<div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;}</div>
<div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160; </div>
<div class="line"><a name="l00605"></a><span class="lineno"><a class="line" href="classyarp_1_1os_1_1impl_1_1DgramTwoWayStream.html#a3fb7835682d050ad6b70ec34b1a25d00">  605</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classyarp_1_1os_1_1impl_1_1DgramTwoWayStream.html#a3fb7835682d050ad6b70ec34b1a25d00">DgramTwoWayStream::interrupt</a>()</div>
<div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;{</div>
<div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;    <span class="keywordtype">bool</span> act = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;    mutex.lock();</div>
<div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;    <span class="keywordflow">if</span> ((!closed) &amp;&amp; (!interrupting) &amp;&amp; happy) {</div>
<div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;        act = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;        interrupting = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;        closed = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;    }</div>
<div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;    mutex.unlock();</div>
<div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160; </div>
<div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;    <span class="keywordflow">if</span> (act) {</div>
<div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;        <span class="keywordflow">if</span> (reader) {</div>
<div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;            <span class="keywordtype">int</span> ct = 3;</div>
<div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;            <span class="keywordflow">while</span> (happy &amp;&amp; ct &gt; 0) {</div>
<div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;                ct--;</div>
<div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;                <a class="code" href="classyarp_1_1os_1_1impl_1_1DgramTwoWayStream.html">DgramTwoWayStream</a> tmp;</div>
<div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;                <span class="keywordflow">if</span> (mgram != <span class="keyword">nullptr</span>) {</div>
<div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;                    <a class="code" href="libYARP__os_2src_2yarp_2os_2LogComponent_8h.html#a8227343e844aca96bb821dd566d8cbb2">yCDebug</a>(DGRAMTWOWAYSTREAM, <span class="stringliteral">&quot;* mcast interrupt, interface %s&quot;</span>, restrictInterfaceIp.toString().c_str());</div>
<div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;                    tmp.<a class="code" href="classyarp_1_1os_1_1impl_1_1DgramTwoWayStream.html#a9e36f05df8aebf6273bec55fcddeb7be">join</a>(localAddress, <span class="keyword">true</span>, restrictInterfaceIp);</div>
<div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;                } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;                    <a class="code" href="libYARP__os_2src_2yarp_2os_2LogComponent_8h.html#a8227343e844aca96bb821dd566d8cbb2">yCDebug</a>(DGRAMTWOWAYSTREAM, <span class="stringliteral">&quot;* dgram interrupt&quot;</span>);</div>
<div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;                    tmp.<a class="code" href="classyarp_1_1os_1_1impl_1_1DgramTwoWayStream.html#a421205cfcf35495ea9e518e1d8eba805">open</a>(<a class="code" href="classyarp_1_1os_1_1Contact.html">Contact</a>(localAddress.getHost(), 0),</div>
<div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;                             localAddress);</div>
<div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;                }</div>
<div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;                <a class="code" href="libYARP__os_2src_2yarp_2os_2LogComponent_8h.html#a8227343e844aca96bb821dd566d8cbb2">yCDebug</a>(DGRAMTWOWAYSTREAM, <span class="stringliteral">&quot;* interrupt state %s %s %s&quot;</span>,</div>
<div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;                           (interrupting ? <span class="stringliteral">&quot;true&quot;</span> : <span class="stringliteral">&quot;false&quot;</span>),</div>
<div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;                           (closed ? <span class="stringliteral">&quot;true&quot;</span> : <span class="stringliteral">&quot;false&quot;</span>),</div>
<div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;                           (happy ? <span class="stringliteral">&quot;true&quot;</span> : <span class="stringliteral">&quot;false&quot;</span>));</div>
<div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;                <a class="code" href="classyarp_1_1os_1_1ManagedBytes.html">ManagedBytes</a> empty(10);</div>
<div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;                <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; empty.<a class="code" href="classyarp_1_1os_1_1ManagedBytes.html#ac50d5c97ce01e05a01a1944aa14be377">length</a>(); i++) {</div>
<div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;                    empty.<a class="code" href="classyarp_1_1os_1_1ManagedBytes.html#ab6a6d6720476bd84a3e04c769bcad3e5">get</a>()[i] = 0;</div>
<div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;                }</div>
<div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160; </div>
<div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;                <span class="comment">// don&#39;t want this message getting into a valid packet</span></div>
<div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;                tmp.pct = -1;</div>
<div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160; </div>
<div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;                tmp.<a class="code" href="classyarp_1_1os_1_1impl_1_1DgramTwoWayStream.html#a1de9f8bd9256d2dfc47fddbea73061ab">write</a>(empty.<a class="code" href="classyarp_1_1os_1_1ManagedBytes.html#a41c563c189aa28744836de69f3e54fef">bytes</a>());</div>
<div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;                tmp.<a class="code" href="classyarp_1_1os_1_1impl_1_1DgramTwoWayStream.html#aca9b76f5c308f6f758979fb455d305c0">flush</a>();</div>
<div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;                tmp.<a class="code" href="classyarp_1_1os_1_1impl_1_1DgramTwoWayStream.html#a44c91c82ca068d99b64661fd71bd057b">close</a>();</div>
<div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;                <span class="keywordflow">if</span> (happy) {</div>
<div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;                    <a class="code" href="classyarp_1_1os_1_1SystemClock.html#af9eba2d0a597ba1a53e6be7a47941314">yarp::os::SystemClock::delaySystem</a>(0.25);</div>
<div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;                }</div>
<div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;            }</div>
<div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;            <a class="code" href="libYARP__os_2src_2yarp_2os_2LogComponent_8h.html#a8227343e844aca96bb821dd566d8cbb2">yCDebug</a>(DGRAMTWOWAYSTREAM, <span class="stringliteral">&quot;dgram interrupt done&quot;</span>);</div>
<div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;        }</div>
<div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;        mutex.lock();</div>
<div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;        interrupting = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;        mutex.unlock();</div>
<div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;        <span class="comment">// wait for interruption to be done</span></div>
<div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;        <span class="keywordflow">if</span> (interrupting) {</div>
<div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;            <span class="keywordflow">while</span> (interrupting) {</div>
<div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;                <a class="code" href="libYARP__os_2src_2yarp_2os_2LogComponent_8h.html#a8227343e844aca96bb821dd566d8cbb2">yCDebug</a>(DGRAMTWOWAYSTREAM, <span class="stringliteral">&quot;waiting for dgram interrupt to be finished...&quot;</span>);</div>
<div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;                <a class="code" href="classyarp_1_1os_1_1SystemClock.html#af9eba2d0a597ba1a53e6be7a47941314">yarp::os::SystemClock::delaySystem</a>(0.1);</div>
<div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;            }</div>
<div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;        }</div>
<div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;    }</div>
<div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;}</div>
<div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160; </div>
<div class="line"><a name="l00665"></a><span class="lineno"><a class="line" href="classyarp_1_1os_1_1impl_1_1DgramTwoWayStream.html#a0ff2b10caf0c9a51a1691d374201da54">  665</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classyarp_1_1os_1_1impl_1_1DgramTwoWayStream.html#a0ff2b10caf0c9a51a1691d374201da54">DgramTwoWayStream::closeMain</a>()</div>
<div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;{</div>
<div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;    <span class="keywordflow">if</span> (dgram != <span class="keyword">nullptr</span>) {</div>
<div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;        <span class="comment">//printf(&quot;Dgram closing, interrupt state %d\n&quot;, interrupting);</span></div>
<div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;        interrupt();</div>
<div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;        mutex.lock();</div>
<div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;        closed = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;        happy = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;        <span class="comment">//printf(&quot;Dgram closinger, interrupt state %d\n&quot;, interrupting);</span></div>
<div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;        mutex.unlock();</div>
<div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;        <span class="keywordflow">while</span> (interrupting) {</div>
<div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;            happy = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;            <a class="code" href="classyarp_1_1os_1_1SystemClock.html#af9eba2d0a597ba1a53e6be7a47941314">yarp::os::SystemClock::delaySystem</a>(0.1);</div>
<div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;        }</div>
<div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;        mutex.lock();</div>
<div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;        <span class="keywordflow">if</span> (dgram != <span class="keyword">nullptr</span>) {</div>
<div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;<span class="preprocessor">#if defined(YARP_HAS_ACE)</span></div>
<div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;            dgram-&gt;close();</div>
<div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;            <span class="keyword">delete</span> dgram;</div>
<div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;<span class="preprocessor">#else</span></div>
<div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;            <span class="keywordflow">if</span> (dgram_sockfd &gt;= 0) {</div>
<div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;                ::close(dgram_sockfd);</div>
<div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;            }</div>
<div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;            dgram_sockfd = -1;</div>
<div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;            dgram = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;            mgram = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;        }</div>
<div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;        happy = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;        mutex.unlock();</div>
<div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;    }</div>
<div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;    happy = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;}</div>
<div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160; </div>
<div class="line"><a name="l00699"></a><span class="lineno"><a class="line" href="classyarp_1_1os_1_1impl_1_1DgramTwoWayStream.html#ab01616b26c3a5c9e533d8c970c22067c">  699</a></span>&#160;<a class="code" href="namespaceyarp_1_1conf.html#a3df5afb43ff7b7cc2b4e3cb9150eab20">yarp::conf::ssize_t</a> <a class="code" href="classyarp_1_1os_1_1InputStream.html#a448b29e1cd20c5ae3bf3a43ba6b49f17">DgramTwoWayStream::read</a>(<a class="code" href="classyarp_1_1os_1_1Bytes.html">Bytes</a>&amp; b)</div>
<div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;{</div>
<div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;    reader = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;    <span class="keywordtype">bool</span> done = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160; </div>
<div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;    <span class="keywordflow">while</span> (!done) {</div>
<div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160; </div>
<div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;        <span class="keywordflow">if</span> (closed) {</div>
<div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;            happy = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;            <span class="keywordflow">return</span> -1;</div>
<div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;        }</div>
<div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160; </div>
<div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;        <span class="comment">// if nothing is available, try to grab stuff</span></div>
<div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;        <span class="keywordflow">if</span> (readAvail == 0) {</div>
<div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;            readAt = 0;</div>
<div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160; </div>
<div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160; </div>
<div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;            <span class="comment">//yCAssert(DGRAMTWOWAYSTREAM, dgram != nullptr);</span></div>
<div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;            <a class="code" href="libYARP__os_2src_2yarp_2os_2LogComponent_8h.html#a3ffb0d629a2cfebb6abdc73e93a11bce">yCTrace</a>(DGRAMTWOWAYSTREAM, <span class="stringliteral">&quot;DGRAM Waiting for something!&quot;</span>);</div>
<div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;            <a class="code" href="namespaceyarp_1_1conf.html#a3df5afb43ff7b7cc2b4e3cb9150eab20">yarp::conf::ssize_t</a> result = -1;</div>
<div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;<span class="preprocessor">#if defined(YARP_HAS_ACE)</span></div>
<div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;            <span class="keywordflow">if</span> ((dgram != <span class="keyword">nullptr</span>) &amp;&amp; restrictInterfaceIp.isValid()) {</div>
<div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;                <a class="code" href="libYARP__os_2src_2yarp_2os_2LogComponent_8h.html#a3ffb0d629a2cfebb6abdc73e93a11bce">yCTrace</a>(DGRAMTWOWAYSTREAM, <span class="stringliteral">&quot;Consider remote mcast&quot;</span>);</div>
<div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;                <a class="code" href="libYARP__os_2src_2yarp_2os_2LogComponent_8h.html#a3ffb0d629a2cfebb6abdc73e93a11bce">yCTrace</a>(DGRAMTWOWAYSTREAM, <span class="stringliteral">&quot;What we know:&quot;</span>);</div>
<div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;                <a class="code" href="libYARP__os_2src_2yarp_2os_2LogComponent_8h.html#a3ffb0d629a2cfebb6abdc73e93a11bce">yCTrace</a>(DGRAMTWOWAYSTREAM, <span class="stringliteral">&quot;  %s&quot;</span>, restrictInterfaceIp.toString().c_str());</div>
<div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;                <a class="code" href="libYARP__os_2src_2yarp_2os_2LogComponent_8h.html#a3ffb0d629a2cfebb6abdc73e93a11bce">yCTrace</a>(DGRAMTWOWAYSTREAM, <span class="stringliteral">&quot;  %s&quot;</span>, localAddress.toString().c_str());</div>
<div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;                <a class="code" href="libYARP__os_2src_2yarp_2os_2LogComponent_8h.html#a3ffb0d629a2cfebb6abdc73e93a11bce">yCTrace</a>(DGRAMTWOWAYSTREAM, <span class="stringliteral">&quot;  %s&quot;</span>, remoteAddress.toString().c_str());</div>
<div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160; </div>
<div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;                ACE_INET_Addr iface(restrictInterfaceIp.getPort(),</div>
<div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;                                    restrictInterfaceIp.getHost().c_str());</div>
<div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;                ACE_INET_Addr dummy((u_short)0, (ACE_UINT32)INADDR_ANY);</div>
<div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;                result = dgram-&gt;recv(readBuffer.get(), readBuffer.length(), dummy);</div>
<div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;                <a class="code" href="libYARP__os_2src_2yarp_2os_2LogComponent_8h.html#a8227343e844aca96bb821dd566d8cbb2">yCDebug</a>(DGRAMTWOWAYSTREAM, <span class="stringliteral">&quot;MCAST Got %zd bytes&quot;</span>, result);</div>
<div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160; </div>
<div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;            } <span class="keywordflow">else</span></div>
<div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;                <span class="keywordflow">if</span> (dgram != <span class="keyword">nullptr</span>) {</div>
<div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;                <a class="code" href="libYARP__os_2src_2yarp_2os_2LogComponent_8h.html#a2a73589cc2da13516a620f1b86ef17a0">yCAssert</a>(DGRAMTWOWAYSTREAM, dgram != <span class="keyword">nullptr</span>);</div>
<div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;<span class="preprocessor">#if defined(YARP_HAS_ACE)</span></div>
<div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;                ACE_INET_Addr dummy((u_short)0, (ACE_UINT32)INADDR_ANY);</div>
<div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;                <a class="code" href="libYARP__os_2src_2yarp_2os_2LogComponent_8h.html#a3ffb0d629a2cfebb6abdc73e93a11bce">yCTrace</a>(DGRAMTWOWAYSTREAM, <span class="stringliteral">&quot;DGRAM Waiting for something!&quot;</span>);</div>
<div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;                result = dgram-&gt;recv(readBuffer.get(), readBuffer.length(), dummy);</div>
<div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;<span class="preprocessor">#else</span></div>
<div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;                result = recv(dgram_sockfd, readBuffer.get(), readBuffer.length(), 0);</div>
<div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;                <a class="code" href="libYARP__os_2src_2yarp_2os_2LogComponent_8h.html#a8227343e844aca96bb821dd566d8cbb2">yCDebug</a>(DGRAMTWOWAYSTREAM, <span class="stringliteral">&quot;DGRAM Got %zd bytes&quot;</span>, result);</div>
<div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;            } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;                onMonitorInput();</div>
<div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;                <span class="comment">//printf(&quot;Monitored input of %d bytes\n&quot;, monitor.length());</span></div>
<div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;                <span class="keywordflow">if</span> (monitor.length() &gt; readBuffer.length()) {</div>
<div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;                    printf(<span class="stringliteral">&quot;Too big!\n&quot;</span>);</div>
<div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;                    std::exit(1);</div>
<div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;                }</div>
<div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;                memcpy(readBuffer.get(), monitor.get(), monitor.length());</div>
<div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;                result = monitor.length();</div>
<div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;            }</div>
<div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160; </div>
<div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;            <span class="keywordflow">if</span> (closed || (result &lt; 0)) {</div>
<div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;                happy = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;                <span class="keywordflow">return</span> -1;</div>
<div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;            }</div>
<div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;            readAvail = result;</div>
<div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160; </div>
<div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;            <span class="comment">// deal with CRC</span></div>
<div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;            <span class="keywordtype">int</span> altPct = 0;</div>
<div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;            <span class="keywordtype">bool</span> crcOk = <a class="code" href="DgramTwoWayStream_8cpp.html#a3f8812130ffb175a81bdb3eb5f2a0faf">checkCrc</a>(readBuffer.get(), readAvail, <a class="code" href="DgramTwoWayStream_8cpp.html#aa93e89217587fdff12bf43b5d7f54f74">CRC_SIZE</a>, pct, &amp;altPct);</div>
<div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;            <span class="keywordflow">if</span> (altPct != -1) {</div>
<div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;                pct++;</div>
<div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;                <span class="keywordflow">if</span> (!crcOk) {</div>
<div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;                    <span class="keywordflow">if</span> (bufferAlertNeeded &amp;&amp; !bufferAlerted) {</div>
<div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;                        <a class="code" href="libYARP__os_2src_2yarp_2os_2LogComponent_8h.html#a224fd66c5d833ba0367a2ed54bcc279a">yCError</a>(DGRAMTWOWAYSTREAM, <span class="stringliteral">&quot;*** Multicast/UDP packet dropped - checksum error ***&quot;</span>);</div>
<div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;                        <a class="code" href="libYARP__os_2src_2yarp_2os_2LogComponent_8h.html#a18e11e963a9867766b3ac49614348799">yCInfo</a>(DGRAMTWOWAYSTREAM, <span class="stringliteral">&quot;The UDP/MCAST system buffer limit on your system is low.&quot;</span>);</div>
<div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;                        <a class="code" href="libYARP__os_2src_2yarp_2os_2LogComponent_8h.html#a18e11e963a9867766b3ac49614348799">yCInfo</a>(DGRAMTWOWAYSTREAM, <span class="stringliteral">&quot;You may get packet loss under heavy conditions.&quot;</span>);</div>
<div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;<span class="preprocessor">#ifdef __linux__</span></div>
<div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;                        <a class="code" href="libYARP__os_2src_2yarp_2os_2LogComponent_8h.html#a18e11e963a9867766b3ac49614348799">yCInfo</a>(DGRAMTWOWAYSTREAM, <span class="stringliteral">&quot;To change the buffer limit on linux: sysctl -w net.core.rmem_max=8388608&quot;</span>);</div>
<div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;                        <a class="code" href="libYARP__os_2src_2yarp_2os_2LogComponent_8h.html#a18e11e963a9867766b3ac49614348799">yCInfo</a>(DGRAMTWOWAYSTREAM, <span class="stringliteral">&quot;(Might be something like: sudo /sbin/sysctl -w net.core.rmem_max=8388608)&quot;</span>);</div>
<div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;<span class="preprocessor">#else</span></div>
<div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;                        <a class="code" href="libYARP__os_2src_2yarp_2os_2LogComponent_8h.html#a18e11e963a9867766b3ac49614348799">yCInfo</a>(DGRAMTWOWAYSTREAM, <span class="stringliteral">&quot;To change the limit use: sysctl for Linux/FreeBSD, ndd for Solaris, no for AIX&quot;</span>);</div>
<div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;                        bufferAlerted = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;                    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;                        errCount++;</div>
<div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;                        <span class="keywordtype">double</span> <a class="code" href="namespaceyarp_1_1os_1_1Time.html#a9909c5613bb1daee8f1fd92e1f4c95f6">now</a> = <a class="code" href="classyarp_1_1os_1_1SystemClock.html#a8bf2d789cc755768467e392f88eccaf2">SystemClock::nowSystem</a>();</div>
<div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;                        <span class="keywordflow">if</span> (<a class="code" href="namespaceyarp_1_1os_1_1Time.html#a9909c5613bb1daee8f1fd92e1f4c95f6">now</a> - lastReportTime &gt; 1) {</div>
<div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;                            <a class="code" href="libYARP__os_2src_2yarp_2os_2LogComponent_8h.html#a224fd66c5d833ba0367a2ed54bcc279a">yCError</a>(DGRAMTWOWAYSTREAM, <span class="stringliteral">&quot;*** %d datagram packet(s) dropped - checksum error ***&quot;</span>, errCount);</div>
<div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;                            lastReportTime = <a class="code" href="namespaceyarp_1_1os_1_1Time.html#a9909c5613bb1daee8f1fd92e1f4c95f6">now</a>;</div>
<div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;                            errCount = 0;</div>
<div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;                        }</div>
<div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;                    }</div>
<div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;                    reset();</div>
<div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;                    <span class="keywordflow">return</span> -1;</div>
<div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;                }</div>
<div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;                readAt += <a class="code" href="DgramTwoWayStream_8cpp.html#aa93e89217587fdff12bf43b5d7f54f74">CRC_SIZE</a>;</div>
<div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;                readAvail -= <a class="code" href="DgramTwoWayStream_8cpp.html#aa93e89217587fdff12bf43b5d7f54f74">CRC_SIZE</a>;</div>
<div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;                done = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;            } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;                readAvail = 0;</div>
<div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;            }</div>
<div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;        }</div>
<div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160; </div>
<div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;        <span class="comment">// if stuff is available, take it</span></div>
<div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;        <span class="keywordflow">if</span> (readAvail &gt; 0) {</div>
<div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;            <span class="keywordtype">size_t</span> take = readAvail;</div>
<div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;            <span class="keywordflow">if</span> (take &gt; b.<a class="code" href="classyarp_1_1os_1_1Bytes.html#a1777bdec41bab120b74bc353e3570377">length</a>()) {</div>
<div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;                take = b.<a class="code" href="classyarp_1_1os_1_1Bytes.html#a1777bdec41bab120b74bc353e3570377">length</a>();</div>
<div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;            }</div>
<div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;            memcpy(b.<a class="code" href="classyarp_1_1os_1_1Bytes.html#ad62e722069297651d9efb5fa7fba1d92">get</a>(), readBuffer.get() + readAt, take);</div>
<div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;            readAt += take;</div>
<div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;            readAvail -= take;</div>
<div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;            <span class="keywordflow">return</span> take;</div>
<div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;        }</div>
<div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;    }</div>
<div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160; </div>
<div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;}</div>
<div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160; </div>
<div class="line"><a name="l00815"></a><span class="lineno"><a class="line" href="classyarp_1_1os_1_1impl_1_1DgramTwoWayStream.html#a1de9f8bd9256d2dfc47fddbea73061ab">  815</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classyarp_1_1os_1_1impl_1_1DgramTwoWayStream.html#a1de9f8bd9256d2dfc47fddbea73061ab">DgramTwoWayStream::write</a>(<span class="keyword">const</span> <a class="code" href="classyarp_1_1os_1_1Bytes.html">Bytes</a>&amp; b)</div>
<div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;{</div>
<div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;    <a class="code" href="libYARP__os_2src_2yarp_2os_2LogComponent_8h.html#a3ffb0d629a2cfebb6abdc73e93a11bce">yCTrace</a>(DGRAMTWOWAYSTREAM, <span class="stringliteral">&quot;DGRAM prep writing&quot;</span>);</div>
<div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160;    <a class="code" href="libYARP__os_2src_2yarp_2os_2LogComponent_8h.html#a3ffb0d629a2cfebb6abdc73e93a11bce">yCTrace</a>(DGRAMTWOWAYSTREAM, <span class="stringliteral">&quot;DGRAM write %zu bytes&quot;</span>, b.<a class="code" href="classyarp_1_1os_1_1Bytes.html#a1777bdec41bab120b74bc353e3570377">length</a>());</div>
<div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160; </div>
<div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;    <span class="keywordflow">if</span> (reader) {</div>
<div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;    }</div>
<div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;    <span class="keywordflow">if</span> (writeBuffer.get() == <span class="keyword">nullptr</span>) {</div>
<div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160;    }</div>
<div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160; </div>
<div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160;    <a class="code" href="classyarp_1_1os_1_1Bytes.html">Bytes</a> local = b;</div>
<div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;    <span class="keywordflow">while</span> (local.length() &gt; 0) {</div>
<div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160;        <a class="code" href="libYARP__os_2src_2yarp_2os_2LogComponent_8h.html#a3ffb0d629a2cfebb6abdc73e93a11bce">yCTrace</a>(DGRAMTWOWAYSTREAM, <span class="stringliteral">&quot;DGRAM prep writing&quot;</span>);</div>
<div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;        <a class="code" href="namespaceyarp_1_1conf.html#a3df5afb43ff7b7cc2b4e3cb9150eab20">yarp::conf::ssize_t</a> rem = local.length();</div>
<div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160;        <a class="code" href="namespaceyarp_1_1conf.html#a3df5afb43ff7b7cc2b4e3cb9150eab20">yarp::conf::ssize_t</a> space = writeBuffer.length() - writeAvail;</div>
<div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;        <span class="keywordtype">bool</span> shouldFlush = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160;        <span class="keywordflow">if</span> (rem &gt;= space) {</div>
<div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;            rem = space;</div>
<div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;            shouldFlush = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160;        }</div>
<div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160;        memcpy(writeBuffer.get() + writeAvail, local.get(), rem);</div>
<div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160;        writeAvail += rem;</div>
<div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160;        local = <a class="code" href="classyarp_1_1os_1_1Bytes.html">Bytes</a>(local.get() + rem, local.length() - rem);</div>
<div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160;        <span class="keywordflow">if</span> (shouldFlush) {</div>
<div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160;            flush();</div>
<div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160;        }</div>
<div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160;    }</div>
<div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160;}</div>
<div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160; </div>
<div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160; </div>
<div class="line"><a name="l00847"></a><span class="lineno"><a class="line" href="classyarp_1_1os_1_1impl_1_1DgramTwoWayStream.html#aca9b76f5c308f6f758979fb455d305c0">  847</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classyarp_1_1os_1_1impl_1_1DgramTwoWayStream.html#aca9b76f5c308f6f758979fb455d305c0">DgramTwoWayStream::flush</a>()</div>
<div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;{</div>
<div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160;    <span class="keywordflow">if</span> (writeBuffer.get() == <span class="keyword">nullptr</span>) {</div>
<div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160;    }</div>
<div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160; </div>
<div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160;    <span class="comment">// should set CRC</span></div>
<div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160;    <span class="keywordflow">if</span> (writeAvail &lt;= <a class="code" href="DgramTwoWayStream_8cpp.html#aa93e89217587fdff12bf43b5d7f54f74">CRC_SIZE</a>) {</div>
<div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160;    }</div>
<div class="line"><a name="l00857"></a><span class="lineno">  857</span>&#160;    <a class="code" href="DgramTwoWayStream_8cpp.html#afa693fafffe613a6f5c1283661588090">addCrc</a>(writeBuffer.get(), writeAvail, <a class="code" href="DgramTwoWayStream_8cpp.html#aa93e89217587fdff12bf43b5d7f54f74">CRC_SIZE</a>, pct);</div>
<div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160;    pct++;</div>
<div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160; </div>
<div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160;    <span class="keywordflow">if</span> (writeAvail &gt; 0) {</div>
<div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;        <span class="comment">//yCAssert(DGRAMTWOWAYSTREAM, dgram != nullptr);</span></div>
<div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160;        <a class="code" href="namespaceyarp_1_1conf.html#a3df5afb43ff7b7cc2b4e3cb9150eab20">yarp::conf::ssize_t</a> len = 0;</div>
<div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160; </div>
<div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160;<span class="preprocessor">#if defined(YARP_HAS_ACE)</span></div>
<div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160;        <span class="keywordflow">if</span> (mgram != <span class="keyword">nullptr</span>) {</div>
<div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160;            len = mgram-&gt;send(writeBuffer.get(), writeAvail);</div>
<div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160;            <a class="code" href="libYARP__os_2src_2yarp_2os_2LogComponent_8h.html#a8227343e844aca96bb821dd566d8cbb2">yCDebug</a>(DGRAMTWOWAYSTREAM, <span class="stringliteral">&quot;MCAST - wrote %zd bytes&quot;</span>, len);</div>
<div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160;        } <span class="keywordflow">else</span></div>
<div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160;            <span class="keywordflow">if</span> (dgram != <span class="keyword">nullptr</span>) {</div>
<div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160;<span class="preprocessor">#if defined(YARP_HAS_ACE)</span></div>
<div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160;            len = dgram-&gt;send(writeBuffer.get(), writeAvail, remoteHandle);</div>
<div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;<span class="preprocessor">#else</span></div>
<div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160;            len = send(dgram_sockfd, writeBuffer.get(), writeAvail, 0);</div>
<div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160;            <a class="code" href="libYARP__os_2src_2yarp_2os_2LogComponent_8h.html#a8227343e844aca96bb821dd566d8cbb2">yCDebug</a>(DGRAMTWOWAYSTREAM, <span class="stringliteral">&quot;DGRAM - wrote %zd bytes to %s&quot;</span>, len, remoteAddress.toString().c_str());</div>
<div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160;            <a class="code" href="classyarp_1_1os_1_1Bytes.html">Bytes</a> b(writeBuffer.get(), writeAvail);</div>
<div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160;            monitor = <a class="code" href="classyarp_1_1os_1_1ManagedBytes.html">ManagedBytes</a>(b, <span class="keyword">false</span>);</div>
<div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160;            monitor.copy();</div>
<div class="line"><a name="l00881"></a><span class="lineno">  881</span>&#160;            <span class="comment">//printf(&quot;Monitored output of %d bytes\n&quot;, monitor.length());</span></div>
<div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160;            len = monitor.length();</div>
<div class="line"><a name="l00883"></a><span class="lineno">  883</span>&#160;            onMonitorOutput();</div>
<div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160;        }</div>
<div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160;        <span class="keywordflow">if</span> (len &gt; writeBuffer.length() * 0.75) {</div>
<div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160;            <a class="code" href="libYARP__os_2src_2yarp_2os_2LogComponent_8h.html#a8227343e844aca96bb821dd566d8cbb2">yCDebug</a>(DGRAMTWOWAYSTREAM, <span class="stringliteral">&quot;long dgrams might need a little time&quot;</span>);</div>
<div class="line"><a name="l00887"></a><span class="lineno">  887</span>&#160; </div>
<div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160;            <span class="comment">// Under heavy loads, packets could get dropped</span></div>
<div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160;            <span class="comment">// 640x480x3 images correspond to about 15 datagrams</span></div>
<div class="line"><a name="l00890"></a><span class="lineno">  890</span>&#160;            <span class="comment">// so there&#39;s not much time possible between them</span></div>
<div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160;            <span class="comment">// looked at iperf, it just does a busy-waiting delay</span></div>
<div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160;            <span class="comment">// there&#39;s an implementation below, but commented out -</span></div>
<div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160;            <span class="comment">// better solution was to increase recv buffer size</span></div>
<div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160; </div>
<div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160;            <span class="keywordtype">double</span> first = <a class="code" href="classyarp_1_1os_1_1SystemClock.html#a8bf2d789cc755768467e392f88eccaf2">yarp::os::SystemClock::nowSystem</a>();</div>
<div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160;            <span class="keywordtype">double</span> <a class="code" href="namespaceyarp_1_1os_1_1Time.html#a9909c5613bb1daee8f1fd92e1f4c95f6">now</a>;</div>
<div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160;            <span class="keywordtype">int</span> ct = 0;</div>
<div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160;            <span class="keywordflow">do</span> {</div>
<div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160;                <span class="comment">//printf(&quot;Busy wait... %d\n&quot;, ct);</span></div>
<div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160;                <a class="code" href="classyarp_1_1os_1_1SystemClock.html#af9eba2d0a597ba1a53e6be7a47941314">yarp::os::SystemClock::delaySystem</a>(0);</div>
<div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160;                <a class="code" href="namespaceyarp_1_1os_1_1Time.html#a9909c5613bb1daee8f1fd92e1f4c95f6">now</a> = <a class="code" href="classyarp_1_1os_1_1SystemClock.html#a8bf2d789cc755768467e392f88eccaf2">yarp::os::SystemClock::nowSystem</a>();</div>
<div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160;                ct++;</div>
<div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160;            } <span class="keywordflow">while</span> (<a class="code" href="namespaceyarp_1_1os_1_1Time.html#a9909c5613bb1daee8f1fd92e1f4c95f6">now</a> - first &lt; 0.001);</div>
<div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160;        }</div>
<div class="line"><a name="l00905"></a><span class="lineno">  905</span>&#160; </div>
<div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160;        <span class="keywordflow">if</span> (len &lt; 0) {</div>
<div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160;            happy = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160;            <a class="code" href="libYARP__os_2src_2yarp_2os_2LogComponent_8h.html#a8227343e844aca96bb821dd566d8cbb2">yCDebug</a>(DGRAMTWOWAYSTREAM, <span class="stringliteral">&quot;DGRAM failed to send message with error: %s&quot;</span>, strerror(errno));</div>
<div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160;            <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160;        }</div>
<div class="line"><a name="l00911"></a><span class="lineno">  911</span>&#160;        writeAvail -= len;</div>
<div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160; </div>
<div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160;        <span class="keywordflow">if</span> (writeAvail != 0) {</div>
<div class="line"><a name="l00914"></a><span class="lineno">  914</span>&#160;            <span class="comment">// well, we have a problem</span></div>
<div class="line"><a name="l00915"></a><span class="lineno">  915</span>&#160;            <span class="comment">// checksums will cause dumping</span></div>
<div class="line"><a name="l00916"></a><span class="lineno">  916</span>&#160;            <a class="code" href="libYARP__os_2src_2yarp_2os_2LogComponent_8h.html#a8227343e844aca96bb821dd566d8cbb2">yCDebug</a>(DGRAMTWOWAYSTREAM, <span class="stringliteral">&quot;dgram/mcast send behaving badly&quot;</span>);</div>
<div class="line"><a name="l00917"></a><span class="lineno">  917</span>&#160;        }</div>
<div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160;    }</div>
<div class="line"><a name="l00919"></a><span class="lineno">  919</span>&#160;    <span class="comment">// finally: writeAvail should be 0</span></div>
<div class="line"><a name="l00920"></a><span class="lineno">  920</span>&#160; </div>
<div class="line"><a name="l00921"></a><span class="lineno">  921</span>&#160;    <span class="comment">// make space for CRC</span></div>
<div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160;    writeAvail = <a class="code" href="DgramTwoWayStream_8cpp.html#aa93e89217587fdff12bf43b5d7f54f74">CRC_SIZE</a>;</div>
<div class="line"><a name="l00923"></a><span class="lineno">  923</span>&#160;}</div>
<div class="line"><a name="l00924"></a><span class="lineno">  924</span>&#160; </div>
<div class="line"><a name="l00925"></a><span class="lineno">  925</span>&#160; </div>
<div class="line"><a name="l00926"></a><span class="lineno"><a class="line" href="classyarp_1_1os_1_1impl_1_1DgramTwoWayStream.html#ae5ec4ecd19e964f81173e2143d6ffc83">  926</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="classyarp_1_1os_1_1impl_1_1DgramTwoWayStream.html#ae5ec4ecd19e964f81173e2143d6ffc83">DgramTwoWayStream::isOk</a>()<span class="keyword"> const</span></div>
<div class="line"><a name="l00927"></a><span class="lineno">  927</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l00928"></a><span class="lineno">  928</span>&#160;    <span class="keywordflow">return</span> happy;</div>
<div class="line"><a name="l00929"></a><span class="lineno">  929</span>&#160;}</div>
<div class="line"><a name="l00930"></a><span class="lineno">  930</span>&#160; </div>
<div class="line"><a name="l00931"></a><span class="lineno">  931</span>&#160; </div>
<div class="line"><a name="l00932"></a><span class="lineno"><a class="line" href="classyarp_1_1os_1_1impl_1_1DgramTwoWayStream.html#a8c9e646b61d48cb800ca1ed8d3ddba17">  932</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classyarp_1_1os_1_1impl_1_1DgramTwoWayStream.html#a8c9e646b61d48cb800ca1ed8d3ddba17">DgramTwoWayStream::reset</a>()</div>
<div class="line"><a name="l00933"></a><span class="lineno">  933</span>&#160;{</div>
<div class="line"><a name="l00934"></a><span class="lineno">  934</span>&#160;    readAt = 0;</div>
<div class="line"><a name="l00935"></a><span class="lineno">  935</span>&#160;    readAvail = 0;</div>
<div class="line"><a name="l00936"></a><span class="lineno">  936</span>&#160;    writeAvail = <a class="code" href="DgramTwoWayStream_8cpp.html#aa93e89217587fdff12bf43b5d7f54f74">CRC_SIZE</a>;</div>
<div class="line"><a name="l00937"></a><span class="lineno">  937</span>&#160;    pct = 0;</div>
<div class="line"><a name="l00938"></a><span class="lineno">  938</span>&#160;}</div>
<div class="line"><a name="l00939"></a><span class="lineno">  939</span>&#160; </div>
<div class="line"><a name="l00940"></a><span class="lineno">  940</span>&#160; </div>
<div class="line"><a name="l00941"></a><span class="lineno"><a class="line" href="classyarp_1_1os_1_1impl_1_1DgramTwoWayStream.html#ab4879dc8c0c6478d75f5f7b10f84b7f2">  941</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classyarp_1_1os_1_1impl_1_1DgramTwoWayStream.html#ab4879dc8c0c6478d75f5f7b10f84b7f2">DgramTwoWayStream::beginPacket</a>()</div>
<div class="line"><a name="l00942"></a><span class="lineno">  942</span>&#160;{</div>
<div class="line"><a name="l00943"></a><span class="lineno">  943</span>&#160;<span class="comment">//     yCError(DGRAMTWOWAYSTREAM, &quot;Packet begins: %s&quot;, (reader ? &quot;reader&quot; : &quot;writer&quot;));</span></div>
<div class="line"><a name="l00944"></a><span class="lineno">  944</span>&#160;    pct = 0;</div>
<div class="line"><a name="l00945"></a><span class="lineno">  945</span>&#160;}</div>
<div class="line"><a name="l00946"></a><span class="lineno">  946</span>&#160; </div>
<div class="line"><a name="l00947"></a><span class="lineno"><a class="line" href="classyarp_1_1os_1_1impl_1_1DgramTwoWayStream.html#a4eba8eca859455dba0696a96c0a246e3">  947</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classyarp_1_1os_1_1impl_1_1DgramTwoWayStream.html#a4eba8eca859455dba0696a96c0a246e3">DgramTwoWayStream::endPacket</a>()</div>
<div class="line"><a name="l00948"></a><span class="lineno">  948</span>&#160;{</div>
<div class="line"><a name="l00949"></a><span class="lineno">  949</span>&#160;<span class="comment">//     yCError(DGRAMTWOWAYSTREAM, &quot;Packet ends: %s&quot;, (reader ? &quot;reader&quot; : &quot;writer&quot;));</span></div>
<div class="line"><a name="l00950"></a><span class="lineno">  950</span>&#160;    <span class="keywordflow">if</span> (!reader) {</div>
<div class="line"><a name="l00951"></a><span class="lineno">  951</span>&#160;        pct = 0;</div>
<div class="line"><a name="l00952"></a><span class="lineno">  952</span>&#160;    }</div>
<div class="line"><a name="l00953"></a><span class="lineno">  953</span>&#160;}</div>
<div class="line"><a name="l00954"></a><span class="lineno">  954</span>&#160; </div>
<div class="line"><a name="l00955"></a><span class="lineno"><a class="line" href="classyarp_1_1os_1_1impl_1_1DgramTwoWayStream.html#a8a24e93c3c811c2c126f0a9053a55067">  955</a></span>&#160;<a class="code" href="classyarp_1_1os_1_1Bytes.html">Bytes</a> <a class="code" href="classyarp_1_1os_1_1impl_1_1DgramTwoWayStream.html#a8a24e93c3c811c2c126f0a9053a55067">DgramTwoWayStream::getMonitor</a>()</div>
<div class="line"><a name="l00956"></a><span class="lineno">  956</span>&#160;{</div>
<div class="line"><a name="l00957"></a><span class="lineno">  957</span>&#160;    <span class="keywordflow">return</span> monitor.bytes();</div>
<div class="line"><a name="l00958"></a><span class="lineno">  958</span>&#160;}</div>
<div class="line"><a name="l00959"></a><span class="lineno">  959</span>&#160; </div>
<div class="line"><a name="l00960"></a><span class="lineno">  960</span>&#160; </div>
<div class="line"><a name="l00961"></a><span class="lineno"><a class="line" href="classyarp_1_1os_1_1impl_1_1DgramTwoWayStream.html#a38a060fc449a1c6469f067e9d0fa11f6">  961</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classyarp_1_1os_1_1impl_1_1DgramTwoWayStream.html#a38a060fc449a1c6469f067e9d0fa11f6">DgramTwoWayStream::removeMonitor</a>()</div>
<div class="line"><a name="l00962"></a><span class="lineno">  962</span>&#160;{</div>
<div class="line"><a name="l00963"></a><span class="lineno">  963</span>&#160;    monitor.clear();</div>
<div class="line"><a name="l00964"></a><span class="lineno">  964</span>&#160;}</div>
<div class="line"><a name="l00965"></a><span class="lineno">  965</span>&#160; </div>
<div class="line"><a name="l00966"></a><span class="lineno">  966</span>&#160; </div>
<div class="line"><a name="l00967"></a><span class="lineno"><a class="line" href="classyarp_1_1os_1_1impl_1_1DgramTwoWayStream.html#a1a46ee05803203d32c877cc2a85d6fe7">  967</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="classyarp_1_1os_1_1impl_1_1DgramTwoWayStream.html#a1a46ee05803203d32c877cc2a85d6fe7">DgramTwoWayStream::setTypeOfService</a>(<span class="keywordtype">int</span> tos)</div>
<div class="line"><a name="l00968"></a><span class="lineno">  968</span>&#160;{</div>
<div class="line"><a name="l00969"></a><span class="lineno">  969</span>&#160;    <span class="keywordflow">if</span> (dgram == <span class="keyword">nullptr</span>) {</div>
<div class="line"><a name="l00970"></a><span class="lineno">  970</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00971"></a><span class="lineno">  971</span>&#160;    }</div>
<div class="line"><a name="l00972"></a><span class="lineno">  972</span>&#160;<span class="preprocessor">#if defined(YARP_HAS_ACE)</span></div>
<div class="line"><a name="l00973"></a><span class="lineno">  973</span>&#160;    <span class="keywordflow">return</span> (dgram-&gt;set_option(IPPROTO_IP, IP_TOS, (<span class="keywordtype">int</span>*)&amp;tos, (<span class="keywordtype">int</span>)<span class="keyword">sizeof</span>(tos)) == 0);</div>
<div class="line"><a name="l00974"></a><span class="lineno">  974</span>&#160;<span class="preprocessor">#else</span></div>
<div class="line"><a name="l00975"></a><span class="lineno">  975</span>&#160;    <span class="keywordflow">return</span> (setsockopt(dgram_sockfd, IPPROTO_IP, IP_TOS, (<span class="keywordtype">int</span>*)&amp;tos, (<span class="keywordtype">int</span>)<span class="keyword">sizeof</span>(tos)) == 0);</div>
<div class="line"><a name="l00976"></a><span class="lineno">  976</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00977"></a><span class="lineno">  977</span>&#160;}</div>
<div class="line"><a name="l00978"></a><span class="lineno">  978</span>&#160; </div>
<div class="line"><a name="l00979"></a><span class="lineno"><a class="line" href="classyarp_1_1os_1_1impl_1_1DgramTwoWayStream.html#a60551b79781061439e8dd1acad6c0f2f">  979</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="classyarp_1_1os_1_1impl_1_1DgramTwoWayStream.html#a60551b79781061439e8dd1acad6c0f2f">DgramTwoWayStream::getTypeOfService</a>()</div>
<div class="line"><a name="l00980"></a><span class="lineno">  980</span>&#160;{</div>
<div class="line"><a name="l00981"></a><span class="lineno">  981</span>&#160;    <span class="keywordtype">int</span> tos = -1;</div>
<div class="line"><a name="l00982"></a><span class="lineno">  982</span>&#160;    <span class="keywordflow">if</span> (dgram == <span class="keyword">nullptr</span>) {</div>
<div class="line"><a name="l00983"></a><span class="lineno">  983</span>&#160;        <span class="keywordflow">return</span> tos;</div>
<div class="line"><a name="l00984"></a><span class="lineno">  984</span>&#160;    }</div>
<div class="line"><a name="l00985"></a><span class="lineno">  985</span>&#160;<span class="preprocessor">#if defined(YARP_HAS_ACE)</span></div>
<div class="line"><a name="l00986"></a><span class="lineno">  986</span>&#160;    <span class="keywordtype">int</span> optlen;</div>
<div class="line"><a name="l00987"></a><span class="lineno">  987</span>&#160;    dgram-&gt;get_option(IPPROTO_IP, IP_TOS, (<span class="keywordtype">int</span>*)&amp;tos, &amp;optlen);</div>
<div class="line"><a name="l00988"></a><span class="lineno">  988</span>&#160;<span class="preprocessor">#else</span></div>
<div class="line"><a name="l00989"></a><span class="lineno">  989</span>&#160;    socklen_t optlen;</div>
<div class="line"><a name="l00990"></a><span class="lineno">  990</span>&#160;    getsockopt(dgram_sockfd, IPPROTO_IP, IP_TOS, (<span class="keywordtype">int</span>*)&amp;tos, &amp;optlen);</div>
<div class="line"><a name="l00991"></a><span class="lineno">  991</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00992"></a><span class="lineno">  992</span>&#160;    <span class="keywordflow">return</span> tos;</div>
<div class="line"><a name="l00993"></a><span class="lineno">  993</span>&#160;}</div>
<div class="ttc" id="aDgramTwoWayStream_8cpp_html_a3f8812130ffb175a81bdb3eb5f2a0faf"><div class="ttname"><a href="DgramTwoWayStream_8cpp.html#a3f8812130ffb175a81bdb3eb5f2a0faf">checkCrc</a></div><div class="ttdeci">static bool checkCrc(char *buf, yarp::conf::ssize_t length, yarp::conf::ssize_t crcLength, int pct, int *store_altPct=nullptr)</div><div class="ttdef"><b>Definition:</b> <a href="DgramTwoWayStream_8cpp_source.html#l00056">DgramTwoWayStream.cpp:56</a></div></div>
<div class="ttc" id="aDgramTwoWayStream_8cpp_html_aa93e89217587fdff12bf43b5d7f54f74"><div class="ttname"><a href="DgramTwoWayStream_8cpp.html#aa93e89217587fdff12bf43b5d7f54f74">CRC_SIZE</a></div><div class="ttdeci">#define CRC_SIZE</div><div class="ttdef"><b>Definition:</b> <a href="DgramTwoWayStream_8cpp_source.html#l00047">DgramTwoWayStream.cpp:47</a></div></div>
<div class="ttc" id="aDgramTwoWayStream_8cpp_html_ae0a51066428b22f9c74ad2d090df6c88"><div class="ttname"><a href="DgramTwoWayStream_8cpp.html#ae0a51066428b22f9c74ad2d090df6c88">UDP_MAX_DATAGRAM_SIZE</a></div><div class="ttdeci">#define UDP_MAX_DATAGRAM_SIZE</div><div class="ttdef"><b>Definition:</b> <a href="DgramTwoWayStream_8cpp_source.html#l00048">DgramTwoWayStream.cpp:48</a></div></div>
<div class="ttc" id="aDgramTwoWayStream_8cpp_html_afa693fafffe613a6f5c1283661588090"><div class="ttname"><a href="DgramTwoWayStream_8cpp.html#afa693fafffe613a6f5c1283661588090">addCrc</a></div><div class="ttdeci">static void addCrc(char *buf, yarp::conf::ssize_t length, yarp::conf::ssize_t crcLength, int pct)</div><div class="ttdef"><b>Definition:</b> <a href="DgramTwoWayStream_8cpp_source.html#l00081">DgramTwoWayStream.cpp:81</a></div></div>
<div class="ttc" id="aDgramTwoWayStream_8h_html"><div class="ttname"><a href="DgramTwoWayStream_8h.html">DgramTwoWayStream.h</a></div></div>
<div class="ttc" id="aNetType_8h_html"><div class="ttname"><a href="NetType_8h.html">NetType.h</a></div></div>
<div class="ttc" id="aclassyarp_1_1os_1_1Bytes_html"><div class="ttname"><a href="classyarp_1_1os_1_1Bytes.html">yarp::os::Bytes</a></div><div class="ttdoc">A simple abstraction for a block of bytes.</div><div class="ttdef"><b>Definition:</b> <a href="Bytes_8h_source.html#l00027">Bytes.h:28</a></div></div>
<div class="ttc" id="aclassyarp_1_1os_1_1Bytes_html_a1777bdec41bab120b74bc353e3570377"><div class="ttname"><a href="classyarp_1_1os_1_1Bytes.html#a1777bdec41bab120b74bc353e3570377">yarp::os::Bytes::length</a></div><div class="ttdeci">size_t length() const</div><div class="ttdef"><b>Definition:</b> <a href="Bytes_8cpp_source.html#l00025">Bytes.cpp:25</a></div></div>
<div class="ttc" id="aclassyarp_1_1os_1_1Bytes_html_ad62e722069297651d9efb5fa7fba1d92"><div class="ttname"><a href="classyarp_1_1os_1_1Bytes.html#ad62e722069297651d9efb5fa7fba1d92">yarp::os::Bytes::get</a></div><div class="ttdeci">const char * get() const</div><div class="ttdef"><b>Definition:</b> <a href="Bytes_8cpp_source.html#l00030">Bytes.cpp:30</a></div></div>
<div class="ttc" id="aclassyarp_1_1os_1_1Contact_html"><div class="ttname"><a href="classyarp_1_1os_1_1Contact.html">yarp::os::Contact</a></div><div class="ttdoc">Represents how to reach a part of a YARP network.</div><div class="ttdef"><b>Definition:</b> <a href="Contact_8h_source.html#l00038">Contact.h:39</a></div></div>
<div class="ttc" id="aclassyarp_1_1os_1_1Contact_html_a44450481ce5c8dd99f3a75eb9c8f310f"><div class="ttname"><a href="classyarp_1_1os_1_1Contact.html#a44450481ce5c8dd99f3a75eb9c8f310f">yarp::os::Contact::isValid</a></div><div class="ttdeci">bool isValid() const</div><div class="ttdoc">Checks if a Contact is tagged as valid.</div><div class="ttdef"><b>Definition:</b> <a href="Contact_8cpp_source.html#l00301">Contact.cpp:301</a></div></div>
<div class="ttc" id="aclassyarp_1_1os_1_1Contact_html_ab3fceb3bf92cbc7b8eb9d91bda5c807e"><div class="ttname"><a href="classyarp_1_1os_1_1Contact.html#ab3fceb3bf92cbc7b8eb9d91bda5c807e">yarp::os::Contact::toURI</a></div><div class="ttdeci">std::string toURI(bool includeCarrier=true) const</div><div class="ttdoc">Get a representation of the Contact as a URI.</div><div class="ttdef"><b>Definition:</b> <a href="Contact_8cpp_source.html#l00316">Contact.cpp:316</a></div></div>
<div class="ttc" id="aclassyarp_1_1os_1_1Contact_html_ab4312ee491059450c68ab85bb713b44f"><div class="ttname"><a href="classyarp_1_1os_1_1Contact.html#ab4312ee491059450c68ab85bb713b44f">yarp::os::Contact::getPort</a></div><div class="ttdeci">int getPort() const</div><div class="ttdoc">Get the port number associated with this Contact for socket communication.</div><div class="ttdef"><b>Definition:</b> <a href="Contact_8cpp_source.html#l00242">Contact.cpp:242</a></div></div>
<div class="ttc" id="aclassyarp_1_1os_1_1Contact_html_af2fa156ae18485d859ef8c859f43eca1"><div class="ttname"><a href="classyarp_1_1os_1_1Contact.html#af2fa156ae18485d859ef8c859f43eca1">yarp::os::Contact::getHost</a></div><div class="ttdeci">std::string getHost() const</div><div class="ttdoc">Get the host name associated with this Contact for socket communication.</div><div class="ttdef"><b>Definition:</b> <a href="Contact_8cpp_source.html#l00231">Contact.cpp:231</a></div></div>
<div class="ttc" id="aclassyarp_1_1os_1_1InputStream_html_a448b29e1cd20c5ae3bf3a43ba6b49f17"><div class="ttname"><a href="classyarp_1_1os_1_1InputStream.html#a448b29e1cd20c5ae3bf3a43ba6b49f17">yarp::os::InputStream::read</a></div><div class="ttdeci">virtual int read()</div><div class="ttdoc">Read and return a single byte.</div><div class="ttdef"><b>Definition:</b> <a href="InputStream_8cpp_source.html#l00023">InputStream.cpp:23</a></div></div>
<div class="ttc" id="aclassyarp_1_1os_1_1ManagedBytes_html"><div class="ttname"><a href="classyarp_1_1os_1_1ManagedBytes.html">yarp::os::ManagedBytes</a></div><div class="ttdoc">An abstraction for a block of bytes, with optional responsibility for allocating/destroying that bloc...</div><div class="ttdef"><b>Definition:</b> <a href="ManagedBytes_8h_source.html#l00024">ManagedBytes.h:25</a></div></div>
<div class="ttc" id="aclassyarp_1_1os_1_1ManagedBytes_html_a41c563c189aa28744836de69f3e54fef"><div class="ttname"><a href="classyarp_1_1os_1_1ManagedBytes.html#a41c563c189aa28744836de69f3e54fef">yarp::os::ManagedBytes::bytes</a></div><div class="ttdeci">const Bytes &amp; bytes() const</div><div class="ttdef"><b>Definition:</b> <a href="ManagedBytes_8cpp_source.html#l00177">ManagedBytes.cpp:177</a></div></div>
<div class="ttc" id="aclassyarp_1_1os_1_1ManagedBytes_html_ab6a6d6720476bd84a3e04c769bcad3e5"><div class="ttname"><a href="classyarp_1_1os_1_1ManagedBytes.html#ab6a6d6720476bd84a3e04c769bcad3e5">yarp::os::ManagedBytes::get</a></div><div class="ttdeci">const char * get() const</div><div class="ttdef"><b>Definition:</b> <a href="ManagedBytes_8cpp_source.html#l00154">ManagedBytes.cpp:154</a></div></div>
<div class="ttc" id="aclassyarp_1_1os_1_1ManagedBytes_html_ac50d5c97ce01e05a01a1944aa14be377"><div class="ttname"><a href="classyarp_1_1os_1_1ManagedBytes.html#ac50d5c97ce01e05a01a1944aa14be377">yarp::os::ManagedBytes::length</a></div><div class="ttdeci">size_t length() const</div><div class="ttdef"><b>Definition:</b> <a href="ManagedBytes_8cpp_source.html#l00144">ManagedBytes.cpp:144</a></div></div>
<div class="ttc" id="aclassyarp_1_1os_1_1NetType_html_a180deac631b371563b130ee2f0c7e320"><div class="ttname"><a href="classyarp_1_1os_1_1NetType.html#a180deac631b371563b130ee2f0c7e320">yarp::os::NetType::netInt</a></div><div class="ttdeci">static int netInt(const yarp::os::Bytes &amp;code)</div><div class="ttdef"><b>Definition:</b> <a href="NetType_8cpp_source.html#l00096">NetType.cpp:96</a></div></div>
<div class="ttc" id="aclassyarp_1_1os_1_1NetType_html_aa7e85a7bead7fad8b156b89ed48c7185"><div class="ttname"><a href="classyarp_1_1os_1_1NetType.html#aa7e85a7bead7fad8b156b89ed48c7185">yarp::os::NetType::getCrc</a></div><div class="ttdeci">static unsigned long int getCrc(char *buf, size_t len)</div><div class="ttdef"><b>Definition:</b> <a href="NetType_8cpp_source.html#l00250">NetType.cpp:250</a></div></div>
<div class="ttc" id="aclassyarp_1_1os_1_1NetType_html_ae376a87cb0d9c158ad094c94e013907e"><div class="ttname"><a href="classyarp_1_1os_1_1NetType.html#ae376a87cb0d9c158ad094c94e013907e">yarp::os::NetType::toInt</a></div><div class="ttdeci">static int toInt(const std::string &amp;x)</div><div class="ttdef"><b>Definition:</b> <a href="NetType_8cpp_source.html#l00160">NetType.cpp:160</a></div></div>
<div class="ttc" id="aclassyarp_1_1os_1_1SystemClock_html_a8bf2d789cc755768467e392f88eccaf2"><div class="ttname"><a href="classyarp_1_1os_1_1SystemClock.html#a8bf2d789cc755768467e392f88eccaf2">yarp::os::SystemClock::nowSystem</a></div><div class="ttdeci">static double nowSystem()</div><div class="ttdef"><b>Definition:</b> <a href="SystemClock_8cpp_source.html#l00037">SystemClock.cpp:37</a></div></div>
<div class="ttc" id="aclassyarp_1_1os_1_1SystemClock_html_af9eba2d0a597ba1a53e6be7a47941314"><div class="ttname"><a href="classyarp_1_1os_1_1SystemClock.html#af9eba2d0a597ba1a53e6be7a47941314">yarp::os::SystemClock::delaySystem</a></div><div class="ttdeci">static void delaySystem(double seconds)</div><div class="ttdef"><b>Definition:</b> <a href="SystemClock_8cpp_source.html#l00032">SystemClock.cpp:32</a></div></div>
<div class="ttc" id="aclassyarp_1_1os_1_1impl_1_1DgramTwoWayStream_html"><div class="ttname"><a href="classyarp_1_1os_1_1impl_1_1DgramTwoWayStream.html">yarp::os::impl::DgramTwoWayStream</a></div><div class="ttdoc">A stream abstraction for datagram communication.</div><div class="ttdef"><b>Definition:</b> <a href="DgramTwoWayStream_8h_source.html#l00036">DgramTwoWayStream.h:40</a></div></div>
<div class="ttc" id="aclassyarp_1_1os_1_1impl_1_1DgramTwoWayStream_html_a0ff2b10caf0c9a51a1691d374201da54"><div class="ttname"><a href="classyarp_1_1os_1_1impl_1_1DgramTwoWayStream.html#a0ff2b10caf0c9a51a1691d374201da54">yarp::os::impl::DgramTwoWayStream::closeMain</a></div><div class="ttdeci">virtual void closeMain()</div><div class="ttdef"><b>Definition:</b> <a href="DgramTwoWayStream_8cpp_source.html#l00665">DgramTwoWayStream.cpp:665</a></div></div>
<div class="ttc" id="aclassyarp_1_1os_1_1impl_1_1DgramTwoWayStream_html_a1a46ee05803203d32c877cc2a85d6fe7"><div class="ttname"><a href="classyarp_1_1os_1_1impl_1_1DgramTwoWayStream.html#a1a46ee05803203d32c877cc2a85d6fe7">yarp::os::impl::DgramTwoWayStream::setTypeOfService</a></div><div class="ttdeci">bool setTypeOfService(int tos) override</div><div class="ttdef"><b>Definition:</b> <a href="DgramTwoWayStream_8cpp_source.html#l00967">DgramTwoWayStream.cpp:967</a></div></div>
<div class="ttc" id="aclassyarp_1_1os_1_1impl_1_1DgramTwoWayStream_html_a1de9f8bd9256d2dfc47fddbea73061ab"><div class="ttname"><a href="classyarp_1_1os_1_1impl_1_1DgramTwoWayStream.html#a1de9f8bd9256d2dfc47fddbea73061ab">yarp::os::impl::DgramTwoWayStream::write</a></div><div class="ttdeci">void write(const yarp::os::Bytes &amp;b) override</div><div class="ttdoc">Write a block of bytes to the stream.</div><div class="ttdef"><b>Definition:</b> <a href="DgramTwoWayStream_8cpp_source.html#l00815">DgramTwoWayStream.cpp:815</a></div></div>
<div class="ttc" id="aclassyarp_1_1os_1_1impl_1_1DgramTwoWayStream_html_a38a060fc449a1c6469f067e9d0fa11f6"><div class="ttname"><a href="classyarp_1_1os_1_1impl_1_1DgramTwoWayStream.html#a38a060fc449a1c6469f067e9d0fa11f6">yarp::os::impl::DgramTwoWayStream::removeMonitor</a></div><div class="ttdeci">void removeMonitor()</div><div class="ttdef"><b>Definition:</b> <a href="DgramTwoWayStream_8cpp_source.html#l00961">DgramTwoWayStream.cpp:961</a></div></div>
<div class="ttc" id="aclassyarp_1_1os_1_1impl_1_1DgramTwoWayStream_html_a3fb7835682d050ad6b70ec34b1a25d00"><div class="ttname"><a href="classyarp_1_1os_1_1impl_1_1DgramTwoWayStream.html#a3fb7835682d050ad6b70ec34b1a25d00">yarp::os::impl::DgramTwoWayStream::interrupt</a></div><div class="ttdeci">void interrupt() override</div><div class="ttdoc">Interrupt the stream.</div><div class="ttdef"><b>Definition:</b> <a href="DgramTwoWayStream_8cpp_source.html#l00605">DgramTwoWayStream.cpp:605</a></div></div>
<div class="ttc" id="aclassyarp_1_1os_1_1impl_1_1DgramTwoWayStream_html_a421205cfcf35495ea9e518e1d8eba805"><div class="ttname"><a href="classyarp_1_1os_1_1impl_1_1DgramTwoWayStream.html#a421205cfcf35495ea9e518e1d8eba805">yarp::os::impl::DgramTwoWayStream::open</a></div><div class="ttdeci">virtual bool open(const Contact &amp;remote)</div><div class="ttdef"><b>Definition:</b> <a href="DgramTwoWayStream_8cpp_source.html#l00092">DgramTwoWayStream.cpp:92</a></div></div>
<div class="ttc" id="aclassyarp_1_1os_1_1impl_1_1DgramTwoWayStream_html_a44c91c82ca068d99b64661fd71bd057b"><div class="ttname"><a href="classyarp_1_1os_1_1impl_1_1DgramTwoWayStream.html#a44c91c82ca068d99b64661fd71bd057b">yarp::os::impl::DgramTwoWayStream::close</a></div><div class="ttdeci">void close() override</div><div class="ttdoc">Terminate the stream.</div><div class="ttdef"><b>Definition:</b> <a href="DgramTwoWayStream_8h_source.html#l00117">DgramTwoWayStream.h:117</a></div></div>
<div class="ttc" id="aclassyarp_1_1os_1_1impl_1_1DgramTwoWayStream_html_a4eba8eca859455dba0696a96c0a246e3"><div class="ttname"><a href="classyarp_1_1os_1_1impl_1_1DgramTwoWayStream.html#a4eba8eca859455dba0696a96c0a246e3">yarp::os::impl::DgramTwoWayStream::endPacket</a></div><div class="ttdeci">void endPacket() override</div><div class="ttdoc">Mark the end of a logical packet (see beginPacket).</div><div class="ttdef"><b>Definition:</b> <a href="DgramTwoWayStream_8cpp_source.html#l00947">DgramTwoWayStream.cpp:947</a></div></div>
<div class="ttc" id="aclassyarp_1_1os_1_1impl_1_1DgramTwoWayStream_html_a60551b79781061439e8dd1acad6c0f2f"><div class="ttname"><a href="classyarp_1_1os_1_1impl_1_1DgramTwoWayStream.html#a60551b79781061439e8dd1acad6c0f2f">yarp::os::impl::DgramTwoWayStream::getTypeOfService</a></div><div class="ttdeci">int getTypeOfService() override</div><div class="ttdef"><b>Definition:</b> <a href="DgramTwoWayStream_8cpp_source.html#l00979">DgramTwoWayStream.cpp:979</a></div></div>
<div class="ttc" id="aclassyarp_1_1os_1_1impl_1_1DgramTwoWayStream_html_a8a24e93c3c811c2c126f0a9053a55067"><div class="ttname"><a href="classyarp_1_1os_1_1impl_1_1DgramTwoWayStream.html#a8a24e93c3c811c2c126f0a9053a55067">yarp::os::impl::DgramTwoWayStream::getMonitor</a></div><div class="ttdeci">yarp::os::Bytes getMonitor()</div><div class="ttdef"><b>Definition:</b> <a href="DgramTwoWayStream_8cpp_source.html#l00955">DgramTwoWayStream.cpp:955</a></div></div>
<div class="ttc" id="aclassyarp_1_1os_1_1impl_1_1DgramTwoWayStream_html_a8b3cbebddac01498d48a7204a3e664d8"><div class="ttname"><a href="classyarp_1_1os_1_1impl_1_1DgramTwoWayStream.html#a8b3cbebddac01498d48a7204a3e664d8">yarp::os::impl::DgramTwoWayStream::openMcast</a></div><div class="ttdeci">virtual bool openMcast(const Contact &amp;group, const Contact &amp;ipLocal)</div><div class="ttdef"><b>Definition:</b> <a href="DgramTwoWayStream_8cpp_source.html#l00391">DgramTwoWayStream.cpp:391</a></div></div>
<div class="ttc" id="aclassyarp_1_1os_1_1impl_1_1DgramTwoWayStream_html_a8c9e646b61d48cb800ca1ed8d3ddba17"><div class="ttname"><a href="classyarp_1_1os_1_1impl_1_1DgramTwoWayStream.html#a8c9e646b61d48cb800ca1ed8d3ddba17">yarp::os::impl::DgramTwoWayStream::reset</a></div><div class="ttdeci">void reset() override</div><div class="ttdoc">Reset the stream.</div><div class="ttdef"><b>Definition:</b> <a href="DgramTwoWayStream_8cpp_source.html#l00932">DgramTwoWayStream.cpp:932</a></div></div>
<div class="ttc" id="aclassyarp_1_1os_1_1impl_1_1DgramTwoWayStream_html_a9e36f05df8aebf6273bec55fcddeb7be"><div class="ttname"><a href="classyarp_1_1os_1_1impl_1_1DgramTwoWayStream.html#a9e36f05df8aebf6273bec55fcddeb7be">yarp::os::impl::DgramTwoWayStream::join</a></div><div class="ttdeci">virtual bool join(const Contact &amp;group, bool sender, const Contact &amp;ipLocal)</div><div class="ttdef"><b>Definition:</b> <a href="DgramTwoWayStream_8cpp_source.html#l00486">DgramTwoWayStream.cpp:486</a></div></div>
<div class="ttc" id="aclassyarp_1_1os_1_1impl_1_1DgramTwoWayStream_html_aa4a6185fcea781c219d18242411890b0"><div class="ttname"><a href="classyarp_1_1os_1_1impl_1_1DgramTwoWayStream.html#aa4a6185fcea781c219d18242411890b0">yarp::os::impl::DgramTwoWayStream::~DgramTwoWayStream</a></div><div class="ttdeci">virtual ~DgramTwoWayStream()</div><div class="ttdef"><b>Definition:</b> <a href="DgramTwoWayStream_8cpp_source.html#l00600">DgramTwoWayStream.cpp:600</a></div></div>
<div class="ttc" id="aclassyarp_1_1os_1_1impl_1_1DgramTwoWayStream_html_ab4879dc8c0c6478d75f5f7b10f84b7f2"><div class="ttname"><a href="classyarp_1_1os_1_1impl_1_1DgramTwoWayStream.html#ab4879dc8c0c6478d75f5f7b10f84b7f2">yarp::os::impl::DgramTwoWayStream::beginPacket</a></div><div class="ttdeci">void beginPacket() override</div><div class="ttdoc">Mark the beginning of a logical packet.</div><div class="ttdef"><b>Definition:</b> <a href="DgramTwoWayStream_8cpp_source.html#l00941">DgramTwoWayStream.cpp:941</a></div></div>
<div class="ttc" id="aclassyarp_1_1os_1_1impl_1_1DgramTwoWayStream_html_aca9b76f5c308f6f758979fb455d305c0"><div class="ttname"><a href="classyarp_1_1os_1_1impl_1_1DgramTwoWayStream.html#aca9b76f5c308f6f758979fb455d305c0">yarp::os::impl::DgramTwoWayStream::flush</a></div><div class="ttdeci">void flush() override</div><div class="ttdoc">Make sure all pending write operations are finished.</div><div class="ttdef"><b>Definition:</b> <a href="DgramTwoWayStream_8cpp_source.html#l00847">DgramTwoWayStream.cpp:847</a></div></div>
<div class="ttc" id="aclassyarp_1_1os_1_1impl_1_1DgramTwoWayStream_html_ae5ec4ecd19e964f81173e2143d6ffc83"><div class="ttname"><a href="classyarp_1_1os_1_1impl_1_1DgramTwoWayStream.html#ae5ec4ecd19e964f81173e2143d6ffc83">yarp::os::impl::DgramTwoWayStream::isOk</a></div><div class="ttdeci">bool isOk() const override</div><div class="ttdoc">Check if the stream is ok or in an error state.</div><div class="ttdef"><b>Definition:</b> <a href="DgramTwoWayStream_8cpp_source.html#l00926">DgramTwoWayStream.cpp:926</a></div></div>
<div class="ttc" id="aenvironment_8h_html"><div class="ttname"><a href="environment_8h.html">environment.h</a></div></div>
<div class="ttc" id="alibYARP__os_2src_2yarp_2os_2LogComponent_8h_html_a18e11e963a9867766b3ac49614348799"><div class="ttname"><a href="libYARP__os_2src_2yarp_2os_2LogComponent_8h.html#a18e11e963a9867766b3ac49614348799">yCInfo</a></div><div class="ttdeci">#define yCInfo(component,...)</div><div class="ttdef"><b>Definition:</b> <a href="libYARP__os_2src_2yarp_2os_2LogComponent_8h_source.html#l00135">LogComponent.h:135</a></div></div>
<div class="ttc" id="alibYARP__os_2src_2yarp_2os_2LogComponent_8h_html_a224fd66c5d833ba0367a2ed54bcc279a"><div class="ttname"><a href="libYARP__os_2src_2yarp_2os_2LogComponent_8h.html#a224fd66c5d833ba0367a2ed54bcc279a">yCError</a></div><div class="ttdeci">#define yCError(component,...)</div><div class="ttdef"><b>Definition:</b> <a href="libYARP__os_2src_2yarp_2os_2LogComponent_8h_source.html#l00157">LogComponent.h:157</a></div></div>
<div class="ttc" id="alibYARP__os_2src_2yarp_2os_2LogComponent_8h_html_a2a73589cc2da13516a620f1b86ef17a0"><div class="ttname"><a href="libYARP__os_2src_2yarp_2os_2LogComponent_8h.html#a2a73589cc2da13516a620f1b86ef17a0">yCAssert</a></div><div class="ttdeci">#define yCAssert(component, x)</div><div class="ttdef"><b>Definition:</b> <a href="libYARP__os_2src_2yarp_2os_2LogComponent_8h_source.html#l00172">LogComponent.h:172</a></div></div>
<div class="ttc" id="alibYARP__os_2src_2yarp_2os_2LogComponent_8h_html_a3ffb0d629a2cfebb6abdc73e93a11bce"><div class="ttname"><a href="libYARP__os_2src_2yarp_2os_2LogComponent_8h.html#a3ffb0d629a2cfebb6abdc73e93a11bce">yCTrace</a></div><div class="ttdeci">#define yCTrace(component,...)</div><div class="ttdef"><b>Definition:</b> <a href="libYARP__os_2src_2yarp_2os_2LogComponent_8h_source.html#l00088">LogComponent.h:88</a></div></div>
<div class="ttc" id="alibYARP__os_2src_2yarp_2os_2LogComponent_8h_html_a677a97e364857e0eafefacd5cff5dc7e"><div class="ttname"><a href="libYARP__os_2src_2yarp_2os_2LogComponent_8h.html#a677a97e364857e0eafefacd5cff5dc7e">yCWarning</a></div><div class="ttdeci">#define yCWarning(component,...)</div><div class="ttdef"><b>Definition:</b> <a href="libYARP__os_2src_2yarp_2os_2LogComponent_8h_source.html#l00146">LogComponent.h:146</a></div></div>
<div class="ttc" id="alibYARP__os_2src_2yarp_2os_2LogComponent_8h_html_a8227343e844aca96bb821dd566d8cbb2"><div class="ttname"><a href="libYARP__os_2src_2yarp_2os_2LogComponent_8h.html#a8227343e844aca96bb821dd566d8cbb2">yCDebug</a></div><div class="ttdeci">#define yCDebug(component,...)</div><div class="ttdef"><b>Definition:</b> <a href="libYARP__os_2src_2yarp_2os_2LogComponent_8h_source.html#l00112">LogComponent.h:112</a></div></div>
<div class="ttc" id="alibYARP__os_2src_2yarp_2os_2Time_8h_html"><div class="ttname"><a href="libYARP__os_2src_2yarp_2os_2Time_8h.html">Time.h</a></div></div>
<div class="ttc" id="alibYARP__os_2src_2yarp_2os_2impl_2LogComponent_8h_html"><div class="ttname"><a href="libYARP__os_2src_2yarp_2os_2impl_2LogComponent_8h.html">LogComponent.h</a></div></div>
<div class="ttc" id="alibYARP__os_2src_2yarp_2os_2impl_2LogComponent_8h_html_a07501992585e9038bb37b7765a6594b0"><div class="ttname"><a href="libYARP__os_2src_2yarp_2os_2impl_2LogComponent_8h.html#a07501992585e9038bb37b7765a6594b0">YARP_OS_LOG_COMPONENT</a></div><div class="ttdeci">#define YARP_OS_LOG_COMPONENT(name, name_string)</div><div class="ttdef"><b>Definition:</b> <a href="libYARP__os_2src_2yarp_2os_2impl_2LogComponent_8h_source.html#l00037">LogComponent.h:37</a></div></div>
<div class="ttc" id="anamespaceyarp_1_1conf_1_1environment_html_a7903710562dc58e7d8c23fabb9c9fda6"><div class="ttname"><a href="namespaceyarp_1_1conf_1_1environment.html#a7903710562dc58e7d8c23fabb9c9fda6">yarp::conf::environment::getEnvironment</a></div><div class="ttdeci">std::string getEnvironment(const char *key, bool *found=nullptr)</div><div class="ttdoc">Read a variable from the environment.</div><div class="ttdef"><b>Definition:</b> <a href="environment_8h_source.html#l00031">environment.h:31</a></div></div>
<div class="ttc" id="anamespaceyarp_1_1conf_html_a3df5afb43ff7b7cc2b4e3cb9150eab20"><div class="ttname"><a href="namespaceyarp_1_1conf.html#a3df5afb43ff7b7cc2b4e3cb9150eab20">yarp::conf::ssize_t</a></div><div class="ttdeci">::ssize_t ssize_t</div><div class="ttdef"><b>Definition:</b> <a href="numeric_8h_source.html#l00060">numeric.h:60</a></div></div>
<div class="ttc" id="anamespaceyarp_1_1os_1_1Time_html_a9909c5613bb1daee8f1fd92e1f4c95f6"><div class="ttname"><a href="namespaceyarp_1_1os_1_1Time.html#a9909c5613bb1daee8f1fd92e1f4c95f6">yarp::os::Time::now</a></div><div class="ttdeci">double now()</div><div class="ttdoc">Return the current time in seconds, relative to an arbitrary starting point.</div><div class="ttdef"><b>Definition:</b> <a href="Time_8cpp_source.html#l00124">Time.cpp:124</a></div></div>
<div class="ttc" id="anamespaceyarp_1_1os_1_1impl_html"><div class="ttname"><a href="namespaceyarp_1_1os_1_1impl.html">yarp::os::impl</a></div><div class="ttdoc">The components from which ports and connections are built.</div></div>
<div class="ttc" id="anamespaceyarp_1_1os_html"><div class="ttname"><a href="namespaceyarp_1_1os.html">yarp::os</a></div><div class="ttdoc">An interface to the operating system, including Port based communication.</div><div class="ttdef"><b>Definition:</b> <a href="AbstractCarrier_8h_source.html#l00017">AbstractCarrier.h:17</a></div></div>
<div class="ttc" id="anamespaceyarp_1_1os_html_ab2676e32122f2ffd9eeb4301a2c06b4f"><div class="ttname"><a href="namespaceyarp_1_1os.html#ab2676e32122f2ffd9eeb4301a2c06b4f">yarp::os::NetInt32</a></div><div class="ttdeci">std::int32_t NetInt32</div><div class="ttdoc">Definition of the NetInt32 type.</div><div class="ttdef"><b>Definition:</b> <a href="NetInt32_8h_source.html#l00033">NetInt32.h:33</a></div></div>
<div class="ttc" id="asystem_8h_html"><div class="ttname"><a href="system_8h.html">system.h</a></div></div>
</div><!-- fragment --></div><!-- contents -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.8.13-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li><span id="projectname_footer">YARP</span></li>
    <li><span id="projectnumber" class="version_switch">3.4.6</span></li>
    <li class="navelem"><a class="el" href="dir_d946d32291de7db32f6a943fb45d46f4.html">src</a></li><li class="navelem"><a class="el" href="dir_6db82663f7ba9663e5d9d671ea5d994b.html">libYARP_os</a></li><li class="navelem"><a class="el" href="dir_458b8b08b94f68234840be2803cdf7c0.html">src</a></li><li class="navelem"><a class="el" href="dir_d530223c319e1c8823bd0a6015d06df3.html">yarp</a></li><li class="navelem"><a class="el" href="dir_4a32e79e38fd073705b9f1f2eb4b9c17.html">os</a></li><li class="navelem"><a class="el" href="dir_1d9514085433ca6e91417cc877f48792.html">impl</a></li><li class="navelem"><a class="el" href="DgramTwoWayStream_8cpp.html">DgramTwoWayStream.cpp</a></li>
    <li class="footer">Generated on Sat Jul 3 2021 02:17:04 for YARP by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.9.1 </li>
  </ul>
</div>
</body>
</html>
