<!-- HTML header for doxygen 1.8.12-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>YARP: Getting Started with YARP Ports</title>
<link rel="shortcut icon" href="yarp-favicon.ico" type="image/x-icon" />
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript">
    var DOCUMENTATION_OPTIONS = { VERSION: '3.4.6' };
</script>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(function() { init_search(); });
/* @license-end */
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="yarp-doxygen-style.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../version_switch.js"></script>
<link rel="stylesheet" type="text/css" href="cookieconsent.min.css" />
<script src="cookieconsent.min.js"></script>
<script>
window.addEventListener("load", function(){
window.cookieconsent.initialise({
  "palette": {
    "popup": {
      "background": "#eb6c44",
      "text": "#ffffff"
    },
    "button": {
      "background": "#237afc",
    }
  },
  "theme": "classic",
  "content": {
    "message": "INFORMATION NOTICE ON COOKIES : This website uses only browsing/session cookies. Users can choose whether or not to accept the use of cookies and access the website. By clicking on \"Further information\", the full information notice on the types of cookies will be displayed and you will be able  to choose whether or not to accept them whilst browsing on the website.",
    "dismiss": "ACCEPT and close",
    "link": "Further information",
    "href": "http://www.icub.org/other/personal_data_notice.html"
  }
})});
</script>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="yarp-robot-64.png"/></td>
  <td id="projectalign" style="padding-left: 1.5em;">
   <div id="projectname">YARP</div>
   <div id="projectbrief">Yet Another Robot Platform</div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.svg"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.svg" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('note_ports.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Getting Started with YARP Ports </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#note_ports_network">A network of ports</a></li>
<li class="level1"><a href="#note_ports_example">A worked example</a></li>
<li class="level1"><a href="#note_ports_closer">Taking a closer look</a></li>
</ul>
</div>
<div class="textblock"><h1><a class="anchor" id="note_ports_network"></a>
A network of ports</h1>
<p>Communication in YARP generally follows the <em>Observer</em> design pattern. Special <em>port</em> objects deliver messages to any number of observers (other ports), in any number of processes, distributed across any number of machines, using any of several underlying communication protocols. Here is a very simple network of ports for a visual tracking application:</p>
<div class="dotgraph">
<img src="dot_inline_dotgraph_2.png" alt="dot_inline_dotgraph_2.png" border="0" usemap="#dot_inline_dotgraph_2.map"/>
</div>
<p>Images are transmitted from a camera ("/camera") port to a viewer ("/viewer1") port and the input of a visual tracker ("/tracker/image"). The tracker annotates the image, for example by placing a marker on a tracked point, and transmits that to another viewer ("/viewer2"). The tracker also sends just the tracked position from a position output port ("/tracker/position") to a input controlling head position ("/motor/position"). Every port belongs to a process. They do not need to belong to the same process. Every connection can take place using a different protocol and/or physical network. The use of several different protocol allows us to exploit their best characteristics: </p><ul>
<li>TCP: reliable, it can be used to guarantee the reception of a message; </li>
<li>UDP: faster than TCP, but without guarantees; </li>
<li>multicast: efficient for distributing the same information to large numbers of targets; </li>
<li>shared memory: employed for local connections (selected automatically whenever possible, without the need for programmer intervention); If messages follow follow YARP guidelines, then they can be automatically converted to and from a "text mode" connection, for easy human monitoring and intervention in the system.</li>
</ul>
<div class="dotgraph">
<img src="dot_inline_dotgraph_3.png" alt="dot_inline_dotgraph_3.png" border="0" usemap="#dot_inline_dotgraph_3.map"/>
</div>
<p>Processes can be on different physical machines without a problem. They can also run under different operating systems and be implemented using different languages. If the message format follows YARP guidelines, then communication will not be a problem:</p>
<div class="dotgraph">
<img src="dot_inline_dotgraph_4.png" alt="dot_inline_dotgraph_4.png" border="0" usemap="#dot_inline_dotgraph_4.map"/>
</div>
<h1><a class="anchor" id="note_ports_example"></a>
A worked example</h1>
<p>Make sure you've followed the instructions for installing and testing your YARP configuration on the website (<a href="http://www.yarp.it">http://www.yarp.it</a>). Now start some three terminals and do the following:</p>
<pre class="fragment">[on terminal 1] yarp server
[on terminal 2] yarp read /read
[on terminal 3] yarp write /write /read
</pre><p>We'll say a bit more about "yarp server" in the next section; for now it is enough to know that it acts as a database for port contact information. We can ignore it for now.</p>
<p>If you type a list of numbers on terminal 3 ("yarp write"), they will show up on terminal 2 ("yarp read"), e.g. if you type on terminal 3: </p><pre class="fragment">10 -5 17.15 6
</pre><p> you will see the same on terminal 2: </p><pre class="fragment">10 -5 17.15 6
</pre><p>Our network so far is very simple: </p><div class="dotgraph">
<img src="dot_inline_dotgraph_5.png" alt="dot_inline_dotgraph_5.png" border="0" usemap="#dot_inline_dotgraph_5.map"/>
</div>
<p>Now let's make a program that transforms the output of /write in some way, for example by adding up all the numbers in it. Here is a program for this ("example/os/summer/summer.cpp" in the YARP source):</p>
<div class="fragment"><div class="line"><span class="comment">/*</span></div>
<div class="line"><span class="comment"> * Copyright (C) 2006-2020 Istituto Italiano di Tecnologia (IIT)</span></div>
<div class="line"><span class="comment"> * Copyright (C) 2006-2010 RobotCub Consortium</span></div>
<div class="line"><span class="comment"> * All rights reserved.</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * This software may be modified and distributed under the terms of the</span></div>
<div class="line"><span class="comment"> * BSD-3-Clause license. See the accompanying LICENSE file for details.</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="Bottle_8h.html">yarp/os/Bottle.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="BufferedPort_8h.html">yarp/os/BufferedPort.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="LogStream_8h.html">yarp/os/LogStream.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="Network_8h.html">yarp/os/Network.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;iostream&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">using</span> <a class="code" href="classyarp_1_1os_1_1Bottle.html">yarp::os::Bottle</a>;</div>
<div class="line"><span class="keyword">using</span> <a class="code" href="classyarp_1_1os_1_1BufferedPort.html">yarp::os::BufferedPort</a>;</div>
<div class="line"><span class="keyword">using</span> <a class="code" href="classyarp_1_1os_1_1Network.html">yarp::os::Network</a>;</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> <a class="code" href="yarpros_8cpp.html#a0ddf1224851353fc92bfbff6f499fa97">main</a>(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span>* argv[])</div>
<div class="line">{</div>
<div class="line">    <a class="code" href="yarp-v3_84-build_2src_2libYARP__conf_2src_2yarp_2conf_2api_8h.html#a115a3e86265819f41c93ff12c2538d1f">YARP_UNUSED</a>(argc);</div>
<div class="line">    <a class="code" href="yarp-v3_84-build_2src_2libYARP__conf_2src_2yarp_2conf_2api_8h.html#a115a3e86265819f41c93ff12c2538d1f">YARP_UNUSED</a>(argv);</div>
<div class="line"> </div>
<div class="line">    Network <a class="code" href="namespaceyarp.html">yarp</a>;</div>
<div class="line">    BufferedPort&lt;Bottle&gt; port;</div>
<div class="line">    port.open(<span class="stringliteral">&quot;/summer&quot;</span>);</div>
<div class="line">    <span class="keywordflow">while</span> (<span class="keyword">true</span>) {</div>
<div class="line">        <a class="code" href="Log_8h.html#a09e0b22ac4baddf249df4a9d9702c938">yInfo</a>() &lt;&lt; <span class="stringliteral">&quot;waiting for input&quot;</span>;</div>
<div class="line">        Bottle* input = port.read();</div>
<div class="line">        <span class="keywordflow">if</span> (input != <span class="keyword">nullptr</span>) {</div>
<div class="line">            <a class="code" href="Log_8h.html#a09e0b22ac4baddf249df4a9d9702c938">yInfo</a>() &lt;&lt; <span class="stringliteral">&quot;got &quot;</span> &lt;&lt; input-&gt;toString().c_str();</div>
<div class="line">            <span class="keywordtype">double</span> total = 0;</div>
<div class="line">            <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; input-&gt;size(); i++) {</div>
<div class="line">                total += input-&gt;get(i).asFloat64();</div>
<div class="line">            }</div>
<div class="line">            Bottle&amp; output = port.prepare();</div>
<div class="line">            output.clear();</div>
<div class="line">            output.addString(<span class="stringliteral">&quot;total&quot;</span>);</div>
<div class="line">            output.addFloat64(total);</div>
<div class="line">            <a class="code" href="Log_8h.html#a09e0b22ac4baddf249df4a9d9702c938">yInfo</a>() &lt;&lt; <span class="stringliteral">&quot;writing &quot;</span> &lt;&lt; output.toString().c_str();</div>
<div class="line">            port.write();</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="ttc" id="aBottle_8h_html"><div class="ttname"><a href="Bottle_8h.html">Bottle.h</a></div></div>
<div class="ttc" id="aBufferedPort_8h_html"><div class="ttname"><a href="BufferedPort_8h.html">BufferedPort.h</a></div></div>
<div class="ttc" id="aLogStream_8h_html"><div class="ttname"><a href="LogStream_8h.html">LogStream.h</a></div></div>
<div class="ttc" id="aLog_8h_html_a09e0b22ac4baddf249df4a9d9702c938"><div class="ttname"><a href="Log_8h.html#a09e0b22ac4baddf249df4a9d9702c938">yInfo</a></div><div class="ttdeci">#define yInfo(...)</div><div class="ttdef"><b>Definition:</b> <a href="Log_8h_source.html#l00260">Log.h:260</a></div></div>
<div class="ttc" id="aNetwork_8h_html"><div class="ttname"><a href="Network_8h.html">Network.h</a></div></div>
<div class="ttc" id="aclassyarp_1_1os_1_1Bottle_html"><div class="ttname"><a href="classyarp_1_1os_1_1Bottle.html">yarp::os::Bottle</a></div><div class="ttdoc">A simple collection of objects that can be described and transmitted in a portable way.</div><div class="ttdef"><b>Definition:</b> <a href="Bottle_8h_source.html#l00072">Bottle.h:73</a></div></div>
<div class="ttc" id="aclassyarp_1_1os_1_1BufferedPort_html"><div class="ttname"><a href="classyarp_1_1os_1_1BufferedPort.html">yarp::os::BufferedPort</a></div><div class="ttdoc">A mini-server for performing network communication in the background.</div><div class="ttdef"><b>Definition:</b> <a href="BufferedPort_8h_source.html#l00063">BufferedPort.h:64</a></div></div>
<div class="ttc" id="aclassyarp_1_1os_1_1Network_html"><div class="ttname"><a href="classyarp_1_1os_1_1Network.html">yarp::os::Network</a></div><div class="ttdoc">Utilities for manipulating the YARP network, including initialization and shutdown.</div><div class="ttdef"><b>Definition:</b> <a href="Network_8h_source.html#l00785">Network.h:786</a></div></div>
<div class="ttc" id="anamespaceyarp_html"><div class="ttname"><a href="namespaceyarp.html">yarp</a></div><div class="ttdoc">The main, catch-all namespace for YARP.</div><div class="ttdef"><b>Definition:</b> <a href="environment_8h_source.html#l00018">environment.h:18</a></div></div>
<div class="ttc" id="ayarp-v3_84-build_2src_2libYARP__conf_2src_2yarp_2conf_2api_8h_html_a115a3e86265819f41c93ff12c2538d1f"><div class="ttname"><a href="yarp-v3_84-build_2src_2libYARP__conf_2src_2yarp_2conf_2api_8h.html#a115a3e86265819f41c93ff12c2538d1f">YARP_UNUSED</a></div><div class="ttdeci">#define YARP_UNUSED(var)</div><div class="ttdef"><b>Definition:</b> <a href="yarp-v3_84-build_2src_2libYARP__conf_2src_2yarp_2conf_2api_8h_source.html#l00159">api.h:159</a></div></div>
<div class="ttc" id="ayarpros_8cpp_html_a0ddf1224851353fc92bfbff6f499fa97"><div class="ttname"><a href="yarpros_8cpp.html#a0ddf1224851353fc92bfbff6f499fa97">main</a></div><div class="ttdeci">int main(int argc, char *argv[])</div><div class="ttdef"><b>Definition:</b> <a href="yarpros_8cpp_source.html#l00261">yarpros.cpp:261</a></div></div>
</div><!-- fragment --><p>For now, there's no need to worry too much the details of this code. Start another two terminals and do the following (make sure the "yarp read" and "yarp write" programs started earlier are still running):</p>
<pre class="fragment">[on terminal 4] ./summer
[on terminal 5] yarp connect /write /summer
[on terminal 5] yarp connect /summer /read
</pre><p> (You may need to replace "./summer" with "summer.exe" or whatever the executable name of the compiled program is). The network is now as follows: </p><div class="dotgraph">
<img src="dot_inline_dotgraph_6.png" alt="dot_inline_dotgraph_6.png" border="0" usemap="#dot_inline_dotgraph_6.map"/>
</div>
<p>If you type a list of numbers the "yarp write" terminal, they will show up on the "yarp read" terminal as before. But they will also be sent to the "summer" process, which will send an extra message to the "yarp read" terminal. For example, if on terminal 3 ("yarp write") you type: </p><pre class="fragment">10 -5 17.15 6
</pre><p> on terminal 2 ("yarp read"), you will see: </p><pre class="fragment">10 -5 17.15 6
total 28.15
</pre><p> (the order of these messages is random).</p>
<p>We can get rid of the original connection from "/write" to "/read" with: </p><pre class="fragment">[on terminal 5] yarp disconnect /write /read
</pre><p> Now if on terminal 3 ("yarp write") you type: </p><pre class="fragment">10 -5 17.15 6
</pre><p> on terminal 2 ("yarp read"), you will see just: </p><pre class="fragment">total 28.15
</pre><p>Suppose we wanted to send the output of "summer" to many, many readers "/read1" "/read2" .... "/readN". To do that efficiently, we may want to use the <em>multicast</em> network protocol instead of tcp. We can do that easily. As an example, we just switch the output from "/summer" to "/read" to use multicast: </p><pre class="fragment">yarp disconnect /summer /read
yarp connect /summer /read mcast
</pre><p>The network is now as follows: </p><div class="dotgraph">
<img src="dot_inline_dotgraph_7.png" alt="dot_inline_dotgraph_7.png" border="0" usemap="#dot_inline_dotgraph_7.map"/>
</div>
<p>For this small example, you should see no change in performance from using multicast (unless your network interface just doesn't support it at all).</p>
<h1><a class="anchor" id="note_ports_closer"></a>
Taking a closer look</h1>
<p>The first program we ran in the previous section was "yarp server". This is a simple database of information about a yarp network. We can, for example, find out some information about how to reach a port: </p><pre class="fragment">[you type] yarp name query /summer
[response] registration name /summer ip 5.255.222.252 port 10012 type tcp
           *** end of message
</pre><p> This tells us that the port called "/summer" is on a machine with IP address 5.255.222.252, is listening on socket port 10012, and expects any connection with it to be made initially using tcp. After this initial connection, we can request a YARP port to switch to a different protocol for that connection. To see what protocols the port will accept, we do: </p><pre class="fragment">[you type] yarp name get /summer accepts
[response] port /summer property accepts = tcp text text_ack udp mcast shmem
           *** end of message
</pre><p> We see for example that "tcp" and "mcast" are on this list. There's also a "text" protocol. This is to make it easier for a human to make connections manually. For example, we could easily connect to "/summer" with telnet using the socket number we discovered above: </p><pre class="fragment">telnet localhost 10012
</pre><p> This gives us a TCP connection to the port. Now let's request we switch to "text" mode by typing: </p><pre class="fragment">CONNECT anonymous
</pre><p>It is important to get the first 8 characters exactly right &ndash; they are the code that chooses the protocol. "CONNECT " is the code for the text protocol. Some versions of telnet won't show what you're typing, or let you delete, so be careful. If all goes well, the port will respond with: </p><pre class="fragment">Welcome anonymous
</pre><p> We won't cover all the things you can do with the port at this point; one thing you can do is send it some data. We can send the list of numbers (10,20,30) by typing: </p><pre class="fragment">d
10 20 30
</pre><p> On the terminal where "summer" is running, you should see those numbers appear, and their total should appear on "yarp read". Type "q" to disconnect.</p>
<p>In these examples, we've made use of the fact that "yarp read" and "yarp write" can work with a data type called a Bottle, which is particularly flexible &ndash; it is a (potentially nested) list of some primitive types like integers, doubles, and strings, with a well defined representation in binary and text form. But any kind of data can be send across a YARP network. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.8.13-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li><span id="projectname_footer">YARP</span></li>
    <li><span id="projectnumber" class="version_switch">3.4.6</span></li>
    <li class="footer">Generated on Sat Jul 3 2021 02:17:09 for YARP by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.9.1 </li>
  </ul>
</div>
</body>
</html>
