<!-- HTML header for doxygen 1.9.1-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>YARP: Gstreamer carrier</title>
<link rel="shortcut icon" href="yarp-favicon.ico" type="image/x-icon" />
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript">
    var DOCUMENTATION_OPTIONS = { VERSION: '3.11.2' };
</script>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
  $(document).ready(function() { init_search(); });
/* @license-end */
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="yarp-doxygen-style.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../version_switch.js"></script>
<script src="https://cookiehub.net/c2/44d56061.js"></script>
<script type="text/javascript">
window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('consent', 'default', {'ad_storage': 'denied', 'analytics_storage': 'denied', 'wait_for_update': 500});
document.addEventListener("DOMContentLoaded", function(event) {
var cpm = {};
window.cookiehub.load(cpm);
});
</script>
<!--
<link rel="stylesheet" type="text/css" href="cookieconsent.min.css" />
<script src="cookieconsent.min.js"></script>
<script>
window.addEventListener("load", function(){
window.cookieconsent.initialise({
  "palette": {
    "popup": {
      "background": "#eb6c44",
      "text": "#ffffff"
    },
    "button": {
      "background": "#237afc",
    }
  },
  "theme": "classic",
  "content": {
    "message": "INFORMATION NOTICE ON COOKIES : This website uses only browsing/session cookies. Users can choose whether or not to accept the use of cookies and access the website. By clicking on \"Further information\", the full information notice on the types of cookies will be displayed and you will be able  to choose whether or not to accept them whilst browsing on the website.",
    "dismiss": "ACCEPT and close",
    "link": "Further information",
    "href": "http://www.icub.eu/other/personal_data_notice.html"
  }
})});
</script>
-->
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="yarp-robot-64.png"/></td>
  <td id="projectalign" style="padding-left: 1.5em;">
   <div id="projectname">YARP</div>
   <div id="projectbrief">Yet Another Robot Platform</div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <span id="MSearchSelect"                onmouseover="return searchBox.OnSearchSelectShow()"                onmouseout="return searchBox.OnSearchSelectHide()">&#160;</span>
          <input type="text" id="MSearchField" value="" placeholder="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.svg" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('group__carrier__gstreamer__howto.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="headertitle"><div class="title">Gstreamer carrier<div class="ingroups"><a class="el" href="group__carriers__module.html">Carriers</a> &raquo; <a class="el" href="group__carriers__examples.html">Examples</a></div></div></div>
</div><!--header-->
<div class="contents">

<p>If your robot has cameras with high resolution, you need to compress and to stream their images.  
</p>
<div id="dynsection-0" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-0-trigger" src="closed.png" alt="+"/> Collaboration diagram for Gstreamer carrier:</div>
<div id="dynsection-0-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-0-content" class="dyncontent" style="display:none;">
<div class="center"><img src="group__carrier__gstreamer__howto.png" border="0" usemap="#agroup____carrier____gstreamer____howto" alt=""/></div>
<map name="agroup____carrier____gstreamer____howto" id="agroup____carrier____gstreamer____howto">
<area shape="rect" title="If your robot has cameras with high resolution, you need to compress and to stream their images." alt="" coords="140,5,277,31"/>
<area shape="rect" href="group__carriers__examples.html" title="Examples and tutorials about carriers." alt="" coords="5,5,92,31"/>
</map>
</div>
<p>If your robot has cameras with high resolution, you need to compress and to stream their images. </p>
<p>In order to achieve this, we use Gstreamer, a free framework for media applications.</p>
<p>This document contains a brief introduction to Gstreamer tool and explains how the high-resolution cameras stream is encoding and how a yarp application can read it.</p>
<dl class="section note"><dt>Note</dt><dd>They are still work in progress and should be considered experimental. Please report any problems.</dd></dl>
<h1><a class="anchor" id="gstreamer_introduction"></a>
Gstreamer: brief introduction</h1>
<p>Gstreamer is a free framework for media applications; it provides a set of plugins that let the user to build applications by connecting them as in a pipeline. It has been ported to a wide range of operating systems, compilers and processors, including Nvidia GPUs.</p>
<p>A Gstreamer application is composed by a chain of elements, the base construction block of a Gstreamer application. An element takes an input stream from previous element in the chain, carries out its function, like encode, and passes the modified stream to the next element. Usually each element is a plugin.</p>
<p>The user can develop application in two way: the first consists in write an application in c/c++, where the elements are connected using API, while the second uses the gst-launch command-line tool. In the following an example of how to use gst-launch command:</p>
<pre class="fragment">gst-launch-1.0 -v videotestsrc ! ‘video/x-raw, format=(string)I420, width=(int)640, height=(int)480’ ! x264enc ! h264parse ! avdec_h264 ! autovideosink
</pre><p>This command creates a source video test with the properties specified in this string <em> “video/x-raw, format=(string)I420, width=(int)640, height=(int)480”</em>; after it is encoded in h264, then decoded and shown. Each element of this pipeline, except the property element, is plugins dynamically loaded. The videotestsrc element lets the user to see a stream without using camera.</p>
<p>The previous command works on Linux, but since Gstreamer is platform independent, we can launch the same command on Windows taking care to change only hardware dependent plugin. So the same command on Windows is:</p>
<pre class="fragment">gst-launch-1.0 -v videotestsrc ! “video/x-raw, format=(string)I420, width=(int)640, height=(int)480” ! openh264enc ! h264parse ! avdec_h264 ! autovideosink
</pre><p>It’s important to notice that the changed element is the encoder (openh264enc), while the decoder is the same. This because the decoder belongs to the plugin that wraps libav library, a cross-platform library to convert stream in a wide range of multimedia formats. [see <a class="el" href="group__carrier__gstreamer__howto.html#references">References</a> chapter]</p>
<p><em> Please see <a class="el" href="group__carrier__gstreamer__howto.html#notes">Notes</a> section about commands in this tutorial. </em></p>
<h1><a class="anchor" id="how_to_stream_h264"></a>
How to stream using h264 encoder</h1>
<p>The server grabs images from cameras, so it needs to run on where cameras are connected. The server is a Gstreamer command pipeline, while the client could be a yarp or a Gstreamer application connected to the robot’s network.</p>
<h2><a class="anchor" id="server_side"></a>
Server side:</h2>
<p>The server application consists in the following Gstreamer command:</p>
<pre class="fragment">gst-launch-1.0 -v v4l2src device="/dev/video1" ! ‘video/x-raw, width=1280, height=480, format=(string)I420’ ! omxh264enc ! h264parse ! rtph264pay pt=96 config-interval=5 ! udpsink host=224.0.0.1 auto-multicast=true  port=33000
</pre><ul>
<li><em>v4l2src device="/dev/video1"</em>: reads the cameras using v4l (video for linux) driver </li>
<li><em>‘video/x-raw, width=640, height=480, format=(string)I420’ </em>: this is a property-element that specifies image size and format. In order to know which sizes and format are available you can use “v4l2-ctl” utility. </li>
<li><em>omxh264enc</em>: encodes in h264: plugin developed by Nvidia </li>
<li><em>h264parse</em>: signals downstream the format of the stream </li>
<li><em>rtph264pay</em>: puts h264 stream in rtp packets </li>
<li><em>udpsink</em>: this is the last element and sends out the stream. In this case we use multicast, but it is possible to send the stream using unicast in this way: udpsink host=IP_ADDRESS_OF_CLIENT port=NOT_WELL_KNOWN_PORT_NUMBER</li>
</ul>
<h2><a class="anchor" id="client_side"></a>
Client side</h2>
<p>The client can read the stream using Gstreamer native command:</p>
<pre class="fragment">gst-launch-1.0 -v udpsrc multicast-group=224.0.0.1 auto-multicast=true port=3000 caps="application/x-rtp, media=(string)video, encoding-name=(string)H264, payload=(int)96" ! rtph264depay ! h264parse ! avdec_h264 ! autovideosink
</pre><h2><a class="anchor" id="some_options"></a>
Some options and extra notes</h2>
<ul>
<li><b>set the frame rate </b>: in server side exist the parameter framerate=30/1, that configures the framerate to which grab images. Insert in in property element: 'video/x-raw, format=(string)I420, width=(int)640, height=(int)480, framerate=30/1' </li>
<li>In some cases could be useful that server streams video at <b>constant rate</b>. You can achieve this adding this parameter to the encoder plugin: control-rate=2 bitrate=5000000 </li>
<li>You can use the native Gstreamer plugin “videocrop” to crop the video: <pre class="fragment">    gst-launch-1.0 -v udpsrc port=33000 caps="application/x-rtp, media=(string)video,  encoding-name=(string)H264, payload=(int)96" ! rtph264depay ! h264parse ! avdec_h264 ! videocrop left=10, right=30, top=50, bottom=50 ! autovideosink</pre> </li>
<li><b>fakevideosink</b> plugin can be used instead of <b>autovideosink</b> to test the pipeline without displaying anything. </li>
<li><b>videotestsrc</b> followed by the format specifier can be used to generate a test image </li>
<li><b>filesrc / filesink</b> plugins can used to read from/write to file. </li>
<li>other useful encoder plugins: <b>x264,x265,avenc_mjpeg</b>. Suggested decoders: <b>avdec_h265,avdec_h265,avdec_mjpeg</b> </li>
<li>official plugins list: <a href="https://gstreamer.freedesktop.org/documentation/plugins_doc.html?gi-language=c">https://gstreamer.freedesktop.org/documentation/plugins_doc.html?gi-language=c</a> </li>
<li>another common format for video/x-raw instead of <b>I420</b> is <b>RGB</b></li>
</ul>
<h1><a class="anchor" id="how_to_install_gstreamer"></a>
How to install Gstreamer</h1>
<p>Currently we are using 1.24.4 version.</p>
<h2><a class="anchor" id="ubuntu"></a>
On Ubuntu</h2>
<ul>
<li>Packages required to build<ul>
<li>libgstreamer1.0-dev</li>
<li>libgstreamer-plugins-base1.0-dev </li>
</ul>
</li>
<li>Packages required to run<ul>
<li>gstreamer1.0-plugins-base (for videoconvert and appsink)</li>
<li>gstreamer1.0-plugins-good (for udpsrc and rtph264depay)</li>
<li>gstreamer1.0-plugins-bad (for h264parse)</li>
<li>gstreamer1.0-libav (for avdec_h264) </li>
</ul>
</li>
<li>Useful packages but not required<ul>
<li>gstreamer1.0-tools</li>
</ul>
</li>
</ul>
<pre class="fragment">sudo apt-get install libgstreamer1.0-dev \
libgstreamer-plugins-base1.0-dev \
gstreamer1.0-plugins-base \
gstreamer1.0-plugins-good \
gstreamer1.0-plugins-bad \
gstreamer1.0-libav \
gstreamer1.0-tools
</pre><h2><a class="anchor" id="windows"></a>
On windows</h2>
<p>You need to download both the main package and the devel package from here: <a href="https://gstreamer.freedesktop.org/data/pkg/windows/">https://gstreamer.freedesktop.org/data/pkg/windows/</a></p>
<p>Installation of package Gstreamer: </p><ul>
<li>choose typical installation </li>
<li>redo installation adding:<ul>
<li>Gstreamer 1.0 devtools</li>
<li>Gstreamer 1.0 Libav wrapper</li>
</ul>
</li>
</ul>
<p>Installation of grstreamer devel package: </p><ul>
<li>choose typical installation </li>
<li>redo installation adding:<ul>
<li>Gstreamer 1.0 devtools</li>
<li>Gstreamer 1.0 Libav wrapper </li>
</ul>
</li>
<li>Add in path environment variable the path to executable (Usually is C:\gstreamer\1.0\x86_64\bin)</li>
</ul>
<h2><a class="anchor" id="check_installation"></a>
Verify your installation</h2>
<p>You can verify the installation by running a simple test application composed by a server and a client :</p>
<h3><a class="anchor" id="server"></a>
Server side (example on Windows)</h3>
<pre class="fragment">gst-launch-1.0 -v videotestsrc ! "video/x-raw, format=(string)I420, width=(int)640, height=(int)480" ! openh264enc ! h264parse ! rtph264pay pt=96 config-interval=5 ! udpsink host=&lt;YOUR_IP_ADDRESS&gt; port=&lt;A_PORT_NUMBER&gt;
</pre><h3><a class="anchor" id="client"></a>
Client side</h3>
<pre class="fragment">gst-launch-1.0 -v udpsrc port=&lt;A_PORT_NUMBER&gt; caps="application/x-rtp, media=(string)video, encoding-name=(string)H264, payload=(int)96" ! rtph264depay ! h264parse ! avdec_h264 ! autovideosink
</pre><h1><a class="anchor" id="yarp_usage"></a>
Usage with yarp</h1>
<p>If you want use a yarp application to read the stream you need to:</p><ol type="1">
<li>install Gstreamer (see <a class="el" href="group__carrier__gstreamer__howto.html#how_to_install_gstreamer">How to install Gstreamer</a> )</li>
<li>compile yarp with “ENABLE_yarpcar_gstreamer” option enabled.</li>
<li>Run the server as mentioned above.</li>
<li>register a fake port to the yarp server, in this example called gstreamer_src: <pre class="fragment">yarp name register /gstreamer_src  gstreamer  &lt;SERVER_IP_ADRESS&gt; &lt;SERVER_IP_PORT&gt;
</pre></li>
<li>set up your decoding pipeline by setting an environment variable with a string containing a string. For example on windows: <pre class="fragment">set GSTREAMER_ENV=udpsrc port=&lt;A_PORT_NUMBER&gt; caps="application/x-rtp, media=(string)video, encoding-name=(string)H264, payload=(int)96" ! rtph264depay ! h264parse ! avdec_h264
</pre> on linux: <pre class="fragment">export GSTREAMER_ENV="udpsrc port=15000 caps=\"application/x-rtp, media=(string)video, encoding-name=(string)H264, payload=(int)96\" ! rtph264depay ! h264parse ! avdec_h264"
</pre></li>
<li>run your application (e.g. yarpview, or your own application). This must be executed after setting the environment variable, i.e. the environment variable should be accessible to the executable. <pre class="fragment">yarpview --name /view
</pre></li>
<li>connect client and server port using gstreamer carrier: <pre class="fragment">yarp connect /gstreamer_src /view gstreamer+pipelineEnv.GSTREAMER_ENV
</pre></li>
</ol>
<p>Now on yarp view you can see the following image, where in the bottom right box there is snow pattern.</p>
<div class="image">
<img src="h264GstVideoTestSrc.png" alt=""/>
</div>
<h1><a class="anchor" id="notes"></a>
Notes</h1>
<ul>
<li>On Windows the property element uses ‘ instead of “ </li>
<li>Another completely different way to use Yarp with Gstreamer is to use <code>Yarp Gstreamer Plugins</code>. They also allow to feed a yarp image inside a gstreamer pipeline. See documentation: <a class="el" href="group__gstreamerplugins__module.html">Gstreamer plugins</a></li>
</ul>
<h1><a class="anchor" id="references"></a>
References</h1>
<p>[1] Gstreamer documentation <a href="https://gstreamer.freedesktop.org/documentation/">https://gstreamer.freedesktop.org/documentation/</a></p>
<p>[2] Gstreamer plugins <a href="https://gstreamer.freedesktop.org/documentation/plugins.html">https://gstreamer.freedesktop.org/documentation/plugins.html</a></p>
<p>[3] Libav library documentation <a href="https://www.libav.org/index.html">https://www.libav.org/index.html</a></p>
<p>[4] Gstreamer Libav plugin <a href="https://gstreamer.freedesktop.org/modules/gst-libav.html">https://gstreamer.freedesktop.org/modules/gst-libav.html</a></p>
<p>[5] h264 yarp plugin <a href="http://www.yarp.it/classyarp_1_1os_1_1H264Carrier.html">http://www.yarp.it/classyarp_1_1os_1_1H264Carrier.html</a> </p>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.9.1-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li><span id="projectname_footer">YARP</span></li>
    <li><span id="projectnumber" class="version_switch">3.11.2</span></li>
    <li class="footer">Generated on Sat Mar 1 2025 02:35:37 for YARP by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8 </li>
  </ul>
</div>
</body>
</html>
