<!-- HTML header for doxygen 1.8.12-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.20"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>YARP: The YARP motor control interfaces</title>
<link rel="shortcut icon" href="yarp-favicon.ico" type="image/x-icon" />
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript">
    var DOCUMENTATION_OPTIONS = { VERSION: '3.1.2' };
</script>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(function() { init_search(); });
/* @license-end */
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="yarp-doxygen-style.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../version_switch.js"></script>
<link rel="stylesheet" type="text/css" href="cookieconsent.min.css" />
<script src="cookieconsent.min.js"></script>
<script>
window.addEventListener("load", function(){
window.cookieconsent.initialise({
  "palette": {
    "popup": {
      "background": "#eb6c44",
      "text": "#ffffff"
    },
    "button": {
      "background": "#237afc",
    }
  },
  "theme": "classic",
  "content": {
    "message": "INFORMATION NOTICE ON COOKIES : This website uses only browsing/session cookies. Users can choose whether or not to accept the use of cookies and access the website. By clicking on \"Further information\", the full information notice on the types of cookies will be displayed and you will be able  to choose whether or not to accept them whilst browsing on the website.",
    "dismiss": "ACCEPT and close",
    "link": "Further information",
    "href": "http://www.icub.org/other/personal_data_notice.html"
  }
})});
</script>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="yarp-robot-64.png"/></td>
  <td id="projectalign" style="padding-left: 1.5em;">
   <div id="projectname">YARP</div>
   <div id="projectbrief">Yet Another Robot Platform</div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.svg"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.svg" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.20 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('yarp_motor_control.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">The YARP motor control interfaces </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>When controlling a robot you typically use one of the interfaces from the <a class="el" href="ControlBoardInterfaces_8h.html" title="define control board standard interfaces">ControlBoardInterfaces.h</a> header file.</p>
<p>These are meant to abstract a great deal of details but not all of it since we want to retain the possibility of efficient and specialized motor control code.</p>
<h1><a class="anchor" id="yarp_motorcontrol_base"></a>
Motor control.</h1>
<p>We take an example of a motor control device since this is simpler to explain than a general controller. The approach itself is completely general though as for other device abstactions in yarp. In particular, the following is an extract of the EsdMotionControl (see EsdMotionControl.h) declaration which wraps the iCub controller:</p>
<pre class="fragment">class yarp::dev::EsdMotionControl :
    public DeviceDriver,
    public IPidControlRaw,
    public IPositionControlRaw,
    public IVelocityControlRaw,
    public IEncodersRaw,
    public IAmplifierControlRaw,
    public IControlDebug,
    public IControlLimitsRaw,
    public ImplementPositionControl&lt;EsdMotionControl, IPositionControl&gt;,
    public ImplementVelocityControl&lt;EsdMotionControl, IVelocityControl&gt;,
    public ImplementPidControl&lt;EsdMotionControl, IPidControl&gt;,
    public ImplementEncoders&lt;EsdMotionControl, IEncoders&gt;,
    public ImplementAmplifierControl&lt;EsdMotionControl, IAmplifierControl&gt;,
    public ImplementControlLimits&lt;EsdMotionControl, IControlLimits&gt;</pre><p>Beside the confusion here due to the multiplicity of interfaces the important thing to notice is the standard inheritance from DeviceDriver. The controller abstraction assumes:</p>
<ul>
<li>a low-level PID controller, if implemented at all (<a class="el" href="classyarp_1_1dev_1_1IPidControl.html">IPidControl</a>)</li>
<li>a position controller (something that takes angular positions and generates appropriate reference trajectories <a class="el" href="classyarp_1_1dev_1_1IPositionControl.html">IPositionControl</a>)</li>
<li>a velocity controller (to istantaneously specify the angular speed, <a class="el" href="classyarp_1_1dev_1_1IVelocityControl.html">IVelocityControl</a>)</li>
<li>encoders or other positional sensors (<a class="el" href="classyarp_1_1dev_1_1IEncoders.html">IEncoders</a>)</li>
<li>an amplifier to power the actuators (<a class="el" href="classyarp_1_1dev_1_1IAmplifierControl.html">IAmplifierControl</a>)</li>
</ul>
<p>These features are mapped directly onto interfaces. There are "raw" interfaces that speak directly to the control cards and wrapped interfaces that convert and rescale the values before sending them to the control cards. The wrapped interfaces accept angle in degrees, speed in degrees per seconds, etc. The numbering of the axes is also made coherent with respect to the robot kinematics.</p>
<p>The wrapped interfaces are implemented through an "implement" template since the code is likely to be reused in other device drivers: i.e. any control card would perform the same type of mapping. These interfaces use the corresponding "raw" version internally (<a class="el" href="ControlBoardInterfacesImpl_8h.html">ControlBoardInterfacesImpl.h</a>).</p>
<p>Robot control is typically effected by:</p>
<ul>
<li>loading the controller/cards default parameters</li>
<li>turning the amplifiers on</li>
<li>sending control values</li>
</ul>
<p>when done:</p><ul>
<li>turning the amplifiers off</li>
<li>closing the device driver (note that the close() unlike the open() method is generic <a class="el" href="classyarp_1_1dev_1_1DeviceDriver.html">DeviceDriver</a>).</li>
</ul>
<p>The loading of the controller parameters can be also done from a file by using the <a class="el" href="classyarp_1_1os_1_1Property.html">Property</a> class and the fromConfigFile() method. This is the preferred method since the list of parameters is fairly large.</p>
<p>For the <a class="el" href="">EsdMotionControl </a>, for example, you find:</p>
<pre class="fragment">[CAN]
CanAddresses 14 13 12 128 128 128 128 128 128 128 128 128 128 128 128 128
CanDeviceNum    0
CanMyAddress    0
CanPollingInterval  2
CanTimeout  20

[GENERAL]
Joints 6
MaxDAC 100.0 100.0 100.0 100.0 100.0 100.0

AxisMap 0 1 2 3 4 5
Encoder 375.46 375.46 1399.46 1399.46 1399.46 1399.46
Zeros 0.0 0.0 0.0 0.0 0.0 0.0

Verbose 0

[LIMITS]
Max 31.9 31.9 30.0 50.0 80.0 45.0
Min -29.29 -29.9 -30.0 -50.0 -80.0 -10.0
Currents 1220.0 1220.0 1220.0 1220.0 1220.0 1220.0

[PIDS]
Pid0 32 128 2 1333 1333 4 0
Pid1 32 128 2 1333 1333 4 0
Pid2 32 128 2 1333 1333 4 0
Pid3 32 128 2 1333 1333 4 0
Pid4 32 128 4 1333 1333 4 0
Pid5 32 128 1 1333 1333 4 0</pre><p>Some of them are specific to the control card, other are a bit more general. After loading the parameters and opening the device, perhaps through the <a class="el" href="classyarp_1_1dev_1_1PolyDriver.html">PolyDriver</a>, you need to:</p>
<ul>
<li>configure the reference values: speed when doing position control or acceleration for velocity control. This is accomplished through the <a class="el" href="classyarp_1_1dev_1_1IPositionControl.html">IPositionControl</a> or <a class="el" href="classyarp_1_1dev_1_1IVelocityControl.html">IVelocityControl</a> respectively. The <a class="el" href="classyarp_1_1dev_1_1IEncoders.html">IEncoders</a> is used to read the positional information back for your own use: e.g. closing another control loop.</li>
<li>turn the amplifiers on: this is obtained through the use of the <a class="el" href="classyarp_1_1dev_1_1IAmplifierControl.html">IAmplifierControl</a>.</li>
<li>the <a class="el" href="classyarp_1_1dev_1_1IPidControl.html">IPidControl</a> interface allows you to change the gains that have been loaded during open.</li>
</ul>
<p>All these operations are performed through the wrapped interfaces. The "raw" interfaces are not normally used (they are used internally though). Once you are all set with this part, you can then start moving your axes by issuing commands through the:</p>
<ul>
<li>positionMove()</li>
<li>velocityMove()</li>
</ul>
<p>methods. They come in two flavors, one for single joints and another to move all joints simultaneously. The accuracy of the movement is clearly control card and robot dependent. They assume also that you set the reference speeds and accelerations appropriately.</p>
<p>To finish working with a motion control device, be gentle and reverse the settings you changed (some of them might stay resident in the controller memory). As a last operation before close(), disable the amplifiers so that it becomes safe again to move the robot. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.8.13-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li><span id="projectname_footer">YARP</span></li>
    <li><span id="projectnumber" class="version_switch">3.1.2</span></li>
    <li class="footer">Generated on Tue Nov 3 2020 16:43:15 for YARP by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.20 </li>
  </ul>
</div>
</body>
</html>
