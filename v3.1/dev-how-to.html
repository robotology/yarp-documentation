<!-- HTML header for doxygen 1.8.12-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.20"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>YARP: Device Drivers How-To</title>
<link rel="shortcut icon" href="yarp-favicon.ico" type="image/x-icon" />
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript">
    var DOCUMENTATION_OPTIONS = { VERSION: '3.1.2' };
</script>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(function() { init_search(); });
/* @license-end */
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="yarp-doxygen-style.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../version_switch.js"></script>
<link rel="stylesheet" type="text/css" href="cookieconsent.min.css" />
<script src="cookieconsent.min.js"></script>
<script>
window.addEventListener("load", function(){
window.cookieconsent.initialise({
  "palette": {
    "popup": {
      "background": "#eb6c44",
      "text": "#ffffff"
    },
    "button": {
      "background": "#237afc",
    }
  },
  "theme": "classic",
  "content": {
    "message": "INFORMATION NOTICE ON COOKIES : This website uses only browsing/session cookies. Users can choose whether or not to accept the use of cookies and access the website. By clicking on \"Further information\", the full information notice on the types of cookies will be displayed and you will be able  to choose whether or not to accept them whilst browsing on the website.",
    "dismiss": "ACCEPT and close",
    "link": "Further information",
    "href": "http://www.icub.org/other/personal_data_notice.html"
  }
})});
</script>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="yarp-robot-64.png"/></td>
  <td id="projectalign" style="padding-left: 1.5em;">
   <div id="projectname">YARP</div>
   <div id="projectbrief">Yet Another Robot Platform</div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.svg"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.svg" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.20 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('dev-how-to.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Device Drivers How-To </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>For a more up-to-date method of dealing with devices see:</p>
<ul>
<li><a class="el" href="add_a_device.html">How to add a device to YARP</a></li>
</ul>
<p>In YARP, a device driver is a class that implements one or more <a class="el" href="group__dev__iface.html">interfaces</a>.</p>
<p>If you're interested in learning how to use device drivers, see note_devices, <a class="el" href="group__dev__examples.html">Device invocation examples</a>, and <a class="el" href="yarpdev.html">yarpdev: the standard YARP device utility</a>. If you're read all that before and are interested in learning how to create devices, then read on...</p>
<h1><a class="anchor" id="dev-howto-intro"></a>
What is a device driver in YARP?</h1>
<p>A device driver should derive from the abstract class <a class="el" href="classyarp_1_1dev_1_1DeviceDriver.html" title="Interface implemented by all device drivers.">yarp::dev::DeviceDriver</a>. This interface contains methods common to all device drivers, such as open and close.</p>
<p>Additionally a device driver should implement a selection of other interfaces that capture what it shares with other families of devices. For example a camera might implement yarp:dev::IFrameGrabber (a "raw" interface to the raw data) and/or <a class="el" href="classyarp_1_1dev_1_1IFrameGrabberImage.html" title="Read a YARP-format image from a device.">yarp::dev::IFrameGrabberImage</a> (a higher-level source of images). For example, the yarp::dev::DragonflyDeviceDriver class implements a few of these interfaces. Interfaces are abstract classes, the idea is that from outside the user can access a device by using a pointer to the interface he/she needs, if that interface is supported by the device. This is quite similar to the way COM works (in a simplified way).</p>
<p>In practice to implement a new device you create a new object which derives from DeviceDriver and from the interface you want to support, and you implement them. The interfaces are documented in the code, using the doxygen standard. See note_devices for an example.</p>
<h1><a class="anchor" id="dev-howto-lib"></a>
Adding a device driver to libYARP_dev</h1>
<p>Some practical rules are also required to have cmake include your .cpp/.h files in the libYARP_dev (device library) project.</p>
<p>Let's assume you want to create the Foo device. Start by creating a folder called: </p><pre class="fragment">libYARP_dev/src/foo/
</pre><p>Files in foo will be organized in:</p><ul>
<li>/foo/common: This folder can contain header/code files common to all operating systems, if there are any such files.</li>
<li>/foo/$os$ (where $os$ can be either "linux" or "winnt"): This stores operating-system specific files.</li>
<li>/foo/default: This directory is intended for a "default" implementation which will be tried if the relevant operating-specific directory is not present.</li>
</ul>
<p>Each of these directories should be organized as:</p>
<ul>
<li>/foo/$subdir$/dd_orig: This contains header and lib files provided with your specific device by the manufacturer, if any.</li>
<li>/foo/$subdir$/yarp: This contains header and cpp files implementing the YARP device driver (for example FooDeviceDriver.cpp).</li>
</ul>
<p>CMake searches for YARP device drivers listed in: </p><pre class="fragment">libYARP_dev/AvailableDevices.txt
</pre><p>Here you specify the directory that contains the device driver tree (in the above example we called it foo). For example we could add "foo" in as follows: </p><pre class="fragment">SET(AVAILABLE_DEVICES picolo dragonfly esdMotionControl foo)
</pre><p>This is the list of directories under libYARP_dev that are searched for device drivers, when CMake runs. CMake does this by searching for a file called libraries.txt.</p>
<p>The file libraries.txt tells cmake which additional libraries or packages the device depends on. This files is platform specific and is located in /foo/$os$/. If this file is not found cmake simply warns the user and ignores the device.</p>
<p>The file libraries.txt has two options. If the device driver requires a library that is included in the YARP tree you write: </p><pre class="fragment">YARP_LOCAL;ntcan.lib
</pre><p>This tells cmake that the device driver requires the library "ntcan.lib" and that this file is available within the YARP tree (in ./dd_orig/). CMake will search ./dd_orig/lib for ntcan.lib. If ntcan.lib is not found an error will be shown, and the user will have the possibility to manually enter the correct location of the file. This .lib file has probably header files associated with it. We recommend you put them in ./dd_orig/include and include them directly in you code as something like:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;../dd_orig/include/foo_lib.h&gt;</span></div>
</div><!-- fragment --><p>Be careful to "hide" header files specific of each device driver (in this example foo_lib.h) so that symbols defined there are not visible from outside. In practice you do this by avoiding to include them in your header files.</p>
<p>If the device driver has external dependencies you write: </p><pre class="fragment">YARP_EXTERNAL;raw1394;dc1394_control
</pre><p>In this example we are telling CMake that the device driver foo depends on the packages raw1394 and dc1394_control. In this case cmake will not do any check, but will print a warning message saying that these modules are required. It is the user's responsibility (for now, and perhaps forever) to install these packages in the correct locations.</p>
<p>Everything going well, you will see on CMake a list of variables whose name follows the pattern ENABLE_device_name. These are the devices that are listed in AvailableDevices.txt. By default each flag is OFF meaning that the corresponding device will be ignored by CMake. You can turn ON the flags for the devices you want to compile, and type configure again. CMake will search for the file libraries.txt. If among the selected drivers there are some that require additional libraries there will be a list of variables whose name follows the pattern PATH-device_name. If these libraries are correctly located in the ./dd_orig/lib folder, all PATH-device_name entry should be correctly set. Although you can manually locate the libraries yourself, this probably means that there is an error in your YARP distribution or in the way the device is configured.</p>
<p>If all libraries are located, you can go on with CMake and generate your make/project files. If at least one device driver was selected and correctly found, libYARP_dev should now compile.</p>
<h1><a class="anchor" id="dev-howto-factory"></a>
Adding a device driver factory</h1>
<p>It is useful to be able to create devices in a reconfigurable way, for example using the <a class="el" href="yarpdev.html">yarpdev</a> application or the <a class="el" href="classyarp_1_1dev_1_1PolyDriver.html" title="A container for a device driver.">yarp::dev::PolyDriver</a> class. This is done be adding a "factory" for your device driver to libYARP_dev.</p>
<p>Take a look at this file: </p><pre class="fragment">src/libYARP_dev/src/PopulateDrivers.cpp.in
</pre><p>This is a template that CMake configures based on the devices the user selects, adding factories for them to a global list. Suppose your device is called "foo". Find the part of this file that contains a list something like this: </p><div class="fragment"><div class="line"><span class="preprocessor">#cmakedefine ENABLE_dragonfly</span></div>
<div class="line"><span class="preprocessor">#cmakedefine ENABLE_esdMotionControl</span></div>
<div class="line"><span class="preprocessor">#cmakedefine ENABLE_microphone</span></div>
<div class="line"><span class="preprocessor">#cmakedefine ENABLE_inertiacube2</span></div>
<div class="line"><span class="preprocessor">#cmakedefine ENABLE_XSensMTx</span></div>
<div class="line"><span class="preprocessor">#cmakedefine ENABLE_portaudio</span></div>
<div class="line"><span class="preprocessor">#cmakedefine ENABLE_opencv_grabber</span></div>
<div class="line"><span class="preprocessor">#cmakedefine ENABLE_ffmpeg</span></div>
</div><!-- fragment --><p> and add: </p><div class="fragment"><div class="line"><span class="preprocessor">#cmakedefine ENABLE_foo</span></div>
</div><!-- fragment --><p> This will be replaced with: </p><div class="fragment"><div class="line"><span class="preprocessor">#define ENABLE_foo</span></div>
</div><!-- fragment --><p> by CMake if the user chooses to compile your device, otherwise it will be commented out. You can see the code CMake generates at: </p><pre class="fragment">src/libYARP_dev/src_generated/PopulateDrivers.cpp
</pre><p> This is a generated file, do not modify it! Make all your changes to PopulateDrivers.cpp.in.</p>
<p>Now find the part of PopulateDrivers.cpp.in that has lines like: </p><div class="fragment"><div class="line"><span class="preprocessor">#ifdef ENABLE_opencv_grabber</span></div>
<div class="line"><span class="preprocessor">#include &lt;yarp/OpenCVGrabber.h&gt;</span></div>
<div class="line"><span class="preprocessor">#endif</span></div>
</div><!-- fragment --><p> And add: </p><div class="fragment"><div class="line"><span class="preprocessor">#ifdef ENABLE_foo</span></div>
<div class="line"><span class="preprocessor">#include &lt;yarp/Foo.h&gt;</span></div>
<div class="line"><span class="preprocessor">#endif</span></div>
</div><!-- fragment --><p> or whatever header file is needed for your device. The path to the header file should usually work just as yarp/Foo.h rather than anything more complicated.</p>
<p>Finally, now that we have our define, and have included the right header file, we can add the factory for your device. Go to the part of PopulateDrivers.cpp.in that has a list of lines like this: </p><div class="fragment"><div class="line"><span class="preprocessor">#ifdef ENABLE_portaudio</span></div>
<div class="line">    add(<span class="keyword">new</span> DriverCreatorOf&lt;PortAudioDeviceDriver&gt;(<span class="stringliteral">&quot;portaudio&quot;</span>,</div>
<div class="line">                                                   <span class="stringliteral">&quot;grabber&quot;</span>,</div>
<div class="line">                                                   <span class="stringliteral">&quot;PortAudioDeviceDriver&quot;</span>));</div>
<div class="line"><span class="preprocessor">#endif</span></div>
</div><!-- fragment --><p> Now add in an entry for your device: </p><div class="fragment"><div class="line"><span class="preprocessor">#ifdef ENABLE_foo</span></div>
<div class="line">    add(<span class="keyword">new</span> DriverCreatorOf&lt;FooDeviceDriver&gt;(<span class="stringliteral">&quot;foo&quot;</span>,</div>
<div class="line">                                             <span class="stringliteral">&quot;&quot;</span>,</div>
<div class="line">                                             <span class="stringliteral">&quot;FooDeviceDriver&quot;</span>));</div>
<div class="line"><span class="preprocessor">#endif</span></div>
</div><!-- fragment --><p>Replace FooDeviceDriver with the correct name of your class (which must be derived from <a class="el" href="classyarp_1_1dev_1_1DeviceDriver.html" title="Interface implemented by all device drivers.">yarp::dev::DeviceDriver</a>). There are also three the Replace the text "foo" with whatever you want humans to call your device when they create it &ndash; that's completely up to you. If there is a network wrapper device that can transport the data produced by your device, mention it as the second argument. That's the "" above. See the Server classes in <a class="el" href="group__dev__impl__wrapper.html">Network Servers (Wrappers)</a> for existing network wrappers. A fairly generic wrapper is under development; in the meantime <a class="el" href="classyarp_1_1dev_1_1ServerInertial.html">yarp::dev::ServerInertial</a> is an example to start from if you find you have to write your own. Note that network wrappers are completely optional. They are not needed for use of a device via <a class="el" href="classyarp_1_1dev_1_1PolyDriver.html" title="A container for a device driver.">yarp::dev::PolyDriver</a>.</p>
<p>The last text argument just repeats the class name for documentation purposes.</p>
<h1><a class="anchor" id="dev-howto-compile"></a>
Getting things compiled</h1>
<p>Now you should be able to compile your device the same way as any other YARP device.</p>
<ul>
<li>Start CMake and go to your YARP root directory.</li>
<li>Make sure that the "CREATE_DEVICE_LIBRARY_BUILTINS" option is selected. Otherwise YARP won't try to build any any hardware devices into the library. When this is selected, and you configure, you get a list of options of the form: ENABLE_*. There should be a new one now, called ENABLE_foo (or whatever your device is called). Select it, reconfigure, and compile.</li>
</ul>
<p>Then run: </p><pre class="fragment">yarpdev --list
</pre><p> Your device should show up in the list. To learn more about using devices from code, see note_devices, and the examples in example/dev.</p>
<h1><a class="anchor" id="dev-howto-wow"></a>
Hey, why not automate all this?</h1>
<p>True, we should do more automation than we do now. For now, we're just happy to have a mechanism that works solidly on both UNIX and Windows. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.8.13-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li><span id="projectname_footer">YARP</span></li>
    <li><span id="projectnumber" class="version_switch">3.1.2</span></li>
    <li class="footer">Generated on Tue Nov 3 2020 16:43:15 for YARP by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.20 </li>
  </ul>
</div>
</body>
</html>
