<!-- HTML header for doxygen 1.8.12-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.20"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>YARP: Thrift IDL in YARP: editing structures remotely</title>
<link rel="shortcut icon" href="yarp-favicon.ico" type="image/x-icon" />
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript">
    var DOCUMENTATION_OPTIONS = { VERSION: '3.0.1' };
</script>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(function() { init_search(); });
/* @license-end */
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="yarp-doxygen-style.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../version_switch.js"></script>
<link rel="stylesheet" type="text/css" href="cookieconsent.min.css" />
<script src="cookieconsent.min.js"></script>
<script>
window.addEventListener("load", function(){
window.cookieconsent.initialise({
  "palette": {
    "popup": {
      "background": "#eb6c44",
      "text": "#ffffff"
    },
    "button": {
      "background": "#237afc",
    }
  },
  "theme": "classic",
  "content": {
    "message": "INFORMATION NOTICE ON COOKIES : This website uses only browsing/session cookies. Users can choose whether or not to accept the use of cookies and access the website. By clicking on \"Further information\", the full information notice on the types of cookies will be displayed and you will be able  to choose whether or not to accept them whilst browsing on the website.",
    "dismiss": "ACCEPT and close",
    "link": "Further information",
    "href": "http://www.icub.org/other/personal_data_notice.html"
  }
})});
</script>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="yarp-robot-64.png"/></td>
  <td id="projectalign" style="padding-left: 1.5em;">
   <div id="projectname">YARP</div>
   <div id="projectbrief">Yet Another Robot Platform</div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.svg"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.svg" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.20 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('thrift_editor.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Thrift IDL in YARP: editing structures remotely </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><dl class="section author"><dt>Author</dt><dd>Paul Fitzpatrick</dd></dl>
<p>Thrift offers a convenient way to define structures and services. Structures are bundles of data, and services are bundles of methods. Structures fit nicely into streaming communication, while services are intended for RPC communication. But sometimes we want to offer a set of services around a particular structure. One recurring desire is a way to manipulate or read just part of a structure. This is convenient if that structure represents configuration data for a program.</p>
<p>With YARP, every Thrift structure has a corresponding <code>Editor</code> service that can be used to manipulate or read parts of it. For example, suppose we have the following structure in <code>settings.thrift</code></p>
<div class="fragment"><div class="line"><span class="keyword">struct </span>Settings {</div>
<div class="line">       1: i32 id;</div>
<div class="line">       2: <span class="keywordtype">string</span> name;</div>
<div class="line">       3: list&lt;i32&gt; ints;</div>
<div class="line">}</div>
</div><!-- fragment --><p>When compiled, that will give is a <code>Settings</code> class that can read or write from a port. That class will read the structure in full. For example, here's a test program that will read the structure from a port and show its value:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="libYARP__OS_2include_2yarp_2os_2all_8h.html">yarp/os/all.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &quot;Settings.h&quot;</span></div>
<div class="line"><span class="keywordtype">int</span> <a class="code" href="yarpros_8cpp.html#a0ddf1224851353fc92bfbff6f499fa97">main</a>() {</div>
<div class="line">  <a class="code" href="classyarp_1_1os_1_1Network.html">yarp::os::Network</a> <a class="code" href="namespaceyarp.html">yarp</a>;   <span class="comment">// bring up the yarp network</span></div>
<div class="line">  <a class="code" href="classyarp_1_1os_1_1Port.html">yarp::os::Port</a> port;      <span class="comment">// we&#39;ll want a port</span></div>
<div class="line">  Settings settings;        <span class="comment">// here are the settings we&#39;ll be controlling</span></div>
<div class="line">  port.<a class="code" href="classyarp_1_1os_1_1Port.html#a1dd5e79319a03bc62d806dddc7e3df96">setReader</a>(settings); <span class="comment">// read automatically into settings</span></div>
<div class="line">  port.<a class="code" href="classyarp_1_1os_1_1Port.html#a023eb6120647ac2fd6c6da0ff84866da">setCallbackLock</a>();   <span class="comment">// allow automatic reads to be locked</span></div>
<div class="line">  port.<a class="code" href="classyarp_1_1os_1_1Port.html#adbca981deeed5f66b3c4465b91eac509">open</a>(<span class="stringliteral">&quot;/settings&quot;</span>);   <span class="comment">// open port!</span></div>
<div class="line">  <span class="keywordflow">while</span>(<span class="keyword">true</span>) {</div>
<div class="line">    port.<a class="code" href="classyarp_1_1os_1_1Port.html#a9b9c3ef4956ad19037856511e1febf46">lockCallback</a>();    <span class="comment">// lock reads while we show settings</span></div>
<div class="line">    printf(<span class="stringliteral">&quot;Settings %s\n&quot;</span>, settings.toString().c_str());</div>
<div class="line">    port.<a class="code" href="classyarp_1_1os_1_1Port.html#aef5c5827fe043447bf82e4023d24a681">unlockCallback</a>();  <span class="comment">// unlock reads</span></div>
<div class="line">    <a class="code" href="namespaceyarp_1_1os_1_1Time.html#aca80809e0597551745954e2547e581ee">yarp::os::Time::delay</a>(1);         <span class="comment">// wait a little bit</span></div>
<div class="line">  }</div>
<div class="line">  <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
</div><!-- fragment --><p>(If you want to quickly compile this program, just put it in a file called <code>&lt;something&gt;.cpp</code> in an empty directory, then add <code>settings.thrift</code>, then run <code>yarp cmake &amp;&amp; cmake . &amp;&amp; make &amp;&amp; ./yarpy</code>, specifying <code>-DYARP_DIR=&lt;path_to_yarp&gt;</code> to cmake if needed.)</p>
<p>Once that is running, from another terminal we can write to the settings:</p>
<pre class="fragment">echo "1 sam (1 2 3)" | yarp write /write /settings
</pre><p>And we see the resulting change of the entire structure:</p>
<pre class="fragment">yarp: Port /settings active at tcp://192.168.1.2:10002
Settings 0 "" ()
Settings 0 "" ()
Settings 1 sam (1 2 3)
...
</pre><p>Now, suppose we want to offer a way to change parts of the structure individually. We can make the following two-line modification:</p>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> <a class="code" href="yarpros_8cpp.html#a0ddf1224851353fc92bfbff6f499fa97">main</a>() {</div>
<div class="line">  <a class="code" href="classyarp_1_1os_1_1Network.html">yarp::os::Network</a> <a class="code" href="namespaceyarp.html">yarp</a>;</div>
<div class="line">  <a class="code" href="classyarp_1_1os_1_1Port.html">yarp::os::Port</a> port;</div>
<div class="line">  Settings settings;</div>
<div class="line">  Settings::Editor editor(settings);  <span class="comment">// add an editor for settings</span></div>
<div class="line">  port.<a class="code" href="classyarp_1_1os_1_1Port.html#a1dd5e79319a03bc62d806dddc7e3df96">setReader</a>(editor);             <span class="comment">// read via the editor</span></div>
<div class="line">  port.<a class="code" href="classyarp_1_1os_1_1Port.html#a023eb6120647ac2fd6c6da0ff84866da">setCallbackLock</a>();</div>
<div class="line">  port.<a class="code" href="classyarp_1_1os_1_1Port.html#adbca981deeed5f66b3c4465b91eac509">open</a>(<span class="stringliteral">&quot;/settings&quot;</span>);</div>
<div class="line">  <span class="keywordflow">while</span>(<span class="keyword">true</span>) {</div>
<div class="line">    port.<a class="code" href="classyarp_1_1os_1_1Port.html#a9b9c3ef4956ad19037856511e1febf46">lockCallback</a>();</div>
<div class="line">    printf(<span class="stringliteral">&quot;Settings %s\n&quot;</span>, settings.toString().c_str());</div>
<div class="line">    port.<a class="code" href="classyarp_1_1os_1_1Port.html#aef5c5827fe043447bf82e4023d24a681">unlockCallback</a>();</div>
<div class="line">    <a class="code" href="namespaceyarp_1_1os_1_1Time.html#aca80809e0597551745954e2547e581ee">yarp::os::Time::delay</a>(1);</div>
<div class="line">  }</div>
<div class="line">  <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
</div><!-- fragment --><p>Now, we can send a new kind of message to the port:</p>
<pre class="fragment">echo 'set name "sam"' | yarp write /write /settings
</pre><p>(It is now also possible to use <code>yarp rpc /settings</code> to send commands and get status feedback). Now we can see that just the part of the structure we care about will change:</p>
<pre class="fragment">yarp: Port /settings active at tcp://192.168.1.2:10002
Settings 0 "" ()
Settings 0 "" ()
Settings 0 sam ()
...
</pre><p>The editor also lets us capture events generated just before and just after a field is changed. For example, if we want to do something just before or just after the <code>name</code> field is changed, we could do this:</p>
<div class="fragment"><div class="line"><span class="keyword">class </span>MySettings : <span class="keyword">public</span> Settings::Editor {</div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">  <span class="keyword">virtual</span> <span class="keywordtype">bool</span> will_set_name() {</div>
<div class="line">    printf(<span class="stringliteral">&quot;About to set the name, it is currently &#39;%s&#39;\n&quot;</span>, state().name.c_str());</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">virtual</span> <span class="keywordtype">bool</span> did_set_name() {</div>
<div class="line">    printf(<span class="stringliteral">&quot;Just set the name, it is now &#39;%s&#39;\n&quot;</span>, state().name.c_str());</div>
<div class="line">  }</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> <a class="code" href="yarpros_8cpp.html#a0ddf1224851353fc92bfbff6f499fa97">main</a>() {</div>
<div class="line">  <a class="code" href="classyarp_1_1os_1_1Network.html">yarp::os::Network</a> <a class="code" href="namespaceyarp.html">yarp</a>;</div>
<div class="line">  <a class="code" href="classyarp_1_1os_1_1Port.html">yarp::os::Port</a> port;</div>
<div class="line">  Settings settings;</div>
<div class="line">  MySettings editor;     <span class="comment">// switch to using our custom editor</span></div>
<div class="line">  editor.edit(settings); <span class="comment">// connect it to our settings</span></div>
<div class="line">  <span class="comment">// ... everything else is the same ...</span></div>
<div class="line">}</div>
</div><!-- fragment --><p>Now if we send a message to change the <code>name</code> field, we'll see:</p>
<pre class="fragment">yarp: Port /settings active at tcp://192.168.1.2:10002
Settings 0 "" ()
Settings 0 "" ()
About to set the name, it is currently ''
Just set the name, it is now 'sam'
Settings 0 sam ()
...
</pre> </div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<div class="ttc" id="ayarpros_8cpp_html_a0ddf1224851353fc92bfbff6f499fa97"><div class="ttname"><a href="yarpros_8cpp.html#a0ddf1224851353fc92bfbff6f499fa97">main</a></div><div class="ttdeci">int main(int argc, char *argv[])</div><div class="ttdef"><b>Definition:</b> <a href="yarpros_8cpp_source.html#l00225">yarpros.cpp:225</a></div></div>
<div class="ttc" id="aclassyarp_1_1os_1_1Port_html_adbca981deeed5f66b3c4465b91eac509"><div class="ttname"><a href="classyarp_1_1os_1_1Port.html#adbca981deeed5f66b3c4465b91eac509">yarp::os::Port::open</a></div><div class="ttdeci">bool open(const std::string &amp;name) override</div><div class="ttdoc">Start port operation, with a specific name, with automatically-chosen network parameters.</div><div class="ttdef"><b>Definition:</b> <a href="Port_8cpp_source.html#l00079">Port.cpp:79</a></div></div>
<div class="ttc" id="aclassyarp_1_1os_1_1Port_html"><div class="ttname"><a href="classyarp_1_1os_1_1Port.html">yarp::os::Port</a></div><div class="ttdoc">A mini-server for network communication.</div><div class="ttdef"><b>Definition:</b> <a href="Port_8h_source.html#l00050">Port.h:51</a></div></div>
<div class="ttc" id="aclassyarp_1_1os_1_1Port_html_a1dd5e79319a03bc62d806dddc7e3df96"><div class="ttname"><a href="classyarp_1_1os_1_1Port.html#a1dd5e79319a03bc62d806dddc7e3df96">yarp::os::Port::setReader</a></div><div class="ttdeci">void setReader(PortReader &amp;reader) override</div><div class="ttdoc">Set an external reader for port data.</div><div class="ttdef"><b>Definition:</b> <a href="Port_8cpp_source.html#l00505">Port.cpp:505</a></div></div>
<div class="ttc" id="aclassyarp_1_1os_1_1Port_html_a023eb6120647ac2fd6c6da0ff84866da"><div class="ttname"><a href="classyarp_1_1os_1_1Port.html#a023eb6120647ac2fd6c6da0ff84866da">yarp::os::Port::setCallbackLock</a></div><div class="ttdeci">virtual bool setCallbackLock(yarp::os::Mutex *mutex=nullptr) override</div><div class="ttdoc">Add a lock to use when invoking callbacks.</div><div class="ttdef"><b>Definition:</b> <a href="Port_8cpp_source.html#l00679">Port.cpp:679</a></div></div>
<div class="ttc" id="aclassyarp_1_1os_1_1Port_html_a9b9c3ef4956ad19037856511e1febf46"><div class="ttname"><a href="classyarp_1_1os_1_1Port.html#a9b9c3ef4956ad19037856511e1febf46">yarp::os::Port::lockCallback</a></div><div class="ttdeci">virtual bool lockCallback() override</div><div class="ttdoc">Lock callbacks until unlockCallback() is called.</div><div class="ttdef"><b>Definition:</b> <a href="Port_8cpp_source.html#l00689">Port.cpp:689</a></div></div>
<div class="ttc" id="aclassyarp_1_1os_1_1Network_html"><div class="ttname"><a href="classyarp_1_1os_1_1Network.html">yarp::os::Network</a></div><div class="ttdoc">Utilities for manipulating the YARP network, including initialization and shutdown.</div><div class="ttdef"><b>Definition:</b> <a href="Network_8h_source.html#l00688">Network.h:688</a></div></div>
<div class="ttc" id="anamespaceyarp_html"><div class="ttname"><a href="namespaceyarp.html">yarp</a></div><div class="ttdoc">The main, catch-all namespace for YARP.</div><div class="ttdef"><b>Definition:</b> <a href="numeric_8h_source.html#l00047">numeric.h:47</a></div></div>
<div class="ttc" id="alibYARP__OS_2include_2yarp_2os_2all_8h_html"><div class="ttname"><a href="libYARP__OS_2include_2yarp_2os_2all_8h.html">all.h</a></div></div>
<div class="ttc" id="aclassyarp_1_1os_1_1Port_html_aef5c5827fe043447bf82e4023d24a681"><div class="ttname"><a href="classyarp_1_1os_1_1Port.html#aef5c5827fe043447bf82e4023d24a681">yarp::os::Port::unlockCallback</a></div><div class="ttdeci">virtual void unlockCallback() override</div><div class="ttdoc">Unlock callbacks.</div><div class="ttdef"><b>Definition:</b> <a href="Port_8cpp_source.html#l00702">Port.cpp:702</a></div></div>
<div class="ttc" id="anamespaceyarp_1_1os_1_1Time_html_aca80809e0597551745954e2547e581ee"><div class="ttname"><a href="namespaceyarp_1_1os_1_1Time.html#aca80809e0597551745954e2547e581ee">yarp::os::Time::delay</a></div><div class="ttdeci">void delay(double seconds)</div><div class="ttdoc">Wait for a certain number of seconds.</div><div class="ttdef"><b>Definition:</b> <a href="Time_8cpp_source.html#l00111">Time.cpp:111</a></div></div>
<!-- HTML footer for doxygen 1.8.13-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li><span id="projectname_footer">YARP</span></li>
    <li><span id="projectnumber" class="version_switch">3.0.1</span></li>
    <li class="footer">Generated on Tue Nov 3 2020 16:37:07 for YARP by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.20 </li>
  </ul>
</div>
</body>
</html>
