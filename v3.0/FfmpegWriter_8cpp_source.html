<!-- HTML header for doxygen 1.8.12-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.20"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>YARP: src/devices/ffmpeg/FfmpegWriter.cpp Source File</title>
<link rel="shortcut icon" href="yarp-favicon.ico" type="image/x-icon" />
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript">
    var DOCUMENTATION_OPTIONS = { VERSION: '3.0.1' };
</script>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(function() { init_search(); });
/* @license-end */
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="yarp-doxygen-style.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../version_switch.js"></script>
<link rel="stylesheet" type="text/css" href="cookieconsent.min.css" />
<script src="cookieconsent.min.js"></script>
<script>
window.addEventListener("load", function(){
window.cookieconsent.initialise({
  "palette": {
    "popup": {
      "background": "#eb6c44",
      "text": "#ffffff"
    },
    "button": {
      "background": "#237afc",
    }
  },
  "theme": "classic",
  "content": {
    "message": "INFORMATION NOTICE ON COOKIES : This website uses only browsing/session cookies. Users can choose whether or not to accept the use of cookies and access the website. By clicking on \"Further information\", the full information notice on the types of cookies will be displayed and you will be able  to choose whether or not to accept them whilst browsing on the website.",
    "dismiss": "ACCEPT and close",
    "link": "Further information",
    "href": "http://www.icub.org/other/personal_data_notice.html"
  }
})});
</script>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="yarp-robot-64.png"/></td>
  <td id="projectalign" style="padding-left: 1.5em;">
   <div id="projectname">YARP</div>
   <div id="projectbrief">Yet Another Robot Platform</div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.svg"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.svg" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.20 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('FfmpegWriter_8cpp_source.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">FfmpegWriter.cpp</div>  </div>
</div><!--header-->
<div class="contents">
<a href="FfmpegWriter_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">/*</span></div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment"> * Copyright (C) 2006-2018 Istituto Italiano di Tecnologia (IIT)</span></div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment"> * Copyright (C) 2006-2010 RobotCub Consortium</span></div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment"> * All rights reserved.</span></div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment"> * This software may be modified and distributed under the terms of the</span></div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="comment"> * BSD-3-Clause license. See the accompanying LICENSE file for details.</span></div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160; </div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="comment">/*</span></div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="comment"> * Most of this file is from the output_example.c of ffmpeg -</span></div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="comment"> * copyright/copypolicy statement follows --</span></div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160; </div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="comment">/*</span></div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="comment"> * Libavformat API example: Output a media file in any supported</span></div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="comment"> * libavformat format. The default codecs are used.</span></div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="comment"> * Copyright (c) 2003 Fabrice Bellard</span></div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="comment"> * Permission is hereby granted, free of charge, to any person obtaining a copy</span></div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="comment"> * of this software and associated documentation files (the &quot;Software&quot;), to deal</span></div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="comment"> * in the Software without restriction, including without limitation the rights</span></div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;<span class="comment"> * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell</span></div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;<span class="comment"> * copies of the Software, and to permit persons to whom the Software is</span></div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;<span class="comment"> * furnished to do so, subject to the following conditions:</span></div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;<span class="comment"> * The above copyright notice and this permission notice shall be included in</span></div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;<span class="comment"> * all copies or substantial portions of the Software.</span></div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;<span class="comment"> * THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR</span></div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;<span class="comment"> * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,</span></div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;<span class="comment"> * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL</span></div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;<span class="comment"> * THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER</span></div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;<span class="comment"> * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,</span></div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;<span class="comment"> * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN</span></div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;<span class="comment"> * THE SOFTWARE.</span></div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160; </div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160; </div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="FfmpegWriter_8h.html">FfmpegWriter.h</a>&quot;</span></div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;<span class="preprocessor">#include &lt;<a class="code" href="libYARP__OS_2include_2yarp_2os_2all_8h.html">yarp/os/all.h</a>&gt;</span></div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;<span class="preprocessor">#include &lt;<a class="code" href="libYARP__sig_2include_2yarp_2sig_2all_8h.html">yarp/sig/all.h</a>&gt;</span></div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160; </div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="ffmpeg__api_8h.html">ffmpeg_api.h</a>&quot;</span></div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160; </div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;<span class="preprocessor">#include &lt;cstdio&gt;</span></div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160; </div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;<span class="keyword">using namespace </span><a class="code" href="namespaceyarp_1_1os.html">yarp::os</a>;</div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;<span class="keyword">using namespace </span><a class="code" href="namespaceyarp_1_1dev.html">yarp::dev</a>;</div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;<span class="keyword">using namespace </span><a class="code" href="namespaceyarp_1_1sig.html">yarp::sig</a>;</div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;<span class="keyword">using namespace </span><a class="code" href="namespaceyarp_1_1sig_1_1file.html">yarp::sig::file</a>;</div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160; </div>
<div class="line"><a name="l00054"></a><span class="lineno"><a class="line" href="FfmpegWriter_8cpp.html#a49606be7356624568932ec81c0d429f4">   54</a></span>&#160;<span class="preprocessor">#define DBG if (0)</span></div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160; </div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;<span class="comment">//#define OMIT_AUDIO</span></div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160; </div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;<span class="preprocessor">#include &lt;cstdlib&gt;</span></div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;<span class="preprocessor">#include &lt;cstdio&gt;</span></div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;<span class="preprocessor">#include &lt;cstring&gt;</span></div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;<span class="preprocessor">#include &lt;cmath&gt;</span></div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160; </div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;<span class="preprocessor">#ifndef M_PI</span></div>
<div class="line"><a name="l00064"></a><span class="lineno"><a class="line" href="FfmpegWriter_8cpp.html#ae71449b1cc6e6250b91f539153a7a0d3">   64</a></span>&#160;<span class="preprocessor">#define M_PI 3.1415926535897931</span></div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160; </div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;<span class="comment">//#include &lt;libavformat/avformat.h&gt;</span></div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;<span class="comment">//#include &lt;libavcodec/avcodec.h&gt;</span></div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160; </div>
<div class="line"><a name="l00070"></a><span class="lineno"><a class="line" href="FfmpegWriter_8cpp.html#ad0fa7a6ac51a4021276c0a04dfe2283b">   70</a></span>&#160;<span class="preprocessor">#define STREAM_FRAME_RATE 25 </span><span class="comment">/* 25 images/s */</span><span class="preprocessor"></span></div>
<div class="line"><a name="l00071"></a><span class="lineno"><a class="line" href="FfmpegWriter_8cpp.html#ae67b157ab0198fa81bf675b378ff06fd">   71</a></span>&#160;<span class="preprocessor">#define STREAM_PIX_FMT AV_PIX_FMT_YUV420P </span><span class="comment">/* default pix_fmt */</span><span class="preprocessor"></span></div>
<div class="line"><a name="l00072"></a><span class="lineno"><a class="line" href="FfmpegWriter_8cpp.html#a8b75c07a50b141dc06c532007d2886e2">   72</a></span>&#160;<span class="preprocessor">#define STREAM_PIX_WORK AV_PIX_FMT_RGB24</span></div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160; </div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;<span class="comment">/**************************************************************/</span></div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;<span class="comment">/* audio output */</span></div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160; </div>
<div class="line"><a name="l00077"></a><span class="lineno"><a class="line" href="FfmpegWriter_8cpp.html#ae3371cbe1ab70a16f1b58241d289ae77">   77</a></span>&#160;<span class="keywordtype">float</span> <a class="code" href="FfmpegWriter_8cpp.html#afea36502e9d227ff62c5fb2719a246f2">t</a>, <a class="code" href="FfmpegWriter_8cpp.html#a2d8bac9bbefeaba3b68329c0d5e476d8">tincr</a>, <a class="code" href="FfmpegWriter_8cpp.html#ae3371cbe1ab70a16f1b58241d289ae77">tincr2</a>;</div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160; </div>
<div class="line"><a name="l00079"></a><span class="lineno"><a class="line" href="FfmpegWriter_8cpp.html#aeb8ae8386f8ee09979a92b7112576aef">   79</a></span>&#160;int16_t *<a class="code" href="FfmpegWriter_8cpp.html#aeb8ae8386f8ee09979a92b7112576aef">samples</a>;</div>
<div class="line"><a name="l00080"></a><span class="lineno"><a class="line" href="FfmpegWriter_8cpp.html#a15f51ccf617d5002b146e76a41f6d9d9">   80</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="FfmpegWriter_8cpp.html#a15f51ccf617d5002b146e76a41f6d9d9">samples_size</a>;</div>
<div class="line"><a name="l00081"></a><span class="lineno"><a class="line" href="FfmpegWriter_8cpp.html#a9bef43aba4bea626b26f0c5845d042cb">   81</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="FfmpegWriter_8cpp.html#a9bef43aba4bea626b26f0c5845d042cb">samples_at</a>;</div>
<div class="line"><a name="l00082"></a><span class="lineno"><a class="line" href="FfmpegWriter_8cpp.html#aff60fb8719af5ce06ee7034f8d81a735">   82</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="FfmpegWriter_8cpp.html#aff60fb8719af5ce06ee7034f8d81a735">samples_channels</a>;</div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160; </div>
<div class="line"><a name="l00084"></a><span class="lineno"><a class="line" href="FfmpegWriter_8cpp.html#acabbf8cf98a852edeeeae57244e61eae">   84</a></span>&#160;uint8_t *<a class="code" href="FfmpegWriter_8cpp.html#acabbf8cf98a852edeeeae57244e61eae">audio_outbuf</a>;</div>
<div class="line"><a name="l00085"></a><span class="lineno"><a class="line" href="FfmpegWriter_8cpp.html#ab03a5eff2dba5f25bad201cf68d411d0">   85</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="FfmpegWriter_8cpp.html#ab03a5eff2dba5f25bad201cf68d411d0">audio_outbuf_size</a>;</div>
<div class="line"><a name="l00086"></a><span class="lineno"><a class="line" href="FfmpegWriter_8cpp.html#a9478438422f8f847e94f43823e2b3811">   86</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="FfmpegWriter_8cpp.html#a9478438422f8f847e94f43823e2b3811">audio_input_frame_size</a>;</div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160; </div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;<span class="comment">/*</span></div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;<span class="comment"> * add an audio output stream</span></div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00091"></a><span class="lineno"><a class="line" href="FfmpegWriter_8cpp.html#ababed9c1dc58c584ac2c976b93cad87e">   91</a></span>&#160;<span class="keyword">static</span> AVStream *<a class="code" href="FfmpegWriter_8cpp.html#ababed9c1dc58c584ac2c976b93cad87e">add_audio_stream</a>(AVFormatContext *oc, <a class="code" href="ffmpeg__api_8h.html#a999f78b78bb22c07006a98fa0128a7fa">CodecID</a> codec_id)</div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;{</div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;    AVCodecContext *c;</div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;    AVStream *st;</div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160; </div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;    st = <a class="code" href="ffmpeg__api_8h.html#a322d8509e77d051e0c836644991a33cd">av_new_stream</a>(oc, 1);</div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;    <span class="keywordflow">if</span> (!st) {</div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;        fprintf(stderr, <span class="stringliteral">&quot;Could not alloc stream\n&quot;</span>);</div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;        ::exit(1);</div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;    }</div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160; </div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;    c = st-&gt;codec;</div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;    c-&gt;codec_id = codec_id;</div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;    c-&gt;codec_type = <a class="code" href="ffmpeg__api_8h.html#a6333d9039f04fa0174331bd9d1030ead">CODEC_TYPE_AUDIO</a>;</div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160; </div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;    <span class="comment">/* put sample parameters */</span></div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;    c-&gt;bit_rate = 64000;</div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;    c-&gt;sample_rate = 44100;</div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;    c-&gt;channels = 2;</div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;    <span class="keywordflow">return</span> st;</div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;}</div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160; </div>
<div class="line"><a name="l00113"></a><span class="lineno"><a class="line" href="FfmpegWriter_8cpp.html#ae796a528cc56c824a00f44b45226e8d7">  113</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="FfmpegWriter_8cpp.html#ae796a528cc56c824a00f44b45226e8d7">open_audio</a>(AVFormatContext *oc, AVStream *st)</div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;{</div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;    printf(<span class="stringliteral">&quot;Opening audio stream\n&quot;</span>);</div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;    AVCodecContext *c;</div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;    AVCodec *codec;</div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160; </div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;    c = st-&gt;codec;</div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160; </div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;    <span class="comment">/* find the audio encoder */</span></div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;    codec = avcodec_find_encoder(c-&gt;codec_id);</div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;    <span class="keywordflow">if</span> (!codec) {</div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;        fprintf(stderr, <span class="stringliteral">&quot;audio codec not found\n&quot;</span>);</div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;        ::exit(1);</div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;    }</div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160; </div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;    <span class="comment">/* open it */</span></div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;    <span class="keywordflow">if</span> (avcodec_open2(c, codec, <span class="keyword">nullptr</span>) &lt; 0) {</div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;        fprintf(stderr, <span class="stringliteral">&quot;could not open codec\n&quot;</span>);</div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;        ::exit(1);</div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;    }</div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160; </div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;    <span class="comment">/* init signal generator */</span></div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;    <a class="code" href="FfmpegWriter_8cpp.html#afea36502e9d227ff62c5fb2719a246f2">t</a> = 0;</div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;    <a class="code" href="FfmpegWriter_8cpp.html#a2d8bac9bbefeaba3b68329c0d5e476d8">tincr</a> = 2 * <a class="code" href="FfmpegWriter_8cpp.html#ae71449b1cc6e6250b91f539153a7a0d3">M_PI</a> * 110.0 / c-&gt;sample_rate;</div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;    <span class="comment">/* increment frequency by 110 Hz per second */</span></div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;    <a class="code" href="FfmpegWriter_8cpp.html#ae3371cbe1ab70a16f1b58241d289ae77">tincr2</a> = 2 * <a class="code" href="FfmpegWriter_8cpp.html#ae71449b1cc6e6250b91f539153a7a0d3">M_PI</a> * 110.0 / c-&gt;sample_rate / c-&gt;sample_rate;</div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160; </div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;    <a class="code" href="FfmpegWriter_8cpp.html#ab03a5eff2dba5f25bad201cf68d411d0">audio_outbuf_size</a> = 10000;</div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;    <a class="code" href="FfmpegWriter_8cpp.html#acabbf8cf98a852edeeeae57244e61eae">audio_outbuf</a> = (uint8_t*)av_malloc(<a class="code" href="FfmpegWriter_8cpp.html#ab03a5eff2dba5f25bad201cf68d411d0">audio_outbuf_size</a>);</div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160; </div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;    <span class="comment">/* ugly hack for PCM codecs (will be removed ASAP with new PCM</span></div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;<span class="comment">       support to compute the input frame size in samples */</span></div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;    <span class="keywordflow">if</span> (c-&gt;frame_size &lt;= 1) {</div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;        <a class="code" href="FfmpegWriter_8cpp.html#a9478438422f8f847e94f43823e2b3811">audio_input_frame_size</a> = <a class="code" href="FfmpegWriter_8cpp.html#ab03a5eff2dba5f25bad201cf68d411d0">audio_outbuf_size</a> / c-&gt;channels;</div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;        <span class="keywordflow">switch</span>(st-&gt;codec-&gt;codec_id) {</div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="ffmpeg__api_8h.html#a3f0a2dd6861bd478717bb146adcee576">CODEC_ID_PCM_S16LE</a>:</div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="ffmpeg__api_8h.html#af15b3cd593359cd4cc3678b7e76649d1">CODEC_ID_PCM_S16BE</a>:</div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="ffmpeg__api_8h.html#add5786e9d4cd02c437bdda65db67e8be">CODEC_ID_PCM_U16LE</a>:</div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="ffmpeg__api_8h.html#a68bac39f7b32cd6cd253eba9a749796f">CODEC_ID_PCM_U16BE</a>:</div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;            <a class="code" href="FfmpegWriter_8cpp.html#a9478438422f8f847e94f43823e2b3811">audio_input_frame_size</a> &gt;&gt;= 1;</div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;        <span class="keywordflow">default</span>:</div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;        }</div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;        <a class="code" href="FfmpegWriter_8cpp.html#a9478438422f8f847e94f43823e2b3811">audio_input_frame_size</a> = c-&gt;frame_size;</div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;    }</div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;    <a class="code" href="FfmpegWriter_8cpp.html#a15f51ccf617d5002b146e76a41f6d9d9">samples_size</a> = <a class="code" href="FfmpegWriter_8cpp.html#a9478438422f8f847e94f43823e2b3811">audio_input_frame_size</a>;</div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;    <a class="code" href="FfmpegWriter_8cpp.html#a9bef43aba4bea626b26f0c5845d042cb">samples_at</a> = 0;</div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;    <a class="code" href="FfmpegWriter_8cpp.html#aff60fb8719af5ce06ee7034f8d81a735">samples_channels</a> = c-&gt;channels;</div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;    <a class="code" href="FfmpegWriter_8cpp.html#aeb8ae8386f8ee09979a92b7112576aef">samples</a> = (int16_t*)av_malloc(<a class="code" href="FfmpegWriter_8cpp.html#a15f51ccf617d5002b146e76a41f6d9d9">samples_size</a>*2*<a class="code" href="FfmpegWriter_8cpp.html#aff60fb8719af5ce06ee7034f8d81a735">samples_channels</a>);</div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160; </div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160; </div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;    printf(<span class="stringliteral">&quot;FRAME SIZE is %d / samples size is %d\n&quot;</span>,</div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;           c-&gt;frame_size,</div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;           <a class="code" href="FfmpegWriter_8cpp.html#a15f51ccf617d5002b146e76a41f6d9d9">samples_size</a>);</div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;    ::exit(1);</div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;}</div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160; </div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;<span class="comment">/* prepare a 16 bit dummy audio frame of &#39;frame_size&#39; samples and</span></div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;<span class="comment">   &#39;nb_channels&#39; channels */</span></div>
<div class="line"><a name="l00174"></a><span class="lineno"><a class="line" href="FfmpegWriter_8cpp.html#a5405b7dce6394fcc74d94dc9bddf8506">  174</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="FfmpegWriter_8cpp.html#a5405b7dce6394fcc74d94dc9bddf8506">get_audio_frame</a>(int16_t *<a class="code" href="FfmpegWriter_8cpp.html#aeb8ae8386f8ee09979a92b7112576aef">samples</a>, <span class="keywordtype">int</span> frame_size, <span class="keywordtype">int</span> nb_channels)</div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;{</div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;    <span class="keywordtype">int</span> j, i, v;</div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;    int16_t *q;</div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160; </div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;    q = <a class="code" href="FfmpegWriter_8cpp.html#aeb8ae8386f8ee09979a92b7112576aef">samples</a>;</div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;    <span class="keywordflow">for</span>(j=0;j&lt;frame_size;j++) {</div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;        v = (int)(sin(<a class="code" href="FfmpegWriter_8cpp.html#afea36502e9d227ff62c5fb2719a246f2">t</a>) * 10000);</div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;        <span class="keywordflow">for</span>(i = 0; i &lt; nb_channels; i++)</div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;            *q++ = v;</div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;        <a class="code" href="FfmpegWriter_8cpp.html#afea36502e9d227ff62c5fb2719a246f2">t</a> += <a class="code" href="FfmpegWriter_8cpp.html#a2d8bac9bbefeaba3b68329c0d5e476d8">tincr</a>;</div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;        <a class="code" href="FfmpegWriter_8cpp.html#a2d8bac9bbefeaba3b68329c0d5e476d8">tincr</a> += <a class="code" href="FfmpegWriter_8cpp.html#ae3371cbe1ab70a16f1b58241d289ae77">tincr2</a>;</div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;    }</div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;}</div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160; </div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;<span class="preprocessor">#ifdef USE_AUDIO4</span></div>
<div class="line"><a name="l00190"></a><span class="lineno"><a class="line" href="FfmpegWriter_8cpp.html#a794227adcb14b7543512e648e7b869f6">  190</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="FfmpegWriter_8cpp.html#a794227adcb14b7543512e648e7b869f6">make_audio_frame</a>(AVCodecContext *c, AVFrame * &amp;frame,</div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;                             <span class="keywordtype">void</span> *&amp;<a class="code" href="FfmpegWriter_8cpp.html#aeb8ae8386f8ee09979a92b7112576aef">samples</a>) {</div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;    frame = av_frame_alloc();</div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;    <span class="keywordflow">if</span> (!frame) {</div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;        fprintf(stderr, <span class="stringliteral">&quot;Could not allocate audio frame\n&quot;</span>);</div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;        ::exit(1);</div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;    }</div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;    frame-&gt;nb_samples     = c-&gt;frame_size;</div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;    frame-&gt;format         = c-&gt;sample_fmt;</div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;    frame-&gt;channel_layout = c-&gt;channel_layout;</div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;    <span class="keywordtype">int</span> buffer_size = av_samples_get_buffer_size(<span class="keyword">nullptr</span>, c-&gt;channels,</div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;                                                 c-&gt;frame_size,</div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;                                                 c-&gt;sample_fmt, 0);</div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;    <span class="keywordflow">if</span> (buffer_size &lt; 0) {</div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;        fprintf(stderr, <span class="stringliteral">&quot;Could not get sample buffer size\n&quot;</span>);</div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;        ::exit(1);</div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;    }</div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;    <a class="code" href="FfmpegWriter_8cpp.html#aeb8ae8386f8ee09979a92b7112576aef">samples</a> = av_malloc(buffer_size);</div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="FfmpegWriter_8cpp.html#aeb8ae8386f8ee09979a92b7112576aef">samples</a>) {</div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;        fprintf(stderr, <span class="stringliteral">&quot;Could not allocate %d bytes for samples buffer\n&quot;</span>,</div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;                buffer_size);</div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;        ::exit(1);</div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;    }</div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;    <span class="comment">/* setup the data pointers in the AVFrame */</span></div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;    <span class="keywordtype">int</span> <a class="code" href="IAxisInfoImpl_8cpp.html#ab295c2135096172ff421e6b33358407d">ret</a> = avcodec_fill_audio_frame(frame, c-&gt;channels, c-&gt;sample_fmt,</div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;                                       (<span class="keyword">const</span> uint8_t*)<a class="code" href="FfmpegWriter_8cpp.html#aeb8ae8386f8ee09979a92b7112576aef">samples</a>, buffer_size, 0);</div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="IAxisInfoImpl_8cpp.html#ab295c2135096172ff421e6b33358407d">ret</a> &lt; 0) {</div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;        fprintf(stderr, <span class="stringliteral">&quot;Could not setup audio frame\n&quot;</span>);</div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;        ::exit(1);</div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;    }</div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;}</div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160; </div>
<div class="line"><a name="l00223"></a><span class="lineno"><a class="line" href="FfmpegWriter_8cpp.html#a4d24a816adffef9dd0d5d8678ee68052">  223</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="FfmpegWriter_8cpp.html#a4d24a816adffef9dd0d5d8678ee68052">write_audio_frame</a>(AVFormatContext *oc, AVStream *st)</div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;{</div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;    AVCodecContext *c;</div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;    AVPacket pkt;</div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;    av_init_packet(&amp;pkt);</div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160; </div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;    c = st-&gt;codec;</div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160; </div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;    <a class="code" href="FfmpegWriter_8cpp.html#a5405b7dce6394fcc74d94dc9bddf8506">get_audio_frame</a>(<a class="code" href="FfmpegWriter_8cpp.html#aeb8ae8386f8ee09979a92b7112576aef">samples</a>, <a class="code" href="FfmpegWriter_8cpp.html#a9478438422f8f847e94f43823e2b3811">audio_input_frame_size</a>, c-&gt;channels);</div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160; </div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;<span class="preprocessor">#ifdef USE_AUDIO4</span></div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;    AVFrame *frame;</div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;    <span class="keywordtype">void</span> *<a class="code" href="FfmpegWriter_8cpp.html#aeb8ae8386f8ee09979a92b7112576aef">samples</a>;</div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;    <a class="code" href="FfmpegWriter_8cpp.html#a794227adcb14b7543512e648e7b869f6">make_audio_frame</a>(c,frame,<a class="code" href="FfmpegWriter_8cpp.html#aeb8ae8386f8ee09979a92b7112576aef">samples</a>);</div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;    AVPacket tmp;</div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;    <span class="keywordtype">int</span> got_packet = 0;</div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;    av_init_packet(&amp;tmp);</div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;    tmp.data = <a class="code" href="FfmpegWriter_8cpp.html#acabbf8cf98a852edeeeae57244e61eae">audio_outbuf</a>;</div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;    tmp.size = <a class="code" href="FfmpegWriter_8cpp.html#ab03a5eff2dba5f25bad201cf68d411d0">audio_outbuf_size</a>;</div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;    pkt.size = avcodec_encode_audio2(c, &amp;tmp, frame, &amp;got_packet);</div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;    <span class="keywordflow">if</span> (tmp.side_data_elems &gt; 0) {</div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; tmp.side_data_elems; i++) {</div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;            av_free(tmp.side_data[i].data);</div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;        }</div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;        av_freep(&amp;tmp.side_data);</div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;        tmp.side_data_elems = 0;</div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;    }</div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;    av_freep(&amp;<a class="code" href="FfmpegWriter_8cpp.html#aeb8ae8386f8ee09979a92b7112576aef">samples</a>);</div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;    av_frame_free(&amp;frame);</div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;<span class="preprocessor">#else</span></div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;    pkt.size= avcodec_encode_audio(c, <a class="code" href="FfmpegWriter_8cpp.html#acabbf8cf98a852edeeeae57244e61eae">audio_outbuf</a>, <a class="code" href="FfmpegWriter_8cpp.html#ab03a5eff2dba5f25bad201cf68d411d0">audio_outbuf_size</a>, <a class="code" href="FfmpegWriter_8cpp.html#aeb8ae8386f8ee09979a92b7112576aef">samples</a>);</div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160; </div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;    pkt.pts= av_rescale_q(c-&gt;coded_frame-&gt;pts, c-&gt;time_base, st-&gt;time_base);</div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;    pkt.flags |= <a class="code" href="ffmpeg__api_8h.html#a7b9d25898166cbfe61aaffcd24da4622">PKT_FLAG_KEY</a>;</div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;    pkt.stream_index= st-&gt;index;</div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;    pkt.data= <a class="code" href="FfmpegWriter_8cpp.html#acabbf8cf98a852edeeeae57244e61eae">audio_outbuf</a>;</div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160; </div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;    <span class="comment">/* write the compressed frame in the media file */</span></div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;    <span class="keywordflow">if</span> (av_write_frame(oc, &amp;pkt) != 0) {</div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;        fprintf(stderr, <span class="stringliteral">&quot;Error while writing audio frame\n&quot;</span>);</div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;        ::exit(1);</div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;        printf(<span class="stringliteral">&quot;Wrote some audio\n&quot;</span>);</div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;    }</div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;}</div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160; </div>
<div class="line"><a name="l00270"></a><span class="lineno"><a class="line" href="FfmpegWriter_8cpp.html#ad9be1aaf38dbde125c95489f0e2dad92">  270</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="FfmpegWriter_8cpp.html#a4d24a816adffef9dd0d5d8678ee68052">write_audio_frame</a>(AVFormatContext *oc, AVStream *st, <a class="code" href="classyarp_1_1sig_1_1Sound.html">Sound</a>&amp; snd)</div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;{</div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;    printf(<span class="stringliteral">&quot;Preparing to write audio (%d left over)\n&quot;</span>, <a class="code" href="FfmpegWriter_8cpp.html#a9bef43aba4bea626b26f0c5845d042cb">samples_at</a>);</div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;    AVCodecContext *c;</div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;    <span class="keywordtype">int</span> key = 1;</div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160; </div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;    c = st-&gt;codec;</div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160; </div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;    <span class="keywordtype">size_t</span> at = 0;</div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;    <span class="keywordflow">while</span> (at&lt;snd.<a class="code" href="classyarp_1_1sig_1_1Sound.html#a41d388763e431d4c743cf339d01eacd6">getSamples</a>()) {</div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160; </div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;        <span class="keywordtype">int</span> avail = <a class="code" href="FfmpegWriter_8cpp.html#a15f51ccf617d5002b146e76a41f6d9d9">samples_size</a> - <a class="code" href="FfmpegWriter_8cpp.html#a9bef43aba4bea626b26f0c5845d042cb">samples_at</a>;</div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;        <span class="keywordtype">int</span> remain = snd.<a class="code" href="classyarp_1_1sig_1_1Sound.html#a41d388763e431d4c743cf339d01eacd6">getSamples</a>() - at;</div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;        <span class="keywordtype">int</span> chan = snd.<a class="code" href="classyarp_1_1sig_1_1Sound.html#a57bc5db1a8d7c9ff7cc940b13a56eb45">getChannels</a>();</div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;        <span class="keywordflow">if</span> (remain&lt;avail) { avail = remain; }</div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;avail; i++) {</div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;            <span class="keywordtype">int</span> offset = <a class="code" href="FfmpegWriter_8cpp.html#a9bef43aba4bea626b26f0c5845d042cb">samples_at</a>*<a class="code" href="FfmpegWriter_8cpp.html#aff60fb8719af5ce06ee7034f8d81a735">samples_channels</a>;</div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;            <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j=0; j&lt;<a class="code" href="FfmpegWriter_8cpp.html#aff60fb8719af5ce06ee7034f8d81a735">samples_channels</a>; j++) {</div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;                <a class="code" href="FfmpegWriter_8cpp.html#aeb8ae8386f8ee09979a92b7112576aef">samples</a>[offset+j] = snd.<a class="code" href="classyarp_1_1sig_1_1Sound.html#aefb08e8ebd590cb005cb7e025a4ae39b">get</a>(at,j%chan);</div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;            }</div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;            <a class="code" href="FfmpegWriter_8cpp.html#a9bef43aba4bea626b26f0c5845d042cb">samples_at</a>++;</div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;            at++;</div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;        }</div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;        avail = <a class="code" href="FfmpegWriter_8cpp.html#a15f51ccf617d5002b146e76a41f6d9d9">samples_size</a> - <a class="code" href="FfmpegWriter_8cpp.html#a9bef43aba4bea626b26f0c5845d042cb">samples_at</a>;</div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160; </div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;        <span class="keywordflow">if</span> (avail==0) {</div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;            AVPacket pkt;</div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;            av_init_packet(&amp;pkt);</div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160; </div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160; </div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;<span class="preprocessor">#ifdef USE_AUDIO4</span></div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;            AVFrame *frame;</div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;            <span class="keywordtype">void</span> *<a class="code" href="FfmpegWriter_8cpp.html#aeb8ae8386f8ee09979a92b7112576aef">samples</a>;</div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;            <a class="code" href="FfmpegWriter_8cpp.html#a794227adcb14b7543512e648e7b869f6">make_audio_frame</a>(c,frame,<a class="code" href="FfmpegWriter_8cpp.html#aeb8ae8386f8ee09979a92b7112576aef">samples</a>);</div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;            AVPacket tmp;</div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;            <span class="keywordtype">int</span> got_packet = 0;</div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;            av_init_packet(&amp;tmp);</div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;            tmp.data = <a class="code" href="FfmpegWriter_8cpp.html#acabbf8cf98a852edeeeae57244e61eae">audio_outbuf</a>;</div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;            tmp.size = <a class="code" href="FfmpegWriter_8cpp.html#ab03a5eff2dba5f25bad201cf68d411d0">audio_outbuf_size</a>;</div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;            pkt.size = avcodec_encode_audio2(c, &amp;tmp, frame, &amp;got_packet);</div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;            <span class="keywordflow">if</span> (tmp.side_data_elems &gt; 0) {</div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;                <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; tmp.side_data_elems; i++) {</div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;                    av_free(tmp.side_data[i].data);</div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;                }</div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;                av_freep(&amp;tmp.side_data);</div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;                tmp.side_data_elems = 0;</div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;            }</div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;            av_freep(&amp;<a class="code" href="FfmpegWriter_8cpp.html#aeb8ae8386f8ee09979a92b7112576aef">samples</a>);</div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;            av_frame_free(&amp;frame);</div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;<span class="preprocessor">#else</span></div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;            pkt.size= avcodec_encode_audio(c,</div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;                                           <a class="code" href="FfmpegWriter_8cpp.html#acabbf8cf98a852edeeeae57244e61eae">audio_outbuf</a>,</div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;                                           <a class="code" href="FfmpegWriter_8cpp.html#ab03a5eff2dba5f25bad201cf68d411d0">audio_outbuf_size</a>,</div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;                                           <a class="code" href="FfmpegWriter_8cpp.html#aeb8ae8386f8ee09979a92b7112576aef">samples</a>);</div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160; </div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;            pkt.pts= av_rescale_q(c-&gt;coded_frame-&gt;pts, c-&gt;time_base,</div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;                                  st-&gt;time_base);</div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;            pkt.dts = pkt.pts;</div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;            <span class="comment">//printf(&quot;(%d)&quot;, pkt.size);</span></div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;            <span class="keywordflow">if</span> (key) {</div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;                pkt.flags |= <a class="code" href="ffmpeg__api_8h.html#a7b9d25898166cbfe61aaffcd24da4622">PKT_FLAG_KEY</a>;</div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;                key = 0;</div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;            }</div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;            pkt.stream_index= st-&gt;index;</div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;            pkt.data = <a class="code" href="FfmpegWriter_8cpp.html#acabbf8cf98a852edeeeae57244e61eae">audio_outbuf</a>;</div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;            pkt.duration = 0;</div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160; </div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160; </div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;            <span class="comment">/* write the compressed frame in the media file */</span></div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;            printf(<span class="stringliteral">&quot;+&quot;</span>);</div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;            fflush(stdout);</div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;            <span class="keywordflow">if</span> (av_write_frame(oc, &amp;pkt) != 0) {</div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;                fprintf(stderr, <span class="stringliteral">&quot;Error while writing audio frame\n&quot;</span>);</div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;                ::exit(1);</div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;            } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;                printf(<span class="stringliteral">&quot;.&quot;</span>);</div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;            }</div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;            <a class="code" href="FfmpegWriter_8cpp.html#a9bef43aba4bea626b26f0c5845d042cb">samples_at</a> = 0;</div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;        }</div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;    }</div>
<div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;    printf(<span class="stringliteral">&quot; wrote audio\n&quot;</span>);</div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;}</div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160; </div>
<div class="line"><a name="l00354"></a><span class="lineno"><a class="line" href="FfmpegWriter_8cpp.html#a5387ca4ff642aa483043500f2cde769f">  354</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="FfmpegWriter_8cpp.html#a5387ca4ff642aa483043500f2cde769f">close_audio</a>(AVFormatContext *oc, AVStream *st)</div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;{</div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;    avcodec_close(st-&gt;codec);</div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160; </div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;    av_free(<a class="code" href="FfmpegWriter_8cpp.html#aeb8ae8386f8ee09979a92b7112576aef">samples</a>);</div>
<div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;    av_free(<a class="code" href="FfmpegWriter_8cpp.html#acabbf8cf98a852edeeeae57244e61eae">audio_outbuf</a>);</div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;}</div>
<div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160; </div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;<span class="comment">/**************************************************************/</span></div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;<span class="comment">/* video output */</span></div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160; </div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160; </div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;<span class="comment">/* add a video output stream */</span></div>
<div class="line"><a name="l00367"></a><span class="lineno"><a class="line" href="FfmpegWriter_8cpp.html#a3400df8e47c6b9fffc980e3700e58aec">  367</a></span>&#160;<span class="keyword">static</span> AVStream *<a class="code" href="FfmpegWriter_8cpp.html#a3400df8e47c6b9fffc980e3700e58aec">add_video_stream</a>(AVFormatContext *oc, <a class="code" href="ffmpeg__api_8h.html#a999f78b78bb22c07006a98fa0128a7fa">CodecID</a> codec_id,</div>
<div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;                                  <span class="keywordtype">int</span> w, <span class="keywordtype">int</span> h, <span class="keywordtype">int</span> <a class="code" href="realsense2Driver_8cpp.html#ac23eab13531d41c0e01f513774011d9b">framerate</a>)</div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;{</div>
<div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;    <a class="code" href="FfmpegWriter_8cpp.html#a49606be7356624568932ec81c0d429f4">DBG</a> printf(<span class="stringliteral">&quot;Video stream %dx%d\n&quot;</span>, w, h);</div>
<div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160; </div>
<div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;    AVCodecContext *c;</div>
<div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;    AVStream *st;</div>
<div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160; </div>
<div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;    st = <a class="code" href="ffmpeg__api_8h.html#a322d8509e77d051e0c836644991a33cd">av_new_stream</a>(oc, 0);</div>
<div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;    <span class="keywordflow">if</span> (!st) {</div>
<div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;        fprintf(stderr, <span class="stringliteral">&quot;Could not alloc stream\n&quot;</span>);</div>
<div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;        ::exit(1);</div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;    }</div>
<div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160; </div>
<div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;    c = st-&gt;codec;</div>
<div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;    c-&gt;codec_id = codec_id;</div>
<div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;    c-&gt;codec_type = <a class="code" href="ffmpeg__api_8h.html#aa565d0b644dbc52c5e326a6bca068b43">CODEC_TYPE_VIDEO</a>;</div>
<div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160; </div>
<div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;    <span class="comment">/* put sample parameters */</span></div>
<div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;    c-&gt;bit_rate = 400000;</div>
<div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;    <span class="comment">/* resolution must be a multiple of two */</span></div>
<div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;    c-&gt;width = w;</div>
<div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;    c-&gt;height = h;</div>
<div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;    <span class="comment">/* time base: this is the fundamental unit of time (in seconds) in terms</span></div>
<div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;<span class="comment">       of which frame timestamps are represented. for fixed-fps content,</span></div>
<div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;<span class="comment">       timebase should be 1/framerate and timestamp increments should be</span></div>
<div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;<span class="comment">       identically 1. */</span></div>
<div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;    c-&gt;time_base.den = <a class="code" href="realsense2Driver_8cpp.html#ac23eab13531d41c0e01f513774011d9b">framerate</a>;</div>
<div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;    c-&gt;time_base.num = 1;</div>
<div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;    c-&gt;gop_size = 12; <span class="comment">/* emit one intra frame every twelve frames at most */</span></div>
<div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;    c-&gt;pix_fmt = <a class="code" href="FfmpegWriter_8cpp.html#ae67b157ab0198fa81bf675b378ff06fd">STREAM_PIX_FMT</a>;</div>
<div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;    <span class="keywordflow">if</span> (c-&gt;codec_id == <a class="code" href="ffmpeg__api_8h.html#a296fe4a5c2b06e3f19e1a9680b07701f">CODEC_ID_MPEG2VIDEO</a>) {</div>
<div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;        <span class="comment">/* just for testing, we also add B frames */</span></div>
<div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;        c-&gt;max_b_frames = 2;</div>
<div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;    }</div>
<div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;    <span class="keywordflow">if</span> (c-&gt;codec_id == <a class="code" href="ffmpeg__api_8h.html#a3a3120d33a7cb7f167a48444c9b0eb8f">CODEC_ID_MPEG1VIDEO</a>){</div>
<div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;        <span class="comment">/* needed to avoid using macroblocks in which some coeffs overflow</span></div>
<div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;<span class="comment">           this doesnt happen with normal video, it just happens here as the</span></div>
<div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;<span class="comment">           motion of the chroma plane doesnt match the luma plane */</span></div>
<div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;        c-&gt;mb_decision=2;</div>
<div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;    }</div>
<div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;    <span class="comment">// some formats want stream headers to be separate</span></div>
<div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;    <span class="keywordflow">if</span>(!strcmp(oc-&gt;oformat-&gt;name, <span class="stringliteral">&quot;mp4&quot;</span>) || !strcmp(oc-&gt;oformat-&gt;name, <span class="stringliteral">&quot;mov&quot;</span>) || !strcmp(oc-&gt;oformat-&gt;name, <span class="stringliteral">&quot;3gp&quot;</span>))</div>
<div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;        c-&gt;flags |= CODEC_FLAG_GLOBAL_HEADER;</div>
<div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160; </div>
<div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160; </div>
<div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;    <span class="keywordflow">return</span> st;</div>
<div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;}</div>
<div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160; </div>
<div class="line"><a name="l00416"></a><span class="lineno"><a class="line" href="FfmpegWriter_8cpp.html#a9bfef4e7af98d84ce02cb6e12863f966">  416</a></span>&#160;<span class="keyword">static</span> AVFrame *<a class="code" href="FfmpegWriter_8cpp.html#a9bfef4e7af98d84ce02cb6e12863f966">alloc_picture</a>(<span class="keywordtype">int</span> pix_fmt, <span class="keywordtype">int</span> width, <span class="keywordtype">int</span> height)</div>
<div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;{</div>
<div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;    AVFrame *picture;</div>
<div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;    uint8_t *picture_buf;</div>
<div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;    <span class="keywordtype">int</span> size;</div>
<div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160; </div>
<div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;    picture = <a class="code" href="ffmpeg__api_8h.html#a155b0ba0143356f38bded39fe04fd683">YARP_avcodec_alloc_frame</a>();</div>
<div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;    <span class="keywordflow">if</span> (!picture)</div>
<div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;    size = avpicture_get_size((AVPixelFormat)pix_fmt, width, height);</div>
<div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;    picture_buf = (uint8_t*)av_malloc(size);</div>
<div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;    <span class="keywordflow">if</span> (!picture_buf) {</div>
<div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;        av_free(picture);</div>
<div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;    }</div>
<div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;    avpicture_fill((AVPicture *)picture, picture_buf,</div>
<div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;                   (AVPixelFormat)pix_fmt, width, height);</div>
<div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;    <span class="keywordflow">return</span> picture;</div>
<div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;}</div>
<div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160; </div>
<div class="line"><a name="l00436"></a><span class="lineno"><a class="line" href="classyarp_1_1dev_1_1FfmpegWriter.html#ad6d761f43a0c0a2041a59cfdc551713e">  436</a></span>&#160;<span class="keywordtype">void</span> FfmpegWriter::open_video(AVFormatContext *oc, AVStream *st)</div>
<div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;{</div>
<div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;    printf(<span class="stringliteral">&quot;Opening video stream\n&quot;</span>);</div>
<div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;    AVCodec *codec;</div>
<div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;    AVCodecContext *c;</div>
<div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160; </div>
<div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;    c = st-&gt;codec;</div>
<div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160; </div>
<div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;    <span class="comment">/* find the video encoder */</span></div>
<div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;    codec = avcodec_find_encoder(c-&gt;codec_id);</div>
<div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;    <span class="keywordflow">if</span> (!codec) {</div>
<div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;        fprintf(stderr, <span class="stringliteral">&quot;video codec not found\n&quot;</span>);</div>
<div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;        ::exit(1);</div>
<div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;    }</div>
<div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160; </div>
<div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;    <span class="comment">/* open the codec */</span></div>
<div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;    <span class="keywordflow">if</span> (avcodec_open2(c, codec, <span class="keyword">nullptr</span>) &lt; 0) {</div>
<div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;        fprintf(stderr, <span class="stringliteral">&quot;could not open codec\n&quot;</span>);</div>
<div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;        ::exit(1);</div>
<div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;    }</div>
<div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160; </div>
<div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;    video_outbuf = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;    <span class="keywordflow">if</span> (!(oc-&gt;oformat-&gt;flags &amp; AVFMT_RAWPICTURE)) {</div>
<div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;        <span class="comment">/* allocate output buffer */</span></div>
<div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;        <span class="comment">/* XXX: API change will be done */</span></div>
<div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;        <span class="comment">/* buffers passed into lav* can be allocated any way you prefer,</span></div>
<div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;<span class="comment">           as long as they&#39;re aligned enough for the architecture, and</span></div>
<div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;<span class="comment">           they&#39;re freed appropriately (such as using av_free for buffers</span></div>
<div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;<span class="comment">           allocated with av_malloc) */</span></div>
<div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;        video_outbuf_size = 200000;</div>
<div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;        video_outbuf = (uint8_t*)av_malloc(video_outbuf_size);</div>
<div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;    }</div>
<div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160; </div>
<div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;    <span class="comment">/* allocate the encoded raw picture */</span></div>
<div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;    picture = <a class="code" href="FfmpegWriter_8cpp.html#a9bfef4e7af98d84ce02cb6e12863f966">alloc_picture</a>(c-&gt;pix_fmt, c-&gt;width, c-&gt;height);</div>
<div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;    <span class="keywordflow">if</span> (!picture) {</div>
<div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;        fprintf(stderr, <span class="stringliteral">&quot;Could not allocate picture\n&quot;</span>);</div>
<div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;        ::exit(1);</div>
<div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;    }</div>
<div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160; </div>
<div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;    <span class="comment">/* if the output format is not YUV420P, then a temporary YUV420P</span></div>
<div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;<span class="comment">       picture is needed too. It is then converted to the required</span></div>
<div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;<span class="comment">       output format */</span></div>
<div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;    tmp_picture = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;    <span class="keywordflow">if</span> (c-&gt;pix_fmt != AV_PIX_FMT_RGB24) {</div>
<div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;        tmp_picture = <a class="code" href="FfmpegWriter_8cpp.html#a9bfef4e7af98d84ce02cb6e12863f966">alloc_picture</a>(AV_PIX_FMT_RGB24, c-&gt;width, c-&gt;height);</div>
<div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;        <span class="keywordflow">if</span> (!tmp_picture) {</div>
<div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;            fprintf(stderr, <span class="stringliteral">&quot;Could not allocate temporary picture\n&quot;</span>);</div>
<div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;            ::exit(1);</div>
<div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;            <a class="code" href="FfmpegWriter_8cpp.html#a49606be7356624568932ec81c0d429f4">DBG</a> printf(<span class="stringliteral">&quot;Allocated AV_PIX_FMT_RGB24 image of dimensions %dx%d\n&quot;</span>,</div>
<div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;                       c-&gt;width, c-&gt;height);</div>
<div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;        }</div>
<div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;    }</div>
<div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160; </div>
<div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;    <a class="code" href="FfmpegWriter_8cpp.html#a49606be7356624568932ec81c0d429f4">DBG</a> printf(<span class="stringliteral">&quot;Video stream opened\n&quot;</span>);</div>
<div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;}</div>
<div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160; </div>
<div class="line"><a name="l00494"></a><span class="lineno"><a class="line" href="FfmpegWriter_8cpp.html#aa3adc71a1d59d604c491799d81309dce">  494</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="FfmpegWriter_8cpp.html#aa3adc71a1d59d604c491799d81309dce">fill_rgb_image</a>(AVFrame *pict, <span class="keywordtype">int</span> frame_index, <span class="keywordtype">int</span> width,</div>
<div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;                           <span class="keywordtype">int</span> height, <a class="code" href="classyarp_1_1sig_1_1ImageOf.html">ImageOf&lt;PixelRgb&gt;</a>&amp; img)</div>
<div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;{</div>
<div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;    <span class="keywordtype">int</span> x, y;</div>
<div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160; </div>
<div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;    <span class="keywordflow">for</span>(y=0;y&lt;height;y++) {</div>
<div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;        <span class="keywordflow">for</span>(x=0;x&lt;width;x++) {</div>
<div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;            <span class="keywordtype">int</span> base = y*(width*3);</div>
<div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;            pict-&gt;data[0][base + x*3] = img.<a class="code" href="classyarp_1_1sig_1_1ImageOf.html#ad91c64a73ee49d6e0a7c1b60c99e9e55">safePixel</a>(x,y).<a class="code" href="structyarp_1_1sig_1_1PixelRgb.html#a1435e8a0c8141aa1df4be9cf9521b0c5">r</a>;</div>
<div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;            pict-&gt;data[0][base +x*3+1] = img.<a class="code" href="classyarp_1_1sig_1_1ImageOf.html#ad91c64a73ee49d6e0a7c1b60c99e9e55">safePixel</a>(x,y).<a class="code" href="structyarp_1_1sig_1_1PixelRgb.html#a115ec5c9e663c3bd10e811746a26e43c">g</a>;</div>
<div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;            pict-&gt;data[0][base +x*3+2] = img.<a class="code" href="classyarp_1_1sig_1_1ImageOf.html#ad91c64a73ee49d6e0a7c1b60c99e9e55">safePixel</a>(x,y).<a class="code" href="structyarp_1_1sig_1_1PixelRgb.html#a637a8cfae16363af86824f80ab1dd7e8">b</a>;</div>
<div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;        }</div>
<div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;    }</div>
<div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;}</div>
<div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160; </div>
<div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160; </div>
<div class="line"><a name="l00510"></a><span class="lineno"><a class="line" href="classyarp_1_1dev_1_1FfmpegWriter.html#afa863d75429d25e6cfa3573ac0a5f178">  510</a></span>&#160;<span class="keywordtype">void</span> FfmpegWriter::write_video_frame(AVFormatContext *oc, AVStream *st,</div>
<div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;                                     <a class="code" href="classyarp_1_1sig_1_1ImageOf.html">ImageOf&lt;PixelRgb&gt;</a>&amp; img)</div>
<div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;{</div>
<div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;    <a class="code" href="FfmpegWriter_8cpp.html#a49606be7356624568932ec81c0d429f4">DBG</a> printf(<span class="stringliteral">&quot;Writing video stream\n&quot;</span>);</div>
<div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160; </div>
<div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;    <span class="keywordtype">int</span> out_size, <a class="code" href="IAxisInfoImpl_8cpp.html#ab295c2135096172ff421e6b33358407d">ret</a>;</div>
<div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;    AVCodecContext *c;</div>
<div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160; </div>
<div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;    c = st-&gt;codec;</div>
<div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160; </div>
<div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;    <span class="keywordflow">if</span> (c-&gt;pix_fmt != AV_PIX_FMT_RGB24) {</div>
<div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;        <a class="code" href="FfmpegWriter_8cpp.html#a49606be7356624568932ec81c0d429f4">DBG</a> printf(<span class="stringliteral">&quot;Converting to AV_PIX_FMT_RGB24\n&quot;</span>);</div>
<div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;        <a class="code" href="FfmpegWriter_8cpp.html#aa3adc71a1d59d604c491799d81309dce">fill_rgb_image</a>(tmp_picture, frame_count, c-&gt;width, c-&gt;height, img);</div>
<div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;        <a class="code" href="FfmpegWriter_8cpp.html#a49606be7356624568932ec81c0d429f4">DBG</a> printf(<span class="stringliteral">&quot;Converting to AV_PIX_FMT_RGB24 (stable_img_convert)\n&quot;</span>);</div>
<div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;        <a class="code" href="ffmpeg__api_8cpp.html#a20aa5b1f8047b8791323b2d3360a6770">stable_img_convert</a>((AVPicture *)picture, c-&gt;pix_fmt,</div>
<div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;                           (AVPicture *)tmp_picture, AV_PIX_FMT_RGB24,</div>
<div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;                           c-&gt;width, c-&gt;height);</div>
<div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;        <a class="code" href="FfmpegWriter_8cpp.html#a49606be7356624568932ec81c0d429f4">DBG</a> printf(<span class="stringliteral">&quot;Converted to AV_PIX_FMT_RGB24\n&quot;</span>);</div>
<div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;        <a class="code" href="FfmpegWriter_8cpp.html#aa3adc71a1d59d604c491799d81309dce">fill_rgb_image</a>(picture, frame_count, c-&gt;width, c-&gt;height, img);</div>
<div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;    }</div>
<div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160; </div>
<div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160; </div>
<div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;    <span class="keywordflow">if</span> (oc-&gt;oformat-&gt;flags &amp; AVFMT_RAWPICTURE) {</div>
<div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;        <span class="comment">/* raw video case. The API will change slightly in the near</span></div>
<div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;<span class="comment">           futur for that */</span></div>
<div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;        AVPacket pkt;</div>
<div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;        av_init_packet(&amp;pkt);</div>
<div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160; </div>
<div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;        pkt.flags |= <a class="code" href="ffmpeg__api_8h.html#a7b9d25898166cbfe61aaffcd24da4622">PKT_FLAG_KEY</a>;</div>
<div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;        pkt.stream_index= st-&gt;index;</div>
<div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;        pkt.data= (uint8_t *)picture;</div>
<div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;        pkt.size= <span class="keyword">sizeof</span>(AVPicture);</div>
<div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160; </div>
<div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;        <a class="code" href="IAxisInfoImpl_8cpp.html#ab295c2135096172ff421e6b33358407d">ret</a> = av_write_frame(oc, &amp;pkt);</div>
<div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;        <span class="comment">/* encode the image */</span></div>
<div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;<span class="preprocessor">#ifdef USE_AUDIO4</span></div>
<div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;        AVPacket tmp;</div>
<div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;        <span class="keywordtype">int</span> got_packet = 0;</div>
<div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;        av_init_packet(&amp;tmp);</div>
<div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;        tmp.data = video_outbuf;</div>
<div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;        tmp.size = video_outbuf_size;</div>
<div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;        out_size = avcodec_encode_video2(c, &amp;tmp, picture, &amp;got_packet);</div>
<div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;        <span class="keywordflow">if</span> (tmp.side_data_elems &gt; 0) {</div>
<div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;            <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; tmp.side_data_elems; i++) {</div>
<div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;                  av_free(tmp.side_data[i].data);</div>
<div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;            }</div>
<div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;            av_freep(&amp;tmp.side_data);</div>
<div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;            tmp.side_data_elems = 0;</div>
<div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;        }</div>
<div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;<span class="preprocessor">#else</span></div>
<div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;        out_size = avcodec_encode_video(c, video_outbuf, video_outbuf_size, picture);</div>
<div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;        <span class="comment">/* if zero size, it means the image was buffered */</span></div>
<div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;        <span class="keywordflow">if</span> (out_size &gt; 0) {</div>
<div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;            AVPacket pkt;</div>
<div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;            av_init_packet(&amp;pkt);</div>
<div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160; </div>
<div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;            pkt.pts= av_rescale_q(c-&gt;coded_frame-&gt;pts, c-&gt;time_base, st-&gt;time_base);</div>
<div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;            <span class="keywordflow">if</span>(c-&gt;coded_frame-&gt;key_frame)</div>
<div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;                pkt.flags |= <a class="code" href="ffmpeg__api_8h.html#a7b9d25898166cbfe61aaffcd24da4622">PKT_FLAG_KEY</a>;</div>
<div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;            pkt.stream_index= st-&gt;index;</div>
<div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;            pkt.data= video_outbuf;</div>
<div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;            pkt.size= out_size;</div>
<div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160; </div>
<div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;            <span class="comment">/*</span></div>
<div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;<span class="comment">            static int x = 0;</span></div>
<div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;<span class="comment">            printf(&quot;%ld / %ld  :  %ld / %ld  --&gt; %d\n&quot;,</span></div>
<div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;<span class="comment">                   (long int) c-&gt;time_base.num,</span></div>
<div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;<span class="comment">                   (long int) c-&gt;time_base.den,</span></div>
<div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;<span class="comment">                   (long int) st-&gt;time_base.num,</span></div>
<div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;<span class="comment">                   (long int) st-&gt;time_base.den,</span></div>
<div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;<span class="comment">                   x);</span></div>
<div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;<span class="comment">            pkt.pts = x;</span></div>
<div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;<span class="comment">            x++;</span></div>
<div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;<span class="comment">            */</span></div>
<div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160; </div>
<div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;            <span class="comment">/* write the compressed frame in the media file */</span></div>
<div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;            <a class="code" href="IAxisInfoImpl_8cpp.html#ab295c2135096172ff421e6b33358407d">ret</a> = av_write_frame(oc, &amp;pkt);</div>
<div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;            <a class="code" href="IAxisInfoImpl_8cpp.html#ab295c2135096172ff421e6b33358407d">ret</a> = 0;</div>
<div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;        }</div>
<div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;    }</div>
<div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="IAxisInfoImpl_8cpp.html#ab295c2135096172ff421e6b33358407d">ret</a> != 0) {</div>
<div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;        fprintf(stderr, <span class="stringliteral">&quot;Error while writing video frame\n&quot;</span>);</div>
<div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;        ::exit(1);</div>
<div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;    }</div>
<div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;    frame_count++;</div>
<div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;}</div>
<div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160; </div>
<div class="line"><a name="l00601"></a><span class="lineno"><a class="line" href="classyarp_1_1dev_1_1FfmpegWriter.html#af63020b3ebfa2a660832aa6f24519ba5">  601</a></span>&#160;<span class="keywordtype">void</span> FfmpegWriter::close_video(AVFormatContext *oc, AVStream *st)</div>
<div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;{</div>
<div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;    avcodec_close(st-&gt;codec);</div>
<div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;    av_free(picture-&gt;data[0]);</div>
<div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;    av_free(picture);</div>
<div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;    <span class="keywordflow">if</span> (tmp_picture) {</div>
<div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;        av_free(tmp_picture-&gt;data[0]);</div>
<div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;        av_free(tmp_picture);</div>
<div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;    }</div>
<div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;    av_free(video_outbuf);</div>
<div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;}</div>
<div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160; </div>
<div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160; </div>
<div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160; </div>
<div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160; </div>
<div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;<span class="comment">/**************************************************************/</span></div>
<div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;<span class="comment">/* YARP adaptation */</span></div>
<div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160; </div>
<div class="line"><a name="l00619"></a><span class="lineno"><a class="line" href="classyarp_1_1dev_1_1FfmpegWriter.html#a15aa0c5ee459c3a49d3bc0ce6d848387">  619</a></span>&#160;<span class="keywordtype">bool</span> FfmpegWriter::open(<a class="code" href="classyarp_1_1os_1_1Searchable.html">yarp::os::Searchable</a> &amp; config) {</div>
<div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;<span class="comment">//     printf(&quot;ffmpeg libavcodec version number %d.%d.%d\n&quot;, LIBAVCODEC_VERSION_MAJOR,</span></div>
<div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;<span class="comment">//                                                           LIBAVCODEC_VERSION_MINOR,</span></div>
<div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;<span class="comment">//                                                           LIBAVCODEC_VERSION_MICRO);</span></div>
<div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160; </div>
<div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;    ready = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;    savedConfig.fromString(config.<a class="code" href="classyarp_1_1os_1_1Searchable.html#aa8e76c64a9251dc4485022aa7140d150">toString</a>());</div>
<div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160; </div>
<div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;    <span class="comment">// open if possible, if not will do it later</span></div>
<div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;    <span class="keywordflow">return</span> delayedOpen(config);</div>
<div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;}</div>
<div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160; </div>
<div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160; </div>
<div class="line"><a name="l00632"></a><span class="lineno"><a class="line" href="classyarp_1_1dev_1_1FfmpegWriter.html#af41a9944ead000a33ce78fcc6a39ab54">  632</a></span>&#160;<span class="keywordtype">bool</span> FfmpegWriter::delayedOpen(<a class="code" href="classyarp_1_1os_1_1Searchable.html">yarp::os::Searchable</a> &amp; config) {</div>
<div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;    <span class="comment">//printf(&quot;DELAYED OPEN %s\n&quot;, config.toString().c_str());</span></div>
<div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160; </div>
<div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;    <span class="keywordtype">int</span> w = config.<a class="code" href="classyarp_1_1os_1_1Searchable.html#aa7b406215b653817f2450ac416b65867">check</a>(<span class="stringliteral">&quot;width&quot;</span>,<a class="code" href="classyarp_1_1os_1_1Value.html">Value</a>(0),</div>
<div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;                         <span class="stringliteral">&quot;width of image (must be even)&quot;</span>).asInt32();</div>
<div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;    <span class="keywordtype">int</span> h = config.<a class="code" href="classyarp_1_1os_1_1Searchable.html#aa7b406215b653817f2450ac416b65867">check</a>(<span class="stringliteral">&quot;height&quot;</span>,<a class="code" href="classyarp_1_1os_1_1Value.html">Value</a>(0),</div>
<div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;                         <span class="stringliteral">&quot;height of image (must be even)&quot;</span>).asInt32();</div>
<div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;    <span class="keywordtype">int</span> <a class="code" href="realsense2Driver_8cpp.html#ac23eab13531d41c0e01f513774011d9b">framerate</a> = config.<a class="code" href="classyarp_1_1os_1_1Searchable.html#aa7b406215b653817f2450ac416b65867">check</a>(<span class="stringliteral">&quot;framerate&quot;</span>,<a class="code" href="classyarp_1_1os_1_1Value.html">Value</a>(30),</div>
<div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;                                 <span class="stringliteral">&quot;baseline images per second&quot;</span>).asInt32();</div>
<div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160; </div>
<div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;    <span class="keywordtype">int</span> sample_rate = 0;</div>
<div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;    <span class="keywordtype">int</span> channels = 0;</div>
<div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;    <span class="keywordtype">bool</span> audio = config.<a class="code" href="classyarp_1_1os_1_1Searchable.html#aa7b406215b653817f2450ac416b65867">check</a>(<span class="stringliteral">&quot;audio&quot;</span>,<span class="stringliteral">&quot;should audio be included&quot;</span>);</div>
<div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;    <span class="keywordflow">if</span> (audio) {</div>
<div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;        sample_rate = config.<a class="code" href="classyarp_1_1os_1_1Searchable.html#aa7b406215b653817f2450ac416b65867">check</a>(<span class="stringliteral">&quot;sample_rate&quot;</span>,<a class="code" href="classyarp_1_1os_1_1Value.html">Value</a>(44100),</div>
<div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;                                   <span class="stringliteral">&quot;audio samples per second&quot;</span>).asInt32();</div>
<div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;        channels = config.<a class="code" href="classyarp_1_1os_1_1Searchable.html#aa7b406215b653817f2450ac416b65867">check</a>(<span class="stringliteral">&quot;channels&quot;</span>,<a class="code" href="classyarp_1_1os_1_1Value.html">Value</a>(1),</div>
<div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;                                <span class="stringliteral">&quot;audio samples per second&quot;</span>).asInt32();</div>
<div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;    }</div>
<div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160; </div>
<div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;    filename = config.<a class="code" href="classyarp_1_1os_1_1Searchable.html#aa7b406215b653817f2450ac416b65867">check</a>(<span class="stringliteral">&quot;out&quot;</span>,<a class="code" href="classyarp_1_1os_1_1Value.html">Value</a>(<span class="stringliteral">&quot;movie.avi&quot;</span>),</div>
<div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;                            <span class="stringliteral">&quot;name of movie to write&quot;</span>).asString();</div>
<div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160; </div>
<div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;    delayed = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;    <span class="keywordflow">if</span> (w&lt;=0||h&lt;=0) {</div>
<div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;        delayed = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;    }</div>
<div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;    ready = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160; </div>
<div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;    <span class="comment">/* initialize libavcodec, and register all codecs and formats */</span></div>
<div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;    av_register_all();</div>
<div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160; </div>
<div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;    <span class="comment">/* auto detect the output format from the name. default is</span></div>
<div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;<span class="comment">       mpeg. */</span></div>
<div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;    fmt = <a class="code" href="ffmpeg__api_8h.html#a2cb8ca97730dcac5b3ac76a7973eca48">guess_format</a>(<span class="keyword">nullptr</span>, filename.c_str(), <span class="keyword">nullptr</span>);</div>
<div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;    <span class="keywordflow">if</span> (!fmt) {</div>
<div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;        printf(<span class="stringliteral">&quot;Could not deduce output format from file extension: using MPEG.\n&quot;</span>);</div>
<div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;        fmt = <a class="code" href="ffmpeg__api_8h.html#a2cb8ca97730dcac5b3ac76a7973eca48">guess_format</a>(<span class="stringliteral">&quot;mpeg&quot;</span>, <span class="keyword">nullptr</span>, <span class="keyword">nullptr</span>);</div>
<div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;    }</div>
<div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;    <span class="keywordflow">if</span> (!fmt) {</div>
<div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;        fprintf(stderr, <span class="stringliteral">&quot;Could not find suitable output format\n&quot;</span>);</div>
<div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;        ::exit(1);</div>
<div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;    }</div>
<div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160; </div>
<div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;    <span class="comment">/* allocate the output media context */</span></div>
<div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;    oc = <a class="code" href="ffmpeg__api_8h.html#ab4ba1c0e42e5896d4a10d6886b11d037">av_alloc_format_context</a>();</div>
<div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;    <span class="keywordflow">if</span> (!oc) {</div>
<div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;        fprintf(stderr, <span class="stringliteral">&quot;Memory error\n&quot;</span>);</div>
<div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;        ::exit(1);</div>
<div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;    }</div>
<div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;    oc-&gt;oformat = fmt;</div>
<div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;    snprintf(oc-&gt;filename, <span class="keyword">sizeof</span>(oc-&gt;filename), <span class="stringliteral">&quot;%s&quot;</span>, filename.c_str());</div>
<div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160; </div>
<div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;    <span class="comment">/* add the audio and video streams using the default format codecs</span></div>
<div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;<span class="comment">       and initialize the codecs */</span></div>
<div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;    video_st = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;    audio_st = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;    <span class="keywordflow">if</span> (fmt-&gt;video_codec != <a class="code" href="ffmpeg__api_8h.html#a09542ed8f0e49092b04b2215abf3bbcc">CODEC_ID_NONE</a>) {</div>
<div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;        video_st = <a class="code" href="FfmpegWriter_8cpp.html#a3400df8e47c6b9fffc980e3700e58aec">add_video_stream</a>(oc, fmt-&gt;video_codec, w, h, <a class="code" href="realsense2Driver_8cpp.html#ac23eab13531d41c0e01f513774011d9b">framerate</a>);</div>
<div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;    }</div>
<div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160; </div>
<div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;<span class="preprocessor">#ifndef OMIT_AUDIO</span></div>
<div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;    <span class="keywordflow">if</span> (audio) {</div>
<div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;        printf(<span class="stringliteral">&quot;Adding audio %dx%d\n&quot;</span>, sample_rate, channels);</div>
<div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;        <span class="keywordflow">if</span> (fmt-&gt;audio_codec != <a class="code" href="ffmpeg__api_8h.html#a09542ed8f0e49092b04b2215abf3bbcc">CODEC_ID_NONE</a>) {</div>
<div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;            audio_st = <a class="code" href="FfmpegWriter_8cpp.html#ababed9c1dc58c584ac2c976b93cad87e">add_audio_stream</a>(oc, fmt-&gt;audio_codec);</div>
<div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;            <span class="keywordflow">if</span> (audio_st!=<span class="keyword">nullptr</span>) {</div>
<div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;                AVCodecContext *c = audio_st-&gt;codec;</div>
<div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;                c-&gt;sample_rate = sample_rate;</div>
<div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;                c-&gt;channels = channels;</div>
<div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;            } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;                printf(<span class="stringliteral">&quot;Failed to add audio\n&quot;</span>);</div>
<div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;            }</div>
<div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;            printf(<span class="stringliteral">&quot;No audio codec available\n&quot;</span>);</div>
<div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;        }</div>
<div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;        printf(<span class="stringliteral">&quot;Skipping audio\n&quot;</span>);</div>
<div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;    }</div>
<div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160; </div>
<div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;    <span class="comment">/* set the output parameters (must be done even if no</span></div>
<div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;<span class="comment">       parameters). */</span></div>
<div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;<span class="preprocessor">#ifndef AV_NO_SET_PARAMETERS</span></div>
<div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;    <span class="keywordflow">if</span> (av_set_parameters(oc, NULL) &lt; 0) {</div>
<div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;        fprintf(stderr, <span class="stringliteral">&quot;Invalid output format parameters\n&quot;</span>);</div>
<div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;        ::exit(1);</div>
<div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;    }</div>
<div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160; </div>
<div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;    <a class="code" href="ffmpeg__api_8h.html#a2f00643204c779b5dd05f18a7fc43b50">YARP_dump_format</a>(oc, 0, filename.c_str(), 1);</div>
<div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160; </div>
<div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;    <span class="comment">/* now that all the parameters are set, we can open the audio and</span></div>
<div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;<span class="comment">       video codecs and allocate the necessary encode buffers */</span></div>
<div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;    <span class="keywordflow">if</span> (video_st) {</div>
<div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;        open_video(oc, video_st);</div>
<div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;    }</div>
<div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;    <span class="keywordflow">if</span> (audio_st) {</div>
<div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;        <a class="code" href="FfmpegWriter_8cpp.html#ae796a528cc56c824a00f44b45226e8d7">open_audio</a>(oc, audio_st);</div>
<div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;    }</div>
<div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160; </div>
<div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;    <span class="comment">/* open the output file, if needed */</span></div>
<div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;    <span class="keywordflow">if</span> (!(fmt-&gt;flags &amp; AVFMT_NOFILE)) {</div>
<div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="ffmpeg__api_8h.html#ad856a837f709bfaa82a18f44c514eeca">url_fopen</a>(&amp;oc-&gt;pb, filename.c_str(), <a class="code" href="ffmpeg__api_8h.html#ac47133f3871645520d5a3858f77c4930">URL_WRONLY</a>) &lt; 0) {</div>
<div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;            fprintf(stderr, <span class="stringliteral">&quot;Could not open &#39;%s&#39;\n&quot;</span>, filename.c_str());</div>
<div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;            ::exit(1);</div>
<div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;        }</div>
<div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;    }</div>
<div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160; </div>
<div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;    <span class="comment">/* write the stream header, if any */</span></div>
<div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;    <a class="code" href="ffmpeg__api_8h.html#a7e830c21713805d50182156dc7946cb8">av_write_header</a>(oc);</div>
<div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160; </div>
<div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;}</div>
<div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160; </div>
<div class="line"><a name="l00748"></a><span class="lineno"><a class="line" href="classyarp_1_1dev_1_1FfmpegWriter.html#a40df7ae33c9056a0ba50a65d1252a2fe">  748</a></span>&#160;<span class="keywordtype">bool</span> FfmpegWriter::close() {</div>
<div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="classyarp.html#a4444a7d1aa5b4bc9f6d34753342dcc59">isOk</a>()) { <span class="keywordflow">return</span> <span class="keyword">false</span>; }</div>
<div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160; </div>
<div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;    <span class="comment">/* close each codec */</span></div>
<div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;    <span class="keywordflow">if</span> (video_st)</div>
<div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;        close_video(oc, video_st);</div>
<div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;    <span class="keywordflow">if</span> (audio_st)</div>
<div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;        <a class="code" href="FfmpegWriter_8cpp.html#a5387ca4ff642aa483043500f2cde769f">close_audio</a>(oc, audio_st);</div>
<div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160; </div>
<div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;    <span class="comment">/* write the trailer, if any */</span></div>
<div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;    av_write_trailer(oc);</div>
<div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160; </div>
<div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;    <span class="comment">/* free the streams */</span></div>
<div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; oc-&gt;nb_streams; i++) {</div>
<div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;        av_freep(&amp;oc-&gt;streams[i]-&gt;codec);</div>
<div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;        av_freep(&amp;oc-&gt;streams[i]);</div>
<div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;    }</div>
<div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160; </div>
<div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;    <span class="keywordflow">if</span> (!(fmt-&gt;flags &amp; AVFMT_NOFILE)) {</div>
<div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;        <span class="comment">/* close the output file */</span></div>
<div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;        <a class="code" href="ffmpeg__api_8h.html#a9ecf8c95d985a1c01400859bc650a756">url_fclose</a>(oc-&gt;pb);</div>
<div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;    }</div>
<div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160; </div>
<div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;    <span class="comment">/* free the stream */</span></div>
<div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;    av_free(oc);</div>
<div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160; </div>
<div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;    printf(<span class="stringliteral">&quot;Closed media file %s\n&quot;</span>, filename.c_str());</div>
<div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160; </div>
<div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;}</div>
<div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160; </div>
<div class="line"><a name="l00779"></a><span class="lineno"><a class="line" href="classyarp_1_1dev_1_1FfmpegWriter.html#a2a5b664538a5429c7ef673d50abeb185">  779</a></span>&#160;<span class="keywordtype">bool</span> FfmpegWriter::putImage(<a class="code" href="classyarp_1_1sig_1_1ImageOf.html">yarp::sig::ImageOf&lt;yarp::sig::PixelRgb&gt;</a> &amp; image) {</div>
<div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;    <span class="keywordflow">if</span> (delayed) {</div>
<div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;        savedConfig.put(<span class="stringliteral">&quot;width&quot;</span>,<a class="code" href="classyarp_1_1os_1_1Value.html">Value</a>((<span class="keywordtype">int</span>)image.width()));</div>
<div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;        savedConfig.put(<span class="stringliteral">&quot;height&quot;</span>,<a class="code" href="classyarp_1_1os_1_1Value.html">Value</a>((<span class="keywordtype">int</span>)image.height()));</div>
<div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;    }</div>
<div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="classyarp.html#a4444a7d1aa5b4bc9f6d34753342dcc59">isOk</a>()) { <span class="keywordflow">return</span> <span class="keyword">false</span>; }</div>
<div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160; </div>
<div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;    <span class="comment">/* compute current audio and video time */</span></div>
<div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;    <span class="keywordflow">if</span> (audio_st)</div>
<div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;        audio_pts = (double)audio_st-&gt;pts.val * audio_st-&gt;time_base.num / audio_st-&gt;time_base.den;</div>
<div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;        audio_pts = 0.0;</div>
<div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160; </div>
<div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;    if (video_st)</div>
<div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;        video_pts = (double)video_st-&gt;pts.val * video_st-&gt;time_base.num / video_st-&gt;time_base.den;</div>
<div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;        video_pts = 0.0;</div>
<div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160; </div>
<div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;    if (!(audio_st||video_st))</div>
<div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160; </div>
<div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;    <span class="comment">/* write interleaved audio and video frames */</span></div>
<div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;    <span class="keywordflow">if</span> (!video_st || (video_st &amp;&amp; audio_st &amp;&amp; audio_pts &lt; video_pts)) {</div>
<div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;        <a class="code" href="FfmpegWriter_8cpp.html#a4d24a816adffef9dd0d5d8678ee68052">write_audio_frame</a>(oc, audio_st);</div>
<div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;        write_video_frame(oc, video_st, image);</div>
<div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;    }</div>
<div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160; </div>
<div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;}</div>
<div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160; </div>
<div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160; </div>
<div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160; </div>
<div class="line"><a name="l00812"></a><span class="lineno"><a class="line" href="classyarp_1_1dev_1_1FfmpegWriter.html#aeb1905af4f9f47ef5b8da1016c02e66d">  812</a></span>&#160;<span class="keywordtype">bool</span> FfmpegWriter::putAudioVisual(<a class="code" href="classyarp_1_1sig_1_1ImageOf.html">yarp::sig::ImageOf&lt;yarp::sig::PixelRgb&gt;</a>&amp; image,</div>
<div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;                                  <a class="code" href="classyarp_1_1sig_1_1Sound.html">yarp::sig::Sound</a>&amp; sound) {</div>
<div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;    <span class="keywordflow">if</span> (delayed) {</div>
<div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160;        savedConfig.put(<span class="stringliteral">&quot;width&quot;</span>,<a class="code" href="classyarp_1_1os_1_1Value.html">Value</a>((<span class="keywordtype">int</span>)image.width()));</div>
<div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;        savedConfig.put(<span class="stringliteral">&quot;height&quot;</span>,<a class="code" href="classyarp_1_1os_1_1Value.html">Value</a>((<span class="keywordtype">int</span>)image.height()));</div>
<div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;        savedConfig.put(<span class="stringliteral">&quot;sample_rate&quot;</span>,<a class="code" href="classyarp_1_1os_1_1Value.html">Value</a>((<span class="keywordtype">int</span>)sound.<a class="code" href="classyarp_1_1sig_1_1Sound.html#a90e28b3b905a69ecd252d9d83a0cfe8f">getFrequency</a>()));</div>
<div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160;        savedConfig.put(<span class="stringliteral">&quot;channels&quot;</span>,<a class="code" href="classyarp_1_1os_1_1Value.html">Value</a>((<span class="keywordtype">int</span>)sound.<a class="code" href="classyarp_1_1sig_1_1Sound.html#a57bc5db1a8d7c9ff7cc940b13a56eb45">getChannels</a>()));</div>
<div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;        savedConfig.put(<span class="stringliteral">&quot;audio&quot;</span>,<a class="code" href="classyarp_1_1os_1_1Value.html">Value</a>(1));</div>
<div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;    }</div>
<div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="classyarp.html#a4444a7d1aa5b4bc9f6d34753342dcc59">isOk</a>()) { <span class="keywordflow">return</span> <span class="keyword">false</span>; }</div>
<div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160; </div>
<div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;    <span class="comment">/* write interleaved audio and video frames */</span></div>
<div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;    write_video_frame(oc, video_st, image);</div>
<div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160;    <a class="code" href="FfmpegWriter_8cpp.html#a4d24a816adffef9dd0d5d8678ee68052">write_audio_frame</a>(oc, audio_st, sound);</div>
<div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160;}</div>
</div><!-- fragment --></div><!-- contents -->
</div><!-- doc-content -->
<div class="ttc" id="affmpeg__api_8h_html"><div class="ttname"><a href="ffmpeg__api_8h.html">ffmpeg_api.h</a></div></div>
<div class="ttc" id="aclassyarp_1_1sig_1_1Sound_html_a90e28b3b905a69ecd252d9d83a0cfe8f"><div class="ttname"><a href="classyarp_1_1sig_1_1Sound.html#a90e28b3b905a69ecd252d9d83a0cfe8f">yarp::sig::Sound::getFrequency</a></div><div class="ttdeci">size_t getFrequency() const</div><div class="ttdef"><b>Definition:</b> <a href="Sound_8cpp_source.html#l00186">Sound.cpp:186</a></div></div>
<div class="ttc" id="affmpeg__api_8h_html_a2f00643204c779b5dd05f18a7fc43b50"><div class="ttname"><a href="ffmpeg__api_8h.html#a2f00643204c779b5dd05f18a7fc43b50">YARP_dump_format</a></div><div class="ttdeci">#define YARP_dump_format</div><div class="ttdef"><b>Definition:</b> <a href="ffmpeg__api_8h_source.html#l00084">ffmpeg_api.h:84</a></div></div>
<div class="ttc" id="aIAxisInfoImpl_8cpp_html_ab295c2135096172ff421e6b33358407d"><div class="ttname"><a href="IAxisInfoImpl_8cpp.html#ab295c2135096172ff421e6b33358407d">ret</a></div><div class="ttdeci">bool ret</div><div class="ttdef"><b>Definition:</b> <a href="IAxisInfoImpl_8cpp_source.html#l00078">IAxisInfoImpl.cpp:78</a></div></div>
<div class="ttc" id="aFfmpegWriter_8h_html"><div class="ttname"><a href="FfmpegWriter_8h.html">FfmpegWriter.h</a></div></div>
<div class="ttc" id="aclassyarp_1_1os_1_1Searchable_html"><div class="ttname"><a href="classyarp_1_1os_1_1Searchable.html">yarp::os::Searchable</a></div><div class="ttdoc">A base class for nested structures that can be searched.</div><div class="ttdef"><b>Definition:</b> <a href="Searchable_8h_source.html#l00065">Searchable.h:65</a></div></div>
<div class="ttc" id="aFfmpegWriter_8cpp_html_a5387ca4ff642aa483043500f2cde769f"><div class="ttname"><a href="FfmpegWriter_8cpp.html#a5387ca4ff642aa483043500f2cde769f">close_audio</a></div><div class="ttdeci">static void close_audio(AVFormatContext *oc, AVStream *st)</div><div class="ttdef"><b>Definition:</b> <a href="FfmpegWriter_8cpp_source.html#l00354">FfmpegWriter.cpp:354</a></div></div>
<div class="ttc" id="astructyarp_1_1sig_1_1PixelRgb_html_a115ec5c9e663c3bd10e811746a26e43c"><div class="ttname"><a href="structyarp_1_1sig_1_1PixelRgb.html#a115ec5c9e663c3bd10e811746a26e43c">yarp::sig::PixelRgb::g</a></div><div class="ttdeci">unsigned char g</div><div class="ttdef"><b>Definition:</b> <a href="libYARP__sig_2include_2yarp_2sig_2Image_8h_source.html#l00434">Image.h:434</a></div></div>
<div class="ttc" id="affmpeg__api_8h_html_a9ecf8c95d985a1c01400859bc650a756"><div class="ttname"><a href="ffmpeg__api_8h.html#a9ecf8c95d985a1c01400859bc650a756">url_fclose</a></div><div class="ttdeci">#define url_fclose</div><div class="ttdef"><b>Definition:</b> <a href="ffmpeg__api_8h_source.html#l00096">ffmpeg_api.h:96</a></div></div>
<div class="ttc" id="aFfmpegWriter_8cpp_html_a4d24a816adffef9dd0d5d8678ee68052"><div class="ttname"><a href="FfmpegWriter_8cpp.html#a4d24a816adffef9dd0d5d8678ee68052">write_audio_frame</a></div><div class="ttdeci">static void write_audio_frame(AVFormatContext *oc, AVStream *st)</div><div class="ttdef"><b>Definition:</b> <a href="FfmpegWriter_8cpp_source.html#l00223">FfmpegWriter.cpp:223</a></div></div>
<div class="ttc" id="anamespaceyarp_1_1sig_html"><div class="ttname"><a href="namespaceyarp_1_1sig.html">yarp::sig</a></div><div class="ttdoc">Signal processing.</div><div class="ttdef"><b>Definition:</b> <a href="libYARP__sig_2include_2yarp_2sig_2Image_8h_source.html#l00025">Image.h:25</a></div></div>
<div class="ttc" id="aFfmpegWriter_8cpp_html_afea36502e9d227ff62c5fb2719a246f2"><div class="ttname"><a href="FfmpegWriter_8cpp.html#afea36502e9d227ff62c5fb2719a246f2">t</a></div><div class="ttdeci">float t</div><div class="ttdef"><b>Definition:</b> <a href="FfmpegWriter_8cpp_source.html#l00077">FfmpegWriter.cpp:77</a></div></div>
<div class="ttc" id="affmpeg__api_8h_html_ad856a837f709bfaa82a18f44c514eeca"><div class="ttname"><a href="ffmpeg__api_8h.html#ad856a837f709bfaa82a18f44c514eeca">url_fopen</a></div><div class="ttdeci">#define url_fopen</div><div class="ttdef"><b>Definition:</b> <a href="ffmpeg__api_8h_source.html#l00095">ffmpeg_api.h:95</a></div></div>
<div class="ttc" id="affmpeg__api_8h_html_a7b9d25898166cbfe61aaffcd24da4622"><div class="ttname"><a href="ffmpeg__api_8h.html#a7b9d25898166cbfe61aaffcd24da4622">PKT_FLAG_KEY</a></div><div class="ttdeci">#define PKT_FLAG_KEY</div><div class="ttdef"><b>Definition:</b> <a href="ffmpeg__api_8h_source.html#l00068">ffmpeg_api.h:68</a></div></div>
<div class="ttc" id="affmpeg__api_8h_html_a7e830c21713805d50182156dc7946cb8"><div class="ttname"><a href="ffmpeg__api_8h.html#a7e830c21713805d50182156dc7946cb8">av_write_header</a></div><div class="ttdeci">#define av_write_header(x)</div><div class="ttdef"><b>Definition:</b> <a href="ffmpeg__api_8h_source.html#l00099">ffmpeg_api.h:99</a></div></div>
<div class="ttc" id="aclassyarp_1_1os_1_1Searchable_html_aa8e76c64a9251dc4485022aa7140d150"><div class="ttname"><a href="classyarp_1_1os_1_1Searchable.html#aa8e76c64a9251dc4485022aa7140d150">yarp::os::Searchable::toString</a></div><div class="ttdeci">virtual std::string toString() const =0</div><div class="ttdoc">Return a standard text representation of the content of the object.</div></div>
<div class="ttc" id="aFfmpegWriter_8cpp_html_a9bef43aba4bea626b26f0c5845d042cb"><div class="ttname"><a href="FfmpegWriter_8cpp.html#a9bef43aba4bea626b26f0c5845d042cb">samples_at</a></div><div class="ttdeci">int samples_at</div><div class="ttdef"><b>Definition:</b> <a href="FfmpegWriter_8cpp_source.html#l00081">FfmpegWriter.cpp:81</a></div></div>
<div class="ttc" id="affmpeg__api_8h_html_a3f0a2dd6861bd478717bb146adcee576"><div class="ttname"><a href="ffmpeg__api_8h.html#a3f0a2dd6861bd478717bb146adcee576">CODEC_ID_PCM_S16LE</a></div><div class="ttdeci">#define CODEC_ID_PCM_S16LE</div><div class="ttdef"><b>Definition:</b> <a href="ffmpeg__api_8h_source.html#l00089">ffmpeg_api.h:89</a></div></div>
<div class="ttc" id="aFfmpegWriter_8cpp_html_a49606be7356624568932ec81c0d429f4"><div class="ttname"><a href="FfmpegWriter_8cpp.html#a49606be7356624568932ec81c0d429f4">DBG</a></div><div class="ttdeci">#define DBG</div><div class="ttdef"><b>Definition:</b> <a href="FfmpegWriter_8cpp_source.html#l00054">FfmpegWriter.cpp:54</a></div></div>
<div class="ttc" id="affmpeg__api_8h_html_a6333d9039f04fa0174331bd9d1030ead"><div class="ttname"><a href="ffmpeg__api_8h.html#a6333d9039f04fa0174331bd9d1030ead">CODEC_TYPE_AUDIO</a></div><div class="ttdeci">#define CODEC_TYPE_AUDIO</div><div class="ttdef"><b>Definition:</b> <a href="ffmpeg__api_8h_source.html#l00063">ffmpeg_api.h:63</a></div></div>
<div class="ttc" id="aclassyarp_1_1sig_1_1Sound_html_aefb08e8ebd590cb005cb7e025a4ae39b"><div class="ttname"><a href="classyarp_1_1sig_1_1Sound.html#aefb08e8ebd590cb005cb7e025a4ae39b">yarp::sig::Sound::get</a></div><div class="ttdeci">int get(size_t sample, size_t channel=0) const</div><div class="ttdef"><b>Definition:</b> <a href="Sound_8cpp_source.html#l00159">Sound.cpp:159</a></div></div>
<div class="ttc" id="affmpeg__api_8h_html_af15b3cd593359cd4cc3678b7e76649d1"><div class="ttname"><a href="ffmpeg__api_8h.html#af15b3cd593359cd4cc3678b7e76649d1">CODEC_ID_PCM_S16BE</a></div><div class="ttdeci">#define CODEC_ID_PCM_S16BE</div><div class="ttdef"><b>Definition:</b> <a href="ffmpeg__api_8h_source.html#l00090">ffmpeg_api.h:90</a></div></div>
<div class="ttc" id="aFfmpegWriter_8cpp_html_aeb8ae8386f8ee09979a92b7112576aef"><div class="ttname"><a href="FfmpegWriter_8cpp.html#aeb8ae8386f8ee09979a92b7112576aef">samples</a></div><div class="ttdeci">int16_t * samples</div><div class="ttdef"><b>Definition:</b> <a href="FfmpegWriter_8cpp_source.html#l00079">FfmpegWriter.cpp:79</a></div></div>
<div class="ttc" id="aFfmpegWriter_8cpp_html_a9bfef4e7af98d84ce02cb6e12863f966"><div class="ttname"><a href="FfmpegWriter_8cpp.html#a9bfef4e7af98d84ce02cb6e12863f966">alloc_picture</a></div><div class="ttdeci">static AVFrame * alloc_picture(int pix_fmt, int width, int height)</div><div class="ttdef"><b>Definition:</b> <a href="FfmpegWriter_8cpp_source.html#l00416">FfmpegWriter.cpp:416</a></div></div>
<div class="ttc" id="affmpeg__api_8h_html_a155b0ba0143356f38bded39fe04fd683"><div class="ttname"><a href="ffmpeg__api_8h.html#a155b0ba0143356f38bded39fe04fd683">YARP_avcodec_alloc_frame</a></div><div class="ttdeci">#define YARP_avcodec_alloc_frame</div><div class="ttdef"><b>Definition:</b> <a href="ffmpeg__api_8h_source.html#l00077">ffmpeg_api.h:77</a></div></div>
<div class="ttc" id="affmpeg__api_8h_html_a296fe4a5c2b06e3f19e1a9680b07701f"><div class="ttname"><a href="ffmpeg__api_8h.html#a296fe4a5c2b06e3f19e1a9680b07701f">CODEC_ID_MPEG2VIDEO</a></div><div class="ttdeci">#define CODEC_ID_MPEG2VIDEO</div><div class="ttdef"><b>Definition:</b> <a href="ffmpeg__api_8h_source.html#l00094">ffmpeg_api.h:94</a></div></div>
<div class="ttc" id="aFfmpegWriter_8cpp_html_acabbf8cf98a852edeeeae57244e61eae"><div class="ttname"><a href="FfmpegWriter_8cpp.html#acabbf8cf98a852edeeeae57244e61eae">audio_outbuf</a></div><div class="ttdeci">uint8_t * audio_outbuf</div><div class="ttdef"><b>Definition:</b> <a href="FfmpegWriter_8cpp_source.html#l00084">FfmpegWriter.cpp:84</a></div></div>
<div class="ttc" id="aFfmpegWriter_8cpp_html_a15f51ccf617d5002b146e76a41f6d9d9"><div class="ttname"><a href="FfmpegWriter_8cpp.html#a15f51ccf617d5002b146e76a41f6d9d9">samples_size</a></div><div class="ttdeci">int samples_size</div><div class="ttdef"><b>Definition:</b> <a href="FfmpegWriter_8cpp_source.html#l00080">FfmpegWriter.cpp:80</a></div></div>
<div class="ttc" id="aFfmpegWriter_8cpp_html_ae67b157ab0198fa81bf675b378ff06fd"><div class="ttname"><a href="FfmpegWriter_8cpp.html#ae67b157ab0198fa81bf675b378ff06fd">STREAM_PIX_FMT</a></div><div class="ttdeci">#define STREAM_PIX_FMT</div><div class="ttdef"><b>Definition:</b> <a href="FfmpegWriter_8cpp_source.html#l00071">FfmpegWriter.cpp:71</a></div></div>
<div class="ttc" id="anamespaceyarp_1_1dev_html"><div class="ttname"><a href="namespaceyarp_1_1dev.html">yarp::dev</a></div><div class="ttdoc">An interface for the device drivers.</div><div class="ttdef"><b>Definition:</b> <a href="AudioGrabberInterfaces_8h_source.html#l00018">AudioGrabberInterfaces.h:18</a></div></div>
<div class="ttc" id="astructyarp_1_1sig_1_1PixelRgb_html_a637a8cfae16363af86824f80ab1dd7e8"><div class="ttname"><a href="structyarp_1_1sig_1_1PixelRgb.html#a637a8cfae16363af86824f80ab1dd7e8">yarp::sig::PixelRgb::b</a></div><div class="ttdeci">unsigned char b</div><div class="ttdef"><b>Definition:</b> <a href="libYARP__sig_2include_2yarp_2sig_2Image_8h_source.html#l00434">Image.h:434</a></div></div>
<div class="ttc" id="aclassyarp_1_1sig_1_1ImageOf_html"><div class="ttname"><a href="classyarp_1_1sig_1_1ImageOf.html">yarp::sig::ImageOf&lt; PixelRgb &gt;</a></div></div>
<div class="ttc" id="aclassyarp_1_1sig_1_1ImageOf_html_ad91c64a73ee49d6e0a7c1b60c99e9e55"><div class="ttname"><a href="classyarp_1_1sig_1_1ImageOf.html#ad91c64a73ee49d6e0a7c1b60c99e9e55">yarp::sig::ImageOf::safePixel</a></div><div class="ttdeci">T &amp; safePixel(size_t x, size_t y)</div><div class="ttdef"><b>Definition:</b> <a href="libYARP__sig_2include_2yarp_2sig_2Image_8h_source.html#l00597">Image.h:597</a></div></div>
<div class="ttc" id="affmpeg__api_8h_html_a2cb8ca97730dcac5b3ac76a7973eca48"><div class="ttname"><a href="ffmpeg__api_8h.html#a2cb8ca97730dcac5b3ac76a7973eca48">guess_format</a></div><div class="ttdeci">#define guess_format</div><div class="ttdef"><b>Definition:</b> <a href="ffmpeg__api_8h_source.html#l00069">ffmpeg_api.h:69</a></div></div>
<div class="ttc" id="aclassyarp_1_1sig_1_1Sound_html_a41d388763e431d4c743cf339d01eacd6"><div class="ttname"><a href="classyarp_1_1sig_1_1Sound.html#a41d388763e431d4c743cf339d01eacd6">yarp::sig::Sound::getSamples</a></div><div class="ttdeci">size_t getSamples() const</div><div class="ttdef"><b>Definition:</b> <a href="Sound_8h_source.html#l00101">Sound.h:101</a></div></div>
<div class="ttc" id="aFfmpegWriter_8cpp_html_ab03a5eff2dba5f25bad201cf68d411d0"><div class="ttname"><a href="FfmpegWriter_8cpp.html#ab03a5eff2dba5f25bad201cf68d411d0">audio_outbuf_size</a></div><div class="ttdeci">int audio_outbuf_size</div><div class="ttdef"><b>Definition:</b> <a href="FfmpegWriter_8cpp_source.html#l00085">FfmpegWriter.cpp:85</a></div></div>
<div class="ttc" id="aclassyarp_1_1sig_1_1Sound_html_a57bc5db1a8d7c9ff7cc940b13a56eb45"><div class="ttname"><a href="classyarp_1_1sig_1_1Sound.html#a57bc5db1a8d7c9ff7cc940b13a56eb45">yarp::sig::Sound::getChannels</a></div><div class="ttdeci">size_t getChannels() const</div><div class="ttdef"><b>Definition:</b> <a href="Sound_8h_source.html#l00103">Sound.h:103</a></div></div>
<div class="ttc" id="affmpeg__api_8h_html_aa565d0b644dbc52c5e326a6bca068b43"><div class="ttname"><a href="ffmpeg__api_8h.html#aa565d0b644dbc52c5e326a6bca068b43">CODEC_TYPE_VIDEO</a></div><div class="ttdeci">#define CODEC_TYPE_VIDEO</div><div class="ttdef"><b>Definition:</b> <a href="ffmpeg__api_8h_source.html#l00062">ffmpeg_api.h:62</a></div></div>
<div class="ttc" id="aFfmpegWriter_8cpp_html_aff60fb8719af5ce06ee7034f8d81a735"><div class="ttname"><a href="FfmpegWriter_8cpp.html#aff60fb8719af5ce06ee7034f8d81a735">samples_channels</a></div><div class="ttdeci">int samples_channels</div><div class="ttdef"><b>Definition:</b> <a href="FfmpegWriter_8cpp_source.html#l00082">FfmpegWriter.cpp:82</a></div></div>
<div class="ttc" id="aFfmpegWriter_8cpp_html_ae3371cbe1ab70a16f1b58241d289ae77"><div class="ttname"><a href="FfmpegWriter_8cpp.html#ae3371cbe1ab70a16f1b58241d289ae77">tincr2</a></div><div class="ttdeci">float tincr2</div><div class="ttdef"><b>Definition:</b> <a href="FfmpegWriter_8cpp_source.html#l00077">FfmpegWriter.cpp:77</a></div></div>
<div class="ttc" id="aFfmpegWriter_8cpp_html_a2d8bac9bbefeaba3b68329c0d5e476d8"><div class="ttname"><a href="FfmpegWriter_8cpp.html#a2d8bac9bbefeaba3b68329c0d5e476d8">tincr</a></div><div class="ttdeci">float tincr</div><div class="ttdef"><b>Definition:</b> <a href="FfmpegWriter_8cpp_source.html#l00077">FfmpegWriter.cpp:77</a></div></div>
<div class="ttc" id="aFfmpegWriter_8cpp_html_a5405b7dce6394fcc74d94dc9bddf8506"><div class="ttname"><a href="FfmpegWriter_8cpp.html#a5405b7dce6394fcc74d94dc9bddf8506">get_audio_frame</a></div><div class="ttdeci">static void get_audio_frame(int16_t *samples, int frame_size, int nb_channels)</div><div class="ttdef"><b>Definition:</b> <a href="FfmpegWriter_8cpp_source.html#l00174">FfmpegWriter.cpp:174</a></div></div>
<div class="ttc" id="aclassyarp_1_1os_1_1Searchable_html_aa7b406215b653817f2450ac416b65867"><div class="ttname"><a href="classyarp_1_1os_1_1Searchable.html#aa7b406215b653817f2450ac416b65867">yarp::os::Searchable::check</a></div><div class="ttdeci">virtual bool check(const std::string &amp;key) const =0</div><div class="ttdoc">Check if there exists a property of the given name.</div></div>
<div class="ttc" id="affmpeg__api_8h_html_ab4ba1c0e42e5896d4a10d6886b11d037"><div class="ttname"><a href="ffmpeg__api_8h.html#ab4ba1c0e42e5896d4a10d6886b11d037">av_alloc_format_context</a></div><div class="ttdeci">#define av_alloc_format_context</div><div class="ttdef"><b>Definition:</b> <a href="ffmpeg__api_8h_source.html#l00070">ffmpeg_api.h:70</a></div></div>
<div class="ttc" id="aFfmpegWriter_8cpp_html_aa3adc71a1d59d604c491799d81309dce"><div class="ttname"><a href="FfmpegWriter_8cpp.html#aa3adc71a1d59d604c491799d81309dce">fill_rgb_image</a></div><div class="ttdeci">static void fill_rgb_image(AVFrame *pict, int frame_index, int width, int height, ImageOf&lt; PixelRgb &gt; &amp;img)</div><div class="ttdef"><b>Definition:</b> <a href="FfmpegWriter_8cpp_source.html#l00494">FfmpegWriter.cpp:494</a></div></div>
<div class="ttc" id="affmpeg__api_8h_html_a09542ed8f0e49092b04b2215abf3bbcc"><div class="ttname"><a href="ffmpeg__api_8h.html#a09542ed8f0e49092b04b2215abf3bbcc">CODEC_ID_NONE</a></div><div class="ttdeci">#define CODEC_ID_NONE</div><div class="ttdef"><b>Definition:</b> <a href="ffmpeg__api_8h_source.html#l00088">ffmpeg_api.h:88</a></div></div>
<div class="ttc" id="affmpeg__api_8h_html_a322d8509e77d051e0c836644991a33cd"><div class="ttname"><a href="ffmpeg__api_8h.html#a322d8509e77d051e0c836644991a33cd">av_new_stream</a></div><div class="ttdeci">#define av_new_stream(x, v)</div><div class="ttdef"><b>Definition:</b> <a href="ffmpeg__api_8h_source.html#l00100">ffmpeg_api.h:100</a></div></div>
<div class="ttc" id="aFfmpegWriter_8cpp_html_ababed9c1dc58c584ac2c976b93cad87e"><div class="ttname"><a href="FfmpegWriter_8cpp.html#ababed9c1dc58c584ac2c976b93cad87e">add_audio_stream</a></div><div class="ttdeci">static AVStream * add_audio_stream(AVFormatContext *oc, AVCodecID codec_id)</div><div class="ttdef"><b>Definition:</b> <a href="FfmpegWriter_8cpp_source.html#l00091">FfmpegWriter.cpp:91</a></div></div>
<div class="ttc" id="anamespaceyarp_1_1sig_1_1file_html"><div class="ttname"><a href="namespaceyarp_1_1sig_1_1file.html">yarp::sig::file</a></div><div class="ttdoc">Image file operations.</div><div class="ttdef"><b>Definition:</b> <a href="ImageFile_8h_source.html#l00023">ImageFile.h:24</a></div></div>
<div class="ttc" id="aFfmpegWriter_8cpp_html_ae796a528cc56c824a00f44b45226e8d7"><div class="ttname"><a href="FfmpegWriter_8cpp.html#ae796a528cc56c824a00f44b45226e8d7">open_audio</a></div><div class="ttdeci">static void open_audio(AVFormatContext *oc, AVStream *st)</div><div class="ttdef"><b>Definition:</b> <a href="FfmpegWriter_8cpp_source.html#l00113">FfmpegWriter.cpp:113</a></div></div>
<div class="ttc" id="anamespaceyarp_1_1os_html"><div class="ttname"><a href="namespaceyarp_1_1os.html">yarp::os</a></div><div class="ttdoc">An interface to the operating system, including Port based communication.</div><div class="ttdef"><b>Definition:</b> <a href="AbstractCarrier_8h_source.html#l00018">AbstractCarrier.h:18</a></div></div>
<div class="ttc" id="aclassyarp_1_1sig_1_1Sound_html"><div class="ttname"><a href="classyarp_1_1sig_1_1Sound.html">yarp::sig::Sound</a></div><div class="ttdoc">Class for storing sounds.</div><div class="ttdef"><b>Definition:</b> <a href="Sound_8h_source.html#l00028">Sound.h:28</a></div></div>
<div class="ttc" id="aFfmpegWriter_8cpp_html_a794227adcb14b7543512e648e7b869f6"><div class="ttname"><a href="FfmpegWriter_8cpp.html#a794227adcb14b7543512e648e7b869f6">make_audio_frame</a></div><div class="ttdeci">static void make_audio_frame(AVCodecContext *c, AVFrame *&amp;frame, void *&amp;samples)</div><div class="ttdef"><b>Definition:</b> <a href="FfmpegWriter_8cpp_source.html#l00190">FfmpegWriter.cpp:190</a></div></div>
<div class="ttc" id="affmpeg__api_8cpp_html_a20aa5b1f8047b8791323b2d3360a6770"><div class="ttname"><a href="ffmpeg__api_8cpp.html#a20aa5b1f8047b8791323b2d3360a6770">stable_img_convert</a></div><div class="ttdeci">int stable_img_convert(AVPicture *dst, int dst_pix_fmt, const AVPicture *src, int src_pix_fmt, int src_width, int src_height)</div><div class="ttdef"><b>Definition:</b> <a href="ffmpeg__api_8cpp_source.html#l00013">ffmpeg_api.cpp:13</a></div></div>
<div class="ttc" id="affmpeg__api_8h_html_a68bac39f7b32cd6cd253eba9a749796f"><div class="ttname"><a href="ffmpeg__api_8h.html#a68bac39f7b32cd6cd253eba9a749796f">CODEC_ID_PCM_U16BE</a></div><div class="ttdeci">#define CODEC_ID_PCM_U16BE</div><div class="ttdef"><b>Definition:</b> <a href="ffmpeg__api_8h_source.html#l00092">ffmpeg_api.h:92</a></div></div>
<div class="ttc" id="aFfmpegWriter_8cpp_html_a3400df8e47c6b9fffc980e3700e58aec"><div class="ttname"><a href="FfmpegWriter_8cpp.html#a3400df8e47c6b9fffc980e3700e58aec">add_video_stream</a></div><div class="ttdeci">static AVStream * add_video_stream(AVFormatContext *oc, AVCodecID codec_id, int w, int h, int framerate)</div><div class="ttdef"><b>Definition:</b> <a href="FfmpegWriter_8cpp_source.html#l00367">FfmpegWriter.cpp:367</a></div></div>
<div class="ttc" id="alibYARP__OS_2include_2yarp_2os_2all_8h_html"><div class="ttname"><a href="libYARP__OS_2include_2yarp_2os_2all_8h.html">all.h</a></div></div>
<div class="ttc" id="affmpeg__api_8h_html_add5786e9d4cd02c437bdda65db67e8be"><div class="ttname"><a href="ffmpeg__api_8h.html#add5786e9d4cd02c437bdda65db67e8be">CODEC_ID_PCM_U16LE</a></div><div class="ttdeci">#define CODEC_ID_PCM_U16LE</div><div class="ttdef"><b>Definition:</b> <a href="ffmpeg__api_8h_source.html#l00091">ffmpeg_api.h:91</a></div></div>
<div class="ttc" id="alibYARP__sig_2include_2yarp_2sig_2all_8h_html"><div class="ttname"><a href="libYARP__sig_2include_2yarp_2sig_2all_8h.html">all.h</a></div></div>
<div class="ttc" id="aclassyarp_1_1os_1_1Value_html"><div class="ttname"><a href="classyarp_1_1os_1_1Value.html">yarp::os::Value</a></div><div class="ttdoc">A single value (typically within a Bottle).</div><div class="ttdef"><b>Definition:</b> <a href="Value_8h_source.html#l00040">Value.h:42</a></div></div>
<div class="ttc" id="aclassyarp_html_a4444a7d1aa5b4bc9f6d34753342dcc59"><div class="ttname"><a href="classyarp.html#a4444a7d1aa5b4bc9f6d34753342dcc59">yarp::isOk</a></div><div class="ttdeci">virtual bool isOk() const override</div><div class="ttdef"><b>Definition:</b> <a href="TcpRosStream_8h_source.html#l00091">TcpRosStream.h:91</a></div></div>
<div class="ttc" id="aFfmpegWriter_8cpp_html_a9478438422f8f847e94f43823e2b3811"><div class="ttname"><a href="FfmpegWriter_8cpp.html#a9478438422f8f847e94f43823e2b3811">audio_input_frame_size</a></div><div class="ttdeci">int audio_input_frame_size</div><div class="ttdef"><b>Definition:</b> <a href="FfmpegWriter_8cpp_source.html#l00086">FfmpegWriter.cpp:86</a></div></div>
<div class="ttc" id="affmpeg__api_8h_html_ac47133f3871645520d5a3858f77c4930"><div class="ttname"><a href="ffmpeg__api_8h.html#ac47133f3871645520d5a3858f77c4930">URL_WRONLY</a></div><div class="ttdeci">#define URL_WRONLY</div><div class="ttdef"><b>Definition:</b> <a href="ffmpeg__api_8h_source.html#l00097">ffmpeg_api.h:97</a></div></div>
<div class="ttc" id="affmpeg__api_8h_html_a999f78b78bb22c07006a98fa0128a7fa"><div class="ttname"><a href="ffmpeg__api_8h.html#a999f78b78bb22c07006a98fa0128a7fa">CodecID</a></div><div class="ttdeci">#define CodecID</div><div class="ttdef"><b>Definition:</b> <a href="ffmpeg__api_8h_source.html#l00087">ffmpeg_api.h:87</a></div></div>
<div class="ttc" id="aFfmpegWriter_8cpp_html_ae71449b1cc6e6250b91f539153a7a0d3"><div class="ttname"><a href="FfmpegWriter_8cpp.html#ae71449b1cc6e6250b91f539153a7a0d3">M_PI</a></div><div class="ttdeci">#define M_PI</div><div class="ttdef"><b>Definition:</b> <a href="FfmpegWriter_8cpp_source.html#l00064">FfmpegWriter.cpp:64</a></div></div>
<div class="ttc" id="affmpeg__api_8h_html_a3a3120d33a7cb7f167a48444c9b0eb8f"><div class="ttname"><a href="ffmpeg__api_8h.html#a3a3120d33a7cb7f167a48444c9b0eb8f">CODEC_ID_MPEG1VIDEO</a></div><div class="ttdeci">#define CODEC_ID_MPEG1VIDEO</div><div class="ttdef"><b>Definition:</b> <a href="ffmpeg__api_8h_source.html#l00093">ffmpeg_api.h:93</a></div></div>
<div class="ttc" id="arealsense2Driver_8cpp_html_ac23eab13531d41c0e01f513774011d9b"><div class="ttname"><a href="realsense2Driver_8cpp.html#ac23eab13531d41c0e01f513774011d9b">framerate</a></div><div class="ttdeci">constexpr char framerate[]</div><div class="ttdef"><b>Definition:</b> <a href="realsense2Driver_8cpp_source.html#l00029">realsense2Driver.cpp:29</a></div></div>
<div class="ttc" id="astructyarp_1_1sig_1_1PixelRgb_html_a1435e8a0c8141aa1df4be9cf9521b0c5"><div class="ttname"><a href="structyarp_1_1sig_1_1PixelRgb.html#a1435e8a0c8141aa1df4be9cf9521b0c5">yarp::sig::PixelRgb::r</a></div><div class="ttdeci">unsigned char r</div><div class="ttdef"><b>Definition:</b> <a href="libYARP__sig_2include_2yarp_2sig_2Image_8h_source.html#l00434">Image.h:434</a></div></div>
<!-- HTML footer for doxygen 1.8.13-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li><span id="projectname_footer">YARP</span></li>
    <li><span id="projectnumber" class="version_switch">3.0.1</span></li>
    <li class="navelem"><a class="el" href="dir_d946d32291de7db32f6a943fb45d46f4.html">src</a></li><li class="navelem"><a class="el" href="dir_abd80c029d214e783ff905e909ed9db6.html">devices</a></li><li class="navelem"><a class="el" href="dir_d26a7674abdafc0ad016c08a05860761.html">ffmpeg</a></li><li class="navelem"><a class="el" href="FfmpegWriter_8cpp.html">FfmpegWriter.cpp</a></li>
    <li class="footer">Generated on Tue Nov 3 2020 16:37:01 for YARP by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.20 </li>
  </ul>
</div>
</body>
</html>
