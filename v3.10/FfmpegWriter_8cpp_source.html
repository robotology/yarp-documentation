<!-- HTML header for doxygen 1.9.1-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>YARP: src/devices/ffmpeg/FfmpegWriter.cpp Source File</title>
<link rel="shortcut icon" href="yarp-favicon.ico" type="image/x-icon" />
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript">
    var DOCUMENTATION_OPTIONS = { VERSION: '3.10.1' };
</script>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
  $(document).ready(function() { init_search(); });
/* @license-end */
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="yarp-doxygen-style.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../version_switch.js"></script>
<script src="https://cookiehub.net/c2/44d56061.js"></script>
<script type="text/javascript">
window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('consent', 'default', {'ad_storage': 'denied', 'analytics_storage': 'denied', 'wait_for_update': 500});
document.addEventListener("DOMContentLoaded", function(event) {
var cpm = {};
window.cookiehub.load(cpm);
});
</script>
<!--
<link rel="stylesheet" type="text/css" href="cookieconsent.min.css" />
<script src="cookieconsent.min.js"></script>
<script>
window.addEventListener("load", function(){
window.cookieconsent.initialise({
  "palette": {
    "popup": {
      "background": "#eb6c44",
      "text": "#ffffff"
    },
    "button": {
      "background": "#237afc",
    }
  },
  "theme": "classic",
  "content": {
    "message": "INFORMATION NOTICE ON COOKIES : This website uses only browsing/session cookies. Users can choose whether or not to accept the use of cookies and access the website. By clicking on \"Further information\", the full information notice on the types of cookies will be displayed and you will be able  to choose whether or not to accept them whilst browsing on the website.",
    "dismiss": "ACCEPT and close",
    "link": "Further information",
    "href": "http://www.icub.eu/other/personal_data_notice.html"
  }
})});
</script>
-->
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="yarp-robot-64.png"/></td>
  <td id="projectalign" style="padding-left: 1.5em;">
   <div id="projectname">YARP</div>
   <div id="projectbrief">Yet Another Robot Platform</div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <span id="MSearchSelect"                onmouseover="return searchBox.OnSearchSelectShow()"                onmouseout="return searchBox.OnSearchSelectHide()">&#160;</span>
          <input type="text" id="MSearchField" value="" placeholder="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.svg" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('FfmpegWriter_8cpp_source.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="headertitle"><div class="title">FfmpegWriter.cpp</div></div>
</div><!--header-->
<div class="contents">
<a href="FfmpegWriter_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a id="l00001" name="l00001"></a><span class="lineno">    1</span><span class="comment">/*</span></div>
<div class="line"><a id="l00002" name="l00002"></a><span class="lineno">    2</span><span class="comment"> * SPDX-FileCopyrightText: 2006-2021 Istituto Italiano di Tecnologia (IIT)</span></div>
<div class="line"><a id="l00003" name="l00003"></a><span class="lineno">    3</span><span class="comment"> * SPDX-FileCopyrightText: 2006-2010 RobotCub Consortium</span></div>
<div class="line"><a id="l00004" name="l00004"></a><span class="lineno">    4</span><span class="comment"> * SPDX-License-Identifier: BSD-3-Clause</span></div>
<div class="line"><a id="l00005" name="l00005"></a><span class="lineno">    5</span><span class="comment"> */</span></div>
<div class="line"><a id="l00006" name="l00006"></a><span class="lineno">    6</span> </div>
<div class="line"><a id="l00007" name="l00007"></a><span class="lineno">    7</span><span class="comment">/*</span></div>
<div class="line"><a id="l00008" name="l00008"></a><span class="lineno">    8</span><span class="comment"> * Most of this file is from the output_example.c of ffmpeg -</span></div>
<div class="line"><a id="l00009" name="l00009"></a><span class="lineno">    9</span><span class="comment"> * copyright/copypolicy statement follows --</span></div>
<div class="line"><a id="l00010" name="l00010"></a><span class="lineno">   10</span><span class="comment"> */</span></div>
<div class="line"><a id="l00011" name="l00011"></a><span class="lineno">   11</span> </div>
<div class="line"><a id="l00012" name="l00012"></a><span class="lineno">   12</span><span class="comment">/*</span></div>
<div class="line"><a id="l00013" name="l00013"></a><span class="lineno">   13</span><span class="comment"> * Libavformat API example: Output a media file in any supported</span></div>
<div class="line"><a id="l00014" name="l00014"></a><span class="lineno">   14</span><span class="comment"> * libavformat format. The default codecs are used.</span></div>
<div class="line"><a id="l00015" name="l00015"></a><span class="lineno">   15</span><span class="comment"> *</span></div>
<div class="line"><a id="l00016" name="l00016"></a><span class="lineno">   16</span><span class="comment"> * SPDX-FileCopyrightText: 2003 Fabrice Bellard</span></div>
<div class="line"><a id="l00017" name="l00017"></a><span class="lineno">   17</span><span class="comment"> *</span></div>
<div class="line"><a id="l00018" name="l00018"></a><span class="lineno">   18</span><span class="comment"> * Permission is hereby granted, free of charge, to any person obtaining a copy</span></div>
<div class="line"><a id="l00019" name="l00019"></a><span class="lineno">   19</span><span class="comment"> * of this software and associated documentation files (the &quot;Software&quot;), to deal</span></div>
<div class="line"><a id="l00020" name="l00020"></a><span class="lineno">   20</span><span class="comment"> * in the Software without restriction, including without limitation the rights</span></div>
<div class="line"><a id="l00021" name="l00021"></a><span class="lineno">   21</span><span class="comment"> * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell</span></div>
<div class="line"><a id="l00022" name="l00022"></a><span class="lineno">   22</span><span class="comment"> * copies of the Software, and to permit persons to whom the Software is</span></div>
<div class="line"><a id="l00023" name="l00023"></a><span class="lineno">   23</span><span class="comment"> * furnished to do so, subject to the following conditions:</span></div>
<div class="line"><a id="l00024" name="l00024"></a><span class="lineno">   24</span><span class="comment"> *</span></div>
<div class="line"><a id="l00025" name="l00025"></a><span class="lineno">   25</span><span class="comment"> * The above copyright notice and this permission notice shall be included in</span></div>
<div class="line"><a id="l00026" name="l00026"></a><span class="lineno">   26</span><span class="comment"> * all copies or substantial portions of the Software.</span></div>
<div class="line"><a id="l00027" name="l00027"></a><span class="lineno">   27</span><span class="comment"> *</span></div>
<div class="line"><a id="l00028" name="l00028"></a><span class="lineno">   28</span><span class="comment"> * THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR</span></div>
<div class="line"><a id="l00029" name="l00029"></a><span class="lineno">   29</span><span class="comment"> * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,</span></div>
<div class="line"><a id="l00030" name="l00030"></a><span class="lineno">   30</span><span class="comment"> * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL</span></div>
<div class="line"><a id="l00031" name="l00031"></a><span class="lineno">   31</span><span class="comment"> * THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER</span></div>
<div class="line"><a id="l00032" name="l00032"></a><span class="lineno">   32</span><span class="comment"> * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,</span></div>
<div class="line"><a id="l00033" name="l00033"></a><span class="lineno">   33</span><span class="comment"> * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN</span></div>
<div class="line"><a id="l00034" name="l00034"></a><span class="lineno">   34</span><span class="comment"> * THE SOFTWARE.</span></div>
<div class="line"><a id="l00035" name="l00035"></a><span class="lineno">   35</span><span class="comment"> */</span></div>
<div class="line"><a id="l00036" name="l00036"></a><span class="lineno">   36</span> </div>
<div class="line"><a id="l00037" name="l00037"></a><span class="lineno">   37</span> </div>
<div class="line"><a id="l00038" name="l00038"></a><span class="lineno">   38</span><span class="preprocessor">#include &quot;<a class="code" href="FfmpegWriter_8h.html">FfmpegWriter.h</a>&quot;</span></div>
<div class="line"><a id="l00039" name="l00039"></a><span class="lineno">   39</span><span class="preprocessor">#include &quot;<a class="code" href="ffmpeg__api_8h.html">ffmpeg_api.h</a>&quot;</span></div>
<div class="line"><a id="l00040" name="l00040"></a><span class="lineno">   40</span> </div>
<div class="line"><a id="l00041" name="l00041"></a><span class="lineno">   41</span><span class="preprocessor">#include &lt;<a class="code" href="libYARP__os_2src_2yarp_2os_2all_8h.html">yarp/os/all.h</a>&gt;</span></div>
<div class="line"><a id="l00042" name="l00042"></a><span class="lineno">   42</span><span class="preprocessor">#include &lt;<a class="code" href="libYARP__sig_2src_2yarp_2sig_2all_8h.html">yarp/sig/all.h</a>&gt;</span></div>
<div class="line"><a id="l00043" name="l00043"></a><span class="lineno">   43</span><span class="preprocessor">#include &lt;<a class="code" href="Log_8h.html">yarp/os/Log.h</a>&gt;</span></div>
<div class="line"><a id="l00044" name="l00044"></a><span class="lineno">   44</span><span class="preprocessor">#include &lt;<a class="code" href="libYARP__os_2src_2yarp_2os_2LogComponent_8h.html">yarp/os/LogComponent.h</a>&gt;</span></div>
<div class="line"><a id="l00045" name="l00045"></a><span class="lineno">   45</span> </div>
<div class="line"><a id="l00046" name="l00046"></a><span class="lineno">   46</span><span class="preprocessor">#include &lt;cstdlib&gt;</span></div>
<div class="line"><a id="l00047" name="l00047"></a><span class="lineno">   47</span><span class="preprocessor">#include &lt;cstring&gt;</span></div>
<div class="line"><a id="l00048" name="l00048"></a><span class="lineno">   48</span><span class="preprocessor">#include &lt;cmath&gt;</span></div>
<div class="line"><a id="l00049" name="l00049"></a><span class="lineno">   49</span> </div>
<div class="line"><a id="l00050" name="l00050"></a><span class="lineno">   50</span><span class="preprocessor">#ifndef M_PI</span></div>
<div class="line"><a id="l00051" name="l00051"></a><span class="lineno"><a class="line" href="FfmpegWriter_8cpp.html#ae71449b1cc6e6250b91f539153a7a0d3">   51</a></span><span class="preprocessor">#define M_PI 3.1415926535897931</span></div>
<div class="line"><a id="l00052" name="l00052"></a><span class="lineno">   52</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00053" name="l00053"></a><span class="lineno">   53</span> </div>
<div class="line"><a id="l00054" name="l00054"></a><span class="lineno"><a class="line" href="FfmpegWriter_8cpp.html#ad0fa7a6ac51a4021276c0a04dfe2283b">   54</a></span><span class="preprocessor">#define STREAM_FRAME_RATE 25 </span><span class="comment">/* 25 images/s */</span><span class="preprocessor"></span></div>
<div class="line"><a id="l00055" name="l00055"></a><span class="lineno"><a class="line" href="FfmpegWriter_8cpp.html#ae67b157ab0198fa81bf675b378ff06fd">   55</a></span><span class="preprocessor">#define STREAM_PIX_FMT AV_PIX_FMT_YUV420P </span><span class="comment">/* default pix_fmt */</span><span class="preprocessor"></span></div>
<div class="line"><a id="l00056" name="l00056"></a><span class="lineno"><a class="line" href="FfmpegWriter_8cpp.html#a8b75c07a50b141dc06c532007d2886e2">   56</a></span><span class="preprocessor">#define STREAM_PIX_WORK AV_PIX_FMT_RGB24</span></div>
<div class="line"><a id="l00057" name="l00057"></a><span class="lineno">   57</span> </div>
<div class="line"><a id="l00058" name="l00058"></a><span class="lineno">   58</span><span class="keyword">using namespace </span><a class="code hl_namespace" href="namespaceyarp_1_1os.html">yarp::os</a>;</div>
<div class="line"><a id="l00059" name="l00059"></a><span class="lineno">   59</span><span class="keyword">using namespace </span><a class="code hl_namespace" href="namespaceyarp_1_1dev.html">yarp::dev</a>;</div>
<div class="line"><a id="l00060" name="l00060"></a><span class="lineno">   60</span><span class="keyword">using namespace </span><a class="code hl_namespace" href="namespaceyarp_1_1sig.html">yarp::sig</a>;</div>
<div class="line"><a id="l00061" name="l00061"></a><span class="lineno">   61</span><span class="keyword">using namespace </span><a class="code hl_namespace" href="namespaceyarp_1_1sig_1_1file.html">yarp::sig::file</a>;</div>
<div class="line"><a id="l00062" name="l00062"></a><span class="lineno">   62</span> </div>
<div class="line"><a id="l00063" name="l00063"></a><span class="lineno">   63</span><span class="keyword">namespace </span>{</div>
<div class="line"><a id="l00064" name="l00064"></a><span class="lineno">   64</span><a class="code hl_define" href="libYARP__os_2src_2yarp_2os_2LogComponent_8h.html#a86dd8a06be6e589f92112c953c8f8009">YARP_LOG_COMPONENT</a>(<a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">FFMPEGWRITER</a>, <span class="stringliteral">&quot;yarp.device.ffmpeg_writer&quot;</span>)</div>
<div class="line"><a id="l00065" name="l00065"></a><span class="lineno">   65</span>}</div>
<div class="line"><a id="l00066" name="l00066"></a><span class="lineno">   66</span> </div>
<div class="line"><a id="l00067" name="l00067"></a><span class="lineno">   67</span> </div>
<div class="line"><a id="l00068" name="l00068"></a><span class="lineno">   68</span><span class="comment">/**************************************************************/</span></div>
<div class="line"><a id="l00069" name="l00069"></a><span class="lineno">   69</span><span class="comment">/* audio output */</span></div>
<div class="line"><a id="l00070" name="l00070"></a><span class="lineno">   70</span> </div>
<div class="line"><a id="l00071" name="l00071"></a><span class="lineno"><a class="line" href="FfmpegWriter_8cpp.html#afea36502e9d227ff62c5fb2719a246f2">   71</a></span><span class="keywordtype">float</span> <a class="code hl_variable" href="FfmpegWriter_8cpp.html#afea36502e9d227ff62c5fb2719a246f2">t</a>, <a class="code hl_variable" href="FfmpegWriter_8cpp.html#a2d8bac9bbefeaba3b68329c0d5e476d8">tincr</a>, <a class="code hl_variable" href="FfmpegWriter_8cpp.html#ae3371cbe1ab70a16f1b58241d289ae77">tincr2</a>;</div>
<div class="line"><a id="l00072" name="l00072"></a><span class="lineno">   72</span> </div>
<div class="line"><a id="l00073" name="l00073"></a><span class="lineno"><a class="line" href="FfmpegWriter_8cpp.html#aeb8ae8386f8ee09979a92b7112576aef">   73</a></span><a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">int16_t</a> *<a class="code hl_variable" href="FfmpegWriter_8cpp.html#aeb8ae8386f8ee09979a92b7112576aef">samples</a>;</div>
<div class="line"><a id="l00074" name="l00074"></a><span class="lineno"><a class="line" href="FfmpegWriter_8cpp.html#a15f51ccf617d5002b146e76a41f6d9d9">   74</a></span><span class="keywordtype">int</span> <a class="code hl_variable" href="FfmpegWriter_8cpp.html#a15f51ccf617d5002b146e76a41f6d9d9">samples_size</a>;</div>
<div class="line"><a id="l00075" name="l00075"></a><span class="lineno"><a class="line" href="FfmpegWriter_8cpp.html#a9bef43aba4bea626b26f0c5845d042cb">   75</a></span><span class="keywordtype">int</span> <a class="code hl_variable" href="FfmpegWriter_8cpp.html#a9bef43aba4bea626b26f0c5845d042cb">samples_at</a>;</div>
<div class="line"><a id="l00076" name="l00076"></a><span class="lineno"><a class="line" href="FfmpegWriter_8cpp.html#aff60fb8719af5ce06ee7034f8d81a735">   76</a></span><span class="keywordtype">int</span> <a class="code hl_variable" href="FfmpegWriter_8cpp.html#aff60fb8719af5ce06ee7034f8d81a735">samples_channels</a>;</div>
<div class="line"><a id="l00077" name="l00077"></a><span class="lineno">   77</span> </div>
<div class="line"><a id="l00078" name="l00078"></a><span class="lineno"><a class="line" href="FfmpegWriter_8cpp.html#acabbf8cf98a852edeeeae57244e61eae">   78</a></span><a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">uint8_t</a> *<a class="code hl_variable" href="FfmpegWriter_8cpp.html#acabbf8cf98a852edeeeae57244e61eae">audio_outbuf</a>;</div>
<div class="line"><a id="l00079" name="l00079"></a><span class="lineno"><a class="line" href="FfmpegWriter_8cpp.html#ab03a5eff2dba5f25bad201cf68d411d0">   79</a></span><span class="keywordtype">int</span> <a class="code hl_variable" href="FfmpegWriter_8cpp.html#ab03a5eff2dba5f25bad201cf68d411d0">audio_outbuf_size</a>;</div>
<div class="line"><a id="l00080" name="l00080"></a><span class="lineno"><a class="line" href="FfmpegWriter_8cpp.html#a9478438422f8f847e94f43823e2b3811">   80</a></span><span class="keywordtype">int</span> <a class="code hl_variable" href="FfmpegWriter_8cpp.html#a9478438422f8f847e94f43823e2b3811">audio_input_frame_size</a>;</div>
<div class="line"><a id="l00081" name="l00081"></a><span class="lineno">   81</span> </div>
<div class="line"><a id="l00082" name="l00082"></a><span class="lineno">   82</span><span class="comment">/*</span></div>
<div class="line"><a id="l00083" name="l00083"></a><span class="lineno">   83</span><span class="comment"> * add an audio output stream</span></div>
<div class="line"><a id="l00084" name="l00084"></a><span class="lineno">   84</span><span class="comment"> */</span></div>
<div class="foldopen" id="foldopen00085" data-start="{" data-end="}">
<div class="line"><a id="l00085" name="l00085"></a><span class="lineno"><a class="line" href="FfmpegWriter_8cpp.html#a490d2349abb1cf37918bde78f7022c25">   85</a></span><span class="keyword">static</span> <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">AVStream</a> *<a class="code hl_function" href="FfmpegWriter_8cpp.html#a490d2349abb1cf37918bde78f7022c25">add_audio_stream</a>(<a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">AVFormatContext</a> *oc, <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">AVCodecID</a> <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">codec_id</a>)</div>
<div class="line"><a id="l00086" name="l00086"></a><span class="lineno">   86</span>{</div>
<div class="line"><a id="l00087" name="l00087"></a><span class="lineno">   87</span>    <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">AVCodecContext</a> *<a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">c</a>;</div>
<div class="line"><a id="l00088" name="l00088"></a><span class="lineno">   88</span>    <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">AVStream</a> *<a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">st</a>;</div>
<div class="line"><a id="l00089" name="l00089"></a><span class="lineno">   89</span> </div>
<div class="line"><a id="l00090" name="l00090"></a><span class="lineno">   90</span>    <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">st</a> = <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">avformat_new_stream</a>(oc, <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">NULL</a>);</div>
<div class="line"><a id="l00091" name="l00091"></a><span class="lineno">   91</span>    <span class="keywordflow">if</span> (!<a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">st</a>) {</div>
<div class="line"><a id="l00092" name="l00092"></a><span class="lineno">   92</span>        <a class="code hl_define" href="libYARP__os_2src_2yarp_2os_2LogComponent_8h.html#ad0e528d4696fd8f5f0cbac02dd985f44">yCFatal</a>(<a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">FFMPEGWRITER</a>, <span class="stringliteral">&quot;Could not alloc stream&quot;</span>);</div>
<div class="line"><a id="l00093" name="l00093"></a><span class="lineno">   93</span>    }</div>
<div class="line"><a id="l00094" name="l00094"></a><span class="lineno">   94</span> </div>
<div class="line"><a id="l00095" name="l00095"></a><span class="lineno">   95</span>    <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">c</a> = <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">st</a>-&gt;codec;</div>
<div class="line"><a id="l00096" name="l00096"></a><span class="lineno">   96</span>    <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">c</a>-&gt;codec_id = <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">codec_id</a>;</div>
<div class="line"><a id="l00097" name="l00097"></a><span class="lineno">   97</span>    <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">c</a>-&gt;codec_type = <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">AVMEDIA_TYPE_AUDIO</a>;</div>
<div class="line"><a id="l00098" name="l00098"></a><span class="lineno">   98</span> </div>
<div class="line"><a id="l00099" name="l00099"></a><span class="lineno">   99</span>    <span class="comment">/* put sample parameters */</span></div>
<div class="line"><a id="l00100" name="l00100"></a><span class="lineno">  100</span>    <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">c</a>-&gt;bit_rate = 64000;</div>
<div class="line"><a id="l00101" name="l00101"></a><span class="lineno">  101</span>    <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">c</a>-&gt;sample_rate = 44100;</div>
<div class="line"><a id="l00102" name="l00102"></a><span class="lineno">  102</span>    <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">c</a>-&gt;channels = 2;</div>
<div class="line"><a id="l00103" name="l00103"></a><span class="lineno">  103</span>    <span class="keywordflow">return</span> <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">st</a>;</div>
<div class="line"><a id="l00104" name="l00104"></a><span class="lineno">  104</span>}</div>
</div>
<div class="line"><a id="l00105" name="l00105"></a><span class="lineno">  105</span> </div>
<div class="foldopen" id="foldopen00106" data-start="{" data-end="}">
<div class="line"><a id="l00106" name="l00106"></a><span class="lineno"><a class="line" href="FfmpegWriter_8cpp.html#ae796a528cc56c824a00f44b45226e8d7">  106</a></span><span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code hl_function" href="FfmpegWriter_8cpp.html#ae796a528cc56c824a00f44b45226e8d7">open_audio</a>(<a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">AVFormatContext</a> *oc, <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">AVStream</a> *<a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">st</a>)</div>
<div class="line"><a id="l00107" name="l00107"></a><span class="lineno">  107</span>{</div>
<div class="line"><a id="l00108" name="l00108"></a><span class="lineno">  108</span>    <a class="code hl_define" href="libYARP__os_2src_2yarp_2os_2LogComponent_8h.html#a18e11e963a9867766b3ac49614348799">yCInfo</a>(<a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">FFMPEGWRITER</a>, <span class="stringliteral">&quot;Opening audio stream&quot;</span>);</div>
<div class="line"><a id="l00109" name="l00109"></a><span class="lineno">  109</span>    <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">AVCodecContext</a> *<a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">c</a>;</div>
<div class="line"><a id="l00110" name="l00110"></a><span class="lineno">  110</span>    <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">AVCodec</a> *codec;</div>
<div class="line"><a id="l00111" name="l00111"></a><span class="lineno">  111</span> </div>
<div class="line"><a id="l00112" name="l00112"></a><span class="lineno">  112</span>    <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">c</a> = <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">st</a>-&gt;codec;</div>
<div class="line"><a id="l00113" name="l00113"></a><span class="lineno">  113</span> </div>
<div class="line"><a id="l00114" name="l00114"></a><span class="lineno">  114</span>    <span class="comment">/* find the audio encoder */</span></div>
<div class="line"><a id="l00115" name="l00115"></a><span class="lineno">  115</span>    codec = <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">avcodec_find_encoder</a>(<a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">c</a>-&gt;codec_id);</div>
<div class="line"><a id="l00116" name="l00116"></a><span class="lineno">  116</span>    <span class="keywordflow">if</span> (!codec) {</div>
<div class="line"><a id="l00117" name="l00117"></a><span class="lineno">  117</span>        <a class="code hl_define" href="libYARP__os_2src_2yarp_2os_2LogComponent_8h.html#ad0e528d4696fd8f5f0cbac02dd985f44">yCFatal</a>(<a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">FFMPEGWRITER</a>, <span class="stringliteral">&quot;Audio codec not found&quot;</span>);</div>
<div class="line"><a id="l00118" name="l00118"></a><span class="lineno">  118</span>    }</div>
<div class="line"><a id="l00119" name="l00119"></a><span class="lineno">  119</span> </div>
<div class="line"><a id="l00120" name="l00120"></a><span class="lineno">  120</span>    <span class="comment">/* open it */</span></div>
<div class="line"><a id="l00121" name="l00121"></a><span class="lineno">  121</span>    <span class="keywordflow">if</span> (<a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">avcodec_open2</a>(<a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">c</a>, codec, <span class="keyword">nullptr</span>) &lt; 0) {</div>
<div class="line"><a id="l00122" name="l00122"></a><span class="lineno">  122</span>        <a class="code hl_define" href="libYARP__os_2src_2yarp_2os_2LogComponent_8h.html#ad0e528d4696fd8f5f0cbac02dd985f44">yCFatal</a>(<a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">FFMPEGWRITER</a>, <span class="stringliteral">&quot;Could not open codec&quot;</span>);</div>
<div class="line"><a id="l00123" name="l00123"></a><span class="lineno">  123</span>    }</div>
<div class="line"><a id="l00124" name="l00124"></a><span class="lineno">  124</span> </div>
<div class="line"><a id="l00125" name="l00125"></a><span class="lineno">  125</span>    <span class="comment">/* init signal generator */</span></div>
<div class="line"><a id="l00126" name="l00126"></a><span class="lineno">  126</span>    <a class="code hl_variable" href="FfmpegWriter_8cpp.html#afea36502e9d227ff62c5fb2719a246f2">t</a> = 0;</div>
<div class="line"><a id="l00127" name="l00127"></a><span class="lineno">  127</span>    <a class="code hl_variable" href="FfmpegWriter_8cpp.html#a2d8bac9bbefeaba3b68329c0d5e476d8">tincr</a> = 2 * <a class="code hl_define" href="FfmpegWriter_8cpp.html#ae71449b1cc6e6250b91f539153a7a0d3">M_PI</a> * 110.0 / <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">c</a>-&gt;sample_rate;</div>
<div class="line"><a id="l00128" name="l00128"></a><span class="lineno">  128</span>    <span class="comment">/* increment frequency by 110 Hz per second */</span></div>
<div class="line"><a id="l00129" name="l00129"></a><span class="lineno">  129</span>    <a class="code hl_variable" href="FfmpegWriter_8cpp.html#ae3371cbe1ab70a16f1b58241d289ae77">tincr2</a> = 2 * <a class="code hl_define" href="FfmpegWriter_8cpp.html#ae71449b1cc6e6250b91f539153a7a0d3">M_PI</a> * 110.0 / <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">c</a>-&gt;sample_rate / <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">c</a>-&gt;sample_rate;</div>
<div class="line"><a id="l00130" name="l00130"></a><span class="lineno">  130</span> </div>
<div class="line"><a id="l00131" name="l00131"></a><span class="lineno">  131</span>    <a class="code hl_variable" href="FfmpegWriter_8cpp.html#ab03a5eff2dba5f25bad201cf68d411d0">audio_outbuf_size</a> = 10000;</div>
<div class="line"><a id="l00132" name="l00132"></a><span class="lineno">  132</span>    <a class="code hl_variable" href="FfmpegWriter_8cpp.html#acabbf8cf98a852edeeeae57244e61eae">audio_outbuf</a> = (<a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">uint8_t</a>*)<a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">av_malloc</a>(<a class="code hl_variable" href="FfmpegWriter_8cpp.html#ab03a5eff2dba5f25bad201cf68d411d0">audio_outbuf_size</a>);</div>
<div class="line"><a id="l00133" name="l00133"></a><span class="lineno">  133</span> </div>
<div class="line"><a id="l00134" name="l00134"></a><span class="lineno">  134</span>    <span class="comment">/* ugly hack for PCM codecs (will be removed ASAP with new PCM</span></div>
<div class="line"><a id="l00135" name="l00135"></a><span class="lineno">  135</span><span class="comment">       support to compute the input frame size in samples */</span></div>
<div class="line"><a id="l00136" name="l00136"></a><span class="lineno">  136</span>    <span class="keywordflow">if</span> (<a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">c</a>-&gt;frame_size &lt;= 1) {</div>
<div class="line"><a id="l00137" name="l00137"></a><span class="lineno">  137</span>        <a class="code hl_variable" href="FfmpegWriter_8cpp.html#a9478438422f8f847e94f43823e2b3811">audio_input_frame_size</a> = <a class="code hl_variable" href="FfmpegWriter_8cpp.html#ab03a5eff2dba5f25bad201cf68d411d0">audio_outbuf_size</a> / <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">c</a>-&gt;channels;</div>
<div class="line"><a id="l00138" name="l00138"></a><span class="lineno">  138</span>        <span class="keywordflow">switch</span>(<a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">st</a>-&gt;codec-&gt;codec_id) {</div>
<div class="line"><a id="l00139" name="l00139"></a><span class="lineno">  139</span>        <span class="keywordflow">case</span> <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">AV_CODEC_ID_PCM_S16LE</a>:</div>
<div class="line"><a id="l00140" name="l00140"></a><span class="lineno">  140</span>        <span class="keywordflow">case</span> <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">AV_CODEC_ID_PCM_S16BE</a>:</div>
<div class="line"><a id="l00141" name="l00141"></a><span class="lineno">  141</span>        <span class="keywordflow">case</span> <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">AV_CODEC_ID_PCM_U16LE</a>:</div>
<div class="line"><a id="l00142" name="l00142"></a><span class="lineno">  142</span>        <span class="keywordflow">case</span> <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">AV_CODEC_ID_PCM_U16BE</a>:</div>
<div class="line"><a id="l00143" name="l00143"></a><span class="lineno">  143</span>            <a class="code hl_variable" href="FfmpegWriter_8cpp.html#a9478438422f8f847e94f43823e2b3811">audio_input_frame_size</a> &gt;&gt;= 1;</div>
<div class="line"><a id="l00144" name="l00144"></a><span class="lineno">  144</span>            <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l00145" name="l00145"></a><span class="lineno">  145</span>        <span class="keywordflow">default</span>:</div>
<div class="line"><a id="l00146" name="l00146"></a><span class="lineno">  146</span>            <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l00147" name="l00147"></a><span class="lineno">  147</span>        }</div>
<div class="line"><a id="l00148" name="l00148"></a><span class="lineno">  148</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l00149" name="l00149"></a><span class="lineno">  149</span>        <a class="code hl_variable" href="FfmpegWriter_8cpp.html#a9478438422f8f847e94f43823e2b3811">audio_input_frame_size</a> = <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">c</a>-&gt;frame_size;</div>
<div class="line"><a id="l00150" name="l00150"></a><span class="lineno">  150</span>    }</div>
<div class="line"><a id="l00151" name="l00151"></a><span class="lineno">  151</span>    <a class="code hl_variable" href="FfmpegWriter_8cpp.html#a15f51ccf617d5002b146e76a41f6d9d9">samples_size</a> = <a class="code hl_variable" href="FfmpegWriter_8cpp.html#a9478438422f8f847e94f43823e2b3811">audio_input_frame_size</a>;</div>
<div class="line"><a id="l00152" name="l00152"></a><span class="lineno">  152</span>    <a class="code hl_variable" href="FfmpegWriter_8cpp.html#a9bef43aba4bea626b26f0c5845d042cb">samples_at</a> = 0;</div>
<div class="line"><a id="l00153" name="l00153"></a><span class="lineno">  153</span>    <a class="code hl_variable" href="FfmpegWriter_8cpp.html#aff60fb8719af5ce06ee7034f8d81a735">samples_channels</a> = <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">c</a>-&gt;channels;</div>
<div class="line"><a id="l00154" name="l00154"></a><span class="lineno">  154</span>    <a class="code hl_variable" href="FfmpegWriter_8cpp.html#aeb8ae8386f8ee09979a92b7112576aef">samples</a> = (<a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">int16_t</a>*)<a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">av_malloc</a>(<a class="code hl_variable" href="FfmpegWriter_8cpp.html#a15f51ccf617d5002b146e76a41f6d9d9">samples_size</a>*2*<a class="code hl_variable" href="FfmpegWriter_8cpp.html#aff60fb8719af5ce06ee7034f8d81a735">samples_channels</a>);</div>
<div class="line"><a id="l00155" name="l00155"></a><span class="lineno">  155</span> </div>
<div class="line"><a id="l00156" name="l00156"></a><span class="lineno">  156</span> </div>
<div class="line"><a id="l00157" name="l00157"></a><span class="lineno">  157</span>    <a class="code hl_define" href="libYARP__os_2src_2yarp_2os_2LogComponent_8h.html#ad0e528d4696fd8f5f0cbac02dd985f44">yCFatal</a>(<a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">FFMPEGWRITER</a>,</div>
<div class="line"><a id="l00158" name="l00158"></a><span class="lineno">  158</span>            <span class="stringliteral">&quot;FRAME SIZE is %d / samples size is %d\n&quot;</span>,</div>
<div class="line"><a id="l00159" name="l00159"></a><span class="lineno">  159</span>            <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">c</a>-&gt;frame_size,</div>
<div class="line"><a id="l00160" name="l00160"></a><span class="lineno">  160</span>            <a class="code hl_variable" href="FfmpegWriter_8cpp.html#a15f51ccf617d5002b146e76a41f6d9d9">samples_size</a>);</div>
<div class="line"><a id="l00161" name="l00161"></a><span class="lineno">  161</span>}</div>
</div>
<div class="line"><a id="l00162" name="l00162"></a><span class="lineno">  162</span> </div>
<div class="line"><a id="l00163" name="l00163"></a><span class="lineno">  163</span><span class="comment">/* prepare a 16 bit dummy audio frame of &#39;frame_size&#39; samples and</span></div>
<div class="line"><a id="l00164" name="l00164"></a><span class="lineno">  164</span><span class="comment">   &#39;nb_channels&#39; channels */</span></div>
<div class="foldopen" id="foldopen00165" data-start="{" data-end="}">
<div class="line"><a id="l00165" name="l00165"></a><span class="lineno"><a class="line" href="FfmpegWriter_8cpp.html#a5405b7dce6394fcc74d94dc9bddf8506">  165</a></span><span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code hl_function" href="FfmpegWriter_8cpp.html#a5405b7dce6394fcc74d94dc9bddf8506">get_audio_frame</a>(<a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">int16_t</a> *<a class="code hl_variable" href="FfmpegWriter_8cpp.html#aeb8ae8386f8ee09979a92b7112576aef">samples</a>, <span class="keywordtype">int</span> <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">frame_size</a>, <span class="keywordtype">int</span> <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">nb_channels</a>)</div>
<div class="line"><a id="l00166" name="l00166"></a><span class="lineno">  166</span>{</div>
<div class="line"><a id="l00167" name="l00167"></a><span class="lineno">  167</span>    <span class="keywordtype">int</span> <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">j</a>, <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">i</a>, v;</div>
<div class="line"><a id="l00168" name="l00168"></a><span class="lineno">  168</span>    <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">int16_t</a> *<a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">q</a>;</div>
<div class="line"><a id="l00169" name="l00169"></a><span class="lineno">  169</span> </div>
<div class="line"><a id="l00170" name="l00170"></a><span class="lineno">  170</span>    <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">q</a> = <a class="code hl_variable" href="FfmpegWriter_8cpp.html#aeb8ae8386f8ee09979a92b7112576aef">samples</a>;</div>
<div class="line"><a id="l00171" name="l00171"></a><span class="lineno">  171</span>    <span class="keywordflow">for</span>(<a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">j</a>=0;<a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">j</a>&lt;<a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">frame_size</a>;<a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">j</a>++) {</div>
<div class="line"><a id="l00172" name="l00172"></a><span class="lineno">  172</span>        v = (<a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">int</a>)(<a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">sin</a>(<a class="code hl_variable" href="FfmpegWriter_8cpp.html#afea36502e9d227ff62c5fb2719a246f2">t</a>) * 10000);</div>
<div class="line"><a id="l00173" name="l00173"></a><span class="lineno">  173</span>        <span class="keywordflow">for</span> (<a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">i</a> = 0; <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">i</a> &lt; <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">nb_channels</a>; <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">i</a>++) {</div>
<div class="line"><a id="l00174" name="l00174"></a><span class="lineno">  174</span>            *<a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">q</a>++ = v;</div>
<div class="line"><a id="l00175" name="l00175"></a><span class="lineno">  175</span>        }</div>
<div class="line"><a id="l00176" name="l00176"></a><span class="lineno">  176</span>        <a class="code hl_variable" href="FfmpegWriter_8cpp.html#afea36502e9d227ff62c5fb2719a246f2">t</a> += <a class="code hl_variable" href="FfmpegWriter_8cpp.html#a2d8bac9bbefeaba3b68329c0d5e476d8">tincr</a>;</div>
<div class="line"><a id="l00177" name="l00177"></a><span class="lineno">  177</span>        <a class="code hl_variable" href="FfmpegWriter_8cpp.html#a2d8bac9bbefeaba3b68329c0d5e476d8">tincr</a> += <a class="code hl_variable" href="FfmpegWriter_8cpp.html#ae3371cbe1ab70a16f1b58241d289ae77">tincr2</a>;</div>
<div class="line"><a id="l00178" name="l00178"></a><span class="lineno">  178</span>    }</div>
<div class="line"><a id="l00179" name="l00179"></a><span class="lineno">  179</span>}</div>
</div>
<div class="line"><a id="l00180" name="l00180"></a><span class="lineno">  180</span> </div>
<div class="foldopen" id="foldopen00181" data-start="{" data-end="}">
<div class="line"><a id="l00181" name="l00181"></a><span class="lineno"><a class="line" href="FfmpegWriter_8cpp.html#a794227adcb14b7543512e648e7b869f6">  181</a></span><span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code hl_function" href="FfmpegWriter_8cpp.html#a794227adcb14b7543512e648e7b869f6">make_audio_frame</a>(<a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">AVCodecContext</a> *<a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">c</a>, <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">AVFrame</a> * &amp;<a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">frame</a>,</div>
<div class="line"><a id="l00182" name="l00182"></a><span class="lineno">  182</span>                             <span class="keywordtype">void</span> *&amp;<a class="code hl_variable" href="FfmpegWriter_8cpp.html#aeb8ae8386f8ee09979a92b7112576aef">samples</a>) {</div>
<div class="line"><a id="l00183" name="l00183"></a><span class="lineno">  183</span>    <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">frame</a> = <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">av_frame_alloc</a>();</div>
<div class="line"><a id="l00184" name="l00184"></a><span class="lineno">  184</span>    <span class="keywordflow">if</span> (!<a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">frame</a>) {</div>
<div class="line"><a id="l00185" name="l00185"></a><span class="lineno">  185</span>        <a class="code hl_define" href="libYARP__os_2src_2yarp_2os_2LogComponent_8h.html#ad0e528d4696fd8f5f0cbac02dd985f44">yCFatal</a>(<a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">FFMPEGWRITER</a>, <span class="stringliteral">&quot;Could not allocate audio frame&quot;</span>);</div>
<div class="line"><a id="l00186" name="l00186"></a><span class="lineno">  186</span>    }</div>
<div class="line"><a id="l00187" name="l00187"></a><span class="lineno">  187</span>    <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">frame</a>-&gt;nb_samples     = <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">c</a>-&gt;frame_size;</div>
<div class="line"><a id="l00188" name="l00188"></a><span class="lineno">  188</span>    <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">frame</a>-&gt;format         = <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">c</a>-&gt;sample_fmt;</div>
<div class="line"><a id="l00189" name="l00189"></a><span class="lineno">  189</span>    <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">frame</a>-&gt;channel_layout = <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">c</a>-&gt;channel_layout;</div>
<div class="line"><a id="l00190" name="l00190"></a><span class="lineno">  190</span>    <span class="keywordtype">int</span> <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">buffer_size</a> = <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">av_samples_get_buffer_size</a>(<span class="keyword">nullptr</span>, <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">c</a>-&gt;channels,</div>
<div class="line"><a id="l00191" name="l00191"></a><span class="lineno">  191</span>                                                 <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">c</a>-&gt;frame_size,</div>
<div class="line"><a id="l00192" name="l00192"></a><span class="lineno">  192</span>                                                 <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">c</a>-&gt;sample_fmt, 0);</div>
<div class="line"><a id="l00193" name="l00193"></a><span class="lineno">  193</span>    <span class="keywordflow">if</span> (<a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">buffer_size</a> &lt; 0) {</div>
<div class="line"><a id="l00194" name="l00194"></a><span class="lineno">  194</span>        <a class="code hl_define" href="libYARP__os_2src_2yarp_2os_2LogComponent_8h.html#a224fd66c5d833ba0367a2ed54bcc279a">yCError</a>(<a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">FFMPEGWRITER</a>, <span class="stringliteral">&quot;Could not get sample buffer size&quot;</span>);</div>
<div class="line"><a id="l00195" name="l00195"></a><span class="lineno">  195</span>    }</div>
<div class="line"><a id="l00196" name="l00196"></a><span class="lineno">  196</span>    <a class="code hl_variable" href="FfmpegWriter_8cpp.html#aeb8ae8386f8ee09979a92b7112576aef">samples</a> = <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">av_malloc</a>(<a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">buffer_size</a>);</div>
<div class="line"><a id="l00197" name="l00197"></a><span class="lineno">  197</span>    <span class="keywordflow">if</span> (!<a class="code hl_variable" href="FfmpegWriter_8cpp.html#aeb8ae8386f8ee09979a92b7112576aef">samples</a>) {</div>
<div class="line"><a id="l00198" name="l00198"></a><span class="lineno">  198</span>        <a class="code hl_define" href="libYARP__os_2src_2yarp_2os_2LogComponent_8h.html#ad0e528d4696fd8f5f0cbac02dd985f44">yCFatal</a>(<a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">FFMPEGWRITER</a>,</div>
<div class="line"><a id="l00199" name="l00199"></a><span class="lineno">  199</span>                <span class="stringliteral">&quot;Could not allocate %d bytes for samples buffer&quot;</span>,</div>
<div class="line"><a id="l00200" name="l00200"></a><span class="lineno">  200</span>                <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">buffer_size</a>);</div>
<div class="line"><a id="l00201" name="l00201"></a><span class="lineno">  201</span>    }</div>
<div class="line"><a id="l00202" name="l00202"></a><span class="lineno">  202</span>    <span class="comment">/* setup the data pointers in the AVFrame */</span></div>
<div class="line"><a id="l00203" name="l00203"></a><span class="lineno">  203</span>    <span class="keywordtype">int</span> <a class="code hl_variable" href="ImplementAxisInfo_8cpp.html#ab295c2135096172ff421e6b33358407d">ret</a> = <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">avcodec_fill_audio_frame</a>(<a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">frame</a>, <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">c</a>-&gt;channels, <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">c</a>-&gt;sample_fmt,</div>
<div class="line"><a id="l00204" name="l00204"></a><span class="lineno">  204</span>                                       (<span class="keyword">const</span> <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">uint8_t</a>*)<a class="code hl_variable" href="FfmpegWriter_8cpp.html#aeb8ae8386f8ee09979a92b7112576aef">samples</a>, <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">buffer_size</a>, 0);</div>
<div class="line"><a id="l00205" name="l00205"></a><span class="lineno">  205</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="ImplementAxisInfo_8cpp.html#ab295c2135096172ff421e6b33358407d">ret</a> &lt; 0) {</div>
<div class="line"><a id="l00206" name="l00206"></a><span class="lineno">  206</span>        <a class="code hl_define" href="libYARP__os_2src_2yarp_2os_2LogComponent_8h.html#ad0e528d4696fd8f5f0cbac02dd985f44">yCFatal</a>(<a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">FFMPEGWRITER</a>, <span class="stringliteral">&quot;Could not setup audio frame&quot;</span>);</div>
<div class="line"><a id="l00207" name="l00207"></a><span class="lineno">  207</span>    }</div>
<div class="line"><a id="l00208" name="l00208"></a><span class="lineno">  208</span>}</div>
</div>
<div class="line"><a id="l00209" name="l00209"></a><span class="lineno">  209</span> </div>
<div class="foldopen" id="foldopen00210" data-start="{" data-end="}">
<div class="line"><a id="l00210" name="l00210"></a><span class="lineno"><a class="line" href="FfmpegWriter_8cpp.html#a4d24a816adffef9dd0d5d8678ee68052">  210</a></span><span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code hl_function" href="FfmpegWriter_8cpp.html#a4d24a816adffef9dd0d5d8678ee68052">write_audio_frame</a>(<a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">AVFormatContext</a> *oc, <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">AVStream</a> *<a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">st</a>)</div>
<div class="line"><a id="l00211" name="l00211"></a><span class="lineno">  211</span>{</div>
<div class="line"><a id="l00212" name="l00212"></a><span class="lineno">  212</span>    <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">AVCodecContext</a> *<a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">c</a>;</div>
<div class="line"><a id="l00213" name="l00213"></a><span class="lineno">  213</span>    <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">AVPacket</a> <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">pkt</a>;</div>
<div class="line"><a id="l00214" name="l00214"></a><span class="lineno">  214</span>    <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">av_init_packet</a>(&amp;<a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">pkt</a>);</div>
<div class="line"><a id="l00215" name="l00215"></a><span class="lineno">  215</span> </div>
<div class="line"><a id="l00216" name="l00216"></a><span class="lineno">  216</span>    <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">c</a> = <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">st</a>-&gt;codec;</div>
<div class="line"><a id="l00217" name="l00217"></a><span class="lineno">  217</span> </div>
<div class="line"><a id="l00218" name="l00218"></a><span class="lineno">  218</span>    <a class="code hl_function" href="FfmpegWriter_8cpp.html#a5405b7dce6394fcc74d94dc9bddf8506">get_audio_frame</a>(<a class="code hl_variable" href="FfmpegWriter_8cpp.html#aeb8ae8386f8ee09979a92b7112576aef">samples</a>, <a class="code hl_variable" href="FfmpegWriter_8cpp.html#a9478438422f8f847e94f43823e2b3811">audio_input_frame_size</a>, <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">c</a>-&gt;channels);</div>
<div class="line"><a id="l00219" name="l00219"></a><span class="lineno">  219</span> </div>
<div class="line"><a id="l00220" name="l00220"></a><span class="lineno">  220</span>    <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">AVFrame</a> *<a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">frame</a>;</div>
<div class="line"><a id="l00221" name="l00221"></a><span class="lineno">  221</span>    <span class="keywordtype">void</span> *<a class="code hl_variable" href="FfmpegWriter_8cpp.html#aeb8ae8386f8ee09979a92b7112576aef">samples</a>;</div>
<div class="line"><a id="l00222" name="l00222"></a><span class="lineno">  222</span>    <a class="code hl_function" href="FfmpegWriter_8cpp.html#a794227adcb14b7543512e648e7b869f6">make_audio_frame</a>(<a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">c</a>,<a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">frame</a>,<a class="code hl_variable" href="FfmpegWriter_8cpp.html#aeb8ae8386f8ee09979a92b7112576aef">samples</a>);</div>
<div class="line"><a id="l00223" name="l00223"></a><span class="lineno">  223</span>    <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">AVPacket</a> <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">tmp</a>;</div>
<div class="line"><a id="l00224" name="l00224"></a><span class="lineno">  224</span>    <span class="keywordtype">int</span> <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">got_packet</a> = 0;</div>
<div class="line"><a id="l00225" name="l00225"></a><span class="lineno">  225</span>    <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">av_init_packet</a>(&amp;<a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">tmp</a>);</div>
<div class="line"><a id="l00226" name="l00226"></a><span class="lineno">  226</span>    <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">tmp</a>.data = <a class="code hl_variable" href="FfmpegWriter_8cpp.html#acabbf8cf98a852edeeeae57244e61eae">audio_outbuf</a>;</div>
<div class="line"><a id="l00227" name="l00227"></a><span class="lineno">  227</span>    <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">tmp</a>.size = <a class="code hl_variable" href="FfmpegWriter_8cpp.html#ab03a5eff2dba5f25bad201cf68d411d0">audio_outbuf_size</a>;</div>
<div class="line"><a id="l00228" name="l00228"></a><span class="lineno">  228</span>    <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">pkt</a>.size = <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">avcodec_encode_audio2</a>(<a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">c</a>, &amp;<a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">tmp</a>, <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">frame</a>, &amp;<a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">got_packet</a>);</div>
<div class="line"><a id="l00229" name="l00229"></a><span class="lineno">  229</span>    <span class="keywordflow">if</span> (<a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">tmp</a>.side_data_elems &gt; 0) {</div>
<div class="line"><a id="l00230" name="l00230"></a><span class="lineno">  230</span>        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">i</a> = 0; <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">i</a> &lt; <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">tmp</a>.side_data_elems; <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">i</a>++) {</div>
<div class="line"><a id="l00231" name="l00231"></a><span class="lineno">  231</span>            <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">av_free</a>(<a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">tmp</a>.side_data[<a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">i</a>].data);</div>
<div class="line"><a id="l00232" name="l00232"></a><span class="lineno">  232</span>        }</div>
<div class="line"><a id="l00233" name="l00233"></a><span class="lineno">  233</span>        <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">av_freep</a>(&amp;<a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">tmp</a>.side_data);</div>
<div class="line"><a id="l00234" name="l00234"></a><span class="lineno">  234</span>        <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">tmp</a>.side_data_elems = 0;</div>
<div class="line"><a id="l00235" name="l00235"></a><span class="lineno">  235</span>    }</div>
<div class="line"><a id="l00236" name="l00236"></a><span class="lineno">  236</span>    <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">av_freep</a>(&amp;<a class="code hl_variable" href="FfmpegWriter_8cpp.html#aeb8ae8386f8ee09979a92b7112576aef">samples</a>);</div>
<div class="line"><a id="l00237" name="l00237"></a><span class="lineno">  237</span>    <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">av_frame_free</a>(&amp;<a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">frame</a>);</div>
<div class="line"><a id="l00238" name="l00238"></a><span class="lineno">  238</span> </div>
<div class="line"><a id="l00239" name="l00239"></a><span class="lineno">  239</span>    <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">pkt</a>.pts= <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">av_rescale_q</a>(<a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">c</a>-&gt;coded_frame-&gt;pts, <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">c</a>-&gt;time_base, <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">st</a>-&gt;time_base);</div>
<div class="line"><a id="l00240" name="l00240"></a><span class="lineno">  240</span>    <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">pkt</a>.flags |= <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">AV_PKT_FLAG_KEY</a>;</div>
<div class="line"><a id="l00241" name="l00241"></a><span class="lineno">  241</span>    <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">pkt</a>.stream_index= <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">st</a>-&gt;index;</div>
<div class="line"><a id="l00242" name="l00242"></a><span class="lineno">  242</span>    <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">pkt</a>.data= <a class="code hl_variable" href="FfmpegWriter_8cpp.html#acabbf8cf98a852edeeeae57244e61eae">audio_outbuf</a>;</div>
<div class="line"><a id="l00243" name="l00243"></a><span class="lineno">  243</span> </div>
<div class="line"><a id="l00244" name="l00244"></a><span class="lineno">  244</span>    <span class="comment">/* write the compressed frame in the media file */</span></div>
<div class="line"><a id="l00245" name="l00245"></a><span class="lineno">  245</span>    <span class="keywordflow">if</span> (<a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">av_write_frame</a>(oc, &amp;<a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">pkt</a>) != 0) {</div>
<div class="line"><a id="l00246" name="l00246"></a><span class="lineno">  246</span>        <a class="code hl_define" href="libYARP__os_2src_2yarp_2os_2LogComponent_8h.html#ad0e528d4696fd8f5f0cbac02dd985f44">yCFatal</a>(<a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">FFMPEGWRITER</a>, <span class="stringliteral">&quot;Error while writing audio frame&quot;</span>);</div>
<div class="line"><a id="l00247" name="l00247"></a><span class="lineno">  247</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l00248" name="l00248"></a><span class="lineno">  248</span>        <a class="code hl_define" href="libYARP__os_2src_2yarp_2os_2LogComponent_8h.html#a18e11e963a9867766b3ac49614348799">yCInfo</a>(<a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">FFMPEGWRITER</a>, <span class="stringliteral">&quot;Wrote some audio&quot;</span>);</div>
<div class="line"><a id="l00249" name="l00249"></a><span class="lineno">  249</span>    }</div>
<div class="line"><a id="l00250" name="l00250"></a><span class="lineno">  250</span>}</div>
</div>
<div class="line"><a id="l00251" name="l00251"></a><span class="lineno">  251</span> </div>
<div class="foldopen" id="foldopen00252" data-start="{" data-end="}">
<div class="line"><a id="l00252" name="l00252"></a><span class="lineno"><a class="line" href="FfmpegWriter_8cpp.html#ad9be1aaf38dbde125c95489f0e2dad92">  252</a></span><span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code hl_function" href="FfmpegWriter_8cpp.html#a4d24a816adffef9dd0d5d8678ee68052">write_audio_frame</a>(<a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">AVFormatContext</a> *oc, <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">AVStream</a> *<a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">st</a>, <a class="code hl_class" href="classyarp_1_1sig_1_1Sound.html">Sound</a>&amp; snd)</div>
<div class="line"><a id="l00253" name="l00253"></a><span class="lineno">  253</span>{</div>
<div class="line"><a id="l00254" name="l00254"></a><span class="lineno">  254</span>    <a class="code hl_define" href="libYARP__os_2src_2yarp_2os_2LogComponent_8h.html#a18e11e963a9867766b3ac49614348799">yCInfo</a>(<a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">FFMPEGWRITER</a>, <span class="stringliteral">&quot;Preparing to write audio (%d left over)&quot;</span>, <a class="code hl_variable" href="FfmpegWriter_8cpp.html#a9bef43aba4bea626b26f0c5845d042cb">samples_at</a>);</div>
<div class="line"><a id="l00255" name="l00255"></a><span class="lineno">  255</span>    <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">AVCodecContext</a> *<a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">c</a>;</div>
<div class="line"><a id="l00256" name="l00256"></a><span class="lineno">  256</span>    <span class="keywordtype">int</span> key = 1;</div>
<div class="line"><a id="l00257" name="l00257"></a><span class="lineno">  257</span> </div>
<div class="line"><a id="l00258" name="l00258"></a><span class="lineno">  258</span>    <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">c</a> = <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">st</a>-&gt;codec;</div>
<div class="line"><a id="l00259" name="l00259"></a><span class="lineno">  259</span> </div>
<div class="line"><a id="l00260" name="l00260"></a><span class="lineno">  260</span>    <span class="keywordtype">size_t</span> at = 0;</div>
<div class="line"><a id="l00261" name="l00261"></a><span class="lineno">  261</span>    <span class="keywordflow">while</span> (at&lt;snd.<a class="code hl_function" href="classyarp_1_1sig_1_1Sound.html#af00f4a88356c305f02dbbd7b3260bed7">getSamples</a>()) {</div>
<div class="line"><a id="l00262" name="l00262"></a><span class="lineno">  262</span> </div>
<div class="line"><a id="l00263" name="l00263"></a><span class="lineno">  263</span>        <span class="keywordtype">int</span> avail = <a class="code hl_variable" href="FfmpegWriter_8cpp.html#a15f51ccf617d5002b146e76a41f6d9d9">samples_size</a> - <a class="code hl_variable" href="FfmpegWriter_8cpp.html#a9bef43aba4bea626b26f0c5845d042cb">samples_at</a>;</div>
<div class="line"><a id="l00264" name="l00264"></a><span class="lineno">  264</span>        <span class="keywordtype">int</span> <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">remain</a> = snd.<a class="code hl_function" href="classyarp_1_1sig_1_1Sound.html#af00f4a88356c305f02dbbd7b3260bed7">getSamples</a>() - at;</div>
<div class="line"><a id="l00265" name="l00265"></a><span class="lineno">  265</span>        <span class="keywordtype">int</span> <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">chan</a> = snd.<a class="code hl_function" href="classyarp_1_1sig_1_1Sound.html#a697819afea84ef8dfef6bd4cb0096c89">getChannels</a>();</div>
<div class="line"><a id="l00266" name="l00266"></a><span class="lineno">  266</span>        <span class="keywordflow">if</span> (<a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">remain</a>&lt;avail) { avail = <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">remain</a>; }</div>
<div class="line"><a id="l00267" name="l00267"></a><span class="lineno">  267</span>        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">i</a>=0; <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">i</a>&lt;avail; <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">i</a>++) {</div>
<div class="line"><a id="l00268" name="l00268"></a><span class="lineno">  268</span>            <span class="keywordtype">int</span> offset = <a class="code hl_variable" href="FfmpegWriter_8cpp.html#a9bef43aba4bea626b26f0c5845d042cb">samples_at</a>*<a class="code hl_variable" href="FfmpegWriter_8cpp.html#aff60fb8719af5ce06ee7034f8d81a735">samples_channels</a>;</div>
<div class="line"><a id="l00269" name="l00269"></a><span class="lineno">  269</span>            <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">j</a>=0; <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">j</a>&lt;<a class="code hl_variable" href="FfmpegWriter_8cpp.html#aff60fb8719af5ce06ee7034f8d81a735">samples_channels</a>; <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">j</a>++) {</div>
<div class="line"><a id="l00270" name="l00270"></a><span class="lineno">  270</span>                <a class="code hl_variable" href="FfmpegWriter_8cpp.html#aeb8ae8386f8ee09979a92b7112576aef">samples</a>[offset+<a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">j</a>] = snd.<a class="code hl_function" href="classyarp_1_1sig_1_1Sound.html#adc724f5ee7175b0ad438a86743338b02">get</a>(at,<a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">j</a>%<a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">chan</a>);</div>
<div class="line"><a id="l00271" name="l00271"></a><span class="lineno">  271</span>            }</div>
<div class="line"><a id="l00272" name="l00272"></a><span class="lineno">  272</span>            <a class="code hl_variable" href="FfmpegWriter_8cpp.html#a9bef43aba4bea626b26f0c5845d042cb">samples_at</a>++;</div>
<div class="line"><a id="l00273" name="l00273"></a><span class="lineno">  273</span>            at++;</div>
<div class="line"><a id="l00274" name="l00274"></a><span class="lineno">  274</span>        }</div>
<div class="line"><a id="l00275" name="l00275"></a><span class="lineno">  275</span>        avail = <a class="code hl_variable" href="FfmpegWriter_8cpp.html#a15f51ccf617d5002b146e76a41f6d9d9">samples_size</a> - <a class="code hl_variable" href="FfmpegWriter_8cpp.html#a9bef43aba4bea626b26f0c5845d042cb">samples_at</a>;</div>
<div class="line"><a id="l00276" name="l00276"></a><span class="lineno">  276</span> </div>
<div class="line"><a id="l00277" name="l00277"></a><span class="lineno">  277</span>        <span class="keywordflow">if</span> (avail==0) {</div>
<div class="line"><a id="l00278" name="l00278"></a><span class="lineno">  278</span>            <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">AVPacket</a> <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">pkt</a>;</div>
<div class="line"><a id="l00279" name="l00279"></a><span class="lineno">  279</span>            <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">av_init_packet</a>(&amp;<a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">pkt</a>);</div>
<div class="line"><a id="l00280" name="l00280"></a><span class="lineno">  280</span> </div>
<div class="line"><a id="l00281" name="l00281"></a><span class="lineno">  281</span> </div>
<div class="line"><a id="l00282" name="l00282"></a><span class="lineno">  282</span>            <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">AVFrame</a> *<a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">frame</a>;</div>
<div class="line"><a id="l00283" name="l00283"></a><span class="lineno">  283</span>            <span class="keywordtype">void</span> *<a class="code hl_variable" href="FfmpegWriter_8cpp.html#aeb8ae8386f8ee09979a92b7112576aef">samples</a>;</div>
<div class="line"><a id="l00284" name="l00284"></a><span class="lineno">  284</span>            <a class="code hl_function" href="FfmpegWriter_8cpp.html#a794227adcb14b7543512e648e7b869f6">make_audio_frame</a>(<a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">c</a>,<a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">frame</a>,<a class="code hl_variable" href="FfmpegWriter_8cpp.html#aeb8ae8386f8ee09979a92b7112576aef">samples</a>);</div>
<div class="line"><a id="l00285" name="l00285"></a><span class="lineno">  285</span>            <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">AVPacket</a> <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">tmp</a>;</div>
<div class="line"><a id="l00286" name="l00286"></a><span class="lineno">  286</span>            <span class="keywordtype">int</span> <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">got_packet</a> = 0;</div>
<div class="line"><a id="l00287" name="l00287"></a><span class="lineno">  287</span>            <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">av_init_packet</a>(&amp;<a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">tmp</a>);</div>
<div class="line"><a id="l00288" name="l00288"></a><span class="lineno">  288</span>            <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">tmp</a>.data = <a class="code hl_variable" href="FfmpegWriter_8cpp.html#acabbf8cf98a852edeeeae57244e61eae">audio_outbuf</a>;</div>
<div class="line"><a id="l00289" name="l00289"></a><span class="lineno">  289</span>            <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">tmp</a>.size = <a class="code hl_variable" href="FfmpegWriter_8cpp.html#ab03a5eff2dba5f25bad201cf68d411d0">audio_outbuf_size</a>;</div>
<div class="line"><a id="l00290" name="l00290"></a><span class="lineno">  290</span>            <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">pkt</a>.size = <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">avcodec_encode_audio2</a>(<a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">c</a>, &amp;<a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">tmp</a>, <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">frame</a>, &amp;<a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">got_packet</a>);</div>
<div class="line"><a id="l00291" name="l00291"></a><span class="lineno">  291</span>            <span class="keywordflow">if</span> (<a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">tmp</a>.side_data_elems &gt; 0) {</div>
<div class="line"><a id="l00292" name="l00292"></a><span class="lineno">  292</span>                <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">i</a> = 0; <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">i</a> &lt; <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">tmp</a>.side_data_elems; <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">i</a>++) {</div>
<div class="line"><a id="l00293" name="l00293"></a><span class="lineno">  293</span>                    <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">av_free</a>(<a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">tmp</a>.side_data[<a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">i</a>].data);</div>
<div class="line"><a id="l00294" name="l00294"></a><span class="lineno">  294</span>                }</div>
<div class="line"><a id="l00295" name="l00295"></a><span class="lineno">  295</span>                <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">av_freep</a>(&amp;<a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">tmp</a>.side_data);</div>
<div class="line"><a id="l00296" name="l00296"></a><span class="lineno">  296</span>                <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">tmp</a>.side_data_elems = 0;</div>
<div class="line"><a id="l00297" name="l00297"></a><span class="lineno">  297</span>            }</div>
<div class="line"><a id="l00298" name="l00298"></a><span class="lineno">  298</span>            <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">av_freep</a>(&amp;<a class="code hl_variable" href="FfmpegWriter_8cpp.html#aeb8ae8386f8ee09979a92b7112576aef">samples</a>);</div>
<div class="line"><a id="l00299" name="l00299"></a><span class="lineno">  299</span>            <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">av_frame_free</a>(&amp;<a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">frame</a>);</div>
<div class="line"><a id="l00300" name="l00300"></a><span class="lineno">  300</span> </div>
<div class="line"><a id="l00301" name="l00301"></a><span class="lineno">  301</span>            <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">pkt</a>.pts= <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">av_rescale_q</a>(<a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">c</a>-&gt;coded_frame-&gt;pts, <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">c</a>-&gt;time_base,</div>
<div class="line"><a id="l00302" name="l00302"></a><span class="lineno">  302</span>                                  <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">st</a>-&gt;time_base);</div>
<div class="line"><a id="l00303" name="l00303"></a><span class="lineno">  303</span>            <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">pkt</a>.dts = <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">pkt</a>.pts;</div>
<div class="line"><a id="l00304" name="l00304"></a><span class="lineno">  304</span>            <a class="code hl_define" href="libYARP__os_2src_2yarp_2os_2LogComponent_8h.html#a3ffb0d629a2cfebb6abdc73e93a11bce">yCTrace</a>(<a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">FFMPEGWRITER</a>, <span class="stringliteral">&quot;(%d)&quot;</span>, <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">pkt</a>.size);</div>
<div class="line"><a id="l00305" name="l00305"></a><span class="lineno">  305</span>            <span class="keywordflow">if</span> (key) {</div>
<div class="line"><a id="l00306" name="l00306"></a><span class="lineno">  306</span>                <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">pkt</a>.flags |= <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">AV_PKT_FLAG_KEY</a>;</div>
<div class="line"><a id="l00307" name="l00307"></a><span class="lineno">  307</span>                key = 0;</div>
<div class="line"><a id="l00308" name="l00308"></a><span class="lineno">  308</span>            }</div>
<div class="line"><a id="l00309" name="l00309"></a><span class="lineno">  309</span>            <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">pkt</a>.stream_index= <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">st</a>-&gt;index;</div>
<div class="line"><a id="l00310" name="l00310"></a><span class="lineno">  310</span>            <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">pkt</a>.data = <a class="code hl_variable" href="FfmpegWriter_8cpp.html#acabbf8cf98a852edeeeae57244e61eae">audio_outbuf</a>;</div>
<div class="line"><a id="l00311" name="l00311"></a><span class="lineno">  311</span>            <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">pkt</a>.duration = 0;</div>
<div class="line"><a id="l00312" name="l00312"></a><span class="lineno">  312</span> </div>
<div class="line"><a id="l00313" name="l00313"></a><span class="lineno">  313</span> </div>
<div class="line"><a id="l00314" name="l00314"></a><span class="lineno">  314</span>            <span class="comment">/* write the compressed frame in the media file */</span></div>
<div class="line"><a id="l00315" name="l00315"></a><span class="lineno">  315</span>            <span class="keywordflow">if</span> (<a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">av_write_frame</a>(oc, &amp;<a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">pkt</a>) != 0) {</div>
<div class="line"><a id="l00316" name="l00316"></a><span class="lineno">  316</span>                <a class="code hl_define" href="libYARP__os_2src_2yarp_2os_2LogComponent_8h.html#ad0e528d4696fd8f5f0cbac02dd985f44">yCFatal</a>(<a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">FFMPEGWRITER</a>, <span class="stringliteral">&quot;Error while writing audio frame&quot;</span>);</div>
<div class="line"><a id="l00317" name="l00317"></a><span class="lineno">  317</span>            }</div>
<div class="line"><a id="l00318" name="l00318"></a><span class="lineno">  318</span>            <a class="code hl_variable" href="FfmpegWriter_8cpp.html#a9bef43aba4bea626b26f0c5845d042cb">samples_at</a> = 0;</div>
<div class="line"><a id="l00319" name="l00319"></a><span class="lineno">  319</span>        }</div>
<div class="line"><a id="l00320" name="l00320"></a><span class="lineno">  320</span>    }</div>
<div class="line"><a id="l00321" name="l00321"></a><span class="lineno">  321</span>    <a class="code hl_define" href="libYARP__os_2src_2yarp_2os_2LogComponent_8h.html#a18e11e963a9867766b3ac49614348799">yCInfo</a>(<a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">FFMPEGWRITER</a>, <span class="stringliteral">&quot; wrote audio\n&quot;</span>);</div>
<div class="line"><a id="l00322" name="l00322"></a><span class="lineno">  322</span>}</div>
</div>
<div class="line"><a id="l00323" name="l00323"></a><span class="lineno">  323</span> </div>
<div class="foldopen" id="foldopen00324" data-start="{" data-end="}">
<div class="line"><a id="l00324" name="l00324"></a><span class="lineno"><a class="line" href="FfmpegWriter_8cpp.html#a5387ca4ff642aa483043500f2cde769f">  324</a></span><span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code hl_function" href="FfmpegWriter_8cpp.html#a5387ca4ff642aa483043500f2cde769f">close_audio</a>(<a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">AVFormatContext</a> *oc, <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">AVStream</a> *<a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">st</a>)</div>
<div class="line"><a id="l00325" name="l00325"></a><span class="lineno">  325</span>{</div>
<div class="line"><a id="l00326" name="l00326"></a><span class="lineno">  326</span>    <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">avcodec_close</a>(<a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">st</a>-&gt;codec);</div>
<div class="line"><a id="l00327" name="l00327"></a><span class="lineno">  327</span> </div>
<div class="line"><a id="l00328" name="l00328"></a><span class="lineno">  328</span>    <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">av_free</a>(<a class="code hl_variable" href="FfmpegWriter_8cpp.html#aeb8ae8386f8ee09979a92b7112576aef">samples</a>);</div>
<div class="line"><a id="l00329" name="l00329"></a><span class="lineno">  329</span>    <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">av_free</a>(<a class="code hl_variable" href="FfmpegWriter_8cpp.html#acabbf8cf98a852edeeeae57244e61eae">audio_outbuf</a>);</div>
<div class="line"><a id="l00330" name="l00330"></a><span class="lineno">  330</span>}</div>
</div>
<div class="line"><a id="l00331" name="l00331"></a><span class="lineno">  331</span> </div>
<div class="line"><a id="l00332" name="l00332"></a><span class="lineno">  332</span><span class="comment">/**************************************************************/</span></div>
<div class="line"><a id="l00333" name="l00333"></a><span class="lineno">  333</span><span class="comment">/* video output */</span></div>
<div class="line"><a id="l00334" name="l00334"></a><span class="lineno">  334</span> </div>
<div class="line"><a id="l00335" name="l00335"></a><span class="lineno">  335</span> </div>
<div class="line"><a id="l00336" name="l00336"></a><span class="lineno">  336</span><span class="comment">/* add a video output stream */</span></div>
<div class="foldopen" id="foldopen00337" data-start="{" data-end="}">
<div class="line"><a id="l00337" name="l00337"></a><span class="lineno"><a class="line" href="FfmpegWriter_8cpp.html#a082c99ec7c6f39ad08579701bf5c6cf0">  337</a></span><span class="keyword">static</span> <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">AVStream</a> *<a class="code hl_function" href="FfmpegWriter_8cpp.html#a082c99ec7c6f39ad08579701bf5c6cf0">add_video_stream</a>(<a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">AVFormatContext</a> *oc, <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">AVCodecID</a> <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">codec_id</a>,</div>
<div class="line"><a id="l00338" name="l00338"></a><span class="lineno">  338</span>                                  <span class="keywordtype">int</span> w, <span class="keywordtype">int</span> h, <span class="keywordtype">int</span> <a class="code hl_variable" href="realsense2Driver_8cpp.html#ac23eab13531d41c0e01f513774011d9b">framerate</a>)</div>
<div class="line"><a id="l00339" name="l00339"></a><span class="lineno">  339</span>{</div>
<div class="line"><a id="l00340" name="l00340"></a><span class="lineno">  340</span>    <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">AVCodecContext</a> *<a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">c</a>;</div>
<div class="line"><a id="l00341" name="l00341"></a><span class="lineno">  341</span>    <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">AVStream</a> *<a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">st</a>;</div>
<div class="line"><a id="l00342" name="l00342"></a><span class="lineno">  342</span> </div>
<div class="line"><a id="l00343" name="l00343"></a><span class="lineno">  343</span>    <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">st</a> = <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">avformat_new_stream</a>(oc, <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">NULL</a>);</div>
<div class="line"><a id="l00344" name="l00344"></a><span class="lineno">  344</span>    <span class="keywordflow">if</span> (!<a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">st</a>) {</div>
<div class="line"><a id="l00345" name="l00345"></a><span class="lineno">  345</span>        <a class="code hl_define" href="libYARP__os_2src_2yarp_2os_2LogComponent_8h.html#ad0e528d4696fd8f5f0cbac02dd985f44">yCFatal</a>(<a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">FFMPEGWRITER</a>, <span class="stringliteral">&quot;Could not alloc stream&quot;</span>);</div>
<div class="line"><a id="l00346" name="l00346"></a><span class="lineno">  346</span>    }</div>
<div class="line"><a id="l00347" name="l00347"></a><span class="lineno">  347</span> </div>
<div class="line"><a id="l00348" name="l00348"></a><span class="lineno">  348</span>    <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">c</a> = <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">st</a>-&gt;codec;</div>
<div class="line"><a id="l00349" name="l00349"></a><span class="lineno">  349</span>    <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">c</a>-&gt;codec_id = <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">codec_id</a>;</div>
<div class="line"><a id="l00350" name="l00350"></a><span class="lineno">  350</span>    <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">c</a>-&gt;codec_type = <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">AVMEDIA_TYPE_VIDEO</a>;</div>
<div class="line"><a id="l00351" name="l00351"></a><span class="lineno">  351</span> </div>
<div class="line"><a id="l00352" name="l00352"></a><span class="lineno">  352</span>    <span class="comment">/* put sample parameters */</span></div>
<div class="line"><a id="l00353" name="l00353"></a><span class="lineno">  353</span>    <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">c</a>-&gt;bit_rate = 400000;</div>
<div class="line"><a id="l00354" name="l00354"></a><span class="lineno">  354</span>    <span class="comment">/* resolution must be a multiple of two */</span></div>
<div class="line"><a id="l00355" name="l00355"></a><span class="lineno">  355</span>    <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">c</a>-&gt;width = w;</div>
<div class="line"><a id="l00356" name="l00356"></a><span class="lineno">  356</span>    <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">c</a>-&gt;height = h;</div>
<div class="line"><a id="l00357" name="l00357"></a><span class="lineno">  357</span>    <span class="comment">/* time base: this is the fundamental unit of time (in seconds) in terms</span></div>
<div class="line"><a id="l00358" name="l00358"></a><span class="lineno">  358</span><span class="comment">       of which frame timestamps are represented. for fixed-fps content,</span></div>
<div class="line"><a id="l00359" name="l00359"></a><span class="lineno">  359</span><span class="comment">       timebase should be 1/framerate and timestamp increments should be</span></div>
<div class="line"><a id="l00360" name="l00360"></a><span class="lineno">  360</span><span class="comment">       identically 1. */</span></div>
<div class="line"><a id="l00361" name="l00361"></a><span class="lineno">  361</span>    <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">c</a>-&gt;time_base.den = <a class="code hl_variable" href="realsense2Driver_8cpp.html#ac23eab13531d41c0e01f513774011d9b">framerate</a>;</div>
<div class="line"><a id="l00362" name="l00362"></a><span class="lineno">  362</span>    <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">c</a>-&gt;time_base.num = 1;</div>
<div class="line"><a id="l00363" name="l00363"></a><span class="lineno">  363</span>    <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">c</a>-&gt;gop_size = 12; <span class="comment">/* emit one intra frame every twelve frames at most */</span></div>
<div class="line"><a id="l00364" name="l00364"></a><span class="lineno">  364</span>    <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">c</a>-&gt;pix_fmt = <a class="code hl_define" href="FfmpegWriter_8cpp.html#ae67b157ab0198fa81bf675b378ff06fd">STREAM_PIX_FMT</a>;</div>
<div class="line"><a id="l00365" name="l00365"></a><span class="lineno">  365</span>    <span class="keywordflow">if</span> (<a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">c</a>-&gt;codec_id == <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">AV_CODEC_ID_MPEG2VIDEO</a>) {</div>
<div class="line"><a id="l00366" name="l00366"></a><span class="lineno">  366</span>        <span class="comment">/* just for testing, we also add B frames */</span></div>
<div class="line"><a id="l00367" name="l00367"></a><span class="lineno">  367</span>        <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">c</a>-&gt;max_b_frames = 2;</div>
<div class="line"><a id="l00368" name="l00368"></a><span class="lineno">  368</span>    }</div>
<div class="line"><a id="l00369" name="l00369"></a><span class="lineno">  369</span>    <span class="keywordflow">if</span> (<a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">c</a>-&gt;codec_id == <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">AV_CODEC_ID_MPEG1VIDEO</a>){</div>
<div class="line"><a id="l00370" name="l00370"></a><span class="lineno">  370</span>        <span class="comment">/* needed to avoid using macroblocks in which some coeffs overflow</span></div>
<div class="line"><a id="l00371" name="l00371"></a><span class="lineno">  371</span><span class="comment">           this doesnt happen with normal video, it just happens here as the</span></div>
<div class="line"><a id="l00372" name="l00372"></a><span class="lineno">  372</span><span class="comment">           motion of the chroma plane doesnt match the luma plane */</span></div>
<div class="line"><a id="l00373" name="l00373"></a><span class="lineno">  373</span>        <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">c</a>-&gt;mb_decision=2;</div>
<div class="line"><a id="l00374" name="l00374"></a><span class="lineno">  374</span>    }</div>
<div class="line"><a id="l00375" name="l00375"></a><span class="lineno">  375</span>    <span class="comment">// some formats want stream headers to be separate</span></div>
<div class="line"><a id="l00376" name="l00376"></a><span class="lineno">  376</span>    <span class="keywordflow">if</span> (!<a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">strcmp</a>(oc-&gt;oformat-&gt;name, <span class="stringliteral">&quot;mp4&quot;</span>) || !<a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">strcmp</a>(oc-&gt;oformat-&gt;name, <span class="stringliteral">&quot;mov&quot;</span>) || !<a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">strcmp</a>(oc-&gt;oformat-&gt;name, <span class="stringliteral">&quot;3gp&quot;</span>)) {</div>
<div class="line"><a id="l00377" name="l00377"></a><span class="lineno">  377</span>        <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">c</a>-&gt;flags |= <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">AV_CODEC_FLAG_GLOBAL_HEADER</a>;</div>
<div class="line"><a id="l00378" name="l00378"></a><span class="lineno">  378</span>    }</div>
<div class="line"><a id="l00379" name="l00379"></a><span class="lineno">  379</span> </div>
<div class="line"><a id="l00380" name="l00380"></a><span class="lineno">  380</span> </div>
<div class="line"><a id="l00381" name="l00381"></a><span class="lineno">  381</span>    <span class="keywordflow">return</span> <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">st</a>;</div>
<div class="line"><a id="l00382" name="l00382"></a><span class="lineno">  382</span>}</div>
</div>
<div class="line"><a id="l00383" name="l00383"></a><span class="lineno">  383</span> </div>
<div class="foldopen" id="foldopen00384" data-start="{" data-end="}">
<div class="line"><a id="l00384" name="l00384"></a><span class="lineno"><a class="line" href="FfmpegWriter_8cpp.html#a12b64e51c00dc7527e8378c5a41f9455">  384</a></span><span class="keyword">static</span> <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">AVFrame</a> *<a class="code hl_function" href="FfmpegWriter_8cpp.html#a12b64e51c00dc7527e8378c5a41f9455">alloc_picture</a>(<span class="keywordtype">int</span> <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">pix_fmt</a>, <span class="keywordtype">int</span> width, <span class="keywordtype">int</span> height)</div>
<div class="line"><a id="l00385" name="l00385"></a><span class="lineno">  385</span>{</div>
<div class="line"><a id="l00386" name="l00386"></a><span class="lineno">  386</span>    <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">AVFrame</a> *picture;</div>
<div class="line"><a id="l00387" name="l00387"></a><span class="lineno">  387</span>    <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">uint8_t</a> *<a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">picture_buf</a>;</div>
<div class="line"><a id="l00388" name="l00388"></a><span class="lineno">  388</span>    <span class="keywordtype">int</span> size;</div>
<div class="line"><a id="l00389" name="l00389"></a><span class="lineno">  389</span> </div>
<div class="line"><a id="l00390" name="l00390"></a><span class="lineno">  390</span>    picture = <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">av_frame_alloc</a>();</div>
<div class="line"><a id="l00391" name="l00391"></a><span class="lineno">  391</span>    <span class="keywordflow">if</span> (!picture) {</div>
<div class="line"><a id="l00392" name="l00392"></a><span class="lineno">  392</span>        <span class="keywordflow">return</span> <span class="keyword">nullptr</span>;</div>
<div class="line"><a id="l00393" name="l00393"></a><span class="lineno">  393</span>    }</div>
<div class="line"><a id="l00394" name="l00394"></a><span class="lineno">  394</span>    size = <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">avpicture_get_size</a>((<a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">AVPixelFormat</a>)<a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">pix_fmt</a>, width, height);</div>
<div class="line"><a id="l00395" name="l00395"></a><span class="lineno">  395</span>    <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">picture_buf</a> = (<a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">uint8_t</a>*)<a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">av_malloc</a>(size);</div>
<div class="line"><a id="l00396" name="l00396"></a><span class="lineno">  396</span>    <span class="keywordflow">if</span> (!<a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">picture_buf</a>) {</div>
<div class="line"><a id="l00397" name="l00397"></a><span class="lineno">  397</span>        <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">av_free</a>(picture);</div>
<div class="line"><a id="l00398" name="l00398"></a><span class="lineno">  398</span>        <span class="keywordflow">return</span> <span class="keyword">nullptr</span>;</div>
<div class="line"><a id="l00399" name="l00399"></a><span class="lineno">  399</span>    }</div>
<div class="line"><a id="l00400" name="l00400"></a><span class="lineno">  400</span>    <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">avpicture_fill</a>((<a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">AVPicture</a> *)picture, <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">picture_buf</a>,</div>
<div class="line"><a id="l00401" name="l00401"></a><span class="lineno">  401</span>                   (<a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">AVPixelFormat</a>)<a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">pix_fmt</a>, width, height);</div>
<div class="line"><a id="l00402" name="l00402"></a><span class="lineno">  402</span>    <span class="keywordflow">return</span> picture;</div>
<div class="line"><a id="l00403" name="l00403"></a><span class="lineno">  403</span>}</div>
</div>
<div class="line"><a id="l00404" name="l00404"></a><span class="lineno">  404</span> </div>
<div class="line"><a id="l00405" name="l00405"></a><span class="lineno">  405</span><span class="keywordtype">void</span> FfmpegWriter::open_video(<a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">AVFormatContext</a> *oc, <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">AVStream</a> *<a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">st</a>)</div>
<div class="line"><a id="l00406" name="l00406"></a><span class="lineno">  406</span>{</div>
<div class="line"><a id="l00407" name="l00407"></a><span class="lineno">  407</span>    <a class="code hl_define" href="libYARP__os_2src_2yarp_2os_2LogComponent_8h.html#a18e11e963a9867766b3ac49614348799">yCInfo</a>(<a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">FFMPEGWRITER</a>, <span class="stringliteral">&quot;Opening video stream&quot;</span>);</div>
<div class="line"><a id="l00408" name="l00408"></a><span class="lineno">  408</span>    <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">AVCodec</a> *codec;</div>
<div class="line"><a id="l00409" name="l00409"></a><span class="lineno">  409</span>    <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">AVCodecContext</a> *<a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">c</a>;</div>
<div class="line"><a id="l00410" name="l00410"></a><span class="lineno">  410</span> </div>
<div class="line"><a id="l00411" name="l00411"></a><span class="lineno">  411</span>    <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">c</a> = <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">st</a>-&gt;codec;</div>
<div class="line"><a id="l00412" name="l00412"></a><span class="lineno">  412</span> </div>
<div class="line"><a id="l00413" name="l00413"></a><span class="lineno">  413</span>    <span class="comment">/* find the video encoder */</span></div>
<div class="line"><a id="l00414" name="l00414"></a><span class="lineno">  414</span>    codec = <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">avcodec_find_encoder</a>(<a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">c</a>-&gt;codec_id);</div>
<div class="line"><a id="l00415" name="l00415"></a><span class="lineno">  415</span>    <span class="keywordflow">if</span> (!codec) {</div>
<div class="line"><a id="l00416" name="l00416"></a><span class="lineno">  416</span>        <a class="code hl_define" href="libYARP__os_2src_2yarp_2os_2LogComponent_8h.html#ad0e528d4696fd8f5f0cbac02dd985f44">yCFatal</a>(<a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">FFMPEGWRITER</a>, <span class="stringliteral">&quot;Video codec not found&quot;</span>);</div>
<div class="line"><a id="l00417" name="l00417"></a><span class="lineno">  417</span>    }</div>
<div class="line"><a id="l00418" name="l00418"></a><span class="lineno">  418</span> </div>
<div class="line"><a id="l00419" name="l00419"></a><span class="lineno">  419</span>    <span class="comment">/* open the codec */</span></div>
<div class="line"><a id="l00420" name="l00420"></a><span class="lineno">  420</span>    <span class="keywordflow">if</span> (<a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">avcodec_open2</a>(<a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">c</a>, codec, <span class="keyword">nullptr</span>) &lt; 0) {</div>
<div class="line"><a id="l00421" name="l00421"></a><span class="lineno">  421</span>        <a class="code hl_define" href="libYARP__os_2src_2yarp_2os_2LogComponent_8h.html#ad0e528d4696fd8f5f0cbac02dd985f44">yCFatal</a>(<a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">FFMPEGWRITER</a>, <span class="stringliteral">&quot;Could not open codec&quot;</span>);</div>
<div class="line"><a id="l00422" name="l00422"></a><span class="lineno">  422</span>    }</div>
<div class="line"><a id="l00423" name="l00423"></a><span class="lineno">  423</span> </div>
<div class="line"><a id="l00424" name="l00424"></a><span class="lineno">  424</span>    video_outbuf = <span class="keyword">nullptr</span>;</div>
<div class="line"><a id="l00425" name="l00425"></a><span class="lineno">  425</span>    <span class="comment">/* allocate output buffer */</span></div>
<div class="line"><a id="l00426" name="l00426"></a><span class="lineno">  426</span>    <span class="comment">/* XXX: API change will be done */</span></div>
<div class="line"><a id="l00427" name="l00427"></a><span class="lineno">  427</span>    <span class="comment">/* buffers passed into lav* can be allocated any way you prefer,</span></div>
<div class="line"><a id="l00428" name="l00428"></a><span class="lineno">  428</span><span class="comment">       as long as they&#39;re aligned enough for the architecture, and</span></div>
<div class="line"><a id="l00429" name="l00429"></a><span class="lineno">  429</span><span class="comment">       they&#39;re freed appropriately (such as using av_free for buffers</span></div>
<div class="line"><a id="l00430" name="l00430"></a><span class="lineno">  430</span><span class="comment">       allocated with av_malloc) */</span></div>
<div class="line"><a id="l00431" name="l00431"></a><span class="lineno">  431</span>    video_outbuf_size = 200000;</div>
<div class="line"><a id="l00432" name="l00432"></a><span class="lineno">  432</span>    video_outbuf = (<a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">uint8_t</a>*)<a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">av_malloc</a>(video_outbuf_size);</div>
<div class="line"><a id="l00433" name="l00433"></a><span class="lineno">  433</span> </div>
<div class="line"><a id="l00434" name="l00434"></a><span class="lineno">  434</span>    <span class="comment">/* allocate the encoded raw picture */</span></div>
<div class="line"><a id="l00435" name="l00435"></a><span class="lineno">  435</span>    picture = <a class="code hl_function" href="FfmpegWriter_8cpp.html#a12b64e51c00dc7527e8378c5a41f9455">alloc_picture</a>(<a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">c</a>-&gt;pix_fmt, <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">c</a>-&gt;width, <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">c</a>-&gt;height);</div>
<div class="line"><a id="l00436" name="l00436"></a><span class="lineno">  436</span>    <span class="keywordflow">if</span> (!picture) {</div>
<div class="line"><a id="l00437" name="l00437"></a><span class="lineno">  437</span>        <a class="code hl_define" href="libYARP__os_2src_2yarp_2os_2LogComponent_8h.html#ad0e528d4696fd8f5f0cbac02dd985f44">yCFatal</a>(<a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">FFMPEGWRITER</a>, <span class="stringliteral">&quot;Could not allocate picture&quot;</span>);</div>
<div class="line"><a id="l00438" name="l00438"></a><span class="lineno">  438</span>    }</div>
<div class="line"><a id="l00439" name="l00439"></a><span class="lineno">  439</span> </div>
<div class="line"><a id="l00440" name="l00440"></a><span class="lineno">  440</span>    <span class="comment">/* if the output format is not YUV420P, then a temporary YUV420P</span></div>
<div class="line"><a id="l00441" name="l00441"></a><span class="lineno">  441</span><span class="comment">       picture is needed too. It is then converted to the required</span></div>
<div class="line"><a id="l00442" name="l00442"></a><span class="lineno">  442</span><span class="comment">       output format */</span></div>
<div class="line"><a id="l00443" name="l00443"></a><span class="lineno">  443</span>    tmp_picture = <span class="keyword">nullptr</span>;</div>
<div class="line"><a id="l00444" name="l00444"></a><span class="lineno">  444</span>    <span class="keywordflow">if</span> (<a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">c</a>-&gt;pix_fmt != <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">AV_PIX_FMT_RGB24</a>) {</div>
<div class="line"><a id="l00445" name="l00445"></a><span class="lineno">  445</span>        tmp_picture = <a class="code hl_function" href="FfmpegWriter_8cpp.html#a12b64e51c00dc7527e8378c5a41f9455">alloc_picture</a>(<a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">AV_PIX_FMT_RGB24</a>, <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">c</a>-&gt;width, <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">c</a>-&gt;height);</div>
<div class="line"><a id="l00446" name="l00446"></a><span class="lineno">  446</span>        <span class="keywordflow">if</span> (!tmp_picture) {</div>
<div class="line"><a id="l00447" name="l00447"></a><span class="lineno">  447</span>            <a class="code hl_define" href="libYARP__os_2src_2yarp_2os_2LogComponent_8h.html#ad0e528d4696fd8f5f0cbac02dd985f44">yCFatal</a>(<a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">FFMPEGWRITER</a>, <span class="stringliteral">&quot;Could not allocate temporary picture&quot;</span>);</div>
<div class="line"><a id="l00448" name="l00448"></a><span class="lineno">  448</span>        }</div>
<div class="line"><a id="l00449" name="l00449"></a><span class="lineno">  449</span>    }</div>
<div class="line"><a id="l00450" name="l00450"></a><span class="lineno">  450</span>}</div>
<div class="line"><a id="l00451" name="l00451"></a><span class="lineno">  451</span> </div>
<div class="foldopen" id="foldopen00452" data-start="{" data-end="}">
<div class="line"><a id="l00452" name="l00452"></a><span class="lineno"><a class="line" href="FfmpegWriter_8cpp.html#aa3adc71a1d59d604c491799d81309dce">  452</a></span><span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code hl_function" href="FfmpegWriter_8cpp.html#aa3adc71a1d59d604c491799d81309dce">fill_rgb_image</a>(<a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">AVFrame</a> *<a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">pict</a>, <span class="keywordtype">int</span> <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">frame_index</a>, <span class="keywordtype">int</span> width,</div>
<div class="line"><a id="l00453" name="l00453"></a><span class="lineno">  453</span>                           <span class="keywordtype">int</span> height, <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">ImageOf&lt;PixelRgb&gt;</a>&amp; img)</div>
<div class="line"><a id="l00454" name="l00454"></a><span class="lineno">  454</span>{</div>
<div class="line"><a id="l00455" name="l00455"></a><span class="lineno">  455</span>    <span class="keywordtype">int</span> x, y;</div>
<div class="line"><a id="l00456" name="l00456"></a><span class="lineno">  456</span> </div>
<div class="line"><a id="l00457" name="l00457"></a><span class="lineno">  457</span>    <span class="keywordflow">for</span>(y=0;y&lt;height;y++) {</div>
<div class="line"><a id="l00458" name="l00458"></a><span class="lineno">  458</span>        <span class="keywordflow">for</span>(x=0;x&lt;width;x++) {</div>
<div class="line"><a id="l00459" name="l00459"></a><span class="lineno">  459</span>            <span class="keywordtype">int</span> base = y*(width*3);</div>
<div class="line"><a id="l00460" name="l00460"></a><span class="lineno">  460</span>            <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">pict</a>-&gt;data[0][base + x*3] = img.safePixel(x,y).r;</div>
<div class="line"><a id="l00461" name="l00461"></a><span class="lineno">  461</span>            <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">pict</a>-&gt;data[0][base +x*3+1] = img.safePixel(x,y).g;</div>
<div class="line"><a id="l00462" name="l00462"></a><span class="lineno">  462</span>            <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">pict</a>-&gt;data[0][base +x*3+2] = img.safePixel(x,y).b;</div>
<div class="line"><a id="l00463" name="l00463"></a><span class="lineno">  463</span>        }</div>
<div class="line"><a id="l00464" name="l00464"></a><span class="lineno">  464</span>    }</div>
<div class="line"><a id="l00465" name="l00465"></a><span class="lineno">  465</span>}</div>
</div>
<div class="line"><a id="l00466" name="l00466"></a><span class="lineno">  466</span> </div>
<div class="line"><a id="l00467" name="l00467"></a><span class="lineno">  467</span> </div>
<div class="line"><a id="l00468" name="l00468"></a><span class="lineno">  468</span><span class="keywordtype">void</span> FfmpegWriter::write_video_frame(<a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">AVFormatContext</a> *oc, <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">AVStream</a> *<a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">st</a>,</div>
<div class="line"><a id="l00469" name="l00469"></a><span class="lineno">  469</span>                                     <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">ImageOf&lt;PixelRgb&gt;</a>&amp; img)</div>
<div class="line"><a id="l00470" name="l00470"></a><span class="lineno">  470</span>{</div>
<div class="line"><a id="l00471" name="l00471"></a><span class="lineno">  471</span>    <span class="keywordtype">int</span> <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">out_size</a>, <a class="code hl_variable" href="ImplementAxisInfo_8cpp.html#ab295c2135096172ff421e6b33358407d">ret</a>;</div>
<div class="line"><a id="l00472" name="l00472"></a><span class="lineno">  472</span>    <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">AVCodecContext</a> *<a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">c</a>;</div>
<div class="line"><a id="l00473" name="l00473"></a><span class="lineno">  473</span> </div>
<div class="line"><a id="l00474" name="l00474"></a><span class="lineno">  474</span>    <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">c</a> = <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">st</a>-&gt;codec;</div>
<div class="line"><a id="l00475" name="l00475"></a><span class="lineno">  475</span> </div>
<div class="line"><a id="l00476" name="l00476"></a><span class="lineno">  476</span>    <span class="keywordflow">if</span> (<a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">c</a>-&gt;pix_fmt != <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">AV_PIX_FMT_RGB24</a>) {</div>
<div class="line"><a id="l00477" name="l00477"></a><span class="lineno">  477</span>        <a class="code hl_function" href="FfmpegWriter_8cpp.html#aa3adc71a1d59d604c491799d81309dce">fill_rgb_image</a>(tmp_picture, frame_count, <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">c</a>-&gt;width, <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">c</a>-&gt;height, img);</div>
<div class="line"><a id="l00478" name="l00478"></a><span class="lineno">  478</span>        <a class="code hl_function" href="ffmpeg__api_8cpp.html#a20aa5b1f8047b8791323b2d3360a6770">stable_img_convert</a>((<a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">AVPicture</a> *)picture, <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">c</a>-&gt;pix_fmt,</div>
<div class="line"><a id="l00479" name="l00479"></a><span class="lineno">  479</span>                           (<a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">AVPicture</a> *)tmp_picture, <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">AV_PIX_FMT_RGB24</a>,</div>
<div class="line"><a id="l00480" name="l00480"></a><span class="lineno">  480</span>                           <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">c</a>-&gt;width, <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">c</a>-&gt;height);</div>
<div class="line"><a id="l00481" name="l00481"></a><span class="lineno">  481</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l00482" name="l00482"></a><span class="lineno">  482</span>        <a class="code hl_function" href="FfmpegWriter_8cpp.html#aa3adc71a1d59d604c491799d81309dce">fill_rgb_image</a>(picture, frame_count, <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">c</a>-&gt;width, <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">c</a>-&gt;height, img);</div>
<div class="line"><a id="l00483" name="l00483"></a><span class="lineno">  483</span>    }</div>
<div class="line"><a id="l00484" name="l00484"></a><span class="lineno">  484</span> </div>
<div class="line"><a id="l00485" name="l00485"></a><span class="lineno">  485</span>    <span class="comment">/* encode the image */</span></div>
<div class="line"><a id="l00486" name="l00486"></a><span class="lineno">  486</span>    <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">AVPacket</a> <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">tmp</a>;</div>
<div class="line"><a id="l00487" name="l00487"></a><span class="lineno">  487</span>    <span class="keywordtype">int</span> <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">got_packet</a> = 0;</div>
<div class="line"><a id="l00488" name="l00488"></a><span class="lineno">  488</span>    <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">av_init_packet</a>(&amp;<a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">tmp</a>);</div>
<div class="line"><a id="l00489" name="l00489"></a><span class="lineno">  489</span>    <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">tmp</a>.data = video_outbuf;</div>
<div class="line"><a id="l00490" name="l00490"></a><span class="lineno">  490</span>    <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">tmp</a>.size = video_outbuf_size;</div>
<div class="line"><a id="l00491" name="l00491"></a><span class="lineno">  491</span>    <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">out_size</a> = <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">avcodec_encode_video2</a>(<a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">c</a>, &amp;<a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">tmp</a>, picture, &amp;<a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">got_packet</a>);</div>
<div class="line"><a id="l00492" name="l00492"></a><span class="lineno">  492</span>    <span class="keywordflow">if</span> (<a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">tmp</a>.side_data_elems &gt; 0) {</div>
<div class="line"><a id="l00493" name="l00493"></a><span class="lineno">  493</span>        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">i</a> = 0; <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">i</a> &lt; <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">tmp</a>.side_data_elems; <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">i</a>++) {</div>
<div class="line"><a id="l00494" name="l00494"></a><span class="lineno">  494</span>                <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">av_free</a>(<a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">tmp</a>.side_data[<a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">i</a>].data);</div>
<div class="line"><a id="l00495" name="l00495"></a><span class="lineno">  495</span>        }</div>
<div class="line"><a id="l00496" name="l00496"></a><span class="lineno">  496</span>        <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">av_freep</a>(&amp;<a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">tmp</a>.side_data);</div>
<div class="line"><a id="l00497" name="l00497"></a><span class="lineno">  497</span>        <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">tmp</a>.side_data_elems = 0;</div>
<div class="line"><a id="l00498" name="l00498"></a><span class="lineno">  498</span>    }</div>
<div class="line"><a id="l00499" name="l00499"></a><span class="lineno">  499</span>    <span class="comment">/* if zero size, it means the image was buffered */</span></div>
<div class="line"><a id="l00500" name="l00500"></a><span class="lineno">  500</span>    <span class="keywordflow">if</span> (<a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">out_size</a> &gt; 0) {</div>
<div class="line"><a id="l00501" name="l00501"></a><span class="lineno">  501</span>        <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">AVPacket</a> <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">pkt</a>;</div>
<div class="line"><a id="l00502" name="l00502"></a><span class="lineno">  502</span>        <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">av_init_packet</a>(&amp;<a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">pkt</a>);</div>
<div class="line"><a id="l00503" name="l00503"></a><span class="lineno">  503</span> </div>
<div class="line"><a id="l00504" name="l00504"></a><span class="lineno">  504</span>        <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">pkt</a>.pts= <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">av_rescale_q</a>(<a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">c</a>-&gt;coded_frame-&gt;pts, <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">c</a>-&gt;time_base, <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">st</a>-&gt;time_base);</div>
<div class="line"><a id="l00505" name="l00505"></a><span class="lineno">  505</span>        <span class="keywordflow">if</span> (<a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">c</a>-&gt;coded_frame-&gt;key_frame) {</div>
<div class="line"><a id="l00506" name="l00506"></a><span class="lineno">  506</span>            <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">pkt</a>.flags |= <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">AV_PKT_FLAG_KEY</a>;</div>
<div class="line"><a id="l00507" name="l00507"></a><span class="lineno">  507</span>        }</div>
<div class="line"><a id="l00508" name="l00508"></a><span class="lineno">  508</span>        <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">pkt</a>.stream_index= <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">st</a>-&gt;index;</div>
<div class="line"><a id="l00509" name="l00509"></a><span class="lineno">  509</span>        <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">pkt</a>.data= video_outbuf;</div>
<div class="line"><a id="l00510" name="l00510"></a><span class="lineno">  510</span>        <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">pkt</a>.size= <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">out_size</a>;</div>
<div class="line"><a id="l00511" name="l00511"></a><span class="lineno">  511</span> </div>
<div class="line"><a id="l00512" name="l00512"></a><span class="lineno">  512</span>        <span class="comment">/*</span></div>
<div class="line"><a id="l00513" name="l00513"></a><span class="lineno">  513</span><span class="comment">        static int x = 0;</span></div>
<div class="line"><a id="l00514" name="l00514"></a><span class="lineno">  514</span><span class="comment">        yCInfo(FFMPEGWRITER,</span></div>
<div class="line"><a id="l00515" name="l00515"></a><span class="lineno">  515</span><span class="comment">               &quot;%ld / %ld  :  %ld / %ld  --&gt; %d\n&quot;,</span></div>
<div class="line"><a id="l00516" name="l00516"></a><span class="lineno">  516</span><span class="comment">               (long int) c-&gt;time_base.num,</span></div>
<div class="line"><a id="l00517" name="l00517"></a><span class="lineno">  517</span><span class="comment">               (long int) c-&gt;time_base.den,</span></div>
<div class="line"><a id="l00518" name="l00518"></a><span class="lineno">  518</span><span class="comment">               (long int) st-&gt;time_base.num,</span></div>
<div class="line"><a id="l00519" name="l00519"></a><span class="lineno">  519</span><span class="comment">               (long int) st-&gt;time_base.den,</span></div>
<div class="line"><a id="l00520" name="l00520"></a><span class="lineno">  520</span><span class="comment">               x);</span></div>
<div class="line"><a id="l00521" name="l00521"></a><span class="lineno">  521</span><span class="comment">        pkt.pts = x;</span></div>
<div class="line"><a id="l00522" name="l00522"></a><span class="lineno">  522</span><span class="comment">        x++;</span></div>
<div class="line"><a id="l00523" name="l00523"></a><span class="lineno">  523</span><span class="comment">        */</span></div>
<div class="line"><a id="l00524" name="l00524"></a><span class="lineno">  524</span> </div>
<div class="line"><a id="l00525" name="l00525"></a><span class="lineno">  525</span>        <span class="comment">/* write the compressed frame in the media file */</span></div>
<div class="line"><a id="l00526" name="l00526"></a><span class="lineno">  526</span>        <a class="code hl_variable" href="ImplementAxisInfo_8cpp.html#ab295c2135096172ff421e6b33358407d">ret</a> = <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">av_write_frame</a>(oc, &amp;<a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">pkt</a>);</div>
<div class="line"><a id="l00527" name="l00527"></a><span class="lineno">  527</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l00528" name="l00528"></a><span class="lineno">  528</span>        <a class="code hl_variable" href="ImplementAxisInfo_8cpp.html#ab295c2135096172ff421e6b33358407d">ret</a> = 0;</div>
<div class="line"><a id="l00529" name="l00529"></a><span class="lineno">  529</span>    }</div>
<div class="line"><a id="l00530" name="l00530"></a><span class="lineno">  530</span> </div>
<div class="line"><a id="l00531" name="l00531"></a><span class="lineno">  531</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="ImplementAxisInfo_8cpp.html#ab295c2135096172ff421e6b33358407d">ret</a> != 0) {</div>
<div class="line"><a id="l00532" name="l00532"></a><span class="lineno">  532</span>        <a class="code hl_define" href="libYARP__os_2src_2yarp_2os_2LogComponent_8h.html#ad0e528d4696fd8f5f0cbac02dd985f44">yCFatal</a>(<a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">FFMPEGWRITER</a>, <span class="stringliteral">&quot;Error while writing video frame&quot;</span>);</div>
<div class="line"><a id="l00533" name="l00533"></a><span class="lineno">  533</span>    }</div>
<div class="line"><a id="l00534" name="l00534"></a><span class="lineno">  534</span>    frame_count++;</div>
<div class="line"><a id="l00535" name="l00535"></a><span class="lineno">  535</span>}</div>
<div class="line"><a id="l00536" name="l00536"></a><span class="lineno">  536</span> </div>
<div class="line"><a id="l00537" name="l00537"></a><span class="lineno">  537</span><span class="keywordtype">void</span> FfmpegWriter::close_video(<a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">AVFormatContext</a> *oc, <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">AVStream</a> *<a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">st</a>)</div>
<div class="line"><a id="l00538" name="l00538"></a><span class="lineno">  538</span>{</div>
<div class="line"><a id="l00539" name="l00539"></a><span class="lineno">  539</span>    <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">avcodec_close</a>(<a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">st</a>-&gt;codec);</div>
<div class="line"><a id="l00540" name="l00540"></a><span class="lineno">  540</span>    <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">av_free</a>(picture-&gt;data[0]);</div>
<div class="line"><a id="l00541" name="l00541"></a><span class="lineno">  541</span>    <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">av_free</a>(picture);</div>
<div class="line"><a id="l00542" name="l00542"></a><span class="lineno">  542</span>    <span class="keywordflow">if</span> (tmp_picture) {</div>
<div class="line"><a id="l00543" name="l00543"></a><span class="lineno">  543</span>        <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">av_free</a>(tmp_picture-&gt;data[0]);</div>
<div class="line"><a id="l00544" name="l00544"></a><span class="lineno">  544</span>        <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">av_free</a>(tmp_picture);</div>
<div class="line"><a id="l00545" name="l00545"></a><span class="lineno">  545</span>    }</div>
<div class="line"><a id="l00546" name="l00546"></a><span class="lineno">  546</span>    <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">av_free</a>(video_outbuf);</div>
<div class="line"><a id="l00547" name="l00547"></a><span class="lineno">  547</span>}</div>
<div class="line"><a id="l00548" name="l00548"></a><span class="lineno">  548</span> </div>
<div class="line"><a id="l00549" name="l00549"></a><span class="lineno">  549</span> </div>
<div class="line"><a id="l00550" name="l00550"></a><span class="lineno">  550</span> </div>
<div class="line"><a id="l00551" name="l00551"></a><span class="lineno">  551</span> </div>
<div class="line"><a id="l00552" name="l00552"></a><span class="lineno">  552</span><span class="comment">/**************************************************************/</span></div>
<div class="line"><a id="l00553" name="l00553"></a><span class="lineno">  553</span><span class="comment">/* YARP adaptation */</span></div>
<div class="line"><a id="l00554" name="l00554"></a><span class="lineno">  554</span> </div>
<div class="foldopen" id="foldopen00555" data-start="{" data-end="}">
<div class="line"><a id="l00555" name="l00555"></a><span class="lineno"><a class="line" href="classFfmpegWriter.html#a15aa0c5ee459c3a49d3bc0ce6d848387">  555</a></span><span class="keywordtype">bool</span> <a class="code hl_function" href="classFfmpegWriter.html#a15aa0c5ee459c3a49d3bc0ce6d848387">FfmpegWriter::open</a>(<a class="code hl_class" href="classyarp_1_1os_1_1Searchable.html">yarp::os::Searchable</a> &amp; config) {</div>
<div class="line"><a id="l00556" name="l00556"></a><span class="lineno">  556</span>    <a class="code hl_define" href="libYARP__os_2src_2yarp_2os_2LogComponent_8h.html#a3ffb0d629a2cfebb6abdc73e93a11bce">yCTrace</a>(<a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">FFMPEGWRITER</a>,</div>
<div class="line"><a id="l00557" name="l00557"></a><span class="lineno">  557</span>            <span class="stringliteral">&quot;ffmpeg libavcodec version number %d.%d.%d&quot;</span>,</div>
<div class="line"><a id="l00558" name="l00558"></a><span class="lineno">  558</span>            <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">LIBAVCODEC_VERSION_MAJOR</a>,</div>
<div class="line"><a id="l00559" name="l00559"></a><span class="lineno">  559</span>            <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">LIBAVCODEC_VERSION_MINOR</a>,</div>
<div class="line"><a id="l00560" name="l00560"></a><span class="lineno">  560</span>            <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">LIBAVCODEC_VERSION_MICRO</a>);</div>
<div class="line"><a id="l00561" name="l00561"></a><span class="lineno">  561</span> </div>
<div class="line"><a id="l00562" name="l00562"></a><span class="lineno">  562</span>    <span class="keywordflow">if</span> (!this-&gt;<a class="code hl_function" href="classFfmpegWriter__ParamsParser.html#a668722dc5ee43e2fc42fb4d00684e8f3">parseParams</a>(config)) { <span class="keywordflow">return</span> <span class="keyword">false</span>; }</div>
<div class="line"><a id="l00563" name="l00563"></a><span class="lineno">  563</span> </div>
<div class="line"><a id="l00564" name="l00564"></a><span class="lineno">  564</span>    ready = <span class="keyword">false</span>;</div>
<div class="line"><a id="l00565" name="l00565"></a><span class="lineno">  565</span>    savedConfig.<a class="code hl_function" href="classyarp_1_1os_1_1Property.html#a0b938dbb6cf9e92a845cb18509865c62">fromString</a>(config.<a class="code hl_function" href="classyarp_1_1os_1_1Searchable.html#aa8e76c64a9251dc4485022aa7140d150">toString</a>());</div>
<div class="line"><a id="l00566" name="l00566"></a><span class="lineno">  566</span> </div>
<div class="line"><a id="l00567" name="l00567"></a><span class="lineno">  567</span>    <span class="comment">// open if possible, if not will do it later</span></div>
<div class="line"><a id="l00568" name="l00568"></a><span class="lineno">  568</span>    <span class="keywordflow">return</span> delayedOpen(config);</div>
<div class="line"><a id="l00569" name="l00569"></a><span class="lineno">  569</span>}</div>
</div>
<div class="line"><a id="l00570" name="l00570"></a><span class="lineno">  570</span> </div>
<div class="line"><a id="l00571" name="l00571"></a><span class="lineno">  571</span> </div>
<div class="line"><a id="l00572" name="l00572"></a><span class="lineno">  572</span><span class="keywordtype">bool</span> FfmpegWriter::delayedOpen(<a class="code hl_class" href="classyarp_1_1os_1_1Searchable.html">yarp::os::Searchable</a> &amp; config) {</div>
<div class="line"><a id="l00573" name="l00573"></a><span class="lineno">  573</span>    <a class="code hl_define" href="libYARP__os_2src_2yarp_2os_2LogComponent_8h.html#a3ffb0d629a2cfebb6abdc73e93a11bce">yCTrace</a>(<a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">FFMPEGWRITER</a>, <span class="stringliteral">&quot;DELAYED OPEN %s&quot;</span>, config.<a class="code hl_function" href="classyarp_1_1os_1_1Searchable.html#aa8e76c64a9251dc4485022aa7140d150">toString</a>().c_str());</div>
<div class="line"><a id="l00574" name="l00574"></a><span class="lineno">  574</span> </div>
<div class="line"><a id="l00575" name="l00575"></a><span class="lineno">  575</span>    delayed = <span class="keyword">false</span>;</div>
<div class="line"><a id="l00576" name="l00576"></a><span class="lineno">  576</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="classFfmpegWriter__ParamsParser.html#a0ae1295df4bf6e5824a716a46a7e4f51">m_width</a>&lt;=0||<a class="code hl_variable" href="classFfmpegWriter__ParamsParser.html#a0d2a329becd8f9007de780a2c94591da">m_height</a>&lt;=0) {</div>
<div class="line"><a id="l00577" name="l00577"></a><span class="lineno">  577</span>        delayed = <span class="keyword">true</span>;</div>
<div class="line"><a id="l00578" name="l00578"></a><span class="lineno">  578</span>        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a id="l00579" name="l00579"></a><span class="lineno">  579</span>    }</div>
<div class="line"><a id="l00580" name="l00580"></a><span class="lineno">  580</span>    ready = <span class="keyword">true</span>;</div>
<div class="line"><a id="l00581" name="l00581"></a><span class="lineno">  581</span> </div>
<div class="line"><a id="l00582" name="l00582"></a><span class="lineno">  582</span>    <span class="comment">/* initialize libavcodec, and register all codecs and formats */</span></div>
<div class="line"><a id="l00583" name="l00583"></a><span class="lineno">  583</span>    <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">av_register_all</a>();</div>
<div class="line"><a id="l00584" name="l00584"></a><span class="lineno">  584</span> </div>
<div class="line"><a id="l00585" name="l00585"></a><span class="lineno">  585</span>    <span class="comment">/* auto detect the output format from the name. default is</span></div>
<div class="line"><a id="l00586" name="l00586"></a><span class="lineno">  586</span><span class="comment">       mpeg. */</span></div>
<div class="line"><a id="l00587" name="l00587"></a><span class="lineno">  587</span>    fmt = <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">av_guess_format</a>(<span class="keyword">nullptr</span>, filename.c_str(), <span class="keyword">nullptr</span>);</div>
<div class="line"><a id="l00588" name="l00588"></a><span class="lineno">  588</span>    <span class="keywordflow">if</span> (!fmt) {</div>
<div class="line"><a id="l00589" name="l00589"></a><span class="lineno">  589</span>        <a class="code hl_define" href="libYARP__os_2src_2yarp_2os_2LogComponent_8h.html#a18e11e963a9867766b3ac49614348799">yCInfo</a>(<a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">FFMPEGWRITER</a>, <span class="stringliteral">&quot;Could not deduce output format from file extension: using MPEG.&quot;</span>);</div>
<div class="line"><a id="l00590" name="l00590"></a><span class="lineno">  590</span>        fmt = <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">av_guess_format</a>(<span class="stringliteral">&quot;mpeg&quot;</span>, <span class="keyword">nullptr</span>, <span class="keyword">nullptr</span>);</div>
<div class="line"><a id="l00591" name="l00591"></a><span class="lineno">  591</span>    }</div>
<div class="line"><a id="l00592" name="l00592"></a><span class="lineno">  592</span>    <span class="keywordflow">if</span> (!fmt) {</div>
<div class="line"><a id="l00593" name="l00593"></a><span class="lineno">  593</span>        <a class="code hl_define" href="libYARP__os_2src_2yarp_2os_2LogComponent_8h.html#ad0e528d4696fd8f5f0cbac02dd985f44">yCFatal</a>(<a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">FFMPEGWRITER</a>, <span class="stringliteral">&quot;Could not find suitable output format&quot;</span>);</div>
<div class="line"><a id="l00594" name="l00594"></a><span class="lineno">  594</span>    }</div>
<div class="line"><a id="l00595" name="l00595"></a><span class="lineno">  595</span> </div>
<div class="line"><a id="l00596" name="l00596"></a><span class="lineno">  596</span>    <span class="comment">/* allocate the output media context */</span></div>
<div class="line"><a id="l00597" name="l00597"></a><span class="lineno">  597</span>    oc = <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">avformat_alloc_context</a>();</div>
<div class="line"><a id="l00598" name="l00598"></a><span class="lineno">  598</span>    <span class="keywordflow">if</span> (!oc) {</div>
<div class="line"><a id="l00599" name="l00599"></a><span class="lineno">  599</span>        <a class="code hl_define" href="libYARP__os_2src_2yarp_2os_2LogComponent_8h.html#ad0e528d4696fd8f5f0cbac02dd985f44">yCFatal</a>(<a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">FFMPEGWRITER</a>, <span class="stringliteral">&quot;Memory error&quot;</span>);</div>
<div class="line"><a id="l00600" name="l00600"></a><span class="lineno">  600</span>    }</div>
<div class="line"><a id="l00601" name="l00601"></a><span class="lineno">  601</span>    oc-&gt;oformat = fmt;</div>
<div class="line"><a id="l00602" name="l00602"></a><span class="lineno">  602</span>    <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">snprintf</a>(oc-&gt;filename, <span class="keyword">sizeof</span>(oc-&gt;filename), <span class="stringliteral">&quot;%s&quot;</span>, filename.c_str());</div>
<div class="line"><a id="l00603" name="l00603"></a><span class="lineno">  603</span> </div>
<div class="line"><a id="l00604" name="l00604"></a><span class="lineno">  604</span>    <span class="comment">/* add the audio and video streams using the default format codecs</span></div>
<div class="line"><a id="l00605" name="l00605"></a><span class="lineno">  605</span><span class="comment">       and initialize the codecs */</span></div>
<div class="line"><a id="l00606" name="l00606"></a><span class="lineno">  606</span>    video_st = <span class="keyword">nullptr</span>;</div>
<div class="line"><a id="l00607" name="l00607"></a><span class="lineno">  607</span>    audio_st = <span class="keyword">nullptr</span>;</div>
<div class="line"><a id="l00608" name="l00608"></a><span class="lineno">  608</span>    <span class="keywordflow">if</span> (fmt-&gt;video_codec != <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">AV_CODEC_ID_NONE</a>) {</div>
<div class="line"><a id="l00609" name="l00609"></a><span class="lineno">  609</span>        video_st = <a class="code hl_function" href="FfmpegWriter_8cpp.html#a082c99ec7c6f39ad08579701bf5c6cf0">add_video_stream</a>(oc, fmt-&gt;video_codec, <a class="code hl_variable" href="classFfmpegWriter__ParamsParser.html#a0ae1295df4bf6e5824a716a46a7e4f51">m_width</a>, <a class="code hl_variable" href="classFfmpegWriter__ParamsParser.html#a0d2a329becd8f9007de780a2c94591da">m_height</a>, <a class="code hl_variable" href="classFfmpegWriter__ParamsParser.html#a7f106915566f08cf45276ebc8c086db2">m_framerate</a>);</div>
<div class="line"><a id="l00610" name="l00610"></a><span class="lineno">  610</span>    }</div>
<div class="line"><a id="l00611" name="l00611"></a><span class="lineno">  611</span> </div>
<div class="line"><a id="l00612" name="l00612"></a><span class="lineno">  612</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="classFfmpegWriter__ParamsParser.html#a18acb412318ca4a80112c0e157514ade">m_audio</a>) {</div>
<div class="line"><a id="l00613" name="l00613"></a><span class="lineno">  613</span>        <a class="code hl_define" href="libYARP__os_2src_2yarp_2os_2LogComponent_8h.html#a18e11e963a9867766b3ac49614348799">yCInfo</a>(<a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">FFMPEGWRITER</a>, <span class="stringliteral">&quot;Adding audio %dx%d&quot;</span>, <a class="code hl_variable" href="classFfmpegWriter__ParamsParser.html#a14a417605e0d92720e4e33ed9f91a56c">m_sample_rate</a>, <a class="code hl_variable" href="classFfmpegWriter__ParamsParser.html#aff38c605f6380060d3f87260f51ccb36">m_channels</a>);</div>
<div class="line"><a id="l00614" name="l00614"></a><span class="lineno">  614</span>        <span class="keywordflow">if</span> (fmt-&gt;audio_codec != <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">AV_CODEC_ID_NONE</a>) {</div>
<div class="line"><a id="l00615" name="l00615"></a><span class="lineno">  615</span>            audio_st = <a class="code hl_function" href="FfmpegWriter_8cpp.html#a490d2349abb1cf37918bde78f7022c25">add_audio_stream</a>(oc, fmt-&gt;audio_codec);</div>
<div class="line"><a id="l00616" name="l00616"></a><span class="lineno">  616</span>            <span class="keywordflow">if</span> (audio_st!=<span class="keyword">nullptr</span>) {</div>
<div class="line"><a id="l00617" name="l00617"></a><span class="lineno">  617</span>                <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">AVCodecContext</a> *<a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">c</a> = audio_st-&gt;codec;</div>
<div class="line"><a id="l00618" name="l00618"></a><span class="lineno">  618</span>                <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">c</a>-&gt;sample_rate = <a class="code hl_variable" href="classFfmpegWriter__ParamsParser.html#a14a417605e0d92720e4e33ed9f91a56c">m_sample_rate</a>;</div>
<div class="line"><a id="l00619" name="l00619"></a><span class="lineno">  619</span>                <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">c</a>-&gt;channels = <a class="code hl_variable" href="classFfmpegWriter__ParamsParser.html#aff38c605f6380060d3f87260f51ccb36">m_channels</a>;</div>
<div class="line"><a id="l00620" name="l00620"></a><span class="lineno">  620</span>            } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l00621" name="l00621"></a><span class="lineno">  621</span>                <a class="code hl_define" href="libYARP__os_2src_2yarp_2os_2LogComponent_8h.html#a224fd66c5d833ba0367a2ed54bcc279a">yCError</a>(<a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">FFMPEGWRITER</a>, <span class="stringliteral">&quot;Failed to add audio&quot;</span>);</div>
<div class="line"><a id="l00622" name="l00622"></a><span class="lineno">  622</span>            }</div>
<div class="line"><a id="l00623" name="l00623"></a><span class="lineno">  623</span>        } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l00624" name="l00624"></a><span class="lineno">  624</span>            <a class="code hl_define" href="libYARP__os_2src_2yarp_2os_2LogComponent_8h.html#a677a97e364857e0eafefacd5cff5dc7e">yCWarning</a>(<a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">FFMPEGWRITER</a>, <span class="stringliteral">&quot;No audio codec available&quot;</span>);</div>
<div class="line"><a id="l00625" name="l00625"></a><span class="lineno">  625</span>        }</div>
<div class="line"><a id="l00626" name="l00626"></a><span class="lineno">  626</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l00627" name="l00627"></a><span class="lineno">  627</span>        <a class="code hl_define" href="libYARP__os_2src_2yarp_2os_2LogComponent_8h.html#a18e11e963a9867766b3ac49614348799">yCInfo</a>(<a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">FFMPEGWRITER</a>, <span class="stringliteral">&quot;Skipping audio&quot;</span>);</div>
<div class="line"><a id="l00628" name="l00628"></a><span class="lineno">  628</span>    }</div>
<div class="line"><a id="l00629" name="l00629"></a><span class="lineno">  629</span> </div>
<div class="line"><a id="l00630" name="l00630"></a><span class="lineno">  630</span>    <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">av_dump_format</a>(oc, 0, filename.c_str(), 1);</div>
<div class="line"><a id="l00631" name="l00631"></a><span class="lineno">  631</span> </div>
<div class="line"><a id="l00632" name="l00632"></a><span class="lineno">  632</span>    <span class="comment">/* now that all the parameters are set, we can open the audio and</span></div>
<div class="line"><a id="l00633" name="l00633"></a><span class="lineno">  633</span><span class="comment">       video codecs and allocate the necessary encode buffers */</span></div>
<div class="line"><a id="l00634" name="l00634"></a><span class="lineno">  634</span>    <span class="keywordflow">if</span> (video_st) {</div>
<div class="line"><a id="l00635" name="l00635"></a><span class="lineno">  635</span>        open_video(oc, video_st);</div>
<div class="line"><a id="l00636" name="l00636"></a><span class="lineno">  636</span>    }</div>
<div class="line"><a id="l00637" name="l00637"></a><span class="lineno">  637</span>    <span class="keywordflow">if</span> (audio_st) {</div>
<div class="line"><a id="l00638" name="l00638"></a><span class="lineno">  638</span>        <a class="code hl_function" href="FfmpegWriter_8cpp.html#ae796a528cc56c824a00f44b45226e8d7">open_audio</a>(oc, audio_st);</div>
<div class="line"><a id="l00639" name="l00639"></a><span class="lineno">  639</span>    }</div>
<div class="line"><a id="l00640" name="l00640"></a><span class="lineno">  640</span> </div>
<div class="line"><a id="l00641" name="l00641"></a><span class="lineno">  641</span>    <span class="comment">/* open the output file, if needed */</span></div>
<div class="line"><a id="l00642" name="l00642"></a><span class="lineno">  642</span>    <span class="keywordflow">if</span> (!(fmt-&gt;flags &amp; <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">AVFMT_NOFILE</a>)) {</div>
<div class="line"><a id="l00643" name="l00643"></a><span class="lineno">  643</span>        <span class="keywordflow">if</span> (<a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">avio_open</a>(&amp;oc-&gt;pb, filename.c_str(), <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">AVIO_FLAG_WRITE</a>) &lt; 0) {</div>
<div class="line"><a id="l00644" name="l00644"></a><span class="lineno">  644</span>            <a class="code hl_define" href="libYARP__os_2src_2yarp_2os_2LogComponent_8h.html#ad0e528d4696fd8f5f0cbac02dd985f44">yCFatal</a>(<a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">FFMPEGWRITER</a>, <span class="stringliteral">&quot;Could not open &#39;%s&#39;&quot;</span>, filename.c_str());</div>
<div class="line"><a id="l00645" name="l00645"></a><span class="lineno">  645</span>        }</div>
<div class="line"><a id="l00646" name="l00646"></a><span class="lineno">  646</span>    }</div>
<div class="line"><a id="l00647" name="l00647"></a><span class="lineno">  647</span> </div>
<div class="line"><a id="l00648" name="l00648"></a><span class="lineno">  648</span>    <span class="comment">/* write the stream header, if any */</span></div>
<div class="line"><a id="l00649" name="l00649"></a><span class="lineno">  649</span>    <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">avformat_write_header</a>(oc, <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">NULL</a>);</div>
<div class="line"><a id="l00650" name="l00650"></a><span class="lineno">  650</span> </div>
<div class="line"><a id="l00651" name="l00651"></a><span class="lineno">  651</span>    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a id="l00652" name="l00652"></a><span class="lineno">  652</span>}</div>
<div class="line"><a id="l00653" name="l00653"></a><span class="lineno">  653</span> </div>
<div class="foldopen" id="foldopen00654" data-start="{" data-end="}">
<div class="line"><a id="l00654" name="l00654"></a><span class="lineno"><a class="line" href="classFfmpegWriter.html#a40df7ae33c9056a0ba50a65d1252a2fe">  654</a></span><span class="keywordtype">bool</span> <a class="code hl_function" href="classFfmpegWriter.html#a40df7ae33c9056a0ba50a65d1252a2fe">FfmpegWriter::close</a>() {</div>
<div class="line"><a id="l00655" name="l00655"></a><span class="lineno">  655</span>    <span class="keywordflow">if</span> (!isOk()) { <span class="keywordflow">return</span> <span class="keyword">false</span>; }</div>
<div class="line"><a id="l00656" name="l00656"></a><span class="lineno">  656</span> </div>
<div class="line"><a id="l00657" name="l00657"></a><span class="lineno">  657</span>    <span class="comment">/* close each codec */</span></div>
<div class="line"><a id="l00658" name="l00658"></a><span class="lineno">  658</span>    <span class="keywordflow">if</span> (video_st) {</div>
<div class="line"><a id="l00659" name="l00659"></a><span class="lineno">  659</span>        close_video(oc, video_st);</div>
<div class="line"><a id="l00660" name="l00660"></a><span class="lineno">  660</span>    }</div>
<div class="line"><a id="l00661" name="l00661"></a><span class="lineno">  661</span>    <span class="keywordflow">if</span> (audio_st) {</div>
<div class="line"><a id="l00662" name="l00662"></a><span class="lineno">  662</span>        <a class="code hl_function" href="FfmpegWriter_8cpp.html#a5387ca4ff642aa483043500f2cde769f">close_audio</a>(oc, audio_st);</div>
<div class="line"><a id="l00663" name="l00663"></a><span class="lineno">  663</span>    }</div>
<div class="line"><a id="l00664" name="l00664"></a><span class="lineno">  664</span> </div>
<div class="line"><a id="l00665" name="l00665"></a><span class="lineno">  665</span>    <span class="comment">/* write the trailer, if any */</span></div>
<div class="line"><a id="l00666" name="l00666"></a><span class="lineno">  666</span>    <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">av_write_trailer</a>(oc);</div>
<div class="line"><a id="l00667" name="l00667"></a><span class="lineno">  667</span> </div>
<div class="line"><a id="l00668" name="l00668"></a><span class="lineno">  668</span>    <span class="comment">/* free the streams */</span></div>
<div class="line"><a id="l00669" name="l00669"></a><span class="lineno">  669</span>    <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">i</a> = 0; <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">i</a> &lt; oc-&gt;nb_streams; <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">i</a>++) {</div>
<div class="line"><a id="l00670" name="l00670"></a><span class="lineno">  670</span>        <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">av_freep</a>(&amp;oc-&gt;streams[<a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">i</a>]-&gt;codec);</div>
<div class="line"><a id="l00671" name="l00671"></a><span class="lineno">  671</span>        <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">av_freep</a>(&amp;oc-&gt;streams[<a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">i</a>]);</div>
<div class="line"><a id="l00672" name="l00672"></a><span class="lineno">  672</span>    }</div>
<div class="line"><a id="l00673" name="l00673"></a><span class="lineno">  673</span> </div>
<div class="line"><a id="l00674" name="l00674"></a><span class="lineno">  674</span>    <span class="keywordflow">if</span> (!(fmt-&gt;flags &amp; <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">AVFMT_NOFILE</a>)) {</div>
<div class="line"><a id="l00675" name="l00675"></a><span class="lineno">  675</span>        <span class="comment">/* close the output file */</span></div>
<div class="line"><a id="l00676" name="l00676"></a><span class="lineno">  676</span>        <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">avio_close</a>(oc-&gt;pb);</div>
<div class="line"><a id="l00677" name="l00677"></a><span class="lineno">  677</span>    }</div>
<div class="line"><a id="l00678" name="l00678"></a><span class="lineno">  678</span> </div>
<div class="line"><a id="l00679" name="l00679"></a><span class="lineno">  679</span>    <span class="comment">/* free the stream */</span></div>
<div class="line"><a id="l00680" name="l00680"></a><span class="lineno">  680</span>    <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">av_free</a>(oc);</div>
<div class="line"><a id="l00681" name="l00681"></a><span class="lineno">  681</span> </div>
<div class="line"><a id="l00682" name="l00682"></a><span class="lineno">  682</span>    <a class="code hl_define" href="libYARP__os_2src_2yarp_2os_2LogComponent_8h.html#a18e11e963a9867766b3ac49614348799">yCInfo</a>(<a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">FFMPEGWRITER</a>, <span class="stringliteral">&quot;Closed media file %s&quot;</span>, filename.c_str());</div>
<div class="line"><a id="l00683" name="l00683"></a><span class="lineno">  683</span> </div>
<div class="line"><a id="l00684" name="l00684"></a><span class="lineno">  684</span>    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a id="l00685" name="l00685"></a><span class="lineno">  685</span>}</div>
</div>
<div class="line"><a id="l00686" name="l00686"></a><span class="lineno">  686</span> </div>
<div class="foldopen" id="foldopen00687" data-start="{" data-end="}">
<div class="line"><a id="l00687" name="l00687"></a><span class="lineno"><a class="line" href="classFfmpegWriter.html#a2a5b664538a5429c7ef673d50abeb185">  687</a></span><span class="keywordtype">bool</span> <a class="code hl_function" href="classFfmpegWriter.html#a2a5b664538a5429c7ef673d50abeb185">FfmpegWriter::putImage</a>(<a class="code hl_class" href="classyarp_1_1sig_1_1ImageOf.html">yarp::sig::ImageOf&lt;yarp::sig::PixelRgb&gt;</a> &amp; image) {</div>
<div class="line"><a id="l00688" name="l00688"></a><span class="lineno">  688</span>    <span class="keywordflow">if</span> (delayed) {</div>
<div class="line"><a id="l00689" name="l00689"></a><span class="lineno">  689</span>        savedConfig.<a class="code hl_function" href="classyarp_1_1os_1_1Property.html#a2c90f76cba15b8cc9d1c88cf55b253a1">put</a>(<span class="stringliteral">&quot;width&quot;</span>,<a class="code hl_class" href="classyarp_1_1os_1_1Value.html">Value</a>((<span class="keywordtype">int</span>)image.<a class="code hl_function" href="classyarp_1_1sig_1_1Image.html#a27a6819365e6aaae8c89e401ca9f5475">width</a>()));</div>
<div class="line"><a id="l00690" name="l00690"></a><span class="lineno">  690</span>        savedConfig.<a class="code hl_function" href="classyarp_1_1os_1_1Property.html#a2c90f76cba15b8cc9d1c88cf55b253a1">put</a>(<span class="stringliteral">&quot;height&quot;</span>,<a class="code hl_class" href="classyarp_1_1os_1_1Value.html">Value</a>((<span class="keywordtype">int</span>)image.<a class="code hl_function" href="classyarp_1_1sig_1_1Image.html#ac5ceeddf1a947a79fae87c089f33745f">height</a>()));</div>
<div class="line"><a id="l00691" name="l00691"></a><span class="lineno">  691</span>    }</div>
<div class="line"><a id="l00692" name="l00692"></a><span class="lineno">  692</span>    <span class="keywordflow">if</span> (!isOk()) { <span class="keywordflow">return</span> <span class="keyword">false</span>; }</div>
<div class="line"><a id="l00693" name="l00693"></a><span class="lineno">  693</span> </div>
<div class="line"><a id="l00694" name="l00694"></a><span class="lineno">  694</span>    <span class="comment">/* compute current audio and video time */</span></div>
<div class="line"><a id="l00695" name="l00695"></a><span class="lineno">  695</span>    <span class="keywordflow">if</span> (audio_st) {</div>
<div class="line"><a id="l00696" name="l00696"></a><span class="lineno">  696</span>        audio_pts = (<a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">double</a>)<a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">av_stream_get_end_pts</a>(audio_st) * audio_st-&gt;time_base.num / audio_st-&gt;time_base.den;</div>
<div class="line"><a id="l00697" name="l00697"></a><span class="lineno">  697</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l00698" name="l00698"></a><span class="lineno">  698</span>        audio_pts = 0.0;</div>
<div class="line"><a id="l00699" name="l00699"></a><span class="lineno">  699</span>    }</div>
<div class="line"><a id="l00700" name="l00700"></a><span class="lineno">  700</span> </div>
<div class="line"><a id="l00701" name="l00701"></a><span class="lineno">  701</span>    <span class="keywordflow">if</span> (video_st) {</div>
<div class="line"><a id="l00702" name="l00702"></a><span class="lineno">  702</span>        video_pts = (<a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">double</a>)<a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">av_stream_get_end_pts</a>(video_st) * video_st-&gt;time_base.num / video_st-&gt;time_base.den;</div>
<div class="line"><a id="l00703" name="l00703"></a><span class="lineno">  703</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l00704" name="l00704"></a><span class="lineno">  704</span>        video_pts = 0.0;</div>
<div class="line"><a id="l00705" name="l00705"></a><span class="lineno">  705</span>    }</div>
<div class="line"><a id="l00706" name="l00706"></a><span class="lineno">  706</span> </div>
<div class="line"><a id="l00707" name="l00707"></a><span class="lineno">  707</span>    <span class="keywordflow">if</span> (!(audio_st || video_st)) {</div>
<div class="line"><a id="l00708" name="l00708"></a><span class="lineno">  708</span>        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l00709" name="l00709"></a><span class="lineno">  709</span>    }</div>
<div class="line"><a id="l00710" name="l00710"></a><span class="lineno">  710</span> </div>
<div class="line"><a id="l00711" name="l00711"></a><span class="lineno">  711</span>    <span class="comment">/* write interleaved audio and video frames */</span></div>
<div class="line"><a id="l00712" name="l00712"></a><span class="lineno">  712</span>    <span class="keywordflow">if</span> (!video_st || (video_st &amp;&amp; audio_st &amp;&amp; audio_pts &lt; video_pts)) {</div>
<div class="line"><a id="l00713" name="l00713"></a><span class="lineno">  713</span>        <a class="code hl_function" href="FfmpegWriter_8cpp.html#a4d24a816adffef9dd0d5d8678ee68052">write_audio_frame</a>(oc, audio_st);</div>
<div class="line"><a id="l00714" name="l00714"></a><span class="lineno">  714</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l00715" name="l00715"></a><span class="lineno">  715</span>        write_video_frame(oc, video_st, image);</div>
<div class="line"><a id="l00716" name="l00716"></a><span class="lineno">  716</span>    }</div>
<div class="line"><a id="l00717" name="l00717"></a><span class="lineno">  717</span> </div>
<div class="line"><a id="l00718" name="l00718"></a><span class="lineno">  718</span>    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a id="l00719" name="l00719"></a><span class="lineno">  719</span>}</div>
</div>
<div class="line"><a id="l00720" name="l00720"></a><span class="lineno">  720</span> </div>
<div class="line"><a id="l00721" name="l00721"></a><span class="lineno">  721</span> </div>
<div class="line"><a id="l00722" name="l00722"></a><span class="lineno">  722</span> </div>
<div class="foldopen" id="foldopen00723" data-start="{" data-end="}">
<div class="line"><a id="l00723" name="l00723"></a><span class="lineno"><a class="line" href="classFfmpegWriter.html#aeb1905af4f9f47ef5b8da1016c02e66d">  723</a></span><span class="keywordtype">bool</span> <a class="code hl_function" href="classFfmpegWriter.html#aeb1905af4f9f47ef5b8da1016c02e66d">FfmpegWriter::putAudioVisual</a>(<a class="code hl_class" href="classyarp_1_1sig_1_1ImageOf.html">yarp::sig::ImageOf&lt;yarp::sig::PixelRgb&gt;</a>&amp; image,</div>
<div class="line"><a id="l00724" name="l00724"></a><span class="lineno">  724</span>                                  <a class="code hl_class" href="classyarp_1_1sig_1_1Sound.html">yarp::sig::Sound</a>&amp; sound) {</div>
<div class="line"><a id="l00725" name="l00725"></a><span class="lineno">  725</span>    <span class="keywordflow">if</span> (delayed) {</div>
<div class="line"><a id="l00726" name="l00726"></a><span class="lineno">  726</span>        savedConfig.<a class="code hl_function" href="classyarp_1_1os_1_1Property.html#a2c90f76cba15b8cc9d1c88cf55b253a1">put</a>(<span class="stringliteral">&quot;width&quot;</span>,<a class="code hl_class" href="classyarp_1_1os_1_1Value.html">Value</a>((<span class="keywordtype">int</span>)image.<a class="code hl_function" href="classyarp_1_1sig_1_1Image.html#a27a6819365e6aaae8c89e401ca9f5475">width</a>()));</div>
<div class="line"><a id="l00727" name="l00727"></a><span class="lineno">  727</span>        savedConfig.<a class="code hl_function" href="classyarp_1_1os_1_1Property.html#a2c90f76cba15b8cc9d1c88cf55b253a1">put</a>(<span class="stringliteral">&quot;height&quot;</span>,<a class="code hl_class" href="classyarp_1_1os_1_1Value.html">Value</a>((<span class="keywordtype">int</span>)image.<a class="code hl_function" href="classyarp_1_1sig_1_1Image.html#ac5ceeddf1a947a79fae87c089f33745f">height</a>()));</div>
<div class="line"><a id="l00728" name="l00728"></a><span class="lineno">  728</span>        savedConfig.<a class="code hl_function" href="classyarp_1_1os_1_1Property.html#a2c90f76cba15b8cc9d1c88cf55b253a1">put</a>(<span class="stringliteral">&quot;sample_rate&quot;</span>,<a class="code hl_class" href="classyarp_1_1os_1_1Value.html">Value</a>((<span class="keywordtype">int</span>)sound.<a class="code hl_function" href="classyarp_1_1sig_1_1Sound.html#ab6e8e424948ecae463a77436ef8b336a">getFrequency</a>()));</div>
<div class="line"><a id="l00729" name="l00729"></a><span class="lineno">  729</span>        savedConfig.<a class="code hl_function" href="classyarp_1_1os_1_1Property.html#a2c90f76cba15b8cc9d1c88cf55b253a1">put</a>(<span class="stringliteral">&quot;channels&quot;</span>,<a class="code hl_class" href="classyarp_1_1os_1_1Value.html">Value</a>((<span class="keywordtype">int</span>)sound.<a class="code hl_function" href="classyarp_1_1sig_1_1Sound.html#a697819afea84ef8dfef6bd4cb0096c89">getChannels</a>()));</div>
<div class="line"><a id="l00730" name="l00730"></a><span class="lineno">  730</span>        savedConfig.<a class="code hl_function" href="classyarp_1_1os_1_1Property.html#a2c90f76cba15b8cc9d1c88cf55b253a1">put</a>(<span class="stringliteral">&quot;audio&quot;</span>,<a class="code hl_class" href="classyarp_1_1os_1_1Value.html">Value</a>(1));</div>
<div class="line"><a id="l00731" name="l00731"></a><span class="lineno">  731</span>    }</div>
<div class="line"><a id="l00732" name="l00732"></a><span class="lineno">  732</span>    <span class="keywordflow">if</span> (!isOk()) { <span class="keywordflow">return</span> <span class="keyword">false</span>; }</div>
<div class="line"><a id="l00733" name="l00733"></a><span class="lineno">  733</span> </div>
<div class="line"><a id="l00734" name="l00734"></a><span class="lineno">  734</span>    <span class="comment">/* write interleaved audio and video frames */</span></div>
<div class="line"><a id="l00735" name="l00735"></a><span class="lineno">  735</span>    write_video_frame(oc, video_st, image);</div>
<div class="line"><a id="l00736" name="l00736"></a><span class="lineno">  736</span>    <a class="code hl_function" href="FfmpegWriter_8cpp.html#a4d24a816adffef9dd0d5d8678ee68052">write_audio_frame</a>(oc, audio_st, sound);</div>
<div class="line"><a id="l00737" name="l00737"></a><span class="lineno">  737</span>    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a id="l00738" name="l00738"></a><span class="lineno">  738</span>}</div>
</div>
<div class="ttc" id="aFfmpegWriter_8cpp_html_a082c99ec7c6f39ad08579701bf5c6cf0"><div class="ttname"><a href="FfmpegWriter_8cpp.html#a082c99ec7c6f39ad08579701bf5c6cf0">add_video_stream</a></div><div class="ttdeci">static AVStream * add_video_stream(AVFormatContext *oc, AVCodecID codec_id, int w, int h, int framerate)</div><div class="ttdef"><b>Definition</b> <a href="FfmpegWriter_8cpp_source.html#l00337">FfmpegWriter.cpp:337</a></div></div>
<div class="ttc" id="aFfmpegWriter_8cpp_html_a12b64e51c00dc7527e8378c5a41f9455"><div class="ttname"><a href="FfmpegWriter_8cpp.html#a12b64e51c00dc7527e8378c5a41f9455">alloc_picture</a></div><div class="ttdeci">static AVFrame * alloc_picture(int pix_fmt, int width, int height)</div><div class="ttdef"><b>Definition</b> <a href="FfmpegWriter_8cpp_source.html#l00384">FfmpegWriter.cpp:384</a></div></div>
<div class="ttc" id="aFfmpegWriter_8cpp_html_a15f51ccf617d5002b146e76a41f6d9d9"><div class="ttname"><a href="FfmpegWriter_8cpp.html#a15f51ccf617d5002b146e76a41f6d9d9">samples_size</a></div><div class="ttdeci">int samples_size</div><div class="ttdef"><b>Definition</b> <a href="FfmpegWriter_8cpp_source.html#l00074">FfmpegWriter.cpp:74</a></div></div>
<div class="ttc" id="aFfmpegWriter_8cpp_html_a2d8bac9bbefeaba3b68329c0d5e476d8"><div class="ttname"><a href="FfmpegWriter_8cpp.html#a2d8bac9bbefeaba3b68329c0d5e476d8">tincr</a></div><div class="ttdeci">float tincr</div><div class="ttdef"><b>Definition</b> <a href="FfmpegWriter_8cpp_source.html#l00071">FfmpegWriter.cpp:71</a></div></div>
<div class="ttc" id="aFfmpegWriter_8cpp_html_a490d2349abb1cf37918bde78f7022c25"><div class="ttname"><a href="FfmpegWriter_8cpp.html#a490d2349abb1cf37918bde78f7022c25">add_audio_stream</a></div><div class="ttdeci">static AVStream * add_audio_stream(AVFormatContext *oc, AVCodecID codec_id)</div><div class="ttdef"><b>Definition</b> <a href="FfmpegWriter_8cpp_source.html#l00085">FfmpegWriter.cpp:85</a></div></div>
<div class="ttc" id="aFfmpegWriter_8cpp_html_a4d24a816adffef9dd0d5d8678ee68052"><div class="ttname"><a href="FfmpegWriter_8cpp.html#a4d24a816adffef9dd0d5d8678ee68052">write_audio_frame</a></div><div class="ttdeci">static void write_audio_frame(AVFormatContext *oc, AVStream *st)</div><div class="ttdef"><b>Definition</b> <a href="FfmpegWriter_8cpp_source.html#l00210">FfmpegWriter.cpp:210</a></div></div>
<div class="ttc" id="aFfmpegWriter_8cpp_html_a5387ca4ff642aa483043500f2cde769f"><div class="ttname"><a href="FfmpegWriter_8cpp.html#a5387ca4ff642aa483043500f2cde769f">close_audio</a></div><div class="ttdeci">static void close_audio(AVFormatContext *oc, AVStream *st)</div><div class="ttdef"><b>Definition</b> <a href="FfmpegWriter_8cpp_source.html#l00324">FfmpegWriter.cpp:324</a></div></div>
<div class="ttc" id="aFfmpegWriter_8cpp_html_a5405b7dce6394fcc74d94dc9bddf8506"><div class="ttname"><a href="FfmpegWriter_8cpp.html#a5405b7dce6394fcc74d94dc9bddf8506">get_audio_frame</a></div><div class="ttdeci">static void get_audio_frame(int16_t *samples, int frame_size, int nb_channels)</div><div class="ttdef"><b>Definition</b> <a href="FfmpegWriter_8cpp_source.html#l00165">FfmpegWriter.cpp:165</a></div></div>
<div class="ttc" id="aFfmpegWriter_8cpp_html_a794227adcb14b7543512e648e7b869f6"><div class="ttname"><a href="FfmpegWriter_8cpp.html#a794227adcb14b7543512e648e7b869f6">make_audio_frame</a></div><div class="ttdeci">static void make_audio_frame(AVCodecContext *c, AVFrame *&amp;frame, void *&amp;samples)</div><div class="ttdef"><b>Definition</b> <a href="FfmpegWriter_8cpp_source.html#l00181">FfmpegWriter.cpp:181</a></div></div>
<div class="ttc" id="aFfmpegWriter_8cpp_html_a9478438422f8f847e94f43823e2b3811"><div class="ttname"><a href="FfmpegWriter_8cpp.html#a9478438422f8f847e94f43823e2b3811">audio_input_frame_size</a></div><div class="ttdeci">int audio_input_frame_size</div><div class="ttdef"><b>Definition</b> <a href="FfmpegWriter_8cpp_source.html#l00080">FfmpegWriter.cpp:80</a></div></div>
<div class="ttc" id="aFfmpegWriter_8cpp_html_a9bef43aba4bea626b26f0c5845d042cb"><div class="ttname"><a href="FfmpegWriter_8cpp.html#a9bef43aba4bea626b26f0c5845d042cb">samples_at</a></div><div class="ttdeci">int samples_at</div><div class="ttdef"><b>Definition</b> <a href="FfmpegWriter_8cpp_source.html#l00075">FfmpegWriter.cpp:75</a></div></div>
<div class="ttc" id="aFfmpegWriter_8cpp_html_aa3adc71a1d59d604c491799d81309dce"><div class="ttname"><a href="FfmpegWriter_8cpp.html#aa3adc71a1d59d604c491799d81309dce">fill_rgb_image</a></div><div class="ttdeci">static void fill_rgb_image(AVFrame *pict, int frame_index, int width, int height, ImageOf&lt; PixelRgb &gt; &amp;img)</div><div class="ttdef"><b>Definition</b> <a href="FfmpegWriter_8cpp_source.html#l00452">FfmpegWriter.cpp:452</a></div></div>
<div class="ttc" id="aFfmpegWriter_8cpp_html_ab03a5eff2dba5f25bad201cf68d411d0"><div class="ttname"><a href="FfmpegWriter_8cpp.html#ab03a5eff2dba5f25bad201cf68d411d0">audio_outbuf_size</a></div><div class="ttdeci">int audio_outbuf_size</div><div class="ttdef"><b>Definition</b> <a href="FfmpegWriter_8cpp_source.html#l00079">FfmpegWriter.cpp:79</a></div></div>
<div class="ttc" id="aFfmpegWriter_8cpp_html_acabbf8cf98a852edeeeae57244e61eae"><div class="ttname"><a href="FfmpegWriter_8cpp.html#acabbf8cf98a852edeeeae57244e61eae">audio_outbuf</a></div><div class="ttdeci">uint8_t * audio_outbuf</div><div class="ttdef"><b>Definition</b> <a href="FfmpegWriter_8cpp_source.html#l00078">FfmpegWriter.cpp:78</a></div></div>
<div class="ttc" id="aFfmpegWriter_8cpp_html_ae3371cbe1ab70a16f1b58241d289ae77"><div class="ttname"><a href="FfmpegWriter_8cpp.html#ae3371cbe1ab70a16f1b58241d289ae77">tincr2</a></div><div class="ttdeci">float tincr2</div><div class="ttdef"><b>Definition</b> <a href="FfmpegWriter_8cpp_source.html#l00071">FfmpegWriter.cpp:71</a></div></div>
<div class="ttc" id="aFfmpegWriter_8cpp_html_ae67b157ab0198fa81bf675b378ff06fd"><div class="ttname"><a href="FfmpegWriter_8cpp.html#ae67b157ab0198fa81bf675b378ff06fd">STREAM_PIX_FMT</a></div><div class="ttdeci">#define STREAM_PIX_FMT</div><div class="ttdef"><b>Definition</b> <a href="FfmpegWriter_8cpp_source.html#l00055">FfmpegWriter.cpp:55</a></div></div>
<div class="ttc" id="aFfmpegWriter_8cpp_html_ae71449b1cc6e6250b91f539153a7a0d3"><div class="ttname"><a href="FfmpegWriter_8cpp.html#ae71449b1cc6e6250b91f539153a7a0d3">M_PI</a></div><div class="ttdeci">#define M_PI</div><div class="ttdef"><b>Definition</b> <a href="FfmpegWriter_8cpp_source.html#l00051">FfmpegWriter.cpp:51</a></div></div>
<div class="ttc" id="aFfmpegWriter_8cpp_html_ae796a528cc56c824a00f44b45226e8d7"><div class="ttname"><a href="FfmpegWriter_8cpp.html#ae796a528cc56c824a00f44b45226e8d7">open_audio</a></div><div class="ttdeci">static void open_audio(AVFormatContext *oc, AVStream *st)</div><div class="ttdef"><b>Definition</b> <a href="FfmpegWriter_8cpp_source.html#l00106">FfmpegWriter.cpp:106</a></div></div>
<div class="ttc" id="aFfmpegWriter_8cpp_html_aeb8ae8386f8ee09979a92b7112576aef"><div class="ttname"><a href="FfmpegWriter_8cpp.html#aeb8ae8386f8ee09979a92b7112576aef">samples</a></div><div class="ttdeci">int16_t * samples</div><div class="ttdef"><b>Definition</b> <a href="FfmpegWriter_8cpp_source.html#l00073">FfmpegWriter.cpp:73</a></div></div>
<div class="ttc" id="aFfmpegWriter_8cpp_html_afea36502e9d227ff62c5fb2719a246f2"><div class="ttname"><a href="FfmpegWriter_8cpp.html#afea36502e9d227ff62c5fb2719a246f2">t</a></div><div class="ttdeci">float t</div><div class="ttdef"><b>Definition</b> <a href="FfmpegWriter_8cpp_source.html#l00071">FfmpegWriter.cpp:71</a></div></div>
<div class="ttc" id="aFfmpegWriter_8cpp_html_aff60fb8719af5ce06ee7034f8d81a735"><div class="ttname"><a href="FfmpegWriter_8cpp.html#aff60fb8719af5ce06ee7034f8d81a735">samples_channels</a></div><div class="ttdeci">int samples_channels</div><div class="ttdef"><b>Definition</b> <a href="FfmpegWriter_8cpp_source.html#l00076">FfmpegWriter.cpp:76</a></div></div>
<div class="ttc" id="aFfmpegWriter_8h_html"><div class="ttname"><a href="FfmpegWriter_8h.html">FfmpegWriter.h</a></div></div>
<div class="ttc" id="aImplementAxisInfo_8cpp_html_ab295c2135096172ff421e6b33358407d"><div class="ttname"><a href="ImplementAxisInfo_8cpp.html#ab295c2135096172ff421e6b33358407d">ret</a></div><div class="ttdeci">bool ret</div><div class="ttdef"><b>Definition</b> <a href="ImplementAxisInfo_8cpp_source.html#l00077">ImplementAxisInfo.cpp:77</a></div></div>
<div class="ttc" id="aLog_8h_html"><div class="ttname"><a href="Log_8h.html">Log.h</a></div></div>
<div class="ttc" id="aclassFfmpegWriter__ParamsParser_html_a0ae1295df4bf6e5824a716a46a7e4f51"><div class="ttname"><a href="classFfmpegWriter__ParamsParser.html#a0ae1295df4bf6e5824a716a46a7e4f51">FfmpegWriter_ParamsParser::m_width</a></div><div class="ttdeci">int m_width</div><div class="ttdef"><b>Definition</b> <a href="FfmpegWriter__ParamsParser_8h_source.html#l00072">FfmpegWriter_ParamsParser.h:72</a></div></div>
<div class="ttc" id="aclassFfmpegWriter__ParamsParser_html_a0d2a329becd8f9007de780a2c94591da"><div class="ttname"><a href="classFfmpegWriter__ParamsParser.html#a0d2a329becd8f9007de780a2c94591da">FfmpegWriter_ParamsParser::m_height</a></div><div class="ttdeci">int m_height</div><div class="ttdef"><b>Definition</b> <a href="FfmpegWriter__ParamsParser_8h_source.html#l00073">FfmpegWriter_ParamsParser.h:73</a></div></div>
<div class="ttc" id="aclassFfmpegWriter__ParamsParser_html_a14a417605e0d92720e4e33ed9f91a56c"><div class="ttname"><a href="classFfmpegWriter__ParamsParser.html#a14a417605e0d92720e4e33ed9f91a56c">FfmpegWriter_ParamsParser::m_sample_rate</a></div><div class="ttdeci">int m_sample_rate</div><div class="ttdef"><b>Definition</b> <a href="FfmpegWriter__ParamsParser_8h_source.html#l00077">FfmpegWriter_ParamsParser.h:77</a></div></div>
<div class="ttc" id="aclassFfmpegWriter__ParamsParser_html_a18acb412318ca4a80112c0e157514ade"><div class="ttname"><a href="classFfmpegWriter__ParamsParser.html#a18acb412318ca4a80112c0e157514ade">FfmpegWriter_ParamsParser::m_audio</a></div><div class="ttdeci">bool m_audio</div><div class="ttdef"><b>Definition</b> <a href="FfmpegWriter__ParamsParser_8h_source.html#l00075">FfmpegWriter_ParamsParser.h:75</a></div></div>
<div class="ttc" id="aclassFfmpegWriter__ParamsParser_html_a668722dc5ee43e2fc42fb4d00684e8f3"><div class="ttname"><a href="classFfmpegWriter__ParamsParser.html#a668722dc5ee43e2fc42fb4d00684e8f3">FfmpegWriter_ParamsParser::parseParams</a></div><div class="ttdeci">bool parseParams(const yarp::os::Searchable &amp;config) override</div><div class="ttdoc">Parse the DeviceDriver parameters.</div><div class="ttdef"><b>Definition</b> <a href="FfmpegWriter__ParamsParser_8cpp_source.html#l00042">FfmpegWriter_ParamsParser.cpp:42</a></div></div>
<div class="ttc" id="aclassFfmpegWriter__ParamsParser_html_a7f106915566f08cf45276ebc8c086db2"><div class="ttname"><a href="classFfmpegWriter__ParamsParser.html#a7f106915566f08cf45276ebc8c086db2">FfmpegWriter_ParamsParser::m_framerate</a></div><div class="ttdeci">int m_framerate</div><div class="ttdef"><b>Definition</b> <a href="FfmpegWriter__ParamsParser_8h_source.html#l00074">FfmpegWriter_ParamsParser.h:74</a></div></div>
<div class="ttc" id="aclassFfmpegWriter__ParamsParser_html_aff38c605f6380060d3f87260f51ccb36"><div class="ttname"><a href="classFfmpegWriter__ParamsParser.html#aff38c605f6380060d3f87260f51ccb36">FfmpegWriter_ParamsParser::m_channels</a></div><div class="ttdeci">int m_channels</div><div class="ttdef"><b>Definition</b> <a href="FfmpegWriter__ParamsParser_8h_source.html#l00076">FfmpegWriter_ParamsParser.h:76</a></div></div>
<div class="ttc" id="aclassFfmpegWriter_html_a15aa0c5ee459c3a49d3bc0ce6d848387"><div class="ttname"><a href="classFfmpegWriter.html#a15aa0c5ee459c3a49d3bc0ce6d848387">FfmpegWriter::open</a></div><div class="ttdeci">bool open(yarp::os::Searchable &amp;config) override</div><div class="ttdoc">Open the DeviceDriver.</div><div class="ttdef"><b>Definition</b> <a href="FfmpegWriter_8cpp_source.html#l00555">FfmpegWriter.cpp:555</a></div></div>
<div class="ttc" id="aclassFfmpegWriter_html_a2a5b664538a5429c7ef673d50abeb185"><div class="ttname"><a href="classFfmpegWriter.html#a2a5b664538a5429c7ef673d50abeb185">FfmpegWriter::putImage</a></div><div class="ttdeci">bool putImage(yarp::sig::ImageOf&lt; yarp::sig::PixelRgb &gt; &amp;image) override</div><div class="ttdoc">Write an image to the device.</div><div class="ttdef"><b>Definition</b> <a href="FfmpegWriter_8cpp_source.html#l00687">FfmpegWriter.cpp:687</a></div></div>
<div class="ttc" id="aclassFfmpegWriter_html_a40df7ae33c9056a0ba50a65d1252a2fe"><div class="ttname"><a href="classFfmpegWriter.html#a40df7ae33c9056a0ba50a65d1252a2fe">FfmpegWriter::close</a></div><div class="ttdeci">bool close() override</div><div class="ttdoc">Close the DeviceDriver.</div><div class="ttdef"><b>Definition</b> <a href="FfmpegWriter_8cpp_source.html#l00654">FfmpegWriter.cpp:654</a></div></div>
<div class="ttc" id="aclassFfmpegWriter_html_aeb1905af4f9f47ef5b8da1016c02e66d"><div class="ttname"><a href="classFfmpegWriter.html#aeb1905af4f9f47ef5b8da1016c02e66d">FfmpegWriter::putAudioVisual</a></div><div class="ttdeci">virtual bool putAudioVisual(yarp::sig::ImageOf&lt; yarp::sig::PixelRgb &gt; &amp;image, yarp::sig::Sound &amp;sound) override</div><div class="ttdoc">Write an image and sound.</div><div class="ttdef"><b>Definition</b> <a href="FfmpegWriter_8cpp_source.html#l00723">FfmpegWriter.cpp:723</a></div></div>
<div class="ttc" id="aclassyarp_1_1os_1_1BufferedPort_html"><div class="ttname"><a href="classyarp_1_1os_1_1BufferedPort.html">yarp::os::BufferedPort</a></div><div class="ttdoc">A mini-server for performing network communication in the background.</div><div class="ttdef"><b>Definition</b> <a href="BufferedPort_8h_source.html#l00059">BufferedPort.h:60</a></div></div>
<div class="ttc" id="aclassyarp_1_1os_1_1Property_html_a0b938dbb6cf9e92a845cb18509865c62"><div class="ttname"><a href="classyarp_1_1os_1_1Property.html#a0b938dbb6cf9e92a845cb18509865c62">yarp::os::Property::fromString</a></div><div class="ttdeci">void fromString(const std::string &amp;txt, bool wipe=true)</div><div class="ttdoc">Interprets a string as a list of properties.</div><div class="ttdef"><b>Definition</b> <a href="Property_8cpp_source.html#l01035">Property.cpp:1035</a></div></div>
<div class="ttc" id="aclassyarp_1_1os_1_1Property_html_a2c90f76cba15b8cc9d1c88cf55b253a1"><div class="ttname"><a href="classyarp_1_1os_1_1Property.html#a2c90f76cba15b8cc9d1c88cf55b253a1">yarp::os::Property::put</a></div><div class="ttdeci">void put(const std::string &amp;key, const std::string &amp;value)</div><div class="ttdoc">Associate the given key with the given string.</div><div class="ttdef"><b>Definition</b> <a href="Property_8cpp_source.html#l00987">Property.cpp:987</a></div></div>
<div class="ttc" id="aclassyarp_1_1os_1_1Searchable_html"><div class="ttname"><a href="classyarp_1_1os_1_1Searchable.html">yarp::os::Searchable</a></div><div class="ttdoc">A base class for nested structures that can be searched.</div><div class="ttdef"><b>Definition</b> <a href="Searchable_8h_source.html#l00030">Searchable.h:31</a></div></div>
<div class="ttc" id="aclassyarp_1_1os_1_1Searchable_html_aa8e76c64a9251dc4485022aa7140d150"><div class="ttname"><a href="classyarp_1_1os_1_1Searchable.html#aa8e76c64a9251dc4485022aa7140d150">yarp::os::Searchable::toString</a></div><div class="ttdeci">virtual std::string toString() const =0</div><div class="ttdoc">Return a standard text representation of the content of the object.</div></div>
<div class="ttc" id="aclassyarp_1_1os_1_1Value_html"><div class="ttname"><a href="classyarp_1_1os_1_1Value.html">yarp::os::Value</a></div><div class="ttdoc">A single value (typically within a Bottle).</div><div class="ttdef"><b>Definition</b> <a href="Value_8h_source.html#l00042">Value.h:43</a></div></div>
<div class="ttc" id="aclassyarp_1_1sig_1_1ImageOf_html"><div class="ttname"><a href="classyarp_1_1sig_1_1ImageOf.html">yarp::sig::ImageOf</a></div><div class="ttdoc">Typed image class.</div><div class="ttdef"><b>Definition</b> <a href="Image_8h_source.html#l00604">Image.h:605</a></div></div>
<div class="ttc" id="aclassyarp_1_1sig_1_1Image_html_a27a6819365e6aaae8c89e401ca9f5475"><div class="ttname"><a href="classyarp_1_1sig_1_1Image.html#a27a6819365e6aaae8c89e401ca9f5475">yarp::sig::Image::width</a></div><div class="ttdeci">size_t width() const</div><div class="ttdoc">Gets width of image in pixels.</div><div class="ttdef"><b>Definition</b> <a href="Image_8h_source.html#l00171">Image.h:171</a></div></div>
<div class="ttc" id="aclassyarp_1_1sig_1_1Image_html_ac5ceeddf1a947a79fae87c089f33745f"><div class="ttname"><a href="classyarp_1_1sig_1_1Image.html#ac5ceeddf1a947a79fae87c089f33745f">yarp::sig::Image::height</a></div><div class="ttdeci">size_t height() const</div><div class="ttdoc">Gets height of image in pixels.</div><div class="ttdef"><b>Definition</b> <a href="Image_8h_source.html#l00177">Image.h:177</a></div></div>
<div class="ttc" id="aclassyarp_1_1sig_1_1Sound_html"><div class="ttname"><a href="classyarp_1_1sig_1_1Sound.html">yarp::sig::Sound</a></div><div class="ttdoc">Class for storing sounds See Audio in YARP for additional documentation on YARP audio.</div><div class="ttdef"><b>Definition</b> <a href="Sound_8h_source.html#l00024">Sound.h:25</a></div></div>
<div class="ttc" id="aclassyarp_1_1sig_1_1Sound_html_a697819afea84ef8dfef6bd4cb0096c89"><div class="ttname"><a href="classyarp_1_1sig_1_1Sound.html#a697819afea84ef8dfef6bd4cb0096c89">yarp::sig::Sound::getChannels</a></div><div class="ttdeci">size_t getChannels() const</div><div class="ttdoc">Get the number of channels of the sound.</div><div class="ttdef"><b>Definition</b> <a href="Sound_8cpp_source.html#l00603">Sound.cpp:603</a></div></div>
<div class="ttc" id="aclassyarp_1_1sig_1_1Sound_html_ab6e8e424948ecae463a77436ef8b336a"><div class="ttname"><a href="classyarp_1_1sig_1_1Sound.html#ab6e8e424948ecae463a77436ef8b336a">yarp::sig::Sound::getFrequency</a></div><div class="ttdeci">int getFrequency() const</div><div class="ttdoc">Get the frequency of the sound (i.e.</div><div class="ttdef"><b>Definition</b> <a href="Sound_8cpp_source.html#l00356">Sound.cpp:356</a></div></div>
<div class="ttc" id="aclassyarp_1_1sig_1_1Sound_html_adc724f5ee7175b0ad438a86743338b02"><div class="ttname"><a href="classyarp_1_1sig_1_1Sound.html#adc724f5ee7175b0ad438a86743338b02">yarp::sig::Sound::get</a></div><div class="ttdeci">audio_sample get(size_t sample, size_t channel=0) const</div><div class="ttdef"><b>Definition</b> <a href="Sound_8cpp_source.html#l00294">Sound.cpp:294</a></div></div>
<div class="ttc" id="aclassyarp_1_1sig_1_1Sound_html_af00f4a88356c305f02dbbd7b3260bed7"><div class="ttname"><a href="classyarp_1_1sig_1_1Sound.html#af00f4a88356c305f02dbbd7b3260bed7">yarp::sig::Sound::getSamples</a></div><div class="ttdeci">size_t getSamples() const</div><div class="ttdoc">Get the number of samples contained in the sound.</div><div class="ttdef"><b>Definition</b> <a href="Sound_8cpp_source.html#l00598">Sound.cpp:598</a></div></div>
<div class="ttc" id="affmpeg__api_8cpp_html_a20aa5b1f8047b8791323b2d3360a6770"><div class="ttname"><a href="ffmpeg__api_8cpp.html#a20aa5b1f8047b8791323b2d3360a6770">stable_img_convert</a></div><div class="ttdeci">int stable_img_convert(AVPicture *dst, int dst_pix_fmt, const AVPicture *src, int src_pix_fmt, int src_width, int src_height)</div><div class="ttdef"><b>Definition</b> <a href="ffmpeg__api_8cpp_source.html#l00010">ffmpeg_api.cpp:10</a></div></div>
<div class="ttc" id="affmpeg__api_8h_html"><div class="ttname"><a href="ffmpeg__api_8h.html">ffmpeg_api.h</a></div></div>
<div class="ttc" id="alibYARP__os_2src_2yarp_2os_2LogComponent_8h_html"><div class="ttname"><a href="libYARP__os_2src_2yarp_2os_2LogComponent_8h.html">LogComponent.h</a></div></div>
<div class="ttc" id="alibYARP__os_2src_2yarp_2os_2LogComponent_8h_html_a18e11e963a9867766b3ac49614348799"><div class="ttname"><a href="libYARP__os_2src_2yarp_2os_2LogComponent_8h.html#a18e11e963a9867766b3ac49614348799">yCInfo</a></div><div class="ttdeci">#define yCInfo(component,...)</div><div class="ttdef"><b>Definition</b> <a href="libYARP__os_2src_2yarp_2os_2LogComponent_8h_source.html#l00171">LogComponent.h:171</a></div></div>
<div class="ttc" id="alibYARP__os_2src_2yarp_2os_2LogComponent_8h_html_a224fd66c5d833ba0367a2ed54bcc279a"><div class="ttname"><a href="libYARP__os_2src_2yarp_2os_2LogComponent_8h.html#a224fd66c5d833ba0367a2ed54bcc279a">yCError</a></div><div class="ttdeci">#define yCError(component,...)</div><div class="ttdef"><b>Definition</b> <a href="libYARP__os_2src_2yarp_2os_2LogComponent_8h_source.html#l00213">LogComponent.h:213</a></div></div>
<div class="ttc" id="alibYARP__os_2src_2yarp_2os_2LogComponent_8h_html_a3ffb0d629a2cfebb6abdc73e93a11bce"><div class="ttname"><a href="libYARP__os_2src_2yarp_2os_2LogComponent_8h.html#a3ffb0d629a2cfebb6abdc73e93a11bce">yCTrace</a></div><div class="ttdeci">#define yCTrace(component,...)</div><div class="ttdef"><b>Definition</b> <a href="libYARP__os_2src_2yarp_2os_2LogComponent_8h_source.html#l00084">LogComponent.h:84</a></div></div>
<div class="ttc" id="alibYARP__os_2src_2yarp_2os_2LogComponent_8h_html_a677a97e364857e0eafefacd5cff5dc7e"><div class="ttname"><a href="libYARP__os_2src_2yarp_2os_2LogComponent_8h.html#a677a97e364857e0eafefacd5cff5dc7e">yCWarning</a></div><div class="ttdeci">#define yCWarning(component,...)</div><div class="ttdef"><b>Definition</b> <a href="libYARP__os_2src_2yarp_2os_2LogComponent_8h_source.html#l00192">LogComponent.h:192</a></div></div>
<div class="ttc" id="alibYARP__os_2src_2yarp_2os_2LogComponent_8h_html_a86dd8a06be6e589f92112c953c8f8009"><div class="ttname"><a href="libYARP__os_2src_2yarp_2os_2LogComponent_8h.html#a86dd8a06be6e589f92112c953c8f8009">YARP_LOG_COMPONENT</a></div><div class="ttdeci">#define YARP_LOG_COMPONENT(name,...)</div><div class="ttdef"><b>Definition</b> <a href="libYARP__os_2src_2yarp_2os_2LogComponent_8h_source.html#l00076">LogComponent.h:76</a></div></div>
<div class="ttc" id="alibYARP__os_2src_2yarp_2os_2LogComponent_8h_html_ad0e528d4696fd8f5f0cbac02dd985f44"><div class="ttname"><a href="libYARP__os_2src_2yarp_2os_2LogComponent_8h.html#ad0e528d4696fd8f5f0cbac02dd985f44">yCFatal</a></div><div class="ttdeci">#define yCFatal(component,...)</div><div class="ttdef"><b>Definition</b> <a href="libYARP__os_2src_2yarp_2os_2LogComponent_8h_source.html#l00234">LogComponent.h:234</a></div></div>
<div class="ttc" id="alibYARP__os_2src_2yarp_2os_2all_8h_html"><div class="ttname"><a href="libYARP__os_2src_2yarp_2os_2all_8h.html">all.h</a></div></div>
<div class="ttc" id="alibYARP__sig_2src_2yarp_2sig_2all_8h_html"><div class="ttname"><a href="libYARP__sig_2src_2yarp_2sig_2all_8h.html">all.h</a></div></div>
<div class="ttc" id="anamespaceyarp_1_1dev_html"><div class="ttname"><a href="namespaceyarp_1_1dev.html">yarp::dev</a></div><div class="ttdoc">For streams capable of holding different kinds of content, check what they actually have.</div><div class="ttdef"><b>Definition</b> <a href="jointData_8cpp_source.html#l00013">jointData.cpp:13</a></div></div>
<div class="ttc" id="anamespaceyarp_1_1os_html"><div class="ttname"><a href="namespaceyarp_1_1os.html">yarp::os</a></div><div class="ttdoc">An interface to the operating system, including Port based communication.</div><div class="ttdef"><b>Definition</b> <a href="AbstractCarrier_8h_source.html#l00013">AbstractCarrier.h:13</a></div></div>
<div class="ttc" id="anamespaceyarp_1_1sig_1_1file_html"><div class="ttname"><a href="namespaceyarp_1_1sig_1_1file.html">yarp::sig::file</a></div><div class="ttdef"><b>Definition</b> <a href="ImageFile_8h_source.html#l00013">ImageFile.h:13</a></div></div>
<div class="ttc" id="anamespaceyarp_1_1sig_html"><div class="ttname"><a href="namespaceyarp_1_1sig.html">yarp::sig</a></div><div class="ttdef"><b>Definition</b> <a href="audioBufferSizeData_8cpp_source.html#l00013">audioBufferSizeData.cpp:13</a></div></div>
<div class="ttc" id="arealsense2Driver_8cpp_html_ac23eab13531d41c0e01f513774011d9b"><div class="ttname"><a href="realsense2Driver_8cpp.html#ac23eab13531d41c0e01f513774011d9b">framerate</a></div><div class="ttdeci">constexpr char framerate[]</div><div class="ttdef"><b>Definition</b> <a href="realsense2Driver_8cpp_source.html#l00036">realsense2Driver.cpp:36</a></div></div>
</div><!-- fragment --></div><!-- contents -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.9.1-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li><span id="projectname_footer">YARP</span></li>
    <li><span id="projectnumber" class="version_switch">3.10.1</span></li>
    <li class="navelem"><a class="el" href="dir_d946d32291de7db32f6a943fb45d46f4.html">src</a></li><li class="navelem"><a class="el" href="dir_abd80c029d214e783ff905e909ed9db6.html">devices</a></li><li class="navelem"><a class="el" href="dir_d26a7674abdafc0ad016c08a05860761.html">ffmpeg</a></li><li class="navelem"><a class="el" href="FfmpegWriter_8cpp.html">FfmpegWriter.cpp</a></li>
    <li class="footer">Generated on Wed Nov 27 2024 02:35:08 for YARP by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8 </li>
  </ul>
</div>
</body>
</html>
