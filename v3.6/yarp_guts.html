<!-- HTML header for doxygen 1.9.1-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>YARP: A trip through the guts of YARP</title>
<link rel="shortcut icon" href="yarp-favicon.ico" type="image/x-icon" />
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript">
    var DOCUMENTATION_OPTIONS = { VERSION: '3.6.0' };
</script>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(function() { init_search(); });
/* @license-end */
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="yarp-doxygen-style.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../version_switch.js"></script>
<link rel="stylesheet" type="text/css" href="cookieconsent.min.css" />
<script src="cookieconsent.min.js"></script>
<script>
window.addEventListener("load", function(){
window.cookieconsent.initialise({
  "palette": {
    "popup": {
      "background": "#eb6c44",
      "text": "#ffffff"
    },
    "button": {
      "background": "#237afc",
    }
  },
  "theme": "classic",
  "content": {
    "message": "INFORMATION NOTICE ON COOKIES : This website uses only browsing/session cookies. Users can choose whether or not to accept the use of cookies and access the website. By clicking on \"Further information\", the full information notice on the types of cookies will be displayed and you will be able  to choose whether or not to accept them whilst browsing on the website.",
    "dismiss": "ACCEPT and close",
    "link": "Further information",
    "href": "http://www.icub.org/other/personal_data_notice.html"
  }
})});
</script>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="yarp-robot-64.png"/></td>
  <td id="projectalign" style="padding-left: 1.5em;">
   <div id="projectname">YARP</div>
   <div id="projectbrief">Yet Another Robot Platform</div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.svg"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.svg" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('yarp_guts.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">A trip through the guts of YARP </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#yarp_guts_facade">Behind the facade</a></li>
<li class="level1"><a href="#yarp_guts_summary">Summary of important implementation classes</a></li>
<li class="level1"><a href="#yarp_guts_create">Port creation</a></li>
<li class="level1"><a href="#yarp_guts_connect">Connection creation</a></li>
<li class="level1"><a href="#yarp_guts_mcast">Multicast elections</a></li>
</ul>
</div>
<div class="textblock"><p>The goal of the tutorial is to help people find their way around the internals of the YARP implementation.</p>
<p>Most people will never need to read it. It could be useful if you want to extend or modify YARP in radical ways.</p>
<p>Beware: classes that are deemed to be "internal" (basically, anything in namespace <a class="el" href="namespaceyarp_1_1os_1_1impl.html" title="The components from which ports and connections are built.">yarp::os::impl</a>, yarp::sig::impl, etc) are more likely to change as time goes by than other classes.</p>
<h1><a class="anchor" id="yarp_guts_facade"></a>
Behind the facade</h1>
<p>Many YARP user-facing classes have private implementations, that is they follow this pattern:</p>
<div class="fragment"><div class="line"><span class="keyword">class </span>UserFacingClass {</div>
<div class="line">   ...</div>
<div class="line">private:</div>
<div class="line">  <span class="keywordtype">void</span> *<a class="code" href="RandnScalar_8cpp.html#acfd212359dc5a809fd0f4f7195c8e3f6">implementation</a>;</div>
<div class="line">};</div>
<div class="ttc" id="aRandnScalar_8cpp_html_acfd212359dc5a809fd0f4f7195c8e3f6"><div class="ttname"><a href="RandnScalar_8cpp.html#acfd212359dc5a809fd0f4f7195c8e3f6">implementation</a></div><div class="ttdeci">RandScalar * implementation(void *t)</div><div class="ttdef"><b>Definition:</b> <a href="RandnScalar_8cpp_source.html#l00017">RandnScalar.cpp:17</a></div></div>
</div><!-- fragment --><p>There are two reasons for this. One is ABI stability, so that significant changes can safely be made to the underlying implementation. Another reason is to insulate regular users of YARP from ACE header files. We use the ACE library in the implementation of YARP because of its portability, but it can turn proper compilation into an art-form. We don't want to force our users to deal with that (and don't want to deal with the confused emails they will send us). So we use ACE in the YARP implementation, but do not reference it in user-facing header files.</p>
<h1><a class="anchor" id="yarp_guts_summary"></a>
Summary of important implementation classes</h1>
<p>For every port, there is a <a class="el" href="classyarp_1_1os_1_1impl_1_1PortCore.html">yarp::os::impl::PortCore</a> object. The user-facing <a class="el" href="classyarp_1_1os_1_1Port.html" title="A mini-server for network communication.">yarp::os::Port</a> class is a superficial wrapper around this.</p>
<p>For every connection between two ports (call them the source port and the target port), there is a <a class="el" href="classyarp_1_1os_1_1impl_1_1PortCoreOutputUnit.html" title="Manager for a single output from a port.">yarp::os::impl::PortCoreOutputUnit</a> object held in a list by the source port's PortCore, and a <a class="el" href="classyarp_1_1os_1_1impl_1_1PortCoreInputUnit.html" title="Manager for a single input to a port.">yarp::os::impl::PortCoreInputUnit</a> object held in a list by the target port's PortCore.</p>
<p>Every PortCoreUnit has a <a class="el" href="classyarp_1_1os_1_1InputProtocol.html" title="The input side of an active connection between two ports.">yarp::os::InputProtocol</a> or <a class="el" href="classyarp_1_1os_1_1OutputProtocol.html" title="The output side of an active connection between two ports.">yarp::os::OutputProtocol</a> object that manages the overall phases of YARP's network protocol.</p>
<p>The Protocol object delegates to an object from the <a class="el" href="classyarp_1_1os_1_1Carrier.html" title="A base class for connection types (tcp, mcast, shmem, ...) which are called carriers in YARP.">yarp::os::Carrier</a> family (<a class="el" href="classyarp_1_1os_1_1impl_1_1TcpCarrier.html" title="Communicating between two ports via TCP.">yarp::os::impl::TcpCarrier</a>, <a class="el" href="classyarp_1_1os_1_1impl_1_1McastCarrier.html" title="Communicating between two ports via MCAST.">yarp::os::impl::McastCarrier</a>, ...) to manage the peculiarities of a particular connection type. This carrier can be replaced during the operation of a connection. Typically, connections start with a TcpCarrier, and then switch (after hand-shaking) to whatever carrier the user has selected.</p>
<p>Here's an example diagram of four ports. Port 1 is connected by multicast to ports 2 and 3, and by tcp to port 4.</p>
<div class="dotgraph">
<img src="dot_inline_dotgraph_9.png" alt="dot_inline_dotgraph_9.png" border="0" usemap="#dot_inline_dotgraph_9.map"/>
</div>
<p>This diagram shows logical data flow, but omits other relationships. For example, all McastCarrier objects acting as outputs for the same PortCore work together so that data only gets sent once on a shared logical bus. See <a class="el" href="yarp_guts.html#yarp_guts_mcast">Multicast elections</a>.</p>
<h1><a class="anchor" id="yarp_guts_create"></a>
Port creation</h1>
<p>Every <a class="el" href="classyarp_1_1os_1_1Port.html" title="A mini-server for network communication.">yarp::os::Port</a> or <a class="el" href="classyarp_1_1os_1_1BufferedPort.html" title="A mini-server for performing network communication in the background.">yarp::os::BufferedPort</a> contains exactly one <a class="el" href="classyarp_1_1os_1_1impl_1_1PortCore.html">yarp::os::impl::PortCore</a> object. This is the main coordinator for communication. Every <a class="el" href="classyarp_1_1os_1_1impl_1_1PortCore.html">yarp::os::impl::PortCore</a>, on start-up, initiates one yarp::os::impl::Face object. This object is currently always of type <a class="el" href="classyarp_1_1os_1_1impl_1_1TcpFace.html" title="Communicating with a port via TCP.">yarp::os::impl::TcpFace</a>, which represents a server socket.</p>
<p>The PortCore creates a thread to listen to the Face (the server socket). Any initial communication with the port is made via the Face.</p>
<p>The PortCore maintains a list of <a class="el" href="classyarp_1_1os_1_1impl_1_1PortCoreUnit.html" title="This manages a single threaded resource related to a single input or output connection.">yarp::os::impl::PortCoreUnit</a> objects. These represent incoming and outgoing connections. When a request is received via the Face to connect to some other port, the first step is to create a new PortCoreUnit (either a <a class="el" href="classyarp_1_1os_1_1impl_1_1PortCoreInputUnit.html" title="Manager for a single input to a port.">yarp::os::impl::PortCoreInputUnit</a> or a <a class="el" href="classyarp_1_1os_1_1impl_1_1PortCoreOutputUnit.html" title="Manager for a single output from a port.">yarp::os::impl::PortCoreOutputUnit</a>). Depending on the configuration of the port, a new thread may be created to service that unit. Inputs always get a new thread. Outputs get a new thread only if requested (see <a class="el" href="classyarp_1_1os_1_1Port.html#a013b993154498cd04031437049b3cb4b" title="control whether writing from this port is done in the background.">yarp::os::Port::enableBackgroundWrite</a>; this is called for BufferedPorts by default).</p>
<h1><a class="anchor" id="yarp_guts_connect"></a>
Connection creation</h1>
<p>When the Face object receives a communication from the outside world, it wraps it in a Protocol object. Concretely, this means that the TcpFace server socket takes each socket it receives and gives it to the PortCore as a Protocol object, which then creates a PortCoreUnit to manage that Protocol object. The abstraction is important here because one of the first steps of the YARP network protocol allows connections to switch from whatever the carrier used to establish the connection is (TCP) to something different for transmitting payloads (multicast, shared memory, etc). The Protocol object is either <a class="el" href="classyarp_1_1os_1_1InputProtocol.html" title="The input side of an active connection between two ports.">yarp::os::InputProtocol</a> or <a class="el" href="classyarp_1_1os_1_1OutputProtocol.html" title="The output side of an active connection between two ports.">yarp::os::OutputProtocol</a> (in fact both of these are interfaces implemented by a single class, <a class="el" href="classyarp_1_1os_1_1impl_1_1Protocol.html" title="Connection choreographer.">yarp::os::impl::Protocol</a>, but most of YARP does not know that).</p>
<p>The Protocol object deals with switching to a particular carrier (implemented by sub-types of <a class="el" href="classyarp_1_1os_1_1Carrier.html" title="A base class for connection types (tcp, mcast, shmem, ...) which are called carriers in YARP.">yarp::os::Carrier</a>), and the details of the YARP network protocol.</p>
<h1><a class="anchor" id="yarp_guts_mcast"></a>
Multicast elections</h1>
<p>The two McastCarrier objects owned by Port 1 in the figure above "conspire" behind the scenes to make sure only one of them sends data, but as far as the rest of YARP is concerned there's nothing special about them. This conspiracy is implemented via a global yarp::os::Election object. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.9.1-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li><span id="projectname_footer">YARP</span></li>
    <li><span id="projectnumber" class="version_switch">3.6.0</span></li>
    <li class="footer">Generated on Wed Jun 1 2022 14:48:32 for YARP by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1 </li>
  </ul>
</div>
</body>
</html>
