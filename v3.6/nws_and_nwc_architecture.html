<!-- HTML header for doxygen 1.9.1-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>YARP: Network Wrapper Server and Network Wrapper Client Architecture</title>
<link rel="shortcut icon" href="yarp-favicon.ico" type="image/x-icon" />
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript">
    var DOCUMENTATION_OPTIONS = { VERSION: '3.6.0' };
</script>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(function() { init_search(); });
/* @license-end */
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="yarp-doxygen-style.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../version_switch.js"></script>
<link rel="stylesheet" type="text/css" href="cookieconsent.min.css" />
<script src="cookieconsent.min.js"></script>
<script>
window.addEventListener("load", function(){
window.cookieconsent.initialise({
  "palette": {
    "popup": {
      "background": "#eb6c44",
      "text": "#ffffff"
    },
    "button": {
      "background": "#237afc",
    }
  },
  "theme": "classic",
  "content": {
    "message": "INFORMATION NOTICE ON COOKIES : This website uses only browsing/session cookies. Users can choose whether or not to accept the use of cookies and access the website. By clicking on \"Further information\", the full information notice on the types of cookies will be displayed and you will be able  to choose whether or not to accept them whilst browsing on the website.",
    "dismiss": "ACCEPT and close",
    "link": "Further information",
    "href": "http://www.icub.org/other/personal_data_notice.html"
  }
})});
</script>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="yarp-robot-64.png"/></td>
  <td id="projectalign" style="padding-left: 1.5em;">
   <div id="projectname">YARP</div>
   <div id="projectbrief">Yet Another Robot Platform</div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.svg"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.svg" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('nws_and_nwc_architecture.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Network Wrapper Server and Network Wrapper Client Architecture </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#autotoc_md10">Architecture Description</a></li>
<li class="level1"><a href="#autotoc_md11">Historical Notes and Rationale</a><ul><li class="level2"><a href="#autotoc_md12">YARP and ROS wrappers</a></li>
<li class="level2"><a href="#autotoc_md13">Naming</a></li>
<li class="level2"><a href="#autotoc_md14">Logic inside the wrappers</a></li>
<li class="level2"><a href="#autotoc_md15">Definition of the protocol</a></li>
</ul>
</li>
<li class="level1"><a href="#autotoc_md16">Recommendation</a><ul><li class="level2"><a href="#autotoc_md17">Naming convention</a></li>
<li class="level2"><a href="#autotoc_md18">Directories</a></li>
<li class="level2"><a href="#autotoc_md19">Definition of the protocol</a></li>
<li class="level2"><a href="#autotoc_md20">Logic inside</a></li>
<li class="level2"><a href="#autotoc_md21">Base class for NWS</a></li>
</ul>
</li>
</ul>
</div>
<div class="textblock"><p><a class="anchor" id="md_doc_nws_and_nwc_architecture"></a></p>
<h1><a class="anchor" id="autotoc_md10"></a>
Architecture Description</h1>
<p>A device driver should derive from the abstract class <a href="http://www.yarp.it/git-master/classyarp_1_1dev_1_1DeviceDriver.html"><code>yarp::dev::DeviceDriver</code></a>. This interface contains methods common to all device drivers, such as open and close. Additionally a device driver should implement a selection of other interfaces that capture what it shares with other families of devices. For example a camera might implement <a href="http://www.yarp.it/git-master/classyarp_1_1dev_1_1IFrameGrabber.html"><code>yarp:dev::IFrameGrabber</code></a> (a "raw" interface to the raw data) and/or <a href="http://www.yarp.it/git-master/classyarp_1_1dev_1_1IFrameGrabberImage.html"><code>yarp::dev::IFrameGrabberImage</code></a> (a higher-level source of images).</p>
<p>Even if a device is normally opened as a <em>plugin</em> through the <a href="http://www.yarp.it/git-master/classyarp_1_1dev_1_1PolyDriver.html"><code>PolyDriver</code></a> class, and the process instantiating the device driver <em>locally</em> does not know exactly what interfaces are implemented by the device, the process is still able to access to these interfaces by calling the <a href="http://www.yarp.it/git-master/classyarp_1_1dev_1_1DeviceDriver.html#ad2a1b10de5dda3160d687ebb5f20577c"><code>view&lt;T&gt;()</code></a> template method.</p>
<p>YARP Network Wrapper Server/Client architecture extends this functionalities to a <em>remote</em> device.</p>
<p>A "*Network Wrapper Client*" (<b>NWC</b>) is a device driver (i.e. derived from the <a href="http://www.yarp.it/git-master/classyarp_1_1dev_1_1DeviceDriver.html"><code>yarp::dev::DeviceDriver</code></a> class), and implements the same interfaces that a normal device would implement, but instead of being connected to a physical device, it is connected to a "*Network Wrapper Server*" (<b>NWS</b>), or equivalent for different middlewares. A "*Network Wrapper Server*" (<b>NWS</b>) is a very thin layer that is attached (using the <a href="http://www.yarp.it/git-master/classyarp_1_1dev_1_1IWrapper.html#ad7637d057fd26a32eb27f87a046fe095"><code>IWrapper::attach()</code></a> method), and that should not have any logic inside, besides forwarding the interfaces to the client. In this way, it is possible to develop an application that can work indifferently with a local or with a remote device, without any need to change the code of the application, but just adjusting a few parameters.</p>
<p>NWC and NWS are tightly coupled, and communicate using some protocol (which does not necessarily imply that YARP is used underneath, in the future there might be NWC and NWS couples using ROS or some other protocol to communicate). NWS and NWC can be replaced by something else that uses the exact same protocol.</p>
<h1><a class="anchor" id="autotoc_md11"></a>
Historical Notes and Rationale</h1>
<p>The following sections are supposed to give a rationale to the changes that are currently happening in the backstage.</p>
<h2><a class="anchor" id="autotoc_md12"></a>
YARP and ROS wrappers</h2>
<p>Before YARP 3 and earlier releases, network wrappers were for YARP only. Recently, with the introduction of YARP-ROS compatibility layer, wrappers started implementing also the compatibility with the ROS middleware, with tons of if and switch cases inside the code. Obviously, this doesn't scale to other middlewares.</p>
<p>There is no limit to how many wrappers can be attached to a device. We are therefore currently working to split the wrappers in two separate wrappers (one for YARP and one for ROS) that can be attached to the same device. Unfortunately this has the limitation that only one of them can be launched using <code>yarpdev</code>, and in order to use both of them contemporarily, it is necessary to use <code>yarprobotinterface</code>. We are currently considering whether to modify <code>yarpdev</code> to support attaching multiple wrappers.</p>
<h2><a class="anchor" id="autotoc_md13"></a>
Naming</h2>
<p>Before YARP 3.5, NWS have often been called including one or more of these terms:</p>
<ul>
<li>Wrapper</li>
<li>Network Wrapper</li>
<li>Server</li>
</ul>
<p>NWC have been called including one or more of these terms in their names:</p>
<ul>
<li>Client</li>
<li>Remote</li>
</ul>
<p>The server and client nomenclature was not always the same, therefore it was not always immediate to understand which client should be connected to a server.</p>
<p>Moreover the name "server" is used also for servers that are not network wrappers, and the name "wrapper" is used also for devices that do not implement a client/server architecture (e.g. calibrators).</p>
<p>After several discussions we came out with this new nomenclature, that should avoid any ambiguity</p>
<ul>
<li><em>Network Wrapper Client</em> (<b>NWC</b>)</li>
<li><em>Network Wrapper Server</em> (<b>NWS</b>)</li>
</ul>
<p>We also decided that the couples of NWC and NWS should share a part of the name, so that it is easy to understand which devices can be connected.</p>
<p>Devices that are actually servers (i.e. servers that are devices, so that they can be started from <code>yarprobotinterface</code>) will not change their name.</p>
<p>We also decided to include in the name the middleware used underneath (even for YARP).</p>
<h2><a class="anchor" id="autotoc_md14"></a>
Logic inside the wrappers</h2>
<p>Before YARP 3.5, a few wrappers had "logic" inside. This means that using a device locally it is different, compared to using it remotely. This also means that a few wrappers, in order to avoid this differences, had to implement the same interfaces of the device wrapped. In order to make things as small and clear as possible, network wrappers should not have any logic inside, and instead a separate wrapper (note: not a <b>network</b> wrapper here) should be created, and the NWS should be attached to this device instead of to the actual device. NWS and NWC using a transport that is different from YARP, can require some conversion in order to match with the standards used by the middleware underneath. This kind of conversion is acceptable</p>
<h2><a class="anchor" id="autotoc_md15"></a>
Definition of the protocol</h2>
<p>Historically, the protocol used in YARP NWC and NWS was defined inside the code. This is not recommended, since it requires for that the server and client are kept in sync. For more recent devices, the definition of the protocol was moved to a thrift file, allowing to modify it in just one place.</p>
<h1><a class="anchor" id="autotoc_md16"></a>
Recommendation</h1>
<h2><a class="anchor" id="autotoc_md17"></a>
Naming convention</h2>
<p>The name of the device consists of 3 parts, separated by a <code>_</code> character:</p><ul>
<li>A "significative" common part shared by both devices (camelCase, with the first word lowercase)</li>
<li><code>nwc</code> or <code>nws</code>.</li>
<li>The name of the middleware (lowercase) (<code>yarp</code>, <code>ros</code>, etc.)</li>
</ul>
<p>For example:</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">NWS   </th><th class="markdownTableHeadNone">NWC    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>controlBoard_nws_yarp</code>   </td><td class="markdownTableBodyNone"><code>controlBoard_nwc_yarp</code>    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>multipleAnalogSensor_nws_yarp</code>   </td><td class="markdownTableBodyNone"><code>multipleAnalogSensor_nwc_yarp</code>   </td></tr>
</table>
<h2><a class="anchor" id="autotoc_md18"></a>
Directories</h2>
<p>NWC, NWS and protocol should be in the same directory</p>
<h2><a class="anchor" id="autotoc_md19"></a>
Definition of the protocol</h2>
<p>Using Thrift is currently the recommended way to do define the protocol between NWC and NWS</p>
<h2><a class="anchor" id="autotoc_md20"></a>
Logic inside</h2>
<p>NWC and NWS should not have any logic inside, besides the one required to replicate the interfaces remotely. Any logic should be moved to a different device. Logic in NWS and NWC using a transport that is different from YARP is acceptable in order to match the data with what is expected from the middleware used underneath. This means that any conversion that is performed by the NVS must be matched by an inverse conversion on the NVC.</p>
<h2><a class="anchor" id="autotoc_md21"></a>
Base class for NWS</h2>
<p>The base class for all NWS should be <a class="el" href="classyarp_1_1dev_1_1WrapperSingle.html" title="Helper interface for an object that can wrap/or &quot;attach&quot; to a single other device.">yarp::dev::WrapperSingle</a> because NWS are supposed to attach always to one and just one device. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.9.1-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li><span id="projectname_footer">YARP</span></li>
    <li><span id="projectnumber" class="version_switch">3.6.0</span></li>
    <li class="footer">Generated on Wed Jun 1 2022 14:48:31 for YARP by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1 </li>
  </ul>
</div>
</body>
</html>
