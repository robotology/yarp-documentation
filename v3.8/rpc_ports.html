<!-- HTML header for doxygen 1.9.1-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>YARP: Specialized RPC ports</title>
<link rel="shortcut icon" href="yarp-favicon.ico" type="image/x-icon" />
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript">
    var DOCUMENTATION_OPTIONS = { VERSION: '3.8.1' };
</script>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
  $(document).ready(function() { init_search(); });
/* @license-end */
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="yarp-doxygen-style.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../version_switch.js"></script>
<script src="https://cookiehub.net/c2/44d56061.js"></script>
<script type="text/javascript">
window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('consent', 'default', {'ad_storage': 'denied', 'analytics_storage': 'denied', 'wait_for_update': 500});
document.addEventListener("DOMContentLoaded", function(event) {
var cpm = {};
window.cookiehub.load(cpm);
});
</script>
<!--
<link rel="stylesheet" type="text/css" href="cookieconsent.min.css" />
<script src="cookieconsent.min.js"></script>
<script>
window.addEventListener("load", function(){
window.cookieconsent.initialise({
  "palette": {
    "popup": {
      "background": "#eb6c44",
      "text": "#ffffff"
    },
    "button": {
      "background": "#237afc",
    }
  },
  "theme": "classic",
  "content": {
    "message": "INFORMATION NOTICE ON COOKIES : This website uses only browsing/session cookies. Users can choose whether or not to accept the use of cookies and access the website. By clicking on \"Further information\", the full information notice on the types of cookies will be displayed and you will be able  to choose whether or not to accept them whilst browsing on the website.",
    "dismiss": "ACCEPT and close",
    "link": "Further information",
    "href": "http://www.icub.eu/other/personal_data_notice.html"
  }
})});
</script>
-->
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="yarp-robot-64.png"/></td>
  <td id="projectalign" style="padding-left: 1.5em;">
   <div id="projectname">YARP</div>
   <div id="projectbrief">Yet Another Robot Platform</div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <span id="MSearchSelect"                onmouseover="return searchBox.OnSearchSelectShow()"                onmouseout="return searchBox.OnSearchSelectHide()">&#160;</span>
          <input type="text" id="MSearchField" value="" placeholder="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.svg" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('rpc_ports.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Specialized RPC ports</div></div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#rpc_ports_basics">RPC using regular YARP ports</a></li>
<li class="level1"><a href="#rpc_ports_special">RPC using specialized YARP ports</a></li>
<li class="level1"><a href="#rpc_ports_sniffing">Monitoring RPC communication</a></li>
</ul>
</div>
<div class="textblock"><p>RPC stands for "Remote Procedure Call", and in YARP is used to refer to communication that consists of a message and a reply to that message.</p>
<p>Historically, YARP has stressed streaming communication (without replies) because in our experience it leads to more robust and scalable control logic. However, RPC definitely has its place, and this tutorial describes how to do it in YARP.</p>
<h1><a class="anchor" id="rpc_ports_basics"></a>
RPC using regular YARP ports</h1>
<p>The basic mechanism for getting replies with YARP is described in the <a class="el" href="port_expert.html#port_expert_reply">getting replies</a> section of the <a class="el" href="port_expert.html">Port Power</a> tutorial. The RPC ports are a thin wrapper around regular ports, for the purpose of restricting flexibility rather than increasing it.</p>
<h1><a class="anchor" id="rpc_ports_special"></a>
RPC using specialized YARP ports</h1>
<p>If you intend to use ports for RPC alone, you can use the <a class="el" href="classyarp_1_1os_1_1RpcClient.html" title="A port that is specialized as an RPC client.">yarp::os::RpcClient</a> and <a class="el" href="classyarp_1_1os_1_1RpcServer.html" title="A port that is specialized as an RPC server.">yarp::os::RpcServer</a> classes. These are just like the regular <a class="el" href="classyarp_1_1os_1_1Port.html" title="A mini-server for network communication.">yarp::os::Port</a> class, except that streaming operation is prohibited. By using these classes, YARP can check for accidental misusage of the ports, and give more helpful error messages.</p>
<p>Here is an example server: </p><div class="fragment"><div class="line"><span class="comment">/*</span></div>
<div class="line"><span class="comment"> * SPDX-FileCopyrightText: 2006-2021 Istituto Italiano di Tecnologia (IIT)</span></div>
<div class="line"><span class="comment"> * SPDX-FileCopyrightText: 2006-2010 RobotCub Consortium</span></div>
<div class="line"><span class="comment"> * SPDX-License-Identifier: BSD-3-Clause</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">/*</span></div>
<div class="line"><span class="comment"> * This is an example of using a specialized RpcServer port to receive</span></div>
<div class="line"><span class="comment"> * and reply to messages.  Regular YARP ports can do this as well (see</span></div>
<div class="line"><span class="comment"> * summer.cpp), but use of RpcServer/RpcClient allows for better</span></div>
<div class="line"><span class="comment"> * run-time checking of port usage to catch mistakes.</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="Bottle_8h.html">yarp/os/Bottle.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="Network_8h.html">yarp/os/Network.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="RpcServer_8h.html">yarp/os/RpcServer.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="libYARP__os_2src_2yarp_2os_2Time_8h.html">yarp/os/Time.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;cstdio&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">using </span><a class="code hl_class" href="classyarp_1_1os_1_1Bottle.html">yarp::os::Bottle</a>;</div>
<div class="line"><span class="keyword">using </span><a class="code hl_class" href="classyarp_1_1os_1_1Network.html">yarp::os::Network</a>;</div>
<div class="line"><span class="keyword">using </span><a class="code hl_class" href="classyarp_1_1os_1_1RpcServer.html">yarp::os::RpcServer</a>;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">using namespace </span><a class="code hl_namespace" href="namespaceyarp_1_1os.html">yarp::os</a>;</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> <a class="code hl_function" href="yarpros_8cpp.html#a0ddf1224851353fc92bfbff6f499fa97">main</a>(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span>* argv[])</div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">if</span> (argc &lt; 2) {</div>
<div class="line">        <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">fprintf</a>(<a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">stderr</a>, <span class="stringliteral">&quot;Please supply a port name for the server\n&quot;</span>);</div>
<div class="line">        <span class="keywordflow">return</span> 1;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">char</span>* name = argv[1];</div>
<div class="line"> </div>
<div class="line">    <a class="code hl_class" href="classyarp_1_1os_1_1Network.html">Network</a> <a class="code hl_namespace" href="namespaceyarp.html">yarp</a>;</div>
<div class="line">    <a class="code hl_class" href="classyarp_1_1os_1_1RpcServer.html">RpcServer</a> port;</div>
<div class="line">    port.<a class="code hl_function" href="classyarp_1_1os_1_1AbstractContactable.html#a8e54d61a5270cbfe3aaf918423a7b579">open</a>(name);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">while</span> (<span class="keyword">true</span>) {</div>
<div class="line">        <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">printf</a>(<span class="stringliteral">&quot;Waiting for a message...\n&quot;</span>);</div>
<div class="line">        <a class="code hl_class" href="classyarp_1_1os_1_1Bottle.html">Bottle</a> cmd;</div>
<div class="line">        <a class="code hl_class" href="classyarp_1_1os_1_1Bottle.html">Bottle</a> response;</div>
<div class="line">        port.<a class="code hl_function" href="classyarp_1_1os_1_1RpcServer.html#a5e550b11484a29733b10ce9eefebed4f">read</a>(cmd, <span class="keyword">true</span>);</div>
<div class="line">        <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">printf</a>(<span class="stringliteral">&quot;Got message: %s\n&quot;</span>, cmd.<a class="code hl_function" href="classyarp_1_1os_1_1Bottle.html#ad8cb921bd7e22d6fcafc3a61db65e75c">toString</a>().c_str());</div>
<div class="line">        response.<a class="code hl_function" href="classyarp_1_1os_1_1Bottle.html#ad5bc9c6a71cde0b2bec814f3b632e28a">addString</a>(<span class="stringliteral">&quot;you&quot;</span>);</div>
<div class="line">        response.<a class="code hl_function" href="classyarp_1_1os_1_1Bottle.html#ad5bc9c6a71cde0b2bec814f3b632e28a">addString</a>(<span class="stringliteral">&quot;said&quot;</span>);</div>
<div class="line">        response.<a class="code hl_function" href="classyarp_1_1os_1_1Bottle.html#a3aaf3d68715913bf052c4729485ba42c">append</a>(cmd);</div>
<div class="line">        <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">printf</a>(<span class="stringliteral">&quot;Sending reply: %s\n&quot;</span>, response.<a class="code hl_function" href="classyarp_1_1os_1_1Bottle.html#ad8cb921bd7e22d6fcafc3a61db65e75c">toString</a>().c_str());</div>
<div class="line">        port.<a class="code hl_function" href="classyarp_1_1os_1_1AbstractContactable.html#a0e1a0e2c71838d239fe9565a876a1284">reply</a>(response);</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="ttc" id="aBottle_8h_html"><div class="ttname"><a href="Bottle_8h.html">Bottle.h</a></div></div>
<div class="ttc" id="aNetwork_8h_html"><div class="ttname"><a href="Network_8h.html">Network.h</a></div></div>
<div class="ttc" id="aRpcServer_8h_html"><div class="ttname"><a href="RpcServer_8h.html">RpcServer.h</a></div></div>
<div class="ttc" id="aclassyarp_1_1os_1_1AbstractContactable_html_a0e1a0e2c71838d239fe9565a876a1284"><div class="ttname"><a href="classyarp_1_1os_1_1AbstractContactable.html#a0e1a0e2c71838d239fe9565a876a1284">yarp::os::AbstractContactable::reply</a></div><div class="ttdeci">bool reply(PortWriter &amp;writer) override</div><div class="ttdoc">Send an object as a reply to an object read from the port.</div><div class="ttdef"><b>Definition</b> <a href="AbstractContactable_8cpp_source.html#l00165">AbstractContactable.cpp:165</a></div></div>
<div class="ttc" id="aclassyarp_1_1os_1_1AbstractContactable_html_a8e54d61a5270cbfe3aaf918423a7b579"><div class="ttname"><a href="classyarp_1_1os_1_1AbstractContactable.html#a8e54d61a5270cbfe3aaf918423a7b579">yarp::os::AbstractContactable::open</a></div><div class="ttdeci">bool open(const std::string &amp;name) override</div><div class="ttdoc">Start port operation, with a specific name, with automatically-chosen network parameters.</div><div class="ttdef"><b>Definition</b> <a href="AbstractContactable_8cpp_source.html#l00009">AbstractContactable.cpp:9</a></div></div>
<div class="ttc" id="aclassyarp_1_1os_1_1Bottle_html"><div class="ttname"><a href="classyarp_1_1os_1_1Bottle.html">yarp::os::Bottle</a></div><div class="ttdoc">A simple collection of objects that can be described and transmitted in a portable way.</div><div class="ttdef"><b>Definition</b> <a href="Bottle_8h_source.html#l00063">Bottle.h:64</a></div></div>
<div class="ttc" id="aclassyarp_1_1os_1_1Bottle_html_a3aaf3d68715913bf052c4729485ba42c"><div class="ttname"><a href="classyarp_1_1os_1_1Bottle.html#a3aaf3d68715913bf052c4729485ba42c">yarp::os::Bottle::append</a></div><div class="ttdeci">void append(const Bottle &amp;alt)</div><div class="ttdoc">Append the content of the given bottle to the current list.</div><div class="ttdef"><b>Definition</b> <a href="Bottle_8cpp_source.html#l00380">Bottle.cpp:380</a></div></div>
<div class="ttc" id="aclassyarp_1_1os_1_1Bottle_html_ad5bc9c6a71cde0b2bec814f3b632e28a"><div class="ttname"><a href="classyarp_1_1os_1_1Bottle.html#ad5bc9c6a71cde0b2bec814f3b632e28a">yarp::os::Bottle::addString</a></div><div class="ttdeci">void addString(const char *str)</div><div class="ttdoc">Places a string in the bottle, at the end of the list.</div><div class="ttdef"><b>Definition</b> <a href="Bottle_8cpp_source.html#l00170">Bottle.cpp:170</a></div></div>
<div class="ttc" id="aclassyarp_1_1os_1_1Bottle_html_ad8cb921bd7e22d6fcafc3a61db65e75c"><div class="ttname"><a href="classyarp_1_1os_1_1Bottle.html#ad8cb921bd7e22d6fcafc3a61db65e75c">yarp::os::Bottle::toString</a></div><div class="ttdeci">std::string toString() const override</div><div class="ttdoc">Gives a human-readable textual representation of the bottle.</div><div class="ttdef"><b>Definition</b> <a href="Bottle_8cpp_source.html#l00211">Bottle.cpp:211</a></div></div>
<div class="ttc" id="aclassyarp_1_1os_1_1BufferedPort_html"><div class="ttname"><a href="classyarp_1_1os_1_1BufferedPort.html">yarp::os::BufferedPort</a></div><div class="ttdoc">A mini-server for performing network communication in the background.</div><div class="ttdef"><b>Definition</b> <a href="BufferedPort_8h_source.html#l00059">BufferedPort.h:60</a></div></div>
<div class="ttc" id="aclassyarp_1_1os_1_1Network_html"><div class="ttname"><a href="classyarp_1_1os_1_1Network.html">yarp::os::Network</a></div><div class="ttdoc">Utilities for manipulating the YARP network, including initialization and shutdown.</div><div class="ttdef"><b>Definition</b> <a href="Network_8h_source.html#l00779">Network.h:780</a></div></div>
<div class="ttc" id="aclassyarp_1_1os_1_1RpcServer_html"><div class="ttname"><a href="classyarp_1_1os_1_1RpcServer.html">yarp::os::RpcServer</a></div><div class="ttdoc">A port that is specialized as an RPC server.</div><div class="ttdef"><b>Definition</b> <a href="RpcServer_8h_source.html#l00022">RpcServer.h:23</a></div></div>
<div class="ttc" id="aclassyarp_1_1os_1_1RpcServer_html_a5e550b11484a29733b10ce9eefebed4f"><div class="ttname"><a href="classyarp_1_1os_1_1RpcServer.html#a5e550b11484a29733b10ce9eefebed4f">yarp::os::RpcServer::read</a></div><div class="ttdeci">bool read(PortReader &amp;reader, bool willReply=true) override</div><div class="ttdoc">Read an object from the port.</div><div class="ttdef"><b>Definition</b> <a href="RpcServer_8cpp_source.html#l00049">RpcServer.cpp:49</a></div></div>
<div class="ttc" id="alibYARP__os_2src_2yarp_2os_2Time_8h_html"><div class="ttname"><a href="libYARP__os_2src_2yarp_2os_2Time_8h.html">Time.h</a></div></div>
<div class="ttc" id="anamespaceyarp_1_1os_html"><div class="ttname"><a href="namespaceyarp_1_1os.html">yarp::os</a></div><div class="ttdoc">An interface to the operating system, including Port based communication.</div><div class="ttdef"><b>Definition</b> <a href="AbstractCarrier_8h_source.html#l00013">AbstractCarrier.h:13</a></div></div>
<div class="ttc" id="anamespaceyarp_html"><div class="ttname"><a href="namespaceyarp.html">yarp</a></div><div class="ttdoc">The main, catch-all namespace for YARP.</div><div class="ttdef"><b>Definition</b> <a href="dirs_8h_source.html#l00016">dirs.h:16</a></div></div>
<div class="ttc" id="ayarpros_8cpp_html_a0ddf1224851353fc92bfbff6f499fa97"><div class="ttname"><a href="yarpros_8cpp.html#a0ddf1224851353fc92bfbff6f499fa97">main</a></div><div class="ttdeci">int main(int argc, char *argv[])</div><div class="ttdef"><b>Definition</b> <a href="yarpros_8cpp_source.html#l00265">yarpros.cpp:265</a></div></div>
</div><!-- fragment --><p>And here is a client to go with it: </p><div class="fragment"><div class="line"><span class="comment">/*</span></div>
<div class="line"><span class="comment"> * SPDX-FileCopyrightText: 2006-2021 Istituto Italiano di Tecnologia (IIT)</span></div>
<div class="line"><span class="comment"> * SPDX-FileCopyrightText: 2006-2010 RobotCub Consortium</span></div>
<div class="line"><span class="comment"> * SPDX-License-Identifier: BSD-3-Clause</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">/*</span></div>
<div class="line"><span class="comment"> * This is an example of using a specialized RpcClient port to send</span></div>
<div class="line"><span class="comment"> * messages and receive replies.  Regular YARP ports can do this as well,</span></div>
<div class="line"><span class="comment"> * but use of RpcServer/RpcClient allows for better</span></div>
<div class="line"><span class="comment"> * run-time checking of port usage to catch mistakes.</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="Bottle_8h.html">yarp/os/Bottle.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="Network_8h.html">yarp/os/Network.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="RpcClient_8h.html">yarp/os/RpcClient.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="libYARP__os_2src_2yarp_2os_2Time_8h.html">yarp/os/Time.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;cstdio&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">using </span><a class="code hl_class" href="classyarp_1_1os_1_1Bottle.html">yarp::os::Bottle</a>;</div>
<div class="line"><span class="keyword">using </span><a class="code hl_class" href="classyarp_1_1os_1_1Network.html">yarp::os::Network</a>;</div>
<div class="line"><span class="keyword">using </span><a class="code hl_class" href="classyarp_1_1os_1_1RpcClient.html">yarp::os::RpcClient</a>;</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> <a class="code hl_function" href="yarpros_8cpp.html#a0ddf1224851353fc92bfbff6f499fa97">main</a>(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span>* argv[])</div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">if</span> (argc &lt; 3) {</div>
<div class="line">        <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">fprintf</a>(<a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">stderr</a>, <span class="stringliteral">&quot;Please supply (1) a port name for the client\n&quot;</span>);</div>
<div class="line">        <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">fprintf</a>(<a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">stderr</a>, <span class="stringliteral">&quot;              (2) a port name for the server\n&quot;</span>);</div>
<div class="line">        <span class="keywordflow">return</span> 1;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <a class="code hl_class" href="classyarp_1_1os_1_1Network.html">Network</a> <a class="code hl_namespace" href="namespaceyarp.html">yarp</a>;</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">char</span>* <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">client_name</a> = argv[1];</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">char</span>* <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">server_name</a> = argv[2];</div>
<div class="line"> </div>
<div class="line">    <a class="code hl_class" href="classyarp_1_1os_1_1RpcClient.html">RpcClient</a> port;</div>
<div class="line">    port.<a class="code hl_function" href="classyarp_1_1os_1_1AbstractContactable.html#a8e54d61a5270cbfe3aaf918423a7b579">open</a>(<a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">client_name</a>);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">int</span> ct = 0;</div>
<div class="line">    <span class="keywordflow">while</span> (<span class="keyword">true</span>) {</div>
<div class="line">        <span class="keywordflow">if</span> (port.<a class="code hl_function" href="classyarp_1_1os_1_1AbstractContactable.html#a3dfef6eb03e002f9a78439e2bf88cee1">getOutputCount</a>() == 0) {</div>
<div class="line">            <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">printf</a>(<span class="stringliteral">&quot;Trying to connect to %s\n&quot;</span>, <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">server_name</a>);</div>
<div class="line">            <a class="code hl_function" href="classyarp_1_1os_1_1NetworkBase.html#a20d1100e9e9056164290a5e98e7a651d">yarp::os::Network::connect</a>(<a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">client_name</a>, <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">server_name</a>);</div>
<div class="line">        } <span class="keywordflow">else</span> {</div>
<div class="line">            <a class="code hl_class" href="classyarp_1_1os_1_1Bottle.html">Bottle</a> cmd;</div>
<div class="line">            cmd.<a class="code hl_function" href="classyarp_1_1os_1_1Bottle.html#ad5bc9c6a71cde0b2bec814f3b632e28a">addString</a>(<span class="stringliteral">&quot;COUNT&quot;</span>);</div>
<div class="line">            cmd.<a class="code hl_function" href="classyarp_1_1os_1_1Bottle.html#ac5ff63ea20f6c877e5c4541121f98482">addInt32</a>(ct);</div>
<div class="line">            ct++;</div>
<div class="line">            <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">printf</a>(<span class="stringliteral">&quot;Sending message... %s\n&quot;</span>, cmd.<a class="code hl_function" href="classyarp_1_1os_1_1Bottle.html#ad8cb921bd7e22d6fcafc3a61db65e75c">toString</a>().c_str());</div>
<div class="line">            <a class="code hl_class" href="classyarp_1_1os_1_1Bottle.html">Bottle</a> response;</div>
<div class="line">            port.<a class="code hl_function" href="classyarp_1_1os_1_1AbstractContactable.html#a42a166b730265667ecdf56f1f8156d62">write</a>(cmd, response);</div>
<div class="line">            <a class="code hl_class" href="classyarp_1_1os_1_1BufferedPort.html">printf</a>(<span class="stringliteral">&quot;Got response: %s\n&quot;</span>, response.<a class="code hl_function" href="classyarp_1_1os_1_1Bottle.html#ad8cb921bd7e22d6fcafc3a61db65e75c">toString</a>().c_str());</div>
<div class="line">        }</div>
<div class="line">        <a class="code hl_function" href="namespaceyarp_1_1os_1_1Time.html#aca80809e0597551745954e2547e581ee">yarp::os::Time::delay</a>(1);</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="ttc" id="aRpcClient_8h_html"><div class="ttname"><a href="RpcClient_8h.html">RpcClient.h</a></div></div>
<div class="ttc" id="aclassyarp_1_1os_1_1AbstractContactable_html_a3dfef6eb03e002f9a78439e2bf88cee1"><div class="ttname"><a href="classyarp_1_1os_1_1AbstractContactable.html#a3dfef6eb03e002f9a78439e2bf88cee1">yarp::os::AbstractContactable::getOutputCount</a></div><div class="ttdeci">int getOutputCount() override</div><div class="ttdoc">Determine how many output connections this port has.</div><div class="ttdef"><b>Definition</b> <a href="AbstractContactable_8cpp_source.html#l00076">AbstractContactable.cpp:76</a></div></div>
<div class="ttc" id="aclassyarp_1_1os_1_1AbstractContactable_html_a42a166b730265667ecdf56f1f8156d62"><div class="ttname"><a href="classyarp_1_1os_1_1AbstractContactable.html#a42a166b730265667ecdf56f1f8156d62">yarp::os::AbstractContactable::write</a></div><div class="ttdeci">bool write(const PortWriter &amp;writer, const PortWriter *callback=nullptr) const override</div><div class="ttdoc">Write an object to the port.</div><div class="ttdef"><b>Definition</b> <a href="AbstractContactable_8cpp_source.html#l00146">AbstractContactable.cpp:146</a></div></div>
<div class="ttc" id="aclassyarp_1_1os_1_1Bottle_html_ac5ff63ea20f6c877e5c4541121f98482"><div class="ttname"><a href="classyarp_1_1os_1_1Bottle.html#ac5ff63ea20f6c877e5c4541121f98482">yarp::os::Bottle::addInt32</a></div><div class="ttdeci">void addInt32(std::int32_t x)</div><div class="ttdoc">Places a 32-bit integer in the bottle, at the end of the list.</div><div class="ttdef"><b>Definition</b> <a href="Bottle_8cpp_source.html#l00140">Bottle.cpp:140</a></div></div>
<div class="ttc" id="aclassyarp_1_1os_1_1NetworkBase_html_a20d1100e9e9056164290a5e98e7a651d"><div class="ttname"><a href="classyarp_1_1os_1_1NetworkBase.html#a20d1100e9e9056164290a5e98e7a651d">yarp::os::NetworkBase::connect</a></div><div class="ttdeci">static bool connect(const std::string &amp;src, const std::string &amp;dest, const std::string &amp;carrier=&quot;&quot;, bool quiet=true)</div><div class="ttdoc">Request that an output port connect to an input port.</div><div class="ttdef"><b>Definition</b> <a href="Network_8cpp_source.html#l00682">Network.cpp:682</a></div></div>
<div class="ttc" id="aclassyarp_1_1os_1_1RpcClient_html"><div class="ttname"><a href="classyarp_1_1os_1_1RpcClient.html">yarp::os::RpcClient</a></div><div class="ttdoc">A port that is specialized as an RPC client.</div><div class="ttdef"><b>Definition</b> <a href="RpcClient_8h_source.html#l00021">RpcClient.h:22</a></div></div>
<div class="ttc" id="anamespaceyarp_1_1os_1_1Time_html_aca80809e0597551745954e2547e581ee"><div class="ttname"><a href="namespaceyarp_1_1os_1_1Time.html#aca80809e0597551745954e2547e581ee">yarp::os::Time::delay</a></div><div class="ttdeci">void delay(double seconds)</div><div class="ttdoc">Wait for a certain number of seconds.</div><div class="ttdef"><b>Definition</b> <a href="Time_8cpp_source.html#l00111">Time.cpp:111</a></div></div>
</div><!-- fragment --><p>The server and client communicate with <a class="el" href="classyarp_1_1os_1_1Bottle.html" title="A simple collection of objects that can be described and transmitted in a portable way.">yarp::os::Bottle</a> objects here, but as usual anything that implements <a class="el" href="classyarp_1_1os_1_1Portable.html" title="This is a base class for objects that can be both read from and be written to the YARP network.">yarp::os::Portable</a> can be used.</p>
<h1><a class="anchor" id="rpc_ports_sniffing"></a>
Monitoring RPC communication</h1>
<p>Normal streaming communication in YARP is very easy to monitor, just connect another port to the sender. For RPC communication, we have to be a bit more careful.</p>
<p>Suppose the server and client above are running (the source code is in example/os/rpc_server/rpc_server.cpp and example/os/rpc_client/rpc_client.cpp), in two separate terminals, as follows: </p><pre class="fragment">./rpc_server /server
./rpc_client /client /server
</pre><p> Here we have named the server port <code>/server</code> and the client port <code>/client</code>. Every second or so, the client sends a message to the server with a count in it, and the server replies with "you said" followed by that message.</p>
<p>How can we monitor this traffic remotely? YARP supports a special kind of logging connection called <code>log.in</code> which can report all the <em>inputs</em> a port is receiving (along with the corresponding replies). We make a connection from the <em>server</em> (not the <em>client</em>) to a logging port, set the connection to <code>log.in</code> mode, and we are done.</p>
<p>The syntax for doing so is either: </p><pre class="fragment">yarp read /read tcp+log.in://server
</pre><p>Or equivalently: </p><pre class="fragment">yarp read /read
yarp connect /server /read tcp+log.in
</pre><p>The protocol in this case is specified to be tcp (which is the default), but with an added <code>+log.in</code> decoration. This is a "carrier modifier" that tells YARP that the connection has a special purpose, in this case to log traffic that arrives at the <code>/server</code> port. Without that modifier, this connection would be forbidden if the RPC server is already connected to a client, and even if it were allowed it would misbehave.</p>
<p>The output shown by the "yarp read" command will be something like this: </p><pre class="fragment">[rpc] (COUNT 29) (you said COUNT 29)
[rpc] (COUNT 30) (you said COUNT 30)
[rpc] (COUNT 31) (you said COUNT 31)
[rpc] (COUNT 32) (you said COUNT 32)
[rpc] (COUNT 33) (you said COUNT 33)
[rpc] (COUNT 34) (you said COUNT 34)
[rpc] (COUNT 35) (you said COUNT 35)
[rpc] (COUNT 36) (you said COUNT 36)
</pre><p> The first element is a tag for RPC traffic. The second element is a nested list describing the input received by the port. The third element is a nested list describing the corresponding output produced by the port.</p>
<p>Note that we log from the <em>server</em> side, because we are logging inputs. At this time YARP does not have a <code>log.out</code> mode for logging outputs with their replies.</p>
<p>The logging connection will pass along any envelope or timestamp associated with the input, and will lack an envelope if the input lacks an envelope. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.9.1-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li><span id="projectname_footer">YARP</span></li>
    <li><span id="projectnumber" class="version_switch">3.8.1</span></li>
    <li class="footer">Generated on Wed Sep 13 2023 08:44:46 for YARP by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8 </li>
  </ul>
</div>
</body>
</html>
